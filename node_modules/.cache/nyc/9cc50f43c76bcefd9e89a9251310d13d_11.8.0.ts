"use strict";/*
 * Copyright Â© 2018 Atomist, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cov_205u0yaes7=function(){var path="/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/blueprint/DefaultSoftwareDeliveryMachine.ts",hash="78e6e03cfacb9e48604fd1fe51036849b5efe2e6",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/blueprint/DefaultSoftwareDeliveryMachine.ts",statementMap:{"0":{start:{line:17,column:0},end:{line:17,column:62}},"1":{start:{line:18,column:10},end:{line:18,column:27}},"2":{start:{line:19,column:25},end:{line:19,column:63}},"3":{start:{line:20,column:21},end:{line:20,column:70}},"4":{start:{line:21,column:25},end:{line:21,column:78}},"5":{start:{line:22,column:27},end:{line:22,column:86}},"6":{start:{line:23,column:31},end:{line:23,column:86}},"7":{start:{line:24,column:32},end:{line:24,column:100}},"8":{start:{line:25,column:24},end:{line:25,column:79}},"9":{start:{line:26,column:26},end:{line:26,column:78}},"10":{start:{line:27,column:26},end:{line:27,column:85}},"11":{start:{line:28,column:23},end:{line:28,column:67}},"12":{start:{line:29,column:25},end:{line:29,column:84}},"13":{start:{line:30,column:42},end:{line:30,column:94}},"14":{start:{line:78,column:8},end:{line:78,column:26}},"15":{start:{line:79,column:8},end:{line:79,column:50}},"16":{start:{line:80,column:8},end:{line:80,column:161}},"17":{start:{line:81,column:8},end:{line:91,column:158}},"18":{start:{line:92,column:8},end:{line:92,column:80}},"19":{start:{line:95,column:0},end:{line:95,column:72}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:77,column:4},end:{line:77,column:5}},loc:{start:{line:77,column:44},end:{line:93,column:5}},line:77}},branchMap:{},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0},f:{"0":0},b:{},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();cov_205u0yaes7.s[0]++;Object.defineProperty(exports,"__esModule",{value:true});const _=(cov_205u0yaes7.s[1]++,require("lodash"));const wellKnownGoals_1=(cov_205u0yaes7.s[2]++,require("../blueprint/wellKnownGoals"));const createRepo_1=(cov_205u0yaes7.s[3]++,require("../common/command/generator/createRepo"));const listGenerators_1=(cov_205u0yaes7.s[4]++,require("../common/command/generator/listGenerators"));const executeAutofixes_1=(cov_205u0yaes7.s[5]++,require("../common/delivery/code/autofix/executeAutofixes"));const executePushReactions_1=(cov_205u0yaes7.s[6]++,require("../common/delivery/code/executePushReactions"));const executeFingerprinting_1=(cov_205u0yaes7.s[7]++,require("../common/delivery/code/fingerprint/executeFingerprinting"));const executeReview_1=(cov_205u0yaes7.s[8]++,require("../common/delivery/code/review/executeReview"));const executeUndeploy_1=(cov_205u0yaes7.s[9]++,require("../common/delivery/deploy/executeUndeploy"));const logInterpreters_1=(cov_205u0yaes7.s[10]++,require("../common/delivery/goals/support/logInterpreters"));const SelfDescribe_1=(cov_205u0yaes7.s[11]++,require("../handlers/commands/SelfDescribe"));const SetGoalsOnPush_1=(cov_205u0yaes7.s[12]++,require("../handlers/events/delivery/goals/SetGoalsOnPush"));const AbstractSoftwareDeliveryMachine_1=(cov_205u0yaes7.s[13]++,require("./support/AbstractSoftwareDeliveryMachine"));/**
 * Class instantiated to create a **Software Delivery Machine**.
 * Combines commands and delivery event handling using _goals_.
 *
 * Goals and goal "implementations" can be defined by users.
 * However, certain well known goals are built into the DefaultSoftwareDeliveryMachine
 * for convenience, with their own associated listeners.
 *
 * Well known goal support is based around a delivery process spanning
 * common goals of fingerprinting, reacting to fingerprint diffs,
 * code review, build, deployment, endpoint verification and
 * promotion to a production environment.
 *
 * The most important element of a software delivery machine is setting
 * zero or more _push rules_ in the constructor.
 * This is normally done using the internal DSL as follows:
 *
 * ```
 * const sdm = new DefaultSoftwareDeliveryMachine(
 *    "MyMachine",
 *    options,
 *    whenPushSatisfies(IsMaven, HasSpringBootApplicationClass, not(MaterialChangeToJavaRepo))
 *      .itMeans("No material change to Java")
 *      .setGoals(NoGoals),
 *    whenPushSatisfies(ToDefaultBranch, IsMaven, HasSpringBootApplicationClass, HasCloudFoundryManifest)
 *      .itMeans("Spring Boot service to deploy")
 *      .setGoals(HttpServiceGoals));
 * ```
 *
 * Uses the builder pattern to allow fluent construction. For example:
 *
 * ```
 * softwareDeliveryMachine
 *    .addPushReactions(async pu => ...)
 *    .addNewIssueListeners(async i => ...)
 *    .add...;
 * ```
 */class DefaultSoftwareDeliveryMachine extends(AbstractSoftwareDeliveryMachine_1.AbstractSoftwareDeliveryMachine){/**
     * Construct a new software delivery machine, with zero or
     * more goal setters.
     * @param {string} name
     * @param {SoftwareDeliveryMachineOptions} opts
     * @param {GoalSetter} goalSetters tell me what to do on a push. Hint: start with "whenPushSatisfies(...)"
     */constructor(name,opts,...goalSetters){cov_205u0yaes7.f[0]++;cov_205u0yaes7.s[14]++;super(name,opts);cov_205u0yaes7.s[15]++;this.goalSetters=_.flatten(goalSetters);cov_205u0yaes7.s[16]++;this.addSupportingCommands(SelfDescribe_1.selfDescribeHandler(this),listGenerators_1.listGeneratorsHandler(this),createRepo_1.createRepoHandler(this));cov_205u0yaes7.s[17]++;this.addGoalImplementation("Autofix",wellKnownGoals_1.AutofixGoal,executeAutofixes_1.executeAutofixes(this.opts.projectLoader,this.autofixRegistrations),{// Autofix errors should not be reported to the user
logInterpreter:logInterpreters_1.LogSuppressor}).addGoalImplementation("DoNothing",wellKnownGoals_1.NoGoal,SetGoalsOnPush_1.executeImmaterial).addGoalImplementation("FingerprinterRegistration",wellKnownGoals_1.FingerprintGoal,executeFingerprinting_1.executeFingerprinting(this.opts.projectLoader,this.fingerprinterRegistrations,this.fingerprintListeners)).addGoalImplementation("CodeReactions",wellKnownGoals_1.PushReactionGoal,executePushReactions_1.executePushReactions(this.opts.projectLoader,this.pushReactionRegistrations)).addGoalImplementation("Reviews",wellKnownGoals_1.ReviewGoal,executeReview_1.executeReview(this.opts.projectLoader,this.reviewerRegistrations,this.reviewListeners)).addVerifyImplementation().addGoalImplementation("OfferToDeleteRepo",wellKnownGoals_1.DeleteRepositoryGoal,executeUndeploy_1.offerToDeleteRepository()).addGoalImplementation("OfferToDeleteRepoAfterUndeploys",wellKnownGoals_1.DeleteAfterUndeploysGoal,executeUndeploy_1.offerToDeleteRepository());cov_205u0yaes7.s[18]++;this.knownSideEffect(wellKnownGoals_1.ArtifactGoal,"from ImageLinked");}}cov_205u0yaes7.s[19]++;exports.DefaultSoftwareDeliveryMachine=DefaultSoftwareDeliveryMachine;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL3JvZGpvaG5zb24vc2ZvcnphbmRvLWRldi9pZGVhLXByb2plY3RzL215LWZsb3cvc3JjL2JsdWVwcmludC9EZWZhdWx0U29mdHdhcmVEZWxpdmVyeU1hY2hpbmUudHMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2Rqb2huc29uL3Nmb3J6YW5kby1kZXYvaWRlYS1wcm9qZWN0cy9teS1mbG93L3NyYy9ibHVlcHJpbnQvRGVmYXVsdFNvZnR3YXJlRGVsaXZlcnlNYWNoaW5lLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7Ozs7R0FjRzs7QUFFSCw0QkFBNEI7QUFDNUIsZ0VBU3FDO0FBQ3JDLHVFQUEyRTtBQUMzRSwrRUFBbUY7QUFDbkYsdUZBQW9GO0FBQ3BGLHVGQUFvRjtBQUNwRixxR0FBa0c7QUFDbEcsZ0ZBQTZFO0FBQzdFLCtFQUFvRjtBQUNwRixzRkFBaUY7QUFFakYsb0VBQXdFO0FBQ3hFLHFGQUFxRjtBQUVyRiwrRkFBNEY7QUFFNUY7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FxQ0c7QUFDSCxvQ0FBNEMsU0FBUSxpRUFBK0I7SUFFL0U7Ozs7OztPQU1HO0lBQ0gsWUFBWSxJQUFZLEVBQ1osSUFBb0MsRUFDcEMsR0FBRyxXQUE2QztRQUN4RCxLQUFLLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ2xCLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUMxQyxJQUFJLENBQUMscUJBQXFCLENBQ3RCLGtDQUFtQixDQUFDLElBQUksQ0FBQyxFQUN6QixzQ0FBcUIsQ0FBQyxJQUFJLENBQUMsRUFDM0IsOEJBQWlCLENBQUMsSUFBSSxDQUFDLENBQzFCLENBQUM7UUFFRixJQUFJLENBQUMscUJBQXFCLENBQUMsU0FBUyxFQUFFLDRCQUFXLEVBQzdDLG1DQUFnQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxFQUFFO1lBQ2xFLG9EQUFvRDtZQUNwRCxjQUFjLEVBQUUsK0JBQWE7U0FDaEMsQ0FBQzthQUNELHFCQUFxQixDQUFDLFdBQVcsRUFBRSx1QkFBTSxFQUFFLGtDQUFpQixDQUFDO2FBQzdELHFCQUFxQixDQUFDLDJCQUEyQixFQUFFLGdDQUFlLEVBQy9ELDZDQUFxQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQywwQkFBMEIsRUFBRSxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQzthQUM5RyxxQkFBcUIsQ0FBQyxlQUFlLEVBQUUsaUNBQWdCLEVBQ3BELDJDQUFvQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO2FBQ2pGLHFCQUFxQixDQUFDLFNBQVMsRUFBRSwyQkFBVSxFQUN4Qyw2QkFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7YUFDNUYsdUJBQXVCLEVBQUU7YUFDekIscUJBQXFCLENBQUMsbUJBQW1CLEVBQUUscUNBQW9CLEVBQzVELHlDQUF1QixFQUFFLENBQUM7YUFDN0IscUJBQXFCLENBQUMsaUNBQWlDLEVBQUUseUNBQXdCLEVBQzlFLHlDQUF1QixFQUFFLENBQUMsQ0FBQztRQUNuQyxJQUFJLENBQUMsZUFBZSxDQUFDLDZCQUFZLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztJQUMzRCxDQUFDO0NBRUo7QUF4Q0Qsd0VBd0NDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCDCqSAyMDE4IEF0b21pc3QsIEluYy5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0ICogYXMgXyBmcm9tIFwibG9kYXNoXCI7XG5pbXBvcnQge1xuICAgIEFydGlmYWN0R29hbCxcbiAgICBBdXRvZml4R29hbCxcbiAgICBEZWxldGVBZnRlclVuZGVwbG95c0dvYWwsXG4gICAgRGVsZXRlUmVwb3NpdG9yeUdvYWwsXG4gICAgRmluZ2VycHJpbnRHb2FsLFxuICAgIE5vR29hbCxcbiAgICBQdXNoUmVhY3Rpb25Hb2FsLFxuICAgIFJldmlld0dvYWwsXG59IGZyb20gXCIuLi9ibHVlcHJpbnQvd2VsbEtub3duR29hbHNcIjtcbmltcG9ydCB7IGNyZWF0ZVJlcG9IYW5kbGVyIH0gZnJvbSBcIi4uL2NvbW1vbi9jb21tYW5kL2dlbmVyYXRvci9jcmVhdGVSZXBvXCI7XG5pbXBvcnQgeyBsaXN0R2VuZXJhdG9yc0hhbmRsZXIgfSBmcm9tIFwiLi4vY29tbW9uL2NvbW1hbmQvZ2VuZXJhdG9yL2xpc3RHZW5lcmF0b3JzXCI7XG5pbXBvcnQgeyBleGVjdXRlQXV0b2ZpeGVzIH0gZnJvbSBcIi4uL2NvbW1vbi9kZWxpdmVyeS9jb2RlL2F1dG9maXgvZXhlY3V0ZUF1dG9maXhlc1wiO1xuaW1wb3J0IHsgZXhlY3V0ZVB1c2hSZWFjdGlvbnMgfSBmcm9tIFwiLi4vY29tbW9uL2RlbGl2ZXJ5L2NvZGUvZXhlY3V0ZVB1c2hSZWFjdGlvbnNcIjtcbmltcG9ydCB7IGV4ZWN1dGVGaW5nZXJwcmludGluZyB9IGZyb20gXCIuLi9jb21tb24vZGVsaXZlcnkvY29kZS9maW5nZXJwcmludC9leGVjdXRlRmluZ2VycHJpbnRpbmdcIjtcbmltcG9ydCB7IGV4ZWN1dGVSZXZpZXcgfSBmcm9tIFwiLi4vY29tbW9uL2RlbGl2ZXJ5L2NvZGUvcmV2aWV3L2V4ZWN1dGVSZXZpZXdcIjtcbmltcG9ydCB7IG9mZmVyVG9EZWxldGVSZXBvc2l0b3J5IH0gZnJvbSBcIi4uL2NvbW1vbi9kZWxpdmVyeS9kZXBsb3kvZXhlY3V0ZVVuZGVwbG95XCI7XG5pbXBvcnQgeyBMb2dTdXBwcmVzc29yIH0gZnJvbSBcIi4uL2NvbW1vbi9kZWxpdmVyeS9nb2Fscy9zdXBwb3J0L2xvZ0ludGVycHJldGVyc1wiO1xuaW1wb3J0IHsgR29hbFNldHRlciB9IGZyb20gXCIuLi9jb21tb24vbGlzdGVuZXIvR29hbFNldHRlclwiO1xuaW1wb3J0IHsgc2VsZkRlc2NyaWJlSGFuZGxlciB9IGZyb20gXCIuLi9oYW5kbGVycy9jb21tYW5kcy9TZWxmRGVzY3JpYmVcIjtcbmltcG9ydCB7IGV4ZWN1dGVJbW1hdGVyaWFsIH0gZnJvbSBcIi4uL2hhbmRsZXJzL2V2ZW50cy9kZWxpdmVyeS9nb2Fscy9TZXRHb2Fsc09uUHVzaFwiO1xuaW1wb3J0IHsgU29mdHdhcmVEZWxpdmVyeU1hY2hpbmVPcHRpb25zIH0gZnJvbSBcIi4vU29mdHdhcmVEZWxpdmVyeU1hY2hpbmVPcHRpb25zXCI7XG5pbXBvcnQgeyBBYnN0cmFjdFNvZnR3YXJlRGVsaXZlcnlNYWNoaW5lIH0gZnJvbSBcIi4vc3VwcG9ydC9BYnN0cmFjdFNvZnR3YXJlRGVsaXZlcnlNYWNoaW5lXCI7XG5cbi8qKlxuICogQ2xhc3MgaW5zdGFudGlhdGVkIHRvIGNyZWF0ZSBhICoqU29mdHdhcmUgRGVsaXZlcnkgTWFjaGluZSoqLlxuICogQ29tYmluZXMgY29tbWFuZHMgYW5kIGRlbGl2ZXJ5IGV2ZW50IGhhbmRsaW5nIHVzaW5nIF9nb2Fsc18uXG4gKlxuICogR29hbHMgYW5kIGdvYWwgXCJpbXBsZW1lbnRhdGlvbnNcIiBjYW4gYmUgZGVmaW5lZCBieSB1c2Vycy5cbiAqIEhvd2V2ZXIsIGNlcnRhaW4gd2VsbCBrbm93biBnb2FscyBhcmUgYnVpbHQgaW50byB0aGUgRGVmYXVsdFNvZnR3YXJlRGVsaXZlcnlNYWNoaW5lXG4gKiBmb3IgY29udmVuaWVuY2UsIHdpdGggdGhlaXIgb3duIGFzc29jaWF0ZWQgbGlzdGVuZXJzLlxuICpcbiAqIFdlbGwga25vd24gZ29hbCBzdXBwb3J0IGlzIGJhc2VkIGFyb3VuZCBhIGRlbGl2ZXJ5IHByb2Nlc3Mgc3Bhbm5pbmdcbiAqIGNvbW1vbiBnb2FscyBvZiBmaW5nZXJwcmludGluZywgcmVhY3RpbmcgdG8gZmluZ2VycHJpbnQgZGlmZnMsXG4gKiBjb2RlIHJldmlldywgYnVpbGQsIGRlcGxveW1lbnQsIGVuZHBvaW50IHZlcmlmaWNhdGlvbiBhbmRcbiAqIHByb21vdGlvbiB0byBhIHByb2R1Y3Rpb24gZW52aXJvbm1lbnQuXG4gKlxuICogVGhlIG1vc3QgaW1wb3J0YW50IGVsZW1lbnQgb2YgYSBzb2Z0d2FyZSBkZWxpdmVyeSBtYWNoaW5lIGlzIHNldHRpbmdcbiAqIHplcm8gb3IgbW9yZSBfcHVzaCBydWxlc18gaW4gdGhlIGNvbnN0cnVjdG9yLlxuICogVGhpcyBpcyBub3JtYWxseSBkb25lIHVzaW5nIHRoZSBpbnRlcm5hbCBEU0wgYXMgZm9sbG93czpcbiAqXG4gKiBgYGBcbiAqIGNvbnN0IHNkbSA9IG5ldyBEZWZhdWx0U29mdHdhcmVEZWxpdmVyeU1hY2hpbmUoXG4gKiAgICBcIk15TWFjaGluZVwiLFxuICogICAgb3B0aW9ucyxcbiAqICAgIHdoZW5QdXNoU2F0aXNmaWVzKElzTWF2ZW4sIEhhc1NwcmluZ0Jvb3RBcHBsaWNhdGlvbkNsYXNzLCBub3QoTWF0ZXJpYWxDaGFuZ2VUb0phdmFSZXBvKSlcbiAqICAgICAgLml0TWVhbnMoXCJObyBtYXRlcmlhbCBjaGFuZ2UgdG8gSmF2YVwiKVxuICogICAgICAuc2V0R29hbHMoTm9Hb2FscyksXG4gKiAgICB3aGVuUHVzaFNhdGlzZmllcyhUb0RlZmF1bHRCcmFuY2gsIElzTWF2ZW4sIEhhc1NwcmluZ0Jvb3RBcHBsaWNhdGlvbkNsYXNzLCBIYXNDbG91ZEZvdW5kcnlNYW5pZmVzdClcbiAqICAgICAgLml0TWVhbnMoXCJTcHJpbmcgQm9vdCBzZXJ2aWNlIHRvIGRlcGxveVwiKVxuICogICAgICAuc2V0R29hbHMoSHR0cFNlcnZpY2VHb2FscykpO1xuICogYGBgXG4gKlxuICogVXNlcyB0aGUgYnVpbGRlciBwYXR0ZXJuIHRvIGFsbG93IGZsdWVudCBjb25zdHJ1Y3Rpb24uIEZvciBleGFtcGxlOlxuICpcbiAqIGBgYFxuICogc29mdHdhcmVEZWxpdmVyeU1hY2hpbmVcbiAqICAgIC5hZGRQdXNoUmVhY3Rpb25zKGFzeW5jIHB1ID0+IC4uLilcbiAqICAgIC5hZGROZXdJc3N1ZUxpc3RlbmVycyhhc3luYyBpID0+IC4uLilcbiAqICAgIC5hZGQuLi47XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGNsYXNzIERlZmF1bHRTb2Z0d2FyZURlbGl2ZXJ5TWFjaGluZSBleHRlbmRzIEFic3RyYWN0U29mdHdhcmVEZWxpdmVyeU1hY2hpbmUge1xuXG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0IGEgbmV3IHNvZnR3YXJlIGRlbGl2ZXJ5IG1hY2hpbmUsIHdpdGggemVybyBvclxuICAgICAqIG1vcmUgZ29hbCBzZXR0ZXJzLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lXG4gICAgICogQHBhcmFtIHtTb2Z0d2FyZURlbGl2ZXJ5TWFjaGluZU9wdGlvbnN9IG9wdHNcbiAgICAgKiBAcGFyYW0ge0dvYWxTZXR0ZXJ9IGdvYWxTZXR0ZXJzIHRlbGwgbWUgd2hhdCB0byBkbyBvbiBhIHB1c2guIEhpbnQ6IHN0YXJ0IHdpdGggXCJ3aGVuUHVzaFNhdGlzZmllcyguLi4pXCJcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihuYW1lOiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgb3B0czogU29mdHdhcmVEZWxpdmVyeU1hY2hpbmVPcHRpb25zLFxuICAgICAgICAgICAgICAgIC4uLmdvYWxTZXR0ZXJzOiBBcnJheTxHb2FsU2V0dGVyIHwgR29hbFNldHRlcltdPikge1xuICAgICAgICBzdXBlcihuYW1lLCBvcHRzKTtcbiAgICAgICAgdGhpcy5nb2FsU2V0dGVycyA9IF8uZmxhdHRlbihnb2FsU2V0dGVycyk7XG4gICAgICAgIHRoaXMuYWRkU3VwcG9ydGluZ0NvbW1hbmRzKFxuICAgICAgICAgICAgc2VsZkRlc2NyaWJlSGFuZGxlcih0aGlzKSxcbiAgICAgICAgICAgIGxpc3RHZW5lcmF0b3JzSGFuZGxlcih0aGlzKSxcbiAgICAgICAgICAgIGNyZWF0ZVJlcG9IYW5kbGVyKHRoaXMpLFxuICAgICAgICApO1xuXG4gICAgICAgIHRoaXMuYWRkR29hbEltcGxlbWVudGF0aW9uKFwiQXV0b2ZpeFwiLCBBdXRvZml4R29hbCxcbiAgICAgICAgICAgIGV4ZWN1dGVBdXRvZml4ZXModGhpcy5vcHRzLnByb2plY3RMb2FkZXIsIHRoaXMuYXV0b2ZpeFJlZ2lzdHJhdGlvbnMpLCB7XG4gICAgICAgICAgICAgICAgLy8gQXV0b2ZpeCBlcnJvcnMgc2hvdWxkIG5vdCBiZSByZXBvcnRlZCB0byB0aGUgdXNlclxuICAgICAgICAgICAgICAgIGxvZ0ludGVycHJldGVyOiBMb2dTdXBwcmVzc29yLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hZGRHb2FsSW1wbGVtZW50YXRpb24oXCJEb05vdGhpbmdcIiwgTm9Hb2FsLCBleGVjdXRlSW1tYXRlcmlhbClcbiAgICAgICAgICAgIC5hZGRHb2FsSW1wbGVtZW50YXRpb24oXCJGaW5nZXJwcmludGVyUmVnaXN0cmF0aW9uXCIsIEZpbmdlcnByaW50R29hbCxcbiAgICAgICAgICAgICAgICBleGVjdXRlRmluZ2VycHJpbnRpbmcodGhpcy5vcHRzLnByb2plY3RMb2FkZXIsIHRoaXMuZmluZ2VycHJpbnRlclJlZ2lzdHJhdGlvbnMsIHRoaXMuZmluZ2VycHJpbnRMaXN0ZW5lcnMpKVxuICAgICAgICAgICAgLmFkZEdvYWxJbXBsZW1lbnRhdGlvbihcIkNvZGVSZWFjdGlvbnNcIiwgUHVzaFJlYWN0aW9uR29hbCxcbiAgICAgICAgICAgICAgICBleGVjdXRlUHVzaFJlYWN0aW9ucyh0aGlzLm9wdHMucHJvamVjdExvYWRlciwgdGhpcy5wdXNoUmVhY3Rpb25SZWdpc3RyYXRpb25zKSlcbiAgICAgICAgICAgIC5hZGRHb2FsSW1wbGVtZW50YXRpb24oXCJSZXZpZXdzXCIsIFJldmlld0dvYWwsXG4gICAgICAgICAgICAgICAgZXhlY3V0ZVJldmlldyh0aGlzLm9wdHMucHJvamVjdExvYWRlciwgdGhpcy5yZXZpZXdlclJlZ2lzdHJhdGlvbnMsIHRoaXMucmV2aWV3TGlzdGVuZXJzKSlcbiAgICAgICAgICAgIC5hZGRWZXJpZnlJbXBsZW1lbnRhdGlvbigpXG4gICAgICAgICAgICAuYWRkR29hbEltcGxlbWVudGF0aW9uKFwiT2ZmZXJUb0RlbGV0ZVJlcG9cIiwgRGVsZXRlUmVwb3NpdG9yeUdvYWwsXG4gICAgICAgICAgICAgICAgb2ZmZXJUb0RlbGV0ZVJlcG9zaXRvcnkoKSlcbiAgICAgICAgICAgIC5hZGRHb2FsSW1wbGVtZW50YXRpb24oXCJPZmZlclRvRGVsZXRlUmVwb0FmdGVyVW5kZXBsb3lzXCIsIERlbGV0ZUFmdGVyVW5kZXBsb3lzR29hbCxcbiAgICAgICAgICAgICAgICBvZmZlclRvRGVsZXRlUmVwb3NpdG9yeSgpKTtcbiAgICAgICAgdGhpcy5rbm93blNpZGVFZmZlY3QoQXJ0aWZhY3RHb2FsLCBcImZyb20gSW1hZ2VMaW5rZWRcIik7XG4gICAgfVxuXG59XG4iXX0=