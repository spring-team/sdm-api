{"version":3,"file":"/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/common/delivery/deploy/pcf/CloudFoundryApi.ts","sources":["/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/common/delivery/deploy/pcf/CloudFoundryApi.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright © 2018 Atomist, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CloudFoundryInfo } from \"./CloudFoundryTarget\";\n\nimport { AxiosResponse } from \"axios\";\n\nimport axios from \"axios\";\nimport FormData = require(\"form-data\");\nimport {ReadStream} from \"fs\";\nimport * as _ from \"lodash\";\nimport request = require(\"request\");\nimport {ManifestApplication} from \"./CloudFoundryManifest\";\n\nimport {doWithRetry} from \"@atomist/automation-client/util/retry\";\nimport cfClient = require(\"cf-client\");\n\nexport interface CloudFoundryClientV2 {\n    api_url: string;\n    token: any;\n    usersUaa: any;\n    apps: any;\n    domains: any;\n    spaces: any;\n    serviceBindings: any;\n    userProvidedServices: any;\n    routes: any;\n}\n\nexport async function initializeCloudFoundry(cfi: CloudFoundryInfo): Promise<CloudFoundryClientV2> {\n    const cloudController = new cfClient.CloudController(cfi.api);\n    const endpoint = await cloudController.getInfo();\n    const usersUaa = new cfClient.UsersUAA();\n    usersUaa.setEndPoint(endpoint.authorization_endpoint);\n    const token = await usersUaa.login(cfi.username, cfi.password);\n    usersUaa.setToken(token);\n    const cf = {\n        api_url: cfi.api,\n        token,\n        usersUaa,\n        apps: new cfClient.Apps(cfi.api),\n        domains: new cfClient.Domains(cfi.api),\n        spaces: new cfClient.Spaces(cfi.api),\n        serviceBindings: new cfClient.ServiceBindings(cfi.api),\n        userProvidedServices: new cfClient.UserProvidedServices(cfi.api),\n        routes: new cfClient.Routes(cfi.api),\n    };\n    return cf;\n}\n\n/**\n * This abstracts away the details of common CF API operations.\n * The implementations use a mix of API versions and HTTP libs and will likely change.\n */\nexport class CloudFoundryApi {\n\n    private authHeader;\n    private readonly jsonContentHeader = {\n        \"Content-Type\": \"application/json\",\n    };\n\n    constructor(private readonly cf: CloudFoundryClientV2,\n                private readonly retryInterval: number = 1000) {\n    }\n\n    private async refreshToken() {\n        const newToken = await this.cf.usersUaa.refreshToken();\n        this.cf.token = newToken;\n        this.authHeader = {\n            Authorization: `${newToken.token_type} ${newToken.access_token}`,\n        };\n        this.cf.usersUaa.setToken(newToken);\n        this.cf.apps.setToken(newToken);\n        this.cf.domains.setToken(newToken);\n        this.cf.spaces.setToken(newToken);\n        this.cf.serviceBindings.setToken(newToken);\n        this.cf.userProvidedServices.setToken(newToken);\n        this.cf.routes.setToken(newToken);\n    }\n\n    private async retryUntilCondition(action: () => Promise<AxiosResponse>,\n                                      successCondition: (r: AxiosResponse) => boolean,\n                                      failureCondition: (r: AxiosResponse) => boolean): Promise<AxiosResponse> {\n        const result = await action();\n        if (successCondition(result)) {\n            return result;\n        }\n        if (failureCondition(result)) {\n            throw {\n                name: \"RetryUntilConditionFailure\",\n                message: JSON.stringify(result.data),\n            } as Error;\n        }\n        await new Promise<AxiosResponse>(res => setTimeout(res, this.retryInterval));\n        return this.retryUntilCondition(action, successCondition, failureCondition);\n    }\n\n    public async stopApp(appGuid: string): Promise<AxiosResponse<any>> {\n        await this.refreshToken();\n        return doWithRetry(() => axios.post(\n            `${this.cf.api_url}/v3/apps/${appGuid}/actions/stop`,\n            undefined,\n            { headers: this.authHeader},\n        ), `stop app ${appGuid}`);\n    }\n\n    public async startApp(appGuid: string): Promise<AxiosResponse<any>> {\n        await this.refreshToken();\n        await doWithRetry(() => axios.post(\n            `${this.cf.api_url}/v3/apps/${appGuid}/actions/start`,\n            undefined,\n            { headers: this.authHeader},\n        ), `start app ${appGuid}`);\n        return this.retryUntilCondition(\n            async () => {\n                await this.refreshToken();\n                return this.getProcessStats(appGuid);\n            },\n            r => _.every(r.data.resources, (p: any) => p.state === \"RUNNING\"),\n            r => _.every(r.data.resources, (p: any) => p.state === \"CRASHED\"),\n        );\n    }\n\n    public async getApp(spaceGuid: string, appName: string): Promise<any> {\n        await this.refreshToken();\n        const apps = await this.cf.spaces.getSpaceApps(spaceGuid, {\n            q: `name:${appName}`,\n        });\n        return _.head(apps.resources);\n    }\n\n    public async createApp(spaceGuid: string, manifestApp: ManifestApplication): Promise<any> {\n        await this.refreshToken();\n        return this.cf.apps.add({\n            \"name\": manifestApp.name,\n            \"space_guid\": spaceGuid,\n            \"memory\": this.normalizeManifestMemory(manifestApp.memory),\n            \"instances\": manifestApp.instances,\n            \"disk_quota\": manifestApp.disk_quota,\n            \"command\": manifestApp.command,\n            \"buildpack\": manifestApp.buildpack,\n            \"health-check-type\": manifestApp[\"health-check-type\"],\n            \"health_check_timeout\": manifestApp.timeout,\n            \"environment_json\": manifestApp.env,\n        });\n    }\n\n    public async updateAppWithManifest(appGuid: string, manifestApp: ManifestApplication): Promise<any> {\n        await this.refreshToken();\n        return this.cf.apps.update(appGuid, {\n            \"memory\": this.normalizeManifestMemory(manifestApp.memory),\n            \"instances\": manifestApp.instances,\n            \"disk_quota\": manifestApp.disk_quota,\n            \"command\": manifestApp.command,\n            \"buildpack\": manifestApp.buildpack,\n            \"health-check-type\": manifestApp[\"health-check-type\"],\n            \"health_check_timeout\": manifestApp.timeout,\n            \"environment_json\": manifestApp.env,\n        });\n    }\n\n    public async renameApp(appGuid: string, appName: string): Promise<any> {\n        await this.refreshToken();\n        return doWithRetry(() => axios.patch(\n            `${this.cf.api_url}/v3/apps/${appGuid}`,\n            {\n                name: appName,\n            },\n            {headers: _.assign({}, this.authHeader, this.jsonContentHeader)},\n        ), `rename app ${appGuid} to ${appName}`);\n    }\n\n    private normalizeManifestMemory(memory: string): number {\n        if (memory.endsWith(\"M\")) {\n            return +memory.replace(\"M\", \"\");\n        } else if (memory.endsWith(\"G\")) {\n            return +memory.replace(\"G\", \"\") * 1000;\n        }\n    }\n\n    public async deleteApp(appGuid: string): Promise<AxiosResponse<any>> {\n        await this.refreshToken();\n        return doWithRetry(() => axios.delete(\n            `${this.cf.api_url}/v3/apps/${appGuid}`,\n            { headers: this.authHeader},\n        ), `delete app ${appGuid}`);\n    }\n\n    public async getProcessStats(appGuid: string): Promise<AxiosResponse<any>> {\n        await this.refreshToken();\n        return doWithRetry(() => axios.get(\n            `${this.cf.api_url}/v3/processes/${appGuid}/stats`,\n            { headers: this.authHeader},\n        ), `get process stats ${appGuid}`);\n    }\n\n    public async uploadPackage(appGuid: string, packageFile: ReadStream): Promise<AxiosResponse<any>> {\n        await this.refreshToken();\n        const packageCreateResult = await doWithRetry(() => axios.post(`${this.cf.api_url}/v3/packages`, {\n            type: \"bits\",\n            relationships: {\n                app: {\n                    data: {\n                        guid: appGuid,\n                    },\n                },\n            },\n        }, {headers: _.assign({}, this.authHeader, this.jsonContentHeader)}),\n            `create package ${appGuid}`);\n        const formData = FormData();\n        formData.maxDataSize = Infinity;\n        formData.append(\"bits\", packageFile);\n        const uploadHeaders = _.assign({}, this.authHeader, formData.getHeaders());\n        const options = {\n            method: \"POST\",\n            url: packageCreateResult.data.links.upload.href,\n            headers: uploadHeaders,\n            formData:\n                {\n                    bits: packageFile,\n                },\n        };\n        request(options, (error, response, body) => {\n            if (error) { throw new Error(error); }\n        });\n        return this.retryUntilCondition(\n            async () => {\n                await this.refreshToken();\n                return doWithRetry(() =>\n                        axios.get(packageCreateResult.data.links.self.href, { headers: this.authHeader}),\n                    `get package ${packageCreateResult.data.guid}`);\n            },\n            r => r.data.state === \"READY\",\n            r => r.data.state === \"FAILED\",\n        );\n    }\n\n    public async buildDroplet(packageGuid: string): Promise<AxiosResponse<any>> {\n        await this.refreshToken();\n        const buildResult = await doWithRetry(() => axios.post(`${this.cf.api_url}/v3/builds`, {\n                package: {\n                    guid: packageGuid,\n                },\n            },\n            {headers: _.assign({}, this.authHeader, this.jsonContentHeader)}),\n            `build droplet ${packageGuid}`);\n        return this.retryUntilCondition(\n            async () => {\n                await this.refreshToken();\n                return doWithRetry(() => axios.get(buildResult.data.links.self.href, {headers: this.authHeader}),\n                    `get build for package ${buildResult.data.guid}`);\n                },\n                r => r.data.state === \"STAGED\",\n            r => r.data.state === \"FAILED\" || r.data.state === \"EXPIRED\",\n        );\n    }\n\n    public async setCurrentDropletForApp(appGuid: string, dropletGuid: string): Promise<AxiosResponse<any>> {\n        await this.refreshToken();\n        return doWithRetry(() => axios.patch(\n            `${this.cf.api_url}/v3/apps/${appGuid}/relationships/current_droplet`,\n            { data: { guid: dropletGuid } },\n            { headers: _.assign({}, this.authHeader, this.jsonContentHeader)},\n        ), `set current droplet for app ${appGuid}`);\n    }\n\n    public async getAppServiceBindings(appGuid: string): Promise<any[]> {\n        await this.refreshToken();\n        const bindings = await this.cf.apps.getServiceBindings(appGuid);\n        return bindings.resources;\n    }\n\n    public async getUserServices(): Promise<any[]> {\n        await this.refreshToken();\n        const services = await this.cf.userProvidedServices.getServices();\n        return services.resources;\n    }\n\n    public async addServices(appGuid: string, servicesToAdd: any[]): Promise<any> {\n        await this.refreshToken();\n        return servicesToAdd.map(service => {\n            this.cf.serviceBindings.associateServiceWithApp(service.metadata.guid, appGuid);\n        });\n    }\n\n    public async removeServices(appGuid: string, serviceToRemove: any[]): Promise<any> {\n        await this.refreshToken();\n        return serviceToRemove.forEach(service => {\n            this.cf.apps.removeServiceBindings(appGuid, service.metadata.guid);\n        });\n    }\n\n    public async getAppRoutes(appGuid: string): Promise<any> {\n        await this.refreshToken();\n        const result = await this.cf.apps.getAppRoutes(appGuid);\n        return result.resources;\n    }\n\n    public async addRouteToApp(spaceGuid: string, appGuid: string, hostName: string, domainGuid: string): Promise<any> {\n        await this.refreshToken();\n        const routesMatchingHost = await this.cf.routes.getRoutes({q: `host:${hostName}`});\n        const existingRoute = routesMatchingHost.resources.find(r =>\n            r.entity.domain_guid === domainGuid && r.entity.space_guid === spaceGuid);\n        const route = existingRoute ? existingRoute : await this.cf.routes.add({\n            domain_guid: domainGuid,\n            space_guid: spaceGuid,\n            host: hostName,\n        });\n        return this.cf.apps.associateRoute(appGuid, route.metadata.guid);\n    }\n\n    public async getDomain(domainName: string): Promise<any> {\n        await this.refreshToken();\n        const domains = await this.cf.domains.getSharedDomains();\n        return domains.resources.find(d => d.entity.name === domainName);\n    }\n\n    public async getDomainByGuid(domainGuid: string): Promise<any> {\n        await this.refreshToken();\n        const domains = await this.cf.domains.getSharedDomains();\n        return domains.resources.find(d => d.metadata.guid === domainGuid);\n    }\n\n    public async removeRouteFromApp(spaceGuid: string, appGuid: string, hostName: string, domainName: string): Promise<any> {\n        await this.refreshToken();\n        const appRoutes = await this.getAppRoutes(appGuid);\n        const domains = await this.cf.domains.getSharedDomains();\n        const domain = domains.resources.find(d => d.entity.name === domainName);\n        const domainGuid = domain.metadata.guid;\n        const existingRoute = appRoutes.find(r =>\n            r.entity.host === hostName && r.entity.domain_guid === domainGuid && r.entity.space_guid === spaceGuid);\n        if (existingRoute) {\n            return this.cf.apps.dissociateRoute(appGuid, existingRoute.metadata.guid);\n        }\n        return undefined;\n    }\n\n    public async getSpaceByName(spaceName: string): Promise<any> {\n        await this.refreshToken();\n        const spaces = await this.cf.spaces.getSpaces({q: `name:${spaceName}`});\n        return _.head(spaces.resources);\n    }\n\n}\n"]}