"use strict";/*
 * Copyright Â© 2018 Atomist, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cov_2bftvvt22u=function(){var path="/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/handlers/events/delivery/goals/k8s/launchGoalK8.ts",hash="51a9a86a341a0b8be0a78813f3ab5dcdc4851096",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/handlers/events/delivery/goals/k8s/launchGoalK8.ts",statementMap:{"0":{start:{line:17,column:16},end:{line:24,column:1}},"1":{start:{line:18,column:4},end:{line:23,column:7}},"2":{start:{line:19,column:36},end:{line:19,column:97}},"3":{start:{line:19,column:42},end:{line:19,column:70}},"4":{start:{line:19,column:85},end:{line:19,column:95}},"5":{start:{line:20,column:35},end:{line:20,column:100}},"6":{start:{line:20,column:41},end:{line:20,column:73}},"7":{start:{line:20,column:88},end:{line:20,column:98}},"8":{start:{line:21,column:32},end:{line:21,column:149}},"9":{start:{line:21,column:97},end:{line:21,column:119}},"10":{start:{line:22,column:8},end:{line:22,column:78}},"11":{start:{line:25,column:0},end:{line:25,column:62}},"12":{start:{line:26,column:24},end:{line:26,column:75}},"13":{start:{line:27,column:11},end:{line:27,column:30}},"14":{start:{line:28,column:13},end:{line:28,column:28}},"15":{start:{line:29,column:37},end:{line:29,column:100}},"16":{start:{line:30,column:18},end:{line:30,column:61}},"17":{start:{line:39,column:0},end:{line:106,column:3}},"18":{start:{line:39,column:69},end:{line:106,column:2}},"19":{start:{line:40,column:27},end:{line:40,column:108}},"20":{start:{line:41,column:32},end:{line:41,column:85}},"21":{start:{line:42,column:16},end:{line:42,column:77}},"22":{start:{line:43,column:17},end:{line:48,column:6}},"23":{start:{line:47,column:29},end:{line:47,column:39}},"24":{start:{line:49,column:4},end:{line:51,column:5}},"25":{start:{line:50,column:8},end:{line:50,column:22}},"26":{start:{line:52,column:20},end:{line:52,column:39}},"27":{start:{line:53,column:26},end:{line:53,column:64}},"28":{start:{line:54,column:4},end:{line:54,column:47}},"29":{start:{line:55,column:4},end:{line:56,column:101}},"30":{start:{line:57,column:4},end:{line:57,column:53}},"31":{start:{line:58,column:4},end:{line:58,column:55}},"32":{start:{line:59,column:4},end:{line:59,column:74}},"33":{start:{line:60,column:4},end:{line:78,column:7}},"34":{start:{line:79,column:21},end:{line:79,column:49}},"35":{start:{line:80,column:4},end:{line:80,column:67}},"36":{start:{line:82,column:4},end:{line:87,column:7}},"37":{start:{line:86,column:29},end:{line:86,column:39}},"38":{start:{line:88,column:4},end:{line:103,column:5}},"39":{start:{line:89,column:8},end:{line:94,column:11}},"40":{start:{line:93,column:33},end:{line:93,column:43}},"41":{start:{line:97,column:8},end:{line:102,column:11}},"42":{start:{line:101,column:33},end:{line:101,column:43}},"43":{start:{line:107,column:16},end:{line:121,column:4}},"44":{start:{line:130,column:4},end:{line:137,column:7}},"45":{start:{line:131,column:31},end:{line:131,column:77}},"46":{start:{line:132,column:28},end:{line:132,column:71}},"47":{start:{line:133,column:8},end:{line:136,column:18}},"48":{start:{line:139,column:0},end:{line:139,column:52}},"49":{start:{line:141,column:4},end:{line:149,column:7}},"50":{start:{line:142,column:25},end:{line:142,column:66}},"51":{start:{line:143,column:8},end:{line:148,column:9}},"52":{start:{line:144,column:12},end:{line:144,column:60}},"53":{start:{line:147,column:12},end:{line:147,column:29}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:17,column:44},end:{line:17,column:45}},loc:{start:{line:17,column:89},end:{line:24,column:1}},line:17},"1":{name:"(anonymous_1)",decl:{start:{line:18,column:36},end:{line:18,column:37}},loc:{start:{line:18,column:63},end:{line:23,column:5}},line:18},"2":{name:"fulfilled",decl:{start:{line:19,column:17},end:{line:19,column:26}},loc:{start:{line:19,column:34},end:{line:19,column:99}},line:19},"3":{name:"rejected",decl:{start:{line:20,column:17},end:{line:20,column:25}},loc:{start:{line:20,column:33},end:{line:20,column:102}},line:20},"4":{name:"step",decl:{start:{line:21,column:17},end:{line:21,column:21}},loc:{start:{line:21,column:30},end:{line:21,column:151}},line:21},"5":{name:"(anonymous_5)",decl:{start:{line:21,column:76},end:{line:21,column:77}},loc:{start:{line:21,column:95},end:{line:21,column:121}},line:21},"6":{name:"(anonymous_6)",decl:{start:{line:39,column:41},end:{line:39,column:42}},loc:{start:{line:39,column:69},end:{line:106,column:2}},line:39},"7":{name:"(anonymous_7)",decl:{start:{line:39,column:101},end:{line:39,column:102}},loc:{start:{line:39,column:114},end:{line:106,column:1}},line:39},"8":{name:"(anonymous_8)",decl:{start:{line:47,column:21},end:{line:47,column:22}},loc:{start:{line:47,column:29},end:{line:47,column:39}},line:47},"9":{name:"(anonymous_9)",decl:{start:{line:86,column:21},end:{line:86,column:22}},loc:{start:{line:86,column:29},end:{line:86,column:39}},line:86},"10":{name:"(anonymous_10)",decl:{start:{line:93,column:25},end:{line:93,column:26}},loc:{start:{line:93,column:33},end:{line:93,column:43}},line:93},"11":{name:"(anonymous_11)",decl:{start:{line:101,column:25},end:{line:101,column:26}},loc:{start:{line:101,column:33},end:{line:101,column:43}},line:101},"12":{name:"createKubernetesData",decl:{start:{line:129,column:9},end:{line:129,column:29}},loc:{start:{line:129,column:48},end:{line:138,column:1}},line:129},"13":{name:"(anonymous_13)",decl:{start:{line:130,column:43},end:{line:130,column:44}},loc:{start:{line:130,column:56},end:{line:137,column:5}},line:130},"14":{name:"readKubernetesSpec",decl:{start:{line:140,column:9},end:{line:140,column:27}},loc:{start:{line:140,column:37},end:{line:150,column:1}},line:140},"15":{name:"(anonymous_15)",decl:{start:{line:141,column:43},end:{line:141,column:44}},loc:{start:{line:141,column:56},end:{line:149,column:5}},line:141}},branchMap:{"0":{loc:{start:{line:17,column:16},end:{line:24,column:1}},type:"binary-expr",locations:[{start:{line:17,column:17},end:{line:17,column:21}},{start:{line:17,column:25},end:{line:17,column:39}},{start:{line:17,column:44},end:{line:24,column:1}}],line:17},"1":{loc:{start:{line:18,column:16},end:{line:18,column:34}},type:"binary-expr",locations:[{start:{line:18,column:16},end:{line:18,column:17}},{start:{line:18,column:22},end:{line:18,column:33}}],line:18},"2":{loc:{start:{line:21,column:32},end:{line:21,column:148}},type:"cond-expr",locations:[{start:{line:21,column:46},end:{line:21,column:67}},{start:{line:21,column:70},end:{line:21,column:148}}],line:21},"3":{loc:{start:{line:22,column:51},end:{line:22,column:67}},type:"binary-expr",locations:[{start:{line:22,column:51},end:{line:22,column:61}},{start:{line:22,column:65},end:{line:22,column:67}}],line:22},"4":{loc:{start:{line:40,column:27},end:{line:40,column:108}},type:"binary-expr",locations:[{start:{line:40,column:27},end:{line:40,column:62}},{start:{line:40,column:66},end:{line:40,column:108}}],line:40},"5":{loc:{start:{line:41,column:32},end:{line:41,column:85}},type:"binary-expr",locations:[{start:{line:41,column:32},end:{line:41,column:72}},{start:{line:41,column:76},end:{line:41,column:85}}],line:41},"6":{loc:{start:{line:49,column:4},end:{line:51,column:5}},type:"if",locations:[{start:{line:49,column:4},end:{line:51,column:5}},{start:{line:49,column:4},end:{line:51,column:5}}],line:49},"7":{loc:{start:{line:88,column:4},end:{line:103,column:5}},type:"if",locations:[{start:{line:88,column:4},end:{line:103,column:5}},{start:{line:88,column:4},end:{line:103,column:5}}],line:88},"8":{loc:{start:{line:143,column:8},end:{line:148,column:9}},type:"if",locations:[{start:{line:143,column:8},end:{line:148,column:9}},{start:{line:143,column:8},end:{line:148,column:9}}],line:143}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},b:{"0":[0,0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var __awaiter=(cov_2bftvvt22u.s[0]++,(cov_2bftvvt22u.b[0][0]++,this)&&(cov_2bftvvt22u.b[0][1]++,this.__awaiter)||(cov_2bftvvt22u.b[0][2]++,function(thisArg,_arguments,P,generator){cov_2bftvvt22u.f[0]++;cov_2bftvvt22u.s[1]++;return new((cov_2bftvvt22u.b[1][0]++,P)||(cov_2bftvvt22u.b[1][1]++,P=Promise))(function(resolve,reject){cov_2bftvvt22u.f[1]++;function fulfilled(value){cov_2bftvvt22u.f[2]++;cov_2bftvvt22u.s[2]++;try{cov_2bftvvt22u.s[3]++;step(generator.next(value));}catch(e){cov_2bftvvt22u.s[4]++;reject(e);}}function rejected(value){cov_2bftvvt22u.f[3]++;cov_2bftvvt22u.s[5]++;try{cov_2bftvvt22u.s[6]++;step(generator["throw"](value));}catch(e){cov_2bftvvt22u.s[7]++;reject(e);}}function step(result){cov_2bftvvt22u.f[4]++;cov_2bftvvt22u.s[8]++;result.done?(cov_2bftvvt22u.b[2][0]++,resolve(result.value)):(cov_2bftvvt22u.b[2][1]++,new P(function(resolve){cov_2bftvvt22u.f[5]++;cov_2bftvvt22u.s[9]++;resolve(result.value);}).then(fulfilled,rejected));}cov_2bftvvt22u.s[10]++;step((generator=generator.apply(thisArg,(cov_2bftvvt22u.b[3][0]++,_arguments)||(cov_2bftvvt22u.b[3][1]++,[]))).next());});}));cov_2bftvvt22u.s[11]++;Object.defineProperty(exports,"__esModule",{value:true});const configuration_1=(cov_2bftvvt22u.s[12]++,require("@atomist/automation-client/configuration"));const fs=(cov_2bftvvt22u.s[13]++,require("fs-extra"));const path=(cov_2bftvvt22u.s[14]++,require("path"));const StringCapturingProgressLog_1=(cov_2bftvvt22u.s[15]++,require("../../../../../common/log/StringCapturingProgressLog"));const spawned_1=(cov_2bftvvt22u.s[16]++,require("../../../../../util/misc/spawned"));/**
 * Launch a goal as a kubernetes job
 * @param {OnAnyRequestedSdmGoal.SdmGoal} goal
 * @param {HandlerContext} ctx
 * @param {ProgressLog} progressLog
 * @returns {Promise<HandlerResult>}
 * @constructor
 */cov_2bftvvt22u.s[17]++;exports.KubernetesIsolatedGoalLauncher=(goal,ctx,progressLog)=>{cov_2bftvvt22u.f[6]++;cov_2bftvvt22u.s[18]++;return __awaiter(this,void 0,void 0,function*(){cov_2bftvvt22u.f[7]++;const deploymentName=(cov_2bftvvt22u.s[19]++,(cov_2bftvvt22u.b[4][0]++,process.env.ATOMIST_DEPLOYMENT_NAME)||(cov_2bftvvt22u.b[4][1]++,configuration_1.configurationValue("name")));const deploymentNamespace=(cov_2bftvvt22u.s[20]++,(cov_2bftvvt22u.b[5][0]++,process.env.ATOMIST_DEPLOYMENT_NAMESPACE)||(cov_2bftvvt22u.b[5][1]++,"default"));const log=(cov_2bftvvt22u.s[21]++,new StringCapturingProgressLog_1.StringCapturingProgressLog());let result=(cov_2bftvvt22u.s[22]++,yield spawned_1.spawnAndWatch({command:"kubectl",args:["get","deployment",deploymentName,"-n",deploymentNamespace,"-o","json"]},{},log,{errorFinder:code=>{cov_2bftvvt22u.f[8]++;cov_2bftvvt22u.s[23]++;return code!==0;}}));cov_2bftvvt22u.s[24]++;if(result.code!==0){cov_2bftvvt22u.b[6][0]++;cov_2bftvvt22u.s[25]++;return result;}else{cov_2bftvvt22u.b[6][1]++;}const jobSpec=(cov_2bftvvt22u.s[26]++,JSON.parse(JobSpec));const containerSpec=(cov_2bftvvt22u.s[27]++,JSON.parse(log.log).spec.template.spec);cov_2bftvvt22u.s[28]++;jobSpec.spec.template.spec=containerSpec;cov_2bftvvt22u.s[29]++;jobSpec.metadata.name=`${deploymentName}-job-${goal.goalSetId.slice(0,7)}-${goal.uniqueName.toLocaleLowerCase()}`;cov_2bftvvt22u.s[30]++;jobSpec.metadata.namespace=deploymentNamespace;cov_2bftvvt22u.s[31]++;jobSpec.spec.template.spec.restartPolicy="Never";cov_2bftvvt22u.s[32]++;jobSpec.spec.template.spec.containers[0].name=jobSpec.metadata.name;cov_2bftvvt22u.s[33]++;jobSpec.spec.template.spec.containers[0].env.push({name:"ATOMIST_JOB_NAME",value:jobSpec.metadata.name},{name:"ATOMIST_GOAL_TEAM",value:ctx.teamId},{name:"ATOMIST_GOAL_TEAM_NAME",value:ctx.context.teamName},{name:"ATOMIST_GOAL_ID",value:goal.id},{name:"ATOMIST_CORRELATION_ID",value:ctx.correlationId},{name:"ATOMIST_ISOLATED_GOAL",value:"true"});const tempfile=(cov_2bftvvt22u.s[34]++,require("tempfile")(".json"));cov_2bftvvt22u.s[35]++;yield fs.writeFile(tempfile,JSON.stringify(jobSpec,null,2));// Check if this job was previously launched
cov_2bftvvt22u.s[36]++;result=yield spawned_1.spawnAndWatch({command:"kubectl",args:["get","job",jobSpec.metadata.name,"-n",deploymentNamespace]},{},progressLog,{errorFinder:code=>{cov_2bftvvt22u.f[9]++;cov_2bftvvt22u.s[37]++;return code!==0;}});cov_2bftvvt22u.s[38]++;if(result.code!==0){cov_2bftvvt22u.b[7][0]++;cov_2bftvvt22u.s[39]++;return spawned_1.spawnAndWatch({command:"kubectl",args:["apply","-f",tempfile]},{},progressLog,{errorFinder:code=>{cov_2bftvvt22u.f[10]++;cov_2bftvvt22u.s[40]++;return code!==0;}});}else{cov_2bftvvt22u.b[7][1]++;cov_2bftvvt22u.s[41]++;return spawned_1.spawnAndWatch({command:"kubectl",args:["replace","--force","-f",tempfile]},{},progressLog,{errorFinder:code=>{cov_2bftvvt22u.f[11]++;cov_2bftvvt22u.s[42]++;return code!==0;}});}// query kube to make sure the job got scheduled
// kubectl get job <jobname> -o json
});};const JobSpec=(cov_2bftvvt22u.s[43]++,`{
    "kind" : "Job",
    "apiVersion" : "batch/v1",
    "metadata" : {
      "name" : "sample-sdm-job",
      "namespace" : "default"
    },
    "spec" : {
      "template" : {
        "spec" : {
          "containers" : []
        }
      }
    }
  }`);/**
 * Sets kubernetes deployment specific data to an SdmGoal
 * @param {SdmGoal} goal
 * @param {KubernetesOptions} options
 * @param {GitProject} p
 * @returns {Promise<SdmGoal>}
 */function createKubernetesData(goal,options,p){cov_2bftvvt22u.f[12]++;cov_2bftvvt22u.s[44]++;return __awaiter(this,void 0,void 0,function*(){cov_2bftvvt22u.f[13]++;const deploymentSpec=(cov_2bftvvt22u.s[45]++,yield readKubernetesSpec(p,"deployment.json"));const serviceSpec=(cov_2bftvvt22u.s[46]++,yield readKubernetesSpec(p,"service.json"));cov_2bftvvt22u.s[47]++;return Object.assign({},goal,{data:JSON.stringify({kubernetes:Object.assign({},options,{deploymentSpec,serviceSpec})})});});}cov_2bftvvt22u.s[48]++;exports.createKubernetesData=createKubernetesData;function readKubernetesSpec(p,name){cov_2bftvvt22u.f[14]++;cov_2bftvvt22u.s[49]++;return __awaiter(this,void 0,void 0,function*(){cov_2bftvvt22u.f[15]++;const specPath=(cov_2bftvvt22u.s[50]++,path.join(".atomist","kubernetes",name));cov_2bftvvt22u.s[51]++;if(p.fileExistsSync(specPath)){cov_2bftvvt22u.b[8][0]++;cov_2bftvvt22u.s[52]++;return(yield p.getFile(specPath)).getContent();}else{cov_2bftvvt22u.b[8][1]++;cov_2bftvvt22u.s[53]++;return undefined;}});}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL3JvZGpvaG5zb24vc2ZvcnphbmRvLWRldi9pZGVhLXByb2plY3RzL215LWZsb3cvc3JjL2hhbmRsZXJzL2V2ZW50cy9kZWxpdmVyeS9nb2Fscy9rOHMvbGF1bmNoR29hbEs4LnRzIiwic291cmNlcyI6WyIvVXNlcnMvcm9kam9obnNvbi9zZm9yemFuZG8tZGV2L2lkZWEtcHJvamVjdHMvbXktZmxvdy9zcmMvaGFuZGxlcnMvZXZlbnRzL2RlbGl2ZXJ5L2dvYWxzL2s4cy9sYXVuY2hHb2FsSzgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7Ozs7OztHQWNHOzs7Ozs7Ozs7O0FBT0gsNEVBQThFO0FBRTlFLCtCQUErQjtBQUMvQiw2QkFBNkI7QUFDN0IscUdBQWtHO0FBSWxHLDhEQUFpRTtBQUVqRTs7Ozs7OztHQU9HO0FBQ1UsUUFBQSw4QkFBOEIsR0FBRyxDQUFPLElBQW1DLEVBQ25DLEdBQW1CLEVBQ25CLFdBQXdCLEVBQTBCLEVBQUU7SUFDckcsTUFBTSxjQUFjLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsSUFBSSxrQ0FBa0IsQ0FBUyxNQUFNLENBQUMsQ0FBQztJQUNqRyxNQUFNLG1CQUFtQixHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsNEJBQTRCLElBQUksU0FBUyxDQUFDO0lBRWxGLE1BQU0sR0FBRyxHQUFHLElBQUksdURBQTBCLEVBQUUsQ0FBQztJQUU3QyxJQUFJLE1BQU0sR0FBRyxNQUFNLHVCQUFhLENBQUM7UUFDekIsT0FBTyxFQUFFLFNBQVM7UUFDbEIsSUFBSSxFQUFFLENBQUMsS0FBSyxFQUFFLFlBQVksRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLG1CQUFtQixFQUFFLElBQUksRUFBRSxNQUFNLENBQUM7S0FDdkYsRUFDRCxFQUFFLEVBQ0YsR0FBRyxFQUNIO1FBQ0ksV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxLQUFLLENBQUM7S0FDbEMsQ0FDSixDQUFDO0lBRUYs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ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgwqkgMjAxOCBBdG9taXN0LCBJbmMuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7XG4gICAgQXV0b21hdGlvbkNvbnRleHRBd2FyZSxcbiAgICBIYW5kbGVyQ29udGV4dCxcbiAgICBIYW5kbGVyUmVzdWx0LFxufSBmcm9tIFwiQGF0b21pc3QvYXV0b21hdGlvbi1jbGllbnRcIjtcbmltcG9ydCB7IGNvbmZpZ3VyYXRpb25WYWx1ZSB9IGZyb20gXCJAYXRvbWlzdC9hdXRvbWF0aW9uLWNsaWVudC9jb25maWd1cmF0aW9uXCI7XG5pbXBvcnQgeyBHaXRQcm9qZWN0IH0gZnJvbSBcIkBhdG9taXN0L2F1dG9tYXRpb24tY2xpZW50L3Byb2plY3QvZ2l0L0dpdFByb2plY3RcIjtcbmltcG9ydCAqIGFzIGZzIGZyb20gXCJmcy1leHRyYVwiO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tIFwicGF0aFwiO1xuaW1wb3J0IHsgU3RyaW5nQ2FwdHVyaW5nUHJvZ3Jlc3NMb2cgfSBmcm9tIFwiLi4vLi4vLi4vLi4vLi4vY29tbW9uL2xvZy9TdHJpbmdDYXB0dXJpbmdQcm9ncmVzc0xvZ1wiO1xuaW1wb3J0IHsgU2RtR29hbCB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9pbmdlc3RlcnMvc2RtR29hbEluZ2VzdGVyXCI7XG5pbXBvcnQgeyBQcm9ncmVzc0xvZyB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9zcGkvbG9nL1Byb2dyZXNzTG9nXCI7XG5pbXBvcnQgeyBPbkFueVJlcXVlc3RlZFNkbUdvYWwgfSBmcm9tIFwiLi4vLi4vLi4vLi4vLi4vdHlwaW5ncy90eXBlc1wiO1xuaW1wb3J0IHsgc3Bhd25BbmRXYXRjaCB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi91dGlsL21pc2Mvc3Bhd25lZFwiO1xuXG4vKipcbiAqIExhdW5jaCBhIGdvYWwgYXMgYSBrdWJlcm5ldGVzIGpvYlxuICogQHBhcmFtIHtPbkFueVJlcXVlc3RlZFNkbUdvYWwuU2RtR29hbH0gZ29hbFxuICogQHBhcmFtIHtIYW5kbGVyQ29udGV4dH0gY3R4XG4gKiBAcGFyYW0ge1Byb2dyZXNzTG9nfSBwcm9ncmVzc0xvZ1xuICogQHJldHVybnMge1Byb21pc2U8SGFuZGxlclJlc3VsdD59XG4gKiBAY29uc3RydWN0b3JcbiAqL1xuZXhwb3J0IGNvbnN0IEt1YmVybmV0ZXNJc29sYXRlZEdvYWxMYXVuY2hlciA9IGFzeW5jIChnb2FsOiBPbkFueVJlcXVlc3RlZFNkbUdvYWwuU2RtR29hbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4OiBIYW5kbGVyQ29udGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NMb2c6IFByb2dyZXNzTG9nKTogUHJvbWlzZTxIYW5kbGVyUmVzdWx0PiA9PiB7XG4gICAgY29uc3QgZGVwbG95bWVudE5hbWUgPSBwcm9jZXNzLmVudi5BVE9NSVNUX0RFUExPWU1FTlRfTkFNRSB8fCBjb25maWd1cmF0aW9uVmFsdWU8c3RyaW5nPihcIm5hbWVcIik7XG4gICAgY29uc3QgZGVwbG95bWVudE5hbWVzcGFjZSA9IHByb2Nlc3MuZW52LkFUT01JU1RfREVQTE9ZTUVOVF9OQU1FU1BBQ0UgfHwgXCJkZWZhdWx0XCI7XG5cbiAgICBjb25zdCBsb2cgPSBuZXcgU3RyaW5nQ2FwdHVyaW5nUHJvZ3Jlc3NMb2coKTtcblxuICAgIGxldCByZXN1bHQgPSBhd2FpdCBzcGF3bkFuZFdhdGNoKHtcbiAgICAgICAgICAgIGNvbW1hbmQ6IFwia3ViZWN0bFwiLFxuICAgICAgICAgICAgYXJnczogW1wiZ2V0XCIsIFwiZGVwbG95bWVudFwiLCBkZXBsb3ltZW50TmFtZSwgXCItblwiLCBkZXBsb3ltZW50TmFtZXNwYWNlLCBcIi1vXCIsIFwianNvblwiXSxcbiAgICAgICAgfSxcbiAgICAgICAge30sXG4gICAgICAgIGxvZyxcbiAgICAgICAge1xuICAgICAgICAgICAgZXJyb3JGaW5kZXI6IGNvZGUgPT4gY29kZSAhPT0gMCxcbiAgICAgICAgfSxcbiAgICApO1xuXG4gICAgaWYgKHJlc3VsdC5jb2RlICE9PSAwKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgY29uc3Qgam9iU3BlYyA9IEpTT04ucGFyc2UoSm9iU3BlYyk7XG4gICAgY29uc3QgY29udGFpbmVyU3BlYyA9IEpTT04ucGFyc2UobG9nLmxvZykuc3BlYy50ZW1wbGF0ZS5zcGVjO1xuICAgIGpvYlNwZWMuc3BlYy50ZW1wbGF0ZS5zcGVjID0gY29udGFpbmVyU3BlYztcblxuICAgIGpvYlNwZWMubWV0YWRhdGEubmFtZSA9XG4gICAgICAgIGAke2RlcGxveW1lbnROYW1lfS1qb2ItJHtnb2FsLmdvYWxTZXRJZC5zbGljZSgwLCA3KX0tJHtnb2FsLnVuaXF1ZU5hbWUudG9Mb2NhbGVMb3dlckNhc2UoKX1gO1xuICAgIGpvYlNwZWMubWV0YWRhdGEubmFtZXNwYWNlID0gZGVwbG95bWVudE5hbWVzcGFjZTtcbiAgICBqb2JTcGVjLnNwZWMudGVtcGxhdGUuc3BlYy5yZXN0YXJ0UG9saWN5ID0gXCJOZXZlclwiO1xuICAgIGpvYlNwZWMuc3BlYy50ZW1wbGF0ZS5zcGVjLmNvbnRhaW5lcnNbMF0ubmFtZSA9IGpvYlNwZWMubWV0YWRhdGEubmFtZTtcbiAgICBqb2JTcGVjLnNwZWMudGVtcGxhdGUuc3BlYy5jb250YWluZXJzWzBdLmVudi5wdXNoKHtcbiAgICAgICAgICAgIG5hbWU6IFwiQVRPTUlTVF9KT0JfTkFNRVwiLFxuICAgICAgICAgICAgdmFsdWU6IGpvYlNwZWMubWV0YWRhdGEubmFtZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogXCJBVE9NSVNUX0dPQUxfVEVBTVwiLFxuICAgICAgICAgICAgdmFsdWU6IGN0eC50ZWFtSWQsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6IFwiQVRPTUlTVF9HT0FMX1RFQU1fTkFNRVwiLFxuICAgICAgICAgICAgdmFsdWU6IChjdHggYXMgYW55IGFzIEF1dG9tYXRpb25Db250ZXh0QXdhcmUpLmNvbnRleHQudGVhbU5hbWUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6IFwiQVRPTUlTVF9HT0FMX0lEXCIsXG4gICAgICAgICAgICB2YWx1ZTogZ29hbC5pZCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogXCJBVE9NSVNUX0NPUlJFTEFUSU9OX0lEXCIsXG4gICAgICAgICAgICB2YWx1ZTogY3R4LmNvcnJlbGF0aW9uSWQsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6IFwiQVRPTUlTVF9JU09MQVRFRF9HT0FMXCIsXG4gICAgICAgICAgICB2YWx1ZTogXCJ0cnVlXCIsXG4gICAgICAgIH0pO1xuXG4gICAgY29uc3QgdGVtcGZpbGUgPSByZXF1aXJlKFwidGVtcGZpbGVcIikoXCIuanNvblwiKTtcbiAgICBhd2FpdCBmcy53cml0ZUZpbGUodGVtcGZpbGUsIEpTT04uc3RyaW5naWZ5KGpvYlNwZWMsIG51bGwsIDIpKTtcblxuICAgIC8vIENoZWNrIGlmIHRoaXMgam9iIHdhcyBwcmV2aW91c2x5IGxhdW5jaGVkXG4gICAgcmVzdWx0ID0gYXdhaXQgc3Bhd25BbmRXYXRjaCh7XG4gICAgICAgICAgICBjb21tYW5kOiBcImt1YmVjdGxcIixcbiAgICAgICAgICAgIGFyZ3M6IFtcImdldFwiLCBcImpvYlwiLCBqb2JTcGVjLm1ldGFkYXRhLm5hbWUsIFwiLW5cIiwgZGVwbG95bWVudE5hbWVzcGFjZV0sXG4gICAgICAgIH0sXG4gICAgICAgIHt9LFxuICAgICAgICBwcm9ncmVzc0xvZyxcbiAgICAgICAge1xuICAgICAgICAgICAgZXJyb3JGaW5kZXI6IGNvZGUgPT4gY29kZSAhPT0gMCxcbiAgICAgICAgfSxcbiAgICApO1xuXG4gICAgaWYgKHJlc3VsdC5jb2RlICE9PSAwKSB7XG4gICAgICAgIHJldHVybiBzcGF3bkFuZFdhdGNoKHtcbiAgICAgICAgICAgICAgICBjb21tYW5kOiBcImt1YmVjdGxcIixcbiAgICAgICAgICAgICAgICBhcmdzOiBbXCJhcHBseVwiLCBcIi1mXCIsIHRlbXBmaWxlXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7fSxcbiAgICAgICAgICAgIHByb2dyZXNzTG9nLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGVycm9yRmluZGVyOiBjb2RlID0+IGNvZGUgIT09IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBzcGF3bkFuZFdhdGNoKHtcbiAgICAgICAgICAgICAgICBjb21tYW5kOiBcImt1YmVjdGxcIixcbiAgICAgICAgICAgICAgICBhcmdzOiBbXCJyZXBsYWNlXCIsIFwiLS1mb3JjZVwiLCBcIi1mXCIsIHRlbXBmaWxlXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7fSxcbiAgICAgICAgICAgIHByb2dyZXNzTG9nLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGVycm9yRmluZGVyOiBjb2RlID0+IGNvZGUgIT09IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICApO1xuICAgIH1cbiAgICAvLyBxdWVyeSBrdWJlIHRvIG1ha2Ugc3VyZSB0aGUgam9iIGdvdCBzY2hlZHVsZWRcbiAgICAvLyBrdWJlY3RsIGdldCBqb2IgPGpvYm5hbWU+IC1vIGpzb25cbn07XG5cbmNvbnN0IEpvYlNwZWMgPSBge1xuICAgIFwia2luZFwiIDogXCJKb2JcIixcbiAgICBcImFwaVZlcnNpb25cIiA6IFwiYmF0Y2gvdjFcIixcbiAgICBcIm1ldGFkYXRhXCIgOiB7XG4gICAgICBcIm5hbWVcIiA6IFwic2FtcGxlLXNkbS1qb2JcIixcbiAgICAgIFwibmFtZXNwYWNlXCIgOiBcImRlZmF1bHRcIlxuICAgIH0sXG4gICAgXCJzcGVjXCIgOiB7XG4gICAgICBcInRlbXBsYXRlXCIgOiB7XG4gICAgICAgIFwic3BlY1wiIDoge1xuICAgICAgICAgIFwiY29udGFpbmVyc1wiIDogW11cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfWA7XG5cbmV4cG9ydCBpbnRlcmZhY2UgS3ViZXJuZXRlc09wdGlvbnMge1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBlbnZpcm9ubWVudDogc3RyaW5nO1xuXG4gICAgbnM/OiBzdHJpbmc7XG4gICAgaW1hZ2VQdWxsU2VjcmV0Pzogc3RyaW5nO1xuICAgIHBvcnQ/OiBudW1iZXI7XG4gICAgcGF0aD86IHN0cmluZztcbiAgICBob3N0Pzogc3RyaW5nO1xuICAgIHByb3RvY29sPzogc3RyaW5nO1xuICAgIHJlcGxpY2FzPzogbnVtYmVyO1xufVxuXG4vKipcbiAqIFNldHMga3ViZXJuZXRlcyBkZXBsb3ltZW50IHNwZWNpZmljIGRhdGEgdG8gYW4gU2RtR29hbFxuICogQHBhcmFtIHtTZG1Hb2FsfSBnb2FsXG4gKiBAcGFyYW0ge0t1YmVybmV0ZXNPcHRpb25zfSBvcHRpb25zXG4gKiBAcGFyYW0ge0dpdFByb2plY3R9IHBcbiAqIEByZXR1cm5zIHtQcm9taXNlPFNkbUdvYWw+fVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlS3ViZXJuZXRlc0RhdGEoZ29hbDogU2RtR29hbCwgb3B0aW9uczogS3ViZXJuZXRlc09wdGlvbnMsIHA6IEdpdFByb2plY3QpOiBQcm9taXNlPFNkbUdvYWw+IHtcbiAgICBjb25zdCBkZXBsb3ltZW50U3BlYyA9IGF3YWl0IHJlYWRLdWJlcm5ldGVzU3BlYyhwLCBcImRlcGxveW1lbnQuanNvblwiKTtcbiAgICBjb25zdCBzZXJ2aWNlU3BlYyA9IGF3YWl0IHJlYWRLdWJlcm5ldGVzU3BlYyhwLCBcInNlcnZpY2UuanNvblwiKTtcbiAgICByZXR1cm4ge1xuICAgICAgICAuLi5nb2FsLFxuICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICBrdWJlcm5ldGVzOiB7XG4gICAgICAgICAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgICAgICAgICBkZXBsb3ltZW50U3BlYyxcbiAgICAgICAgICAgICAgICBzZXJ2aWNlU3BlYyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJlYWRLdWJlcm5ldGVzU3BlYyhwOiBHaXRQcm9qZWN0LCBuYW1lOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IHNwZWNQYXRoID0gcGF0aC5qb2luKFwiLmF0b21pc3RcIiwgXCJrdWJlcm5ldGVzXCIsIG5hbWUpO1xuICAgIGlmIChwLmZpbGVFeGlzdHNTeW5jKHNwZWNQYXRoKSkge1xuICAgICAgICByZXR1cm4gKGF3YWl0IHAuZ2V0RmlsZShzcGVjUGF0aCkpLmdldENvbnRlbnQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbn1cbiJdfQ==