"use strict";/*
 * Copyright Â© 2018 Atomist, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cov_17ztf1skqn=function(){var path="/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/handlers/events/delivery/verify/executeVerifyEndpoint.ts",hash="013cbb4a08ef8d4482b44395e25a6f4f107e065f",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/handlers/events/delivery/verify/executeVerifyEndpoint.ts",statementMap:{"0":{start:{line:17,column:16},end:{line:24,column:1}},"1":{start:{line:18,column:4},end:{line:23,column:7}},"2":{start:{line:19,column:36},end:{line:19,column:97}},"3":{start:{line:19,column:42},end:{line:19,column:70}},"4":{start:{line:19,column:85},end:{line:19,column:95}},"5":{start:{line:20,column:35},end:{line:20,column:100}},"6":{start:{line:20,column:41},end:{line:20,column:73}},"7":{start:{line:20,column:88},end:{line:20,column:98}},"8":{start:{line:21,column:32},end:{line:21,column:149}},"9":{start:{line:21,column:97},end:{line:21,column:119}},"10":{start:{line:22,column:8},end:{line:22,column:78}},"11":{start:{line:25,column:0},end:{line:25,column:62}},"12":{start:{line:26,column:21},end:{line:26,column:42}},"13":{start:{line:27,column:29},end:{line:27,column:100}},"14":{start:{line:28,column:18},end:{line:28,column:57}},"15":{start:{line:30,column:4},end:{line:55,column:7}},"16":{start:{line:30,column:18},end:{line:55,column:6}},"17":{start:{line:31,column:40},end:{line:31,column:41}},"18":{start:{line:32,column:25},end:{line:32,column:124}},"19":{start:{line:33,column:29},end:{line:33,column:93}},"20":{start:{line:33,column:49},end:{line:33,column:92}},"21":{start:{line:34,column:8},end:{line:37,column:9}},"22":{start:{line:35,column:12},end:{line:35,column:134}},"23":{start:{line:36,column:12},end:{line:36,column:53}},"24":{start:{line:38,column:8},end:{line:41,column:9}},"25":{start:{line:39,column:12},end:{line:39,column:101}},"26":{start:{line:40,column:12},end:{line:40,column:56}},"27":{start:{line:42,column:20},end:{line:48,column:9}},"28":{start:{line:49,column:8},end:{line:53,column:13}},"29":{start:{line:49,column:56},end:{line:53,column:10}},"30":{start:{line:50,column:12},end:{line:50,column:68}},"31":{start:{line:51,column:12},end:{line:51,column:55}},"32":{start:{line:52,column:12},end:{line:52,column:22}},"33":{start:{line:54,column:8},end:{line:54,column:94}},"34":{start:{line:57,column:0},end:{line:57,column:54}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:17,column:44},end:{line:17,column:45}},loc:{start:{line:17,column:89},end:{line:24,column:1}},line:17},"1":{name:"(anonymous_1)",decl:{start:{line:18,column:36},end:{line:18,column:37}},loc:{start:{line:18,column:63},end:{line:23,column:5}},line:18},"2":{name:"fulfilled",decl:{start:{line:19,column:17},end:{line:19,column:26}},loc:{start:{line:19,column:34},end:{line:19,column:99}},line:19},"3":{name:"rejected",decl:{start:{line:20,column:17},end:{line:20,column:25}},loc:{start:{line:20,column:33},end:{line:20,column:102}},line:20},"4":{name:"step",decl:{start:{line:21,column:17},end:{line:21,column:21}},loc:{start:{line:21,column:30},end:{line:21,column:151}},line:21},"5":{name:"(anonymous_5)",decl:{start:{line:21,column:76},end:{line:21,column:77}},loc:{start:{line:21,column:95},end:{line:21,column:121}},line:21},"6":{name:"executeVerifyEndpoint",decl:{start:{line:29,column:9},end:{line:29,column:30}},loc:{start:{line:29,column:36},end:{line:56,column:1}},line:29},"7":{name:"(anonymous_7)",decl:{start:{line:30,column:11},end:{line:30,column:12}},loc:{start:{line:30,column:18},end:{line:55,column:6}},line:30},"8":{name:"(anonymous_8)",decl:{start:{line:30,column:50},end:{line:30,column:51}},loc:{start:{line:30,column:63},end:{line:55,column:5}},line:30},"9":{name:"(anonymous_9)",decl:{start:{line:33,column:43},end:{line:33,column:44}},loc:{start:{line:33,column:49},end:{line:33,column:92}},line:33},"10":{name:"(anonymous_10)",decl:{start:{line:49,column:44},end:{line:49,column:45}},loc:{start:{line:49,column:56},end:{line:53,column:10}},line:49},"11":{name:"(anonymous_11)",decl:{start:{line:49,column:76},end:{line:49,column:77}},loc:{start:{line:49,column:83},end:{line:53,column:9}},line:49}},branchMap:{"0":{loc:{start:{line:17,column:16},end:{line:24,column:1}},type:"binary-expr",locations:[{start:{line:17,column:17},end:{line:17,column:21}},{start:{line:17,column:25},end:{line:17,column:39}},{start:{line:17,column:44},end:{line:24,column:1}}],line:17},"1":{loc:{start:{line:18,column:16},end:{line:18,column:34}},type:"binary-expr",locations:[{start:{line:18,column:16},end:{line:18,column:17}},{start:{line:18,column:22},end:{line:18,column:33}}],line:18},"2":{loc:{start:{line:21,column:32},end:{line:21,column:148}},type:"cond-expr",locations:[{start:{line:21,column:46},end:{line:21,column:67}},{start:{line:21,column:70},end:{line:21,column:148}}],line:21},"3":{loc:{start:{line:22,column:51},end:{line:22,column:67}},type:"binary-expr",locations:[{start:{line:22,column:51},end:{line:22,column:61}},{start:{line:22,column:65},end:{line:22,column:67}}],line:22},"4":{loc:{start:{line:34,column:8},end:{line:37,column:9}},type:"if",locations:[{start:{line:34,column:8},end:{line:37,column:9}},{start:{line:34,column:8},end:{line:37,column:9}}],line:34},"5":{loc:{start:{line:38,column:8},end:{line:41,column:9}},type:"if",locations:[{start:{line:38,column:8},end:{line:41,column:9}},{start:{line:38,column:8},end:{line:41,column:9}}],line:38}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},b:{"0":[0,0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var __awaiter=(cov_17ztf1skqn.s[0]++,(cov_17ztf1skqn.b[0][0]++,this)&&(cov_17ztf1skqn.b[0][1]++,this.__awaiter)||(cov_17ztf1skqn.b[0][2]++,function(thisArg,_arguments,P,generator){cov_17ztf1skqn.f[0]++;cov_17ztf1skqn.s[1]++;return new((cov_17ztf1skqn.b[1][0]++,P)||(cov_17ztf1skqn.b[1][1]++,P=Promise))(function(resolve,reject){cov_17ztf1skqn.f[1]++;function fulfilled(value){cov_17ztf1skqn.f[2]++;cov_17ztf1skqn.s[2]++;try{cov_17ztf1skqn.s[3]++;step(generator.next(value));}catch(e){cov_17ztf1skqn.s[4]++;reject(e);}}function rejected(value){cov_17ztf1skqn.f[3]++;cov_17ztf1skqn.s[5]++;try{cov_17ztf1skqn.s[6]++;step(generator["throw"](value));}catch(e){cov_17ztf1skqn.s[7]++;reject(e);}}function step(result){cov_17ztf1skqn.f[4]++;cov_17ztf1skqn.s[8]++;result.done?(cov_17ztf1skqn.b[2][0]++,resolve(result.value)):(cov_17ztf1skqn.b[2][1]++,new P(function(resolve){cov_17ztf1skqn.f[5]++;cov_17ztf1skqn.s[9]++;resolve(result.value);}).then(fulfilled,rejected));}cov_17ztf1skqn.s[10]++;step((generator=generator.apply(thisArg,(cov_17ztf1skqn.b[3][0]++,_arguments)||(cov_17ztf1skqn.b[3][1]++,[]))).next());});}));cov_17ztf1skqn.s[11]++;Object.defineProperty(exports,"__esModule",{value:true});const sprintf_js_1=(cov_17ztf1skqn.s[12]++,require("sprintf-js"));const fetchGoalsOnCommit_1=(cov_17ztf1skqn.s[13]++,require("../../../../common/delivery/goals/support/fetchGoalsOnCommit"));const repoRef_1=(cov_17ztf1skqn.s[14]++,require("../../../../util/git/repoRef"));function executeVerifyEndpoint(sdm){cov_17ztf1skqn.f[6]++;cov_17ztf1skqn.s[15]++;return r=>{cov_17ztf1skqn.f[7]++;cov_17ztf1skqn.s[16]++;return __awaiter(this,void 0,void 0,function*(){cov_17ztf1skqn.f[8]++;const{context,id,status}=(cov_17ztf1skqn.s[17]++,r);const sdmGoals=(cov_17ztf1skqn.s[18]++,yield fetchGoalsOnCommit_1.fetchGoalsForCommit(context,id,repoRef_1.providerIdFromStatus(status)));const endpointGoal=(cov_17ztf1skqn.s[19]++,sdmGoals.find(sg=>{cov_17ztf1skqn.f[9]++;cov_17ztf1skqn.s[20]++;return sg.externalKey===sdm.endpointGoal.context;}));cov_17ztf1skqn.s[21]++;if(!endpointGoal){cov_17ztf1skqn.b[4][0]++;cov_17ztf1skqn.s[22]++;r.progressLog.write(sprintf_js_1.sprintf("Did not find endpoint goal. Looking for context %s",sdm.endpointGoal.context));cov_17ztf1skqn.s[23]++;throw new Error("Endpoint goal unfound");}else{cov_17ztf1skqn.b[4][1]++;}cov_17ztf1skqn.s[24]++;if(!endpointGoal.url){cov_17ztf1skqn.b[5][0]++;cov_17ztf1skqn.s[25]++;r.progressLog.write(sprintf_js_1.sprintf("Did not find endpoint url: %j",endpointGoal));cov_17ztf1skqn.s[26]++;throw new Error("Endpoint goal has no URL");}else{cov_17ztf1skqn.b[5][1]++;}const inv=(cov_17ztf1skqn.s[27]++,{id:r.id,url:endpointGoal.url,addressChannels:r.addressChannels,context:r.context,credentials:r.credentials});cov_17ztf1skqn.s[28]++;yield Promise.all(sdm.verifiers.map(verifier=>{cov_17ztf1skqn.f[10]++;cov_17ztf1skqn.s[29]++;return verifier(inv).catch(err=>{cov_17ztf1skqn.f[11]++;cov_17ztf1skqn.s[30]++;r.progressLog.write("A verifier threw: "+err.message);cov_17ztf1skqn.s[31]++;r.progressLog.write("stack: "+err.stack);cov_17ztf1skqn.s[32]++;throw err;});}));cov_17ztf1skqn.s[33]++;return{code:0,requireApproval:sdm.requestApproval,targetUrl:endpointGoal.url};});};}cov_17ztf1skqn.s[34]++;exports.executeVerifyEndpoint=executeVerifyEndpoint;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL3JvZGpvaG5zb24vc2ZvcnphbmRvLWRldi9pZGVhLXByb2plY3RzL215LWZsb3cvc3JjL2hhbmRsZXJzL2V2ZW50cy9kZWxpdmVyeS92ZXJpZnkvZXhlY3V0ZVZlcmlmeUVuZHBvaW50LnRzIiwic291cmNlcyI6WyIvVXNlcnMvcm9kam9obnNvbi9zZm9yemFuZG8tZGV2L2lkZWEtcHJvamVjdHMvbXktZmxvdy9zcmMvaGFuZGxlcnMvZXZlbnRzL2RlbGl2ZXJ5L3ZlcmlmeS9leGVjdXRlVmVyaWZ5RW5kcG9pbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7Ozs7OztHQWNHOzs7Ozs7Ozs7O0FBRUgsMkNBQXFDO0FBR3JDLHFHQUFtRztBQUduRywwREFBb0U7QUFxQnBFLCtCQUFzQyxHQUFvQjtJQUN0RCxPQUFPLENBQU8sQ0FBb0IsRUFBOEIsRUFBRTtRQUM5RCxNQUFNLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDbEMsTUFBTSxRQUFRLEdBQUcsTUFBTSx3Q0FBbUIsQ0FBQyxPQUFPLEVBQUUsRUFBRSxFQUFFLDhCQUFvQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdEYsTUFBTSxZQUFZLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxXQUFXLEtBQUssR0FBRyxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUV0RixJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ2YsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsb0JBQU8sQ0FBQyxvREFBb0QsRUFBRSxHQUFHLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDN0csTUFBTSxJQUFJLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1NBQzVDO1FBQ0QsSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLEVBQUU7WUFDbkIsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsb0JBQU8sQ0FBQywrQkFBK0IsRUFBRSxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQzVFLE1BQU0sSUFBSSxLQUFLLENBQUMsMEJBQTBCLENBQUMsQ0FBQztTQUUvQztRQUNELE1BQU0sR0FBRyxHQUFtQztZQUN4QyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUU7WUFDUixHQUFHLEVBQUUsWUFBWSxDQUFDLEdBQUc7WUFDckIsZUFBZSxFQUFFLENBQUMsQ0FBQyxlQUFlO1lBQ2xDLE9BQU8sRUFBRSxDQUFDLENBQUMsT0FBTztZQUNsQixXQUFXLEVBQUUsQ0FBQyxDQUFDLFdBQVc7U0FDN0IsQ0FBQztRQUNGLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDdEUsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsb0JBQW9CLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3hELENBQUMsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDM0MsTUFBTSxHQUFHLENBQUM7UUFDZCxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFTCxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxlQUFlLEVBQUUsR0FBRyxDQUFDLGVBQWUsRUFBRSxTQUFTLEVBQUUsWUFBWSxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQzFGLENBQUMsQ0FBQSxDQUFDO0FBQ04sQ0FBQztBQTlCRCxzREE4QkMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IMKpIDIwMTggQXRvbWlzdCwgSW5jLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBzcHJpbnRmIH0gZnJvbSBcInNwcmludGYtanNcIjtcbmltcG9ydCB7IEV4ZWN1dGVHb2FsUmVzdWx0IH0gZnJvbSBcIi4uLy4uLy4uLy4uL2NvbW1vbi9kZWxpdmVyeS9nb2Fscy9FeGVjdXRlR29hbFJlc3VsdFwiO1xuaW1wb3J0IHsgR29hbCB9IGZyb20gXCIuLi8uLi8uLi8uLi9jb21tb24vZGVsaXZlcnkvZ29hbHMvR29hbFwiO1xuaW1wb3J0IHsgZmV0Y2hHb2Fsc0ZvckNvbW1pdCB9IGZyb20gXCIuLi8uLi8uLi8uLi9jb21tb24vZGVsaXZlcnkvZ29hbHMvc3VwcG9ydC9mZXRjaEdvYWxzT25Db21taXRcIjtcbmltcG9ydCB7IEV4ZWN1dGVHb2FsV2l0aExvZywgUnVuV2l0aExvZ0NvbnRleHQgfSBmcm9tIFwiLi4vLi4vLi4vLi4vY29tbW9uL2RlbGl2ZXJ5L2dvYWxzL3N1cHBvcnQvcmVwb3J0R29hbEVycm9yXCI7XG5pbXBvcnQgeyBSZXBvTGlzdGVuZXJJbnZvY2F0aW9uLCBTZG1MaXN0ZW5lciB9IGZyb20gXCIuLi8uLi8uLi8uLi9jb21tb24vbGlzdGVuZXIvTGlzdGVuZXJcIjtcbmltcG9ydCB7IHByb3ZpZGVySWRGcm9tU3RhdHVzIH0gZnJvbSBcIi4uLy4uLy4uLy4uL3V0aWwvZ2l0L3JlcG9SZWZcIjtcblxuZXhwb3J0IGludGVyZmFjZSBFbmRwb2ludFZlcmlmaWNhdGlvbkludm9jYXRpb24gZXh0ZW5kcyBSZXBvTGlzdGVuZXJJbnZvY2F0aW9uIHtcblxuICAgIC8qKlxuICAgICAqIFJlcG9ydGVkIGVuZHBvaW50IGJhc2UgdXJsXG4gICAgICovXG4gICAgdXJsOiBzdHJpbmc7XG59XG5cbmV4cG9ydCB0eXBlIEVuZHBvaW50VmVyaWZpY2F0aW9uTGlzdGVuZXIgPSBTZG1MaXN0ZW5lcjxFbmRwb2ludFZlcmlmaWNhdGlvbkludm9jYXRpb24+O1xuXG4vKipcbiAqIFdoYXQgdGhlIFNETSBzaG91bGQgZGVmaW5lIGZvciBlYWNoIGVudmlyb25tZW50J3MgdmVyaWZpY2F0aW9uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgU2RtVmVyaWZpY2F0aW9uIHtcbiAgICB2ZXJpZmllcnM6IEVuZHBvaW50VmVyaWZpY2F0aW9uTGlzdGVuZXJbXTtcbiAgICBlbmRwb2ludEdvYWw6IEdvYWw7XG4gICAgcmVxdWVzdEFwcHJvdmFsOiBib29sZWFuO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZXhlY3V0ZVZlcmlmeUVuZHBvaW50KHNkbTogU2RtVmVyaWZpY2F0aW9uKTogRXhlY3V0ZUdvYWxXaXRoTG9nIHtcbiAgICByZXR1cm4gYXN5bmMgKHI6IFJ1bldpdGhMb2dDb250ZXh0KTogUHJvbWlzZTxFeGVjdXRlR29hbFJlc3VsdD4gPT4ge1xuICAgICAgICBjb25zdCB7IGNvbnRleHQsIGlkLCBzdGF0dXMgfSA9IHI7XG4gICAgICAgIGNvbnN0IHNkbUdvYWxzID0gYXdhaXQgZmV0Y2hHb2Fsc0ZvckNvbW1pdChjb250ZXh0LCBpZCwgcHJvdmlkZXJJZEZyb21TdGF0dXMoc3RhdHVzKSk7XG4gICAgICAgIGNvbnN0IGVuZHBvaW50R29hbCA9IHNkbUdvYWxzLmZpbmQoc2cgPT4gc2cuZXh0ZXJuYWxLZXkgPT09IHNkbS5lbmRwb2ludEdvYWwuY29udGV4dCk7XG5cbiAgICAgICAgaWYgKCFlbmRwb2ludEdvYWwpIHtcbiAgICAgICAgICAgIHIucHJvZ3Jlc3NMb2cud3JpdGUoc3ByaW50ZihcIkRpZCBub3QgZmluZCBlbmRwb2ludCBnb2FsLiBMb29raW5nIGZvciBjb250ZXh0ICVzXCIsIHNkbS5lbmRwb2ludEdvYWwuY29udGV4dCkpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRW5kcG9pbnQgZ29hbCB1bmZvdW5kXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZW5kcG9pbnRHb2FsLnVybCkge1xuICAgICAgICAgICAgci5wcm9ncmVzc0xvZy53cml0ZShzcHJpbnRmKFwiRGlkIG5vdCBmaW5kIGVuZHBvaW50IHVybDogJWpcIiwgZW5kcG9pbnRHb2FsKSk7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFbmRwb2ludCBnb2FsIGhhcyBubyBVUkxcIik7XG5cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpbnY6IEVuZHBvaW50VmVyaWZpY2F0aW9uSW52b2NhdGlvbiA9IHtcbiAgICAgICAgICAgIGlkOiByLmlkLFxuICAgICAgICAgICAgdXJsOiBlbmRwb2ludEdvYWwudXJsLFxuICAgICAgICAgICAgYWRkcmVzc0NoYW5uZWxzOiByLmFkZHJlc3NDaGFubmVscyxcbiAgICAgICAgICAgIGNvbnRleHQ6IHIuY29udGV4dCxcbiAgICAgICAgICAgIGNyZWRlbnRpYWxzOiByLmNyZWRlbnRpYWxzLFxuICAgICAgICB9O1xuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChzZG0udmVyaWZpZXJzLm1hcCh2ZXJpZmllciA9PiB2ZXJpZmllcihpbnYpLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICByLnByb2dyZXNzTG9nLndyaXRlKFwiQSB2ZXJpZmllciB0aHJldzogXCIgKyBlcnIubWVzc2FnZSk7XG4gICAgICAgICAgICByLnByb2dyZXNzTG9nLndyaXRlKFwic3RhY2s6IFwiICsgZXJyLnN0YWNrKTtcbiAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgfSkpKTtcblxuICAgICAgICByZXR1cm4geyBjb2RlOiAwLCByZXF1aXJlQXBwcm92YWw6IHNkbS5yZXF1ZXN0QXBwcm92YWwsIHRhcmdldFVybDogZW5kcG9pbnRHb2FsLnVybCB9O1xuICAgIH07XG59XG4iXX0=