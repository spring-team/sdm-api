"use strict";/*
 * Copyright Â© 2018 Atomist, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cov_2qmzkn45kg=function(){var path="/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/common/delivery/build/local/maven/mavenLogInterpreter.ts",hash="48ae1c01a617d800be32982bdd3bc836136722f1",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/common/delivery/build/local/maven/mavenLogInterpreter.ts",statementMap:{"0":{start:{line:17,column:0},end:{line:17,column:62}},"1":{start:{line:18,column:28},end:{line:18,column:65}},"2":{start:{line:19,column:23},end:{line:19,column:68}},"3":{start:{line:20,column:21},end:{line:20,column:64}},"4":{start:{line:21,column:0},end:{line:73,column:2}},"5":{start:{line:22,column:23},end:{line:22,column:52}},"6":{start:{line:23,column:17},end:{line:27,column:5}},"7":{start:{line:28,column:4},end:{line:36,column:5}},"8":{start:{line:29,column:8},end:{line:29,column:57}},"9":{start:{line:30,column:8},end:{line:35,column:10}},"10":{start:{line:37,column:31},end:{line:37,column:52}},"11":{start:{line:38,column:4},end:{line:45,column:5}},"12":{start:{line:39,column:8},end:{line:44,column:10}},"13":{start:{line:47,column:29},end:{line:47,column:45}},"14":{start:{line:48,column:4},end:{line:56,column:5}},"15":{start:{line:49,column:8},end:{line:49,column:66}},"16":{start:{line:50,column:8},end:{line:55,column:10}},"17":{start:{line:58,column:4},end:{line:66,column:5}},"18":{start:{line:59,column:8},end:{line:59,column:69}},"19":{start:{line:60,column:8},end:{line:65,column:10}},"20":{start:{line:67,column:4},end:{line:67,column:85}},"21":{start:{line:68,column:4},end:{line:72,column:6}},"22":{start:{line:75,column:18},end:{line:75,column:33}},"23":{start:{line:76,column:30},end:{line:76,column:74}},"24":{start:{line:77,column:4},end:{line:79,column:5}},"25":{start:{line:78,column:8},end:{line:78,column:25}},"26":{start:{line:80,column:24},end:{line:80,column:82}},"27":{start:{line:81,column:4},end:{line:81,column:34}},"28":{start:{line:84,column:25},end:{line:87,column:19}},"29":{start:{line:85,column:21},end:{line:85,column:44}},"30":{start:{line:86,column:18},end:{line:86,column:43}},"31":{start:{line:88,column:4},end:{line:90,column:5}},"32":{start:{line:89,column:8},end:{line:89,column:15}},"33":{start:{line:91,column:4},end:{line:91,column:24}},"34":{start:{line:94,column:22},end:{line:96,column:2}},"35":{start:{line:101,column:27},end:{line:106,column:2}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:21,column:30},end:{line:21,column:31}},loc:{start:{line:21,column:37},end:{line:73,column:1}},line:21},"1":{name:"appFailedToStart",decl:{start:{line:74,column:9},end:{line:74,column:25}},loc:{start:{line:74,column:31},end:{line:82,column:1}},line:74},"2":{name:"mavenErrors",decl:{start:{line:83,column:9},end:{line:83,column:20}},loc:{start:{line:83,column:26},end:{line:92,column:1}},line:83},"3":{name:"(anonymous_3)",decl:{start:{line:85,column:16},end:{line:85,column:17}},loc:{start:{line:85,column:21},end:{line:85,column:44}},line:85},"4":{name:"(anonymous_4)",decl:{start:{line:86,column:13},end:{line:86,column:14}},loc:{start:{line:86,column:18},end:{line:86,column:43}},line:86}},branchMap:{"0":{loc:{start:{line:24,column:20},end:{line:24,column:70}},type:"cond-expr",locations:[{start:{line:24,column:33},end:{line:24,column:58}},{start:{line:24,column:61},end:{line:24,column:70}}],line:24},"1":{loc:{start:{line:26,column:18},end:{line:26,column:65}},type:"binary-expr",locations:[{start:{line:26,column:18},end:{line:26,column:52}},{start:{line:26,column:56},end:{line:26,column:65}}],line:26},"2":{loc:{start:{line:28,column:4},end:{line:36,column:5}},type:"if",locations:[{start:{line:28,column:4},end:{line:36,column:5}},{start:{line:28,column:4},end:{line:36,column:5}}],line:28},"3":{loc:{start:{line:38,column:4},end:{line:45,column:5}},type:"if",locations:[{start:{line:38,column:4},end:{line:45,column:5}},{start:{line:38,column:4},end:{line:45,column:5}}],line:38},"4":{loc:{start:{line:48,column:4},end:{line:56,column:5}},type:"if",locations:[{start:{line:48,column:4},end:{line:56,column:5}},{start:{line:48,column:4},end:{line:56,column:5}}],line:48},"5":{loc:{start:{line:58,column:4},end:{line:66,column:5}},type:"if",locations:[{start:{line:58,column:4},end:{line:66,column:5}},{start:{line:58,column:4},end:{line:66,column:5}}],line:58},"6":{loc:{start:{line:77,column:4},end:{line:79,column:5}},type:"if",locations:[{start:{line:77,column:4},end:{line:79,column:5}},{start:{line:77,column:4},end:{line:79,column:5}}],line:77},"7":{loc:{start:{line:88,column:4},end:{line:90,column:5}},type:"if",locations:[{start:{line:88,column:4},end:{line:90,column:5}},{start:{line:88,column:4},end:{line:90,column:5}}],line:88}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();cov_2qmzkn45kg.s[0]++;Object.defineProperty(exports,"__esModule",{value:true});const automation_client_1=(cov_2qmzkn45kg.s[1]++,require("@atomist/automation-client"));const Microgrammar_1=(cov_2qmzkn45kg.s[2]++,require("@atomist/microgrammar/Microgrammar"));const Primitives_1=(cov_2qmzkn45kg.s[3]++,require("@atomist/microgrammar/Primitives"));cov_2qmzkn45kg.s[4]++;exports.MavenLogInterpreter=log=>{cov_2qmzkn45kg.f[0]++;const timingInfo=(cov_2qmzkn45kg.s[5]++,timingGrammar.firstMatch(log));const data=(cov_2qmzkn45kg.s[6]++,{timeMillis:timingInfo?(cov_2qmzkn45kg.b[0][0]++,timingInfo.seconds*1000):(cov_2qmzkn45kg.b[0][1]++,undefined),success:log.includes("BUILD SUCCESS\----"),testInfo:(cov_2qmzkn45kg.b[1][0]++,testSummaryGrammar.firstMatch(log))||(cov_2qmzkn45kg.b[1][1]++,undefined)});cov_2qmzkn45kg.s[7]++;if(!log){cov_2qmzkn45kg.b[2][0]++;cov_2qmzkn45kg.s[8]++;automation_client_1.logger.warn("Log was empty");cov_2qmzkn45kg.s[9]++;return{relevantPart:"",message:"Failed with empty log",includeFullLog:false,data};}else{cov_2qmzkn45kg.b[2][1]++;}const maybeFailedToStart=(cov_2qmzkn45kg.s[10]++,appFailedToStart(log));cov_2qmzkn45kg.s[11]++;if(maybeFailedToStart){cov_2qmzkn45kg.b[3][0]++;cov_2qmzkn45kg.s[12]++;return{relevantPart:maybeFailedToStart,message:"Application failed to start",includeFullLog:false,data};}else{cov_2qmzkn45kg.b[3][1]++;}// default to maven errors
const maybeMavenErrors=(cov_2qmzkn45kg.s[13]++,mavenErrors(log));cov_2qmzkn45kg.s[14]++;if(maybeMavenErrors){cov_2qmzkn45kg.b[4][0]++;cov_2qmzkn45kg.s[15]++;automation_client_1.logger.info("Recognized Maven error");cov_2qmzkn45kg.s[16]++;return{relevantPart:maybeMavenErrors,message:"Maven errors",includeFullLog:false,data};}else{cov_2qmzkn45kg.b[4][1]++;}// or it could be this problem here
cov_2qmzkn45kg.s[17]++;if(log.match(/Error checking out artifact/)){cov_2qmzkn45kg.b[5][0]++;cov_2qmzkn45kg.s[18]++;automation_client_1.logger.info("Recognized artifact error");cov_2qmzkn45kg.s[19]++;return{relevantPart:log,message:"I lost the local cache. Please rebuild",includeFullLog:false,data};}else{cov_2qmzkn45kg.b[5][1]++;}cov_2qmzkn45kg.s[20]++;automation_client_1.logger.info("Did not find anything to recognize in the log");cov_2qmzkn45kg.s[21]++;return{relevantPart:"",message:"Unknown error",data};};function appFailedToStart(log){cov_2qmzkn45kg.f[1]++;const lines=(cov_2qmzkn45kg.s[22]++,log.split("\n"));const failedToStartLine=(cov_2qmzkn45kg.s[23]++,lines.indexOf("APPLICATION FAILED TO START"));cov_2qmzkn45kg.s[24]++;if(failedToStartLine<1){cov_2qmzkn45kg.b[6][0]++;cov_2qmzkn45kg.s[25]++;return undefined;}else{cov_2qmzkn45kg.b[6][1]++;}const likelyLines=(cov_2qmzkn45kg.s[26]++,lines.slice(failedToStartLine+3,failedToStartLine+10));cov_2qmzkn45kg.s[27]++;return likelyLines.join("\n");}function mavenErrors(log){cov_2qmzkn45kg.f[2]++;const relevantPart=(cov_2qmzkn45kg.s[28]++,log.split("\n").filter(l=>{cov_2qmzkn45kg.f[3]++;cov_2qmzkn45kg.s[29]++;return l.startsWith("[ERROR]");}).map(l=>{cov_2qmzkn45kg.f[4]++;cov_2qmzkn45kg.s[30]++;return l.replace("[ERROR] ","");}).join("\n"));cov_2qmzkn45kg.s[31]++;if(!relevantPart){cov_2qmzkn45kg.b[7][0]++;cov_2qmzkn45kg.s[32]++;return;}else{cov_2qmzkn45kg.b[7][1]++;}cov_2qmzkn45kg.s[33]++;return relevantPart;}// Microgrammars...
const timingGrammar=(cov_2qmzkn45kg.s[34]++,Microgrammar_1.Microgrammar.fromString("Total time: ${seconds} s",{seconds:Primitives_1.Float}));/**
 * Microgrammar for Maven test output
 * @type {Microgrammar<MavenInfo>}
 */const testSummaryGrammar=(cov_2qmzkn45kg.s[35]++,Microgrammar_1.Microgrammar.fromString("Tests run: ${testsRun}, Failures: ${failingTests}, Errors: ${errors}, Skipped: ${pendingTests}",{testsRun:Primitives_1.Integer,failingTests:Primitives_1.Integer,pendingTests:Primitives_1.Integer,errors:Primitives_1.Integer}));//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL3JvZGpvaG5zb24vc2ZvcnphbmRvLWRldi9pZGVhLXByb2plY3RzL215LWZsb3cvc3JjL2NvbW1vbi9kZWxpdmVyeS9idWlsZC9sb2NhbC9tYXZlbi9tYXZlbkxvZ0ludGVycHJldGVyLnRzIiwic291cmNlcyI6WyIvVXNlcnMvcm9kam9obnNvbi9zZm9yemFuZG8tZGV2L2lkZWEtcHJvamVjdHMvbXktZmxvdy9zcmMvY29tbW9uL2RlbGl2ZXJ5L2J1aWxkL2xvY2FsL21hdmVuL21hdmVuTG9nSW50ZXJwcmV0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7Ozs7OztHQWNHOztBQUVILGtFQUFvRDtBQUNwRCxxRUFBa0U7QUFDbEUsaUVBQWtFO0FBSXJELFFBQUEsbUJBQW1CLEdBQTRCLEdBQUcsQ0FBQyxFQUFFO0lBQzlELE1BQU0sVUFBVSxHQUFHLGFBQWEsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDakQsTUFBTSxJQUFJLEdBQWM7UUFDcEIsVUFBVSxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLFNBQVM7UUFDOUQsT0FBTyxFQUFFLEdBQUcsQ0FBQyxRQUFRLENBQUMsb0JBQW9CLENBQUM7UUFDM0MsUUFBUSxFQUFFLGtCQUFrQixDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxTQUFTO0tBQzVELENBQUM7SUFDRixJQUFJLENBQUMsR0FBRyxFQUFFO1FBQ04sMEJBQU0sQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDN0IsT0FBTztZQUNILFlBQVksRUFBRSxFQUFFO1lBQ2hCLE9BQU8sRUFBRSx1QkFBdUI7WUFDaEMsY0FBYyxFQUFFLEtBQUs7WUFDckIsSUFBSTtTQUNQLENBQUM7S0FDTDtJQUVELE1BQU0sa0JBQWtCLEdBQUcsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDakQsSUFBSSxrQkFBa0IsRUFBRTtRQUNwQixPQUFPO1lBQ0gsWUFBWSxFQUFFLGtCQUFrQjtZQUNoQyxPQUFPLEVBQUUsNkJBQTZCO1lBQ3RDLGNBQWMsRUFBRSxLQUFLO1lBQ3JCLElBQUk7U0FDUCxDQUFDO0tBQ0w7SUFFRCwwQkFBMEI7SUFDMUIsTUFBTSxnQkFBZ0IsR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDMUMsSUFBSSxnQkFBZ0IsRUFBRTtRQUNsQiwwQkFBTSxDQUFDLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1FBQ3RDLE9BQU87WUFDSCxZQUFZLEVBQUUsZ0JBQWdCO1lBQzlCLE9BQU8sRUFBRSxjQUFjO1lBQ3ZCLGNBQWMsRUFBRSxLQUFLO1lBQ3JCLElBQUk7U0FDUCxDQUFDO0tBQ0w7SUFFRCxtQ0FBbUM7SUFDbkMsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLDZCQUE2QixDQUFDLEVBQUU7UUFDMUMsMEJBQU0sQ0FBQyxJQUFJLENBQUMsMkJBQTJCLENBQUMsQ0FBQztRQUN6QyxPQUFPO1lBQ0gsWUFBWSxFQUFFLEdBQUc7WUFDakIsT0FBTyxFQUFFLHdDQUF3QztZQUNqRCxjQUFjLEVBQUUsS0FBSztZQUNyQixJQUFJO1NBQ1AsQ0FBQztLQUNMO0lBRUQsMEJBQU0sQ0FBQyxJQUFJLENBQUMsK0NBQStDLENBQUMsQ0FBQztJQUM3RCxPQUFPO1FBQ0gsWUFBWSxFQUFFLEVBQUU7UUFDaEIsT0FBTyxFQUFFLGVBQWU7UUFDeEIsSUFBSTtLQUNQLENBQUM7QUFDTixDQUFDLENBQUM7QUFFRiwwQkFBMEIsR0FBVztJQUNqQyxNQUFNLEtBQUssR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzlCLE1BQU0saUJBQWlCLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO0lBQ3ZFLElBQUksaUJBQWlCLEdBQUcsQ0FBQyxFQUFFO1FBQ3ZCLE9BQU8sU0FBUyxDQUFDO0tBQ3BCO0lBQ0QsTUFBTSxXQUFXLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsR0FBRyxDQUFDLEVBQUUsaUJBQWlCLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDL0UsT0FBTyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ2xDLENBQUM7QUFJRCxxQkFBcUIsR0FBVztJQUM1QixNQUFNLFlBQVksR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQztTQUMvQixNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1NBQ3BDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1NBQ25DLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNoQixJQUFJLENBQUMsWUFBWSxFQUFFO1FBQ2YsT0FBTztLQUNWO0lBQ0QsT0FBTyxZQUFZLENBQUM7QUFDeEIsQ0FBQztBQUVELG1CQUFtQjtBQUVuQixNQUFNLGFBQWEsR0FBRywyQkFBWSxDQUFDLFVBQVUsQ0FBc0IsMEJBQTBCLEVBQUU7SUFDM0YsT0FBTyxFQUFFLGtCQUFLO0NBQ2pCLENBQUMsQ0FBQztBQUVIOzs7R0FHRztBQUNILE1BQU0sa0JBQWtCLEdBQUcsMkJBQVksQ0FBQyxVQUFVLENBQzlDLGdHQUFnRyxFQUNoRztJQUNJLFFBQVEsRUFBRSxvQkFBTztJQUNqQixZQUFZLEVBQUUsb0JBQU87SUFDckIsWUFBWSxFQUFFLG9CQUFPO0lBQ3JCLE1BQU0sRUFBRSxvQkFBTztDQUNsQixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IMKpIDIwMTggQXRvbWlzdCwgSW5jLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwiQGF0b21pc3QvYXV0b21hdGlvbi1jbGllbnRcIjtcbmltcG9ydCB7IE1pY3JvZ3JhbW1hciB9IGZyb20gXCJAYXRvbWlzdC9taWNyb2dyYW1tYXIvTWljcm9ncmFtbWFyXCI7XG5pbXBvcnQgeyBGbG9hdCwgSW50ZWdlciB9IGZyb20gXCJAYXRvbWlzdC9taWNyb2dyYW1tYXIvUHJpbWl0aXZlc1wiO1xuaW1wb3J0IHsgSW50ZXJwcmV0TG9nIH0gZnJvbSBcIi4uLy4uLy4uLy4uLy4uL3NwaS9sb2cvSW50ZXJwcmV0ZWRMb2dcIjtcbmltcG9ydCB7IEJ1aWxkSW5mbywgVGVzdFN0YXR1cyB9IGZyb20gXCIuLi8uLi9CdWlsZEluZm9cIjtcblxuZXhwb3J0IGNvbnN0IE1hdmVuTG9nSW50ZXJwcmV0ZXI6IEludGVycHJldExvZzxNYXZlbkluZm8+ID0gbG9nID0+IHtcbiAgICBjb25zdCB0aW1pbmdJbmZvID0gdGltaW5nR3JhbW1hci5maXJzdE1hdGNoKGxvZyk7XG4gICAgY29uc3QgZGF0YTogTWF2ZW5JbmZvID0ge1xuICAgICAgICB0aW1lTWlsbGlzOiB0aW1pbmdJbmZvID8gdGltaW5nSW5mby5zZWNvbmRzICogMTAwMCA6IHVuZGVmaW5lZCxcbiAgICAgICAgc3VjY2VzczogbG9nLmluY2x1ZGVzKFwiQlVJTEQgU1VDQ0VTU1xcLS0tLVwiKSxcbiAgICAgICAgdGVzdEluZm86IHRlc3RTdW1tYXJ5R3JhbW1hci5maXJzdE1hdGNoKGxvZykgfHwgdW5kZWZpbmVkLFxuICAgIH07XG4gICAgaWYgKCFsb2cpIHtcbiAgICAgICAgbG9nZ2VyLndhcm4oXCJMb2cgd2FzIGVtcHR5XCIpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVsZXZhbnRQYXJ0OiBcIlwiLFxuICAgICAgICAgICAgbWVzc2FnZTogXCJGYWlsZWQgd2l0aCBlbXB0eSBsb2dcIixcbiAgICAgICAgICAgIGluY2x1ZGVGdWxsTG9nOiBmYWxzZSxcbiAgICAgICAgICAgIGRhdGEsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgbWF5YmVGYWlsZWRUb1N0YXJ0ID0gYXBwRmFpbGVkVG9TdGFydChsb2cpO1xuICAgIGlmIChtYXliZUZhaWxlZFRvU3RhcnQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlbGV2YW50UGFydDogbWF5YmVGYWlsZWRUb1N0YXJ0LFxuICAgICAgICAgICAgbWVzc2FnZTogXCJBcHBsaWNhdGlvbiBmYWlsZWQgdG8gc3RhcnRcIixcbiAgICAgICAgICAgIGluY2x1ZGVGdWxsTG9nOiBmYWxzZSxcbiAgICAgICAgICAgIGRhdGEsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gZGVmYXVsdCB0byBtYXZlbiBlcnJvcnNcbiAgICBjb25zdCBtYXliZU1hdmVuRXJyb3JzID0gbWF2ZW5FcnJvcnMobG9nKTtcbiAgICBpZiAobWF5YmVNYXZlbkVycm9ycykge1xuICAgICAgICBsb2dnZXIuaW5mbyhcIlJlY29nbml6ZWQgTWF2ZW4gZXJyb3JcIik7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZWxldmFudFBhcnQ6IG1heWJlTWF2ZW5FcnJvcnMsXG4gICAgICAgICAgICBtZXNzYWdlOiBcIk1hdmVuIGVycm9yc1wiLFxuICAgICAgICAgICAgaW5jbHVkZUZ1bGxMb2c6IGZhbHNlLFxuICAgICAgICAgICAgZGF0YSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBvciBpdCBjb3VsZCBiZSB0aGlzIHByb2JsZW0gaGVyZVxuICAgIGlmIChsb2cubWF0Y2goL0Vycm9yIGNoZWNraW5nIG91dCBhcnRpZmFjdC8pKSB7XG4gICAgICAgIGxvZ2dlci5pbmZvKFwiUmVjb2duaXplZCBhcnRpZmFjdCBlcnJvclwiKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlbGV2YW50UGFydDogbG9nLFxuICAgICAgICAgICAgbWVzc2FnZTogXCJJIGxvc3QgdGhlIGxvY2FsIGNhY2hlLiBQbGVhc2UgcmVidWlsZFwiLFxuICAgICAgICAgICAgaW5jbHVkZUZ1bGxMb2c6IGZhbHNlLFxuICAgICAgICAgICAgZGF0YSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBsb2dnZXIuaW5mbyhcIkRpZCBub3QgZmluZCBhbnl0aGluZyB0byByZWNvZ25pemUgaW4gdGhlIGxvZ1wiKTtcbiAgICByZXR1cm4ge1xuICAgICAgICByZWxldmFudFBhcnQ6IFwiXCIsXG4gICAgICAgIG1lc3NhZ2U6IFwiVW5rbm93biBlcnJvclwiLFxuICAgICAgICBkYXRhLFxuICAgIH07XG59O1xuXG5mdW5jdGlvbiBhcHBGYWlsZWRUb1N0YXJ0KGxvZzogc3RyaW5nKSB7XG4gICAgY29uc3QgbGluZXMgPSBsb2cuc3BsaXQoXCJcXG5cIik7XG4gICAgY29uc3QgZmFpbGVkVG9TdGFydExpbmUgPSBsaW5lcy5pbmRleE9mKFwiQVBQTElDQVRJT04gRkFJTEVEIFRPIFNUQVJUXCIpO1xuICAgIGlmIChmYWlsZWRUb1N0YXJ0TGluZSA8IDEpIHtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgY29uc3QgbGlrZWx5TGluZXMgPSBsaW5lcy5zbGljZShmYWlsZWRUb1N0YXJ0TGluZSArIDMsIGZhaWxlZFRvU3RhcnRMaW5lICsgMTApO1xuICAgIHJldHVybiBsaWtlbHlMaW5lcy5qb2luKFwiXFxuXCIpO1xufVxuXG5leHBvcnQgdHlwZSBNYXZlbkluZm8gPSBCdWlsZEluZm87XG5cbmZ1bmN0aW9uIG1hdmVuRXJyb3JzKGxvZzogc3RyaW5nKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCByZWxldmFudFBhcnQgPSBsb2cuc3BsaXQoXCJcXG5cIilcbiAgICAgICAgLmZpbHRlcihsID0+IGwuc3RhcnRzV2l0aChcIltFUlJPUl1cIikpXG4gICAgICAgIC5tYXAobCA9PiBsLnJlcGxhY2UoXCJbRVJST1JdIFwiLCBcIlwiKSlcbiAgICAgICAgLmpvaW4oXCJcXG5cIik7XG4gICAgaWYgKCFyZWxldmFudFBhcnQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICByZXR1cm4gcmVsZXZhbnRQYXJ0O1xufVxuXG4vLyBNaWNyb2dyYW1tYXJzLi4uXG5cbmNvbnN0IHRpbWluZ0dyYW1tYXIgPSBNaWNyb2dyYW1tYXIuZnJvbVN0cmluZzx7IHNlY29uZHM6IG51bWJlciB9PihcIlRvdGFsIHRpbWU6ICR7c2Vjb25kc30gc1wiLCB7XG4gICAgc2Vjb25kczogRmxvYXQsXG59KTtcblxuLyoqXG4gKiBNaWNyb2dyYW1tYXIgZm9yIE1hdmVuIHRlc3Qgb3V0cHV0XG4gKiBAdHlwZSB7TWljcm9ncmFtbWFyPE1hdmVuSW5mbz59XG4gKi9cbmNvbnN0IHRlc3RTdW1tYXJ5R3JhbW1hciA9IE1pY3JvZ3JhbW1hci5mcm9tU3RyaW5nPFRlc3RTdGF0dXM+KFxuICAgIFwiVGVzdHMgcnVuOiAke3Rlc3RzUnVufSwgRmFpbHVyZXM6ICR7ZmFpbGluZ1Rlc3RzfSwgRXJyb3JzOiAke2Vycm9yc30sIFNraXBwZWQ6ICR7cGVuZGluZ1Rlc3RzfVwiLFxuICAgIHtcbiAgICAgICAgdGVzdHNSdW46IEludGVnZXIsXG4gICAgICAgIGZhaWxpbmdUZXN0czogSW50ZWdlcixcbiAgICAgICAgcGVuZGluZ1Rlc3RzOiBJbnRlZ2VyLFxuICAgICAgICBlcnJvcnM6IEludGVnZXIsXG4gICAgfSk7XG4iXX0=