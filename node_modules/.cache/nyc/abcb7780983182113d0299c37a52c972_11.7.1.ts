"use strict";/*
 * Copyright Â© 2018 Atomist, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cov_12o8fxqbiz=function(){var path="/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/util/github/ghub.ts",hash="490d637a6b904e35fb118b9a5271adaa58e718a7",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/util/github/ghub.ts",statementMap:{"0":{start:{line:17,column:16},end:{line:24,column:1}},"1":{start:{line:18,column:4},end:{line:23,column:7}},"2":{start:{line:19,column:36},end:{line:19,column:97}},"3":{start:{line:19,column:42},end:{line:19,column:70}},"4":{start:{line:19,column:85},end:{line:19,column:95}},"5":{start:{line:20,column:35},end:{line:20,column:100}},"6":{start:{line:20,column:41},end:{line:20,column:73}},"7":{start:{line:20,column:88},end:{line:20,column:98}},"8":{start:{line:21,column:32},end:{line:21,column:149}},"9":{start:{line:21,column:97},end:{line:21,column:119}},"10":{start:{line:22,column:8},end:{line:22,column:78}},"11":{start:{line:25,column:0},end:{line:25,column:62}},"12":{start:{line:26,column:28},end:{line:26,column:65}},"13":{start:{line:27,column:24},end:{line:27,column:93}},"14":{start:{line:28,column:38},end:{line:28,column:121}},"15":{start:{line:29,column:16},end:{line:29,column:64}},"16":{start:{line:30,column:16},end:{line:30,column:32}},"17":{start:{line:31,column:18},end:{line:31,column:51}},"18":{start:{line:33,column:18},end:{line:33,column:113}},"19":{start:{line:34,column:19},end:{line:34,column:37}},"20":{start:{line:35,column:24},end:{line:35,column:51}},"21":{start:{line:36,column:16},end:{line:36,column:79}},"22":{start:{line:37,column:4},end:{line:37,column:90}},"23":{start:{line:38,column:4},end:{line:38,column:282}},"24":{start:{line:38,column:37},end:{line:38,column:208}},"25":{start:{line:38,column:97},end:{line:38,column:207}},"26":{start:{line:40,column:0},end:{line:40,column:36}},"27":{start:{line:53,column:4},end:{line:55,column:5}},"28":{start:{line:54,column:8},end:{line:54,column:27}},"29":{start:{line:56,column:4},end:{line:58,column:5}},"30":{start:{line:57,column:8},end:{line:57,column:27}},"31":{start:{line:59,column:4},end:{line:59,column:119}},"32":{start:{line:60,column:4},end:{line:65,column:6}},"33":{start:{line:68,column:19},end:{line:68,column:37}},"34":{start:{line:69,column:16},end:{line:69,column:69}},"35":{start:{line:70,column:4},end:{line:70,column:79}},"36":{start:{line:71,column:4},end:{line:72,column:185}},"37":{start:{line:71,column:37},end:{line:72,column:122}},"38":{start:{line:72,column:22},end:{line:72,column:121}},"39":{start:{line:74,column:0},end:{line:74,column:30}},"40":{start:{line:76,column:19},end:{line:76,column:37}},"41":{start:{line:77,column:16},end:{line:77,column:69}},"42":{start:{line:78,column:4},end:{line:78,column:85}},"43":{start:{line:79,column:4},end:{line:80,column:185}},"44":{start:{line:79,column:37},end:{line:80,column:122}},"45":{start:{line:80,column:22},end:{line:80,column:121}},"46":{start:{line:82,column:0},end:{line:82,column:48}},"47":{start:{line:84,column:19},end:{line:84,column:37}},"48":{start:{line:85,column:16},end:{line:85,column:60}},"49":{start:{line:86,column:4},end:{line:86,column:68}},"50":{start:{line:87,column:4},end:{line:92,column:7}},"51":{start:{line:89,column:8},end:{line:89,column:54}},"52":{start:{line:90,column:8},end:{line:90,column:60}},"53":{start:{line:91,column:8},end:{line:91,column:80}},"54":{start:{line:94,column:0},end:{line:94,column:44}},"55":{start:{line:96,column:19},end:{line:96,column:37}},"56":{start:{line:97,column:16},end:{line:97,column:69}},"57":{start:{line:98,column:4},end:{line:98,column:87}},"58":{start:{line:99,column:4},end:{line:100,column:201}},"59":{start:{line:99,column:37},end:{line:100,column:130}},"60":{start:{line:100,column:22},end:{line:100,column:129}},"61":{start:{line:102,column:0},end:{line:102,column:38}},"62":{start:{line:104,column:19},end:{line:104,column:37}},"63":{start:{line:105,column:16},end:{line:105,column:89}},"64":{start:{line:106,column:4},end:{line:107,column:29}},"65":{start:{line:107,column:20},end:{line:107,column:27}},"66":{start:{line:109,column:0},end:{line:109,column:48}},"67":{start:{line:111,column:4},end:{line:116,column:13}},"68":{start:{line:118,column:0},end:{line:118,column:34}},"69":{start:{line:121,column:19},end:{line:121,column:37}},"70":{start:{line:122,column:16},end:{line:122,column:76}},"71":{start:{line:123,column:4},end:{line:124,column:40}},"72":{start:{line:124,column:20},end:{line:124,column:38}},"73":{start:{line:126,column:0},end:{line:126,column:48}},"74":{start:{line:128,column:19},end:{line:128,column:37}},"75":{start:{line:129,column:16},end:{line:129,column:60}},"76":{start:{line:130,column:4},end:{line:139,column:7}},"77":{start:{line:132,column:28},end:{line:132,column:43}},"78":{start:{line:133,column:8},end:{line:133,column:89}},"79":{start:{line:134,column:8},end:{line:134,column:28}},"80":{start:{line:137,column:8},end:{line:137,column:119}},"81":{start:{line:138,column:8},end:{line:138,column:21}},"82":{start:{line:141,column:0},end:{line:141,column:36}},"83":{start:{line:144,column:16},end:{line:144,column:119}},"84":{start:{line:145,column:16},end:{line:145,column:85}},"85":{start:{line:146,column:4},end:{line:146,column:76}},"86":{start:{line:147,column:4},end:{line:147,column:84}},"87":{start:{line:149,column:0},end:{line:149,column:34}},"88":{start:{line:151,column:4},end:{line:159,column:7}},"89":{start:{line:152,column:24},end:{line:154,column:9}},"90":{start:{line:155,column:20},end:{line:155,column:123}},"91":{start:{line:156,column:20},end:{line:156,column:74}},"92":{start:{line:157,column:23},end:{line:157,column:62}},"93":{start:{line:158,column:8},end:{line:158,column:33}},"94":{start:{line:161,column:0},end:{line:161,column:32}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:17,column:44},end:{line:17,column:45}},loc:{start:{line:17,column:89},end:{line:24,column:1}},line:17},"1":{name:"(anonymous_1)",decl:{start:{line:18,column:36},end:{line:18,column:37}},loc:{start:{line:18,column:63},end:{line:23,column:5}},line:18},"2":{name:"fulfilled",decl:{start:{line:19,column:17},end:{line:19,column:26}},loc:{start:{line:19,column:34},end:{line:19,column:99}},line:19},"3":{name:"rejected",decl:{start:{line:20,column:17},end:{line:20,column:25}},loc:{start:{line:20,column:33},end:{line:20,column:102}},line:20},"4":{name:"step",decl:{start:{line:21,column:17},end:{line:21,column:21}},loc:{start:{line:21,column:30},end:{line:21,column:151}},line:21},"5":{name:"(anonymous_5)",decl:{start:{line:21,column:76},end:{line:21,column:77}},loc:{start:{line:21,column:95},end:{line:21,column:121}},line:21},"6":{name:"createStatus",decl:{start:{line:32,column:9},end:{line:32,column:21}},loc:{start:{line:32,column:52},end:{line:39,column:1}},line:32},"7":{name:"(anonymous_7)",decl:{start:{line:38,column:31},end:{line:38,column:32}},loc:{start:{line:38,column:37},end:{line:38,column:208}},line:38},"8":{name:"(anonymous_8)",decl:{start:{line:38,column:90},end:{line:38,column:91}},loc:{start:{line:38,column:97},end:{line:38,column:207}},line:38},"9":{name:"ensureValidUrl",decl:{start:{line:52,column:9},end:{line:52,column:23}},loc:{start:{line:52,column:37},end:{line:66,column:1}},line:52},"10":{name:"createTag",decl:{start:{line:67,column:9},end:{line:67,column:18}},loc:{start:{line:67,column:35},end:{line:73,column:1}},line:67},"11":{name:"(anonymous_11)",decl:{start:{line:71,column:31},end:{line:71,column:32}},loc:{start:{line:71,column:37},end:{line:72,column:122}},line:71},"12":{name:"(anonymous_12)",decl:{start:{line:72,column:15},end:{line:72,column:16}},loc:{start:{line:72,column:22},end:{line:72,column:121}},line:72},"13":{name:"createTagReference",decl:{start:{line:75,column:9},end:{line:75,column:27}},loc:{start:{line:75,column:44},end:{line:81,column:1}},line:75},"14":{name:"(anonymous_14)",decl:{start:{line:79,column:31},end:{line:79,column:32}},loc:{start:{line:79,column:37},end:{line:80,column:122}},line:79},"15":{name:"(anonymous_15)",decl:{start:{line:80,column:15},end:{line:80,column:16}},loc:{start:{line:80,column:22},end:{line:80,column:121}},line:80},"16":{name:"deleteRepository",decl:{start:{line:83,column:9},end:{line:83,column:25}},loc:{start:{line:83,column:37},end:{line:93,column:1}},line:83},"17":{name:"(anonymous_17)",decl:{start:{line:88,column:15},end:{line:88,column:16}},loc:{start:{line:88,column:22},end:{line:92,column:5}},line:88},"18":{name:"createRelease",decl:{start:{line:95,column:9},end:{line:95,column:22}},loc:{start:{line:95,column:43},end:{line:101,column:1}},line:95},"19":{name:"(anonymous_19)",decl:{start:{line:99,column:31},end:{line:99,column:32}},loc:{start:{line:99,column:37},end:{line:100,column:130}},line:99},"20":{name:"(anonymous_20)",decl:{start:{line:100,column:15},end:{line:100,column:16}},loc:{start:{line:100,column:22},end:{line:100,column:129}},line:100},"21":{name:"listCommitsBetween",decl:{start:{line:103,column:9},end:{line:103,column:27}},loc:{start:{line:103,column:54},end:{line:108,column:1}},line:103},"22":{name:"(anonymous_22)",decl:{start:{line:107,column:14},end:{line:107,column:15}},loc:{start:{line:107,column:20},end:{line:107,column:27}},line:107},"23":{name:"authHeaders",decl:{start:{line:110,column:9},end:{line:110,column:20}},loc:{start:{line:110,column:28},end:{line:117,column:1}},line:110},"24":{name:"tipOfDefaultBranch",decl:{start:{line:119,column:9},end:{line:119,column:27}},loc:{start:{line:119,column:39},end:{line:125,column:1}},line:119},"25":{name:"(anonymous_25)",decl:{start:{line:124,column:14},end:{line:124,column:15}},loc:{start:{line:124,column:20},end:{line:124,column:38}},line:124},"26":{name:"isPublicRepo",decl:{start:{line:127,column:9},end:{line:127,column:21}},loc:{start:{line:127,column:33},end:{line:140,column:1}},line:127},"27":{name:"(anonymous_27)",decl:{start:{line:131,column:14},end:{line:131,column:15}},loc:{start:{line:131,column:20},end:{line:135,column:5}},line:131},"28":{name:"(anonymous_28)",decl:{start:{line:136,column:15},end:{line:136,column:16}},loc:{start:{line:136,column:21},end:{line:139,column:5}},line:136},"29":{name:"updateIssue",decl:{start:{line:143,column:9},end:{line:143,column:20}},loc:{start:{line:143,column:52},end:{line:148,column:1}},line:143},"30":{name:"listTopics",decl:{start:{line:150,column:9},end:{line:150,column:19}},loc:{start:{line:150,column:31},end:{line:160,column:1}},line:150},"31":{name:"(anonymous_31)",decl:{start:{line:151,column:43},end:{line:151,column:44}},loc:{start:{line:151,column:56},end:{line:159,column:5}},line:151}},branchMap:{"0":{loc:{start:{line:17,column:16},end:{line:24,column:1}},type:"binary-expr",locations:[{start:{line:17,column:17},end:{line:17,column:21}},{start:{line:17,column:25},end:{line:17,column:39}},{start:{line:17,column:44},end:{line:24,column:1}}],line:17},"1":{loc:{start:{line:18,column:16},end:{line:18,column:34}},type:"binary-expr",locations:[{start:{line:18,column:16},end:{line:18,column:17}},{start:{line:18,column:22},end:{line:18,column:33}}],line:18},"2":{loc:{start:{line:21,column:32},end:{line:21,column:148}},type:"cond-expr",locations:[{start:{line:21,column:46},end:{line:21,column:67}},{start:{line:21,column:70},end:{line:21,column:148}}],line:21},"3":{loc:{start:{line:22,column:51},end:{line:22,column:67}},type:"binary-expr",locations:[{start:{line:22,column:51},end:{line:22,column:61}},{start:{line:22,column:65},end:{line:22,column:67}}],line:22},"4":{loc:{start:{line:33,column:18},end:{line:33,column:113}},type:"cond-expr",locations:[{start:{line:33,column:82},end:{line:33,column:99}},{start:{line:33,column:102},end:{line:33,column:113}}],line:33},"5":{loc:{start:{line:53,column:4},end:{line:55,column:5}},type:"if",locations:[{start:{line:53,column:4},end:{line:55,column:5}},{start:{line:53,column:4},end:{line:55,column:5}}],line:53},"6":{loc:{start:{line:56,column:4},end:{line:58,column:5}},type:"if",locations:[{start:{line:56,column:4},end:{line:58,column:5}},{start:{line:56,column:4},end:{line:58,column:5}}],line:56},"7":{loc:{start:{line:111,column:11},end:{line:116,column:12}},type:"cond-expr",locations:[{start:{line:111,column:19},end:{line:115,column:5}},{start:{line:116,column:10},end:{line:116,column:12}}],line:111},"8":{loc:{start:{line:144,column:16},end:{line:144,column:119}},type:"cond-expr",locations:[{start:{line:144,column:54},end:{line:144,column:56}},{start:{line:144,column:59},end:{line:144,column:119}}],line:144},"9":{loc:{start:{line:155,column:20},end:{line:155,column:123}},type:"cond-expr",locations:[{start:{line:155,column:58},end:{line:155,column:60}},{start:{line:155,column:63},end:{line:155,column:123}}],line:155}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0},b:{"0":[0,0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var __awaiter=(cov_12o8fxqbiz.s[0]++,(cov_12o8fxqbiz.b[0][0]++,this)&&(cov_12o8fxqbiz.b[0][1]++,this.__awaiter)||(cov_12o8fxqbiz.b[0][2]++,function(thisArg,_arguments,P,generator){cov_12o8fxqbiz.f[0]++;cov_12o8fxqbiz.s[1]++;return new((cov_12o8fxqbiz.b[1][0]++,P)||(cov_12o8fxqbiz.b[1][1]++,P=Promise))(function(resolve,reject){cov_12o8fxqbiz.f[1]++;function fulfilled(value){cov_12o8fxqbiz.f[2]++;cov_12o8fxqbiz.s[2]++;try{cov_12o8fxqbiz.s[3]++;step(generator.next(value));}catch(e){cov_12o8fxqbiz.s[4]++;reject(e);}}function rejected(value){cov_12o8fxqbiz.f[3]++;cov_12o8fxqbiz.s[5]++;try{cov_12o8fxqbiz.s[6]++;step(generator["throw"](value));}catch(e){cov_12o8fxqbiz.s[7]++;reject(e);}}function step(result){cov_12o8fxqbiz.f[4]++;cov_12o8fxqbiz.s[8]++;result.done?(cov_12o8fxqbiz.b[2][0]++,resolve(result.value)):(cov_12o8fxqbiz.b[2][1]++,new P(function(resolve){cov_12o8fxqbiz.f[5]++;cov_12o8fxqbiz.s[9]++;resolve(result.value);}).then(fulfilled,rejected));}cov_12o8fxqbiz.s[10]++;step((generator=generator.apply(thisArg,(cov_12o8fxqbiz.b[3][0]++,_arguments)||(cov_12o8fxqbiz.b[3][1]++,[]))).next());});}));cov_12o8fxqbiz.s[11]++;Object.defineProperty(exports,"__esModule",{value:true});const automation_client_1=(cov_12o8fxqbiz.s[12]++,require("@atomist/automation-client"));const GitHubRepoRef_1=(cov_12o8fxqbiz.s[13]++,require("@atomist/automation-client/operations/common/GitHubRepoRef"));const ProjectOperationCredentials_1=(cov_12o8fxqbiz.s[14]++,require("@atomist/automation-client/operations/common/ProjectOperationCredentials"));const retry_1=(cov_12o8fxqbiz.s[15]++,require("@atomist/automation-client/util/retry"));const axios_1=(cov_12o8fxqbiz.s[16]++,require("axios"));const toToken_1=(cov_12o8fxqbiz.s[17]++,require("../credentials/toToken"));function createStatus(tokenSource,rr,inputStatus){cov_12o8fxqbiz.f[6]++;const token=(cov_12o8fxqbiz.s[18]++,ProjectOperationCredentials_1.isTokenCredentials(tokenSource)?(cov_12o8fxqbiz.b[4][0]++,tokenSource.token):(cov_12o8fxqbiz.b[4][1]++,tokenSource));const config=(cov_12o8fxqbiz.s[19]++,authHeaders(token));const saferStatus=(cov_12o8fxqbiz.s[20]++,ensureValidUrl(inputStatus));const url=(cov_12o8fxqbiz.s[21]++,`${rr.apiBase}/repos/${rr.owner}/${rr.repo}/statuses/${rr.sha}`);cov_12o8fxqbiz.s[22]++;automation_client_1.logger.info("Updating github status: %s to %j",url,saferStatus);cov_12o8fxqbiz.s[23]++;return retry_1.doWithRetry(()=>{cov_12o8fxqbiz.f[7]++;cov_12o8fxqbiz.s[24]++;return axios_1.default.post(url,saferStatus,config).catch(err=>{cov_12o8fxqbiz.f[8]++;cov_12o8fxqbiz.s[25]++;return Promise.reject(new Error(`Error hitting ${url} to set status ${JSON.stringify(saferStatus)}: ${err.message}`));});},`Updating github status: ${url} to ${JSON.stringify(saferStatus)}`,{});}cov_12o8fxqbiz.s[26]++;exports.createStatus=createStatus;/*
 * If you send a targetUrl that doesn't work, GitHub will not accept the status.
 * Commonly on findArtifact, we get a Docker image name instead, and people really want
 * to put that in the URL but it doesn't work.
 *
 * This limitation exists only because we are using GitHub Statuses for Goals right now,
 * and when we move to a custom event it won't be the same problem. So it makes sense
 * to encode the limitation here.
 *
 * Yes the description is going to be ugly. Deal with it.
 */function ensureValidUrl(inputStatus){cov_12o8fxqbiz.f[9]++;cov_12o8fxqbiz.s[27]++;if(!inputStatus.target_url){cov_12o8fxqbiz.b[5][0]++;cov_12o8fxqbiz.s[28]++;return inputStatus;}else{cov_12o8fxqbiz.b[5][1]++;}cov_12o8fxqbiz.s[29]++;if(inputStatus.target_url.startsWith("http")){cov_12o8fxqbiz.b[6][0]++;cov_12o8fxqbiz.s[30]++;return inputStatus;}else{cov_12o8fxqbiz.b[6][1]++;}cov_12o8fxqbiz.s[31]++;automation_client_1.logger.warn("Illegal to send a non-url in target_url, so I'm appending it to the description");cov_12o8fxqbiz.s[32]++;return{target_url:undefined,description:inputStatus.description+" at "+inputStatus.target_url,state:inputStatus.state,context:inputStatus.context};}function createTag(token,rr,tag){cov_12o8fxqbiz.f[10]++;const config=(cov_12o8fxqbiz.s[33]++,authHeaders(token));const url=(cov_12o8fxqbiz.s[34]++,`${rr.apiBase}/repos/${rr.owner}/${rr.repo}/git/tags`);cov_12o8fxqbiz.s[35]++;automation_client_1.logger.info("Updating github tag: %s to %j",url,tag);cov_12o8fxqbiz.s[36]++;return retry_1.doWithRetry(()=>{cov_12o8fxqbiz.f[11]++;cov_12o8fxqbiz.s[37]++;return axios_1.default.post(url,tag,config).catch(err=>{cov_12o8fxqbiz.f[12]++;cov_12o8fxqbiz.s[38]++;return Promise.reject(new Error(`Error hitting ${url} to set tag ${JSON.stringify(tag)}: ${err.message}`));});},`Updating github tag: ${url} to ${JSON.stringify(tag)}`,{});}cov_12o8fxqbiz.s[39]++;exports.createTag=createTag;function createTagReference(token,rr,tag){cov_12o8fxqbiz.f[13]++;const config=(cov_12o8fxqbiz.s[40]++,authHeaders(token));const url=(cov_12o8fxqbiz.s[41]++,`${rr.apiBase}/repos/${rr.owner}/${rr.repo}/git/refs`);cov_12o8fxqbiz.s[42]++;automation_client_1.logger.info("Creating github reference: %s to %j",url,tag);cov_12o8fxqbiz.s[43]++;return retry_1.doWithRetry(()=>{cov_12o8fxqbiz.f[14]++;cov_12o8fxqbiz.s[44]++;return axios_1.default.post(url,{ref:`refs/tags/${tag.tag}`,sha:tag.object},config).catch(err=>{cov_12o8fxqbiz.f[15]++;cov_12o8fxqbiz.s[45]++;return Promise.reject(new Error(`Error hitting ${url} to set tag ${JSON.stringify(tag)}: ${err.message}`));});},`Updating github tag: ${url} to ${JSON.stringify(tag)}`,{});}cov_12o8fxqbiz.s[46]++;exports.createTagReference=createTagReference;function deleteRepository(token,rr){cov_12o8fxqbiz.f[16]++;const config=(cov_12o8fxqbiz.s[47]++,authHeaders(token));const url=(cov_12o8fxqbiz.s[48]++,`${rr.apiBase}/repos/${rr.owner}/${rr.repo}`);cov_12o8fxqbiz.s[49]++;automation_client_1.logger.info("Deleting repository: %s",url);cov_12o8fxqbiz.s[50]++;return axios_1.default.delete(url,config).catch(err=>{cov_12o8fxqbiz.f[17]++;cov_12o8fxqbiz.s[51]++;automation_client_1.logger.error(err.message);cov_12o8fxqbiz.s[52]++;automation_client_1.logger.error(err.response.body);cov_12o8fxqbiz.s[53]++;return Promise.reject(new Error(`Error hitting ${url} to delete repo`));});}cov_12o8fxqbiz.s[54]++;exports.deleteRepository=deleteRepository;function createRelease(token,rr,release){cov_12o8fxqbiz.f[18]++;const config=(cov_12o8fxqbiz.s[55]++,authHeaders(token));const url=(cov_12o8fxqbiz.s[56]++,`${rr.apiBase}/repos/${rr.owner}/${rr.repo}/releases`);cov_12o8fxqbiz.s[57]++;automation_client_1.logger.info("Updating github release: %s to %j",url,release);cov_12o8fxqbiz.s[58]++;return retry_1.doWithRetry(()=>{cov_12o8fxqbiz.f[19]++;cov_12o8fxqbiz.s[59]++;return axios_1.default.post(url,release,config).catch(err=>{cov_12o8fxqbiz.f[20]++;cov_12o8fxqbiz.s[60]++;return Promise.reject(new Error(`Error hitting ${url} to set release ${JSON.stringify(release)}: ${err.message}`));});},`Updating github release: ${url} to ${JSON.stringify(release)}`,{});}cov_12o8fxqbiz.s[61]++;exports.createRelease=createRelease;function listCommitsBetween(token,rr,startSha,end){cov_12o8fxqbiz.f[21]++;const config=(cov_12o8fxqbiz.s[62]++,authHeaders(token));const url=(cov_12o8fxqbiz.s[63]++,`${rr.apiBase}/repos/${rr.owner}/${rr.repo}/compare/${startSha}...${end}`);cov_12o8fxqbiz.s[64]++;return axios_1.default.get(url,config).then(ap=>{cov_12o8fxqbiz.f[22]++;cov_12o8fxqbiz.s[65]++;return ap.data;});}cov_12o8fxqbiz.s[66]++;exports.listCommitsBetween=listCommitsBetween;function authHeaders(token){cov_12o8fxqbiz.f[23]++;cov_12o8fxqbiz.s[67]++;return token?(cov_12o8fxqbiz.b[7][0]++,{headers:{Authorization:`token ${token}`}}):(cov_12o8fxqbiz.b[7][1]++,{});}cov_12o8fxqbiz.s[68]++;exports.authHeaders=authHeaders;function tipOfDefaultBranch(token,rr){cov_12o8fxqbiz.f[24]++;// TODO: use real default branch
const config=(cov_12o8fxqbiz.s[69]++,authHeaders(token));const url=(cov_12o8fxqbiz.s[70]++,`${rr.apiBase}/repos/${rr.owner}/${rr.repo}/branches/master`);cov_12o8fxqbiz.s[71]++;return axios_1.default.get(url,config).then(ap=>{cov_12o8fxqbiz.f[25]++;cov_12o8fxqbiz.s[72]++;return ap.data.commit.sha;});}cov_12o8fxqbiz.s[73]++;exports.tipOfDefaultBranch=tipOfDefaultBranch;function isPublicRepo(token,rr){cov_12o8fxqbiz.f[26]++;const config=(cov_12o8fxqbiz.s[74]++,authHeaders(token));const url=(cov_12o8fxqbiz.s[75]++,`${rr.apiBase}/repos/${rr.owner}/${rr.repo}`);cov_12o8fxqbiz.s[76]++;return axios_1.default.get(url,config).then(ap=>{cov_12o8fxqbiz.f[27]++;const privateness=(cov_12o8fxqbiz.s[77]++,ap.data.private);cov_12o8fxqbiz.s[78]++;automation_client_1.logger.info(`Retrieved ${url}. Private is '${privateness}'`);cov_12o8fxqbiz.s[79]++;return!privateness;}).catch(ap=>{cov_12o8fxqbiz.f[28]++;cov_12o8fxqbiz.s[80]++;automation_client_1.logger.warn(`Could not access ${url} to determine repo visibility: ${ap.response.status}`);cov_12o8fxqbiz.s[81]++;return false;});}cov_12o8fxqbiz.s[82]++;exports.isPublicRepo=isPublicRepo;// TODO move to client
function updateIssue(creds,rr,issueNumber,issue){cov_12o8fxqbiz.f[29]++;const grr=(cov_12o8fxqbiz.s[83]++,GitHubRepoRef_1.isGitHubRepoRef(rr)?(cov_12o8fxqbiz.b[8][0]++,rr):(cov_12o8fxqbiz.b[8][1]++,new GitHubRepoRef_1.GitHubRepoRef(rr.owner,rr.repo,rr.sha)));const url=(cov_12o8fxqbiz.s[84]++,`${grr.apiBase}/repos/${grr.owner}/${grr.repo}/issues/${issueNumber}`);cov_12o8fxqbiz.s[85]++;automation_client_1.logger.debug(`Request to '${url}' to update issue`);cov_12o8fxqbiz.s[86]++;return axios_1.default.patch(url,issue,authHeaders(toToken_1.toToken(creds)));}cov_12o8fxqbiz.s[87]++;exports.updateIssue=updateIssue;function listTopics(token,rr){cov_12o8fxqbiz.f[30]++;cov_12o8fxqbiz.s[88]++;return __awaiter(this,void 0,void 0,function*(){cov_12o8fxqbiz.f[31]++;const headers=(cov_12o8fxqbiz.s[89]++,{headers:Object.assign({},authHeaders(token).headers,{Accept:"application/vnd.github.mercy-preview+json"})});const grr=(cov_12o8fxqbiz.s[90]++,GitHubRepoRef_1.isGitHubRepoRef(rr)?(cov_12o8fxqbiz.b[9][0]++,rr):(cov_12o8fxqbiz.b[9][1]++,new GitHubRepoRef_1.GitHubRepoRef(rr.owner,rr.repo,rr.sha)));const url=(cov_12o8fxqbiz.s[91]++,`${grr.apiBase}/repos/${grr.owner}/${grr.repo}/topics`);const topics=(cov_12o8fxqbiz.s[92]++,yield axios_1.default.get(url,headers));cov_12o8fxqbiz.s[93]++;return topics.data.names;});}cov_12o8fxqbiz.s[94]++;exports.listTopics=listTopics;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL3JvZGpvaG5zb24vc2ZvcnphbmRvLWRldi9pZGVhLXByb2plY3RzL215LWZsb3cvc3JjL3V0aWwvZ2l0aHViL2dodWIudHMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2Rqb2huc29uL3Nmb3J6YW5kby1kZXYvaWRlYS1wcm9qZWN0cy9teS1mbG93L3NyYy91dGlsL2dpdGh1Yi9naHViLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7Ozs7R0FjRzs7Ozs7Ozs7OztBQUVILGtFQUFvRDtBQUNwRCw4RkFBNEc7QUFDNUcsMEhBR2tGO0FBR2xGLGlFQUFvRTtBQUNwRSxpQ0FBZ0U7QUFDaEUsb0RBQWlEO0FBV2pELHNCQUE2QixXQUFpRCxFQUFFLEVBQWlCLEVBQUUsV0FBbUI7SUFDbEgsTUFBTSxLQUFLLEdBQUcsZ0RBQWtCLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFdBQXFCLENBQUM7SUFDMUYsTUFBTSxNQUFNLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2xDLE1BQU0sV0FBVyxHQUFHLGNBQWMsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNoRCxNQUFNLEdBQUcsR0FBRyxHQUFHLEVBQUUsQ0FBQyxPQUFPLFVBQVUsRUFBRSxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUMsSUFBSSxhQUFhLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUM1RSwwQkFBTSxDQUFDLElBQUksQ0FBQyxrQ0FBa0MsRUFBRSxHQUFHLEVBQUUsV0FBVyxDQUFDLENBQUM7SUFDbEUsT0FBTyxtQkFBVyxDQUFDLEdBQUcsRUFBRSxDQUNwQixlQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxXQUFXLEVBQUUsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQzdDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsaUJBQWlCLEdB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Z2h0IMKpIDIwMTggQXRvbWlzdCwgSW5jLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwiQGF0b21pc3QvYXV0b21hdGlvbi1jbGllbnRcIjtcbmltcG9ydCB7IEdpdEh1YlJlcG9SZWYsIGlzR2l0SHViUmVwb1JlZiB9IGZyb20gXCJAYXRvbWlzdC9hdXRvbWF0aW9uLWNsaWVudC9vcGVyYXRpb25zL2NvbW1vbi9HaXRIdWJSZXBvUmVmXCI7XG5pbXBvcnQge1xuICAgIGlzVG9rZW5DcmVkZW50aWFscyxcbiAgICBQcm9qZWN0T3BlcmF0aW9uQ3JlZGVudGlhbHMsXG59IGZyb20gXCJAYXRvbWlzdC9hdXRvbWF0aW9uLWNsaWVudC9vcGVyYXRpb25zL2NvbW1vbi9Qcm9qZWN0T3BlcmF0aW9uQ3JlZGVudGlhbHNcIjtcbmltcG9ydCB7IFJlbW90ZVJlcG9SZWYgfSBmcm9tIFwiQGF0b21pc3QvYXV0b21hdGlvbi1jbGllbnQvb3BlcmF0aW9ucy9jb21tb24vUmVwb0lkXCI7XG5pbXBvcnQgeyBJc3N1ZSB9IGZyb20gXCJAYXRvbWlzdC9hdXRvbWF0aW9uLWNsaWVudC91dGlsL2dpdEh1YlwiO1xuaW1wb3J0IHsgZG9XaXRoUmV0cnkgfSBmcm9tIFwiQGF0b21pc3QvYXV0b21hdGlvbi1jbGllbnQvdXRpbC9yZXRyeVwiO1xuaW1wb3J0IGF4aW9zLCB7IEF4aW9zUHJvbWlzZSwgQXhpb3NSZXF1ZXN0Q29uZmlnIH0gZnJvbSBcImF4aW9zXCI7XG5pbXBvcnQgeyB0b1Rva2VuIH0gZnJvbSBcIi4uL2NyZWRlbnRpYWxzL3RvVG9rZW5cIjtcblxuZXhwb3J0IHR5cGUgU3RhdGUgPSBcImVycm9yXCIgfCBcImZhaWx1cmVcIiB8IFwicGVuZGluZ1wiIHwgXCJzdWNjZXNzXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdHVzIHtcbiAgICBzdGF0ZTogU3RhdGU7XG4gICAgdGFyZ2V0X3VybD86IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgICBjb250ZXh0Pzogc3RyaW5nO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU3RhdHVzKHRva2VuU291cmNlOiBzdHJpbmcgfCBQcm9qZWN0T3BlcmF0aW9uQ3JlZGVudGlhbHMsIHJyOiBHaXRIdWJSZXBvUmVmLCBpbnB1dFN0YXR1czogU3RhdHVzKTogQXhpb3NQcm9taXNlIHtcbiAgICBjb25zdCB0b2tlbiA9IGlzVG9rZW5DcmVkZW50aWFscyh0b2tlblNvdXJjZSkgPyB0b2tlblNvdXJjZS50b2tlbiA6IHRva2VuU291cmNlIGFzIHN0cmluZztcbiAgICBjb25zdCBjb25maWcgPSBhdXRoSGVhZGVycyh0b2tlbik7XG4gICAgY29uc3Qgc2FmZXJTdGF0dXMgPSBlbnN1cmVWYWxpZFVybChpbnB1dFN0YXR1cyk7XG4gICAgY29uc3QgdXJsID0gYCR7cnIuYXBpQmFzZX0vcmVwb3MvJHtyci5vd25lcn0vJHtyci5yZXBvfS9zdGF0dXNlcy8ke3JyLnNoYX1gO1xuICAgIGxvZ2dlci5pbmZvKFwiVXBkYXRpbmcgZ2l0aHViIHN0YXR1czogJXMgdG8gJWpcIiwgdXJsLCBzYWZlclN0YXR1cyk7XG4gICAgcmV0dXJuIGRvV2l0aFJldHJ5KCgpID0+XG4gICAgICAgIGF4aW9zLnBvc3QodXJsLCBzYWZlclN0YXR1cywgY29uZmlnKS5jYXRjaChlcnIgPT5cbiAgICAgICAgICAgIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihgRXJyb3IgaGl0dGluZyAke3VybH0gdG8gc2V0IHN0YXR1cyAke0pTT04uc3RyaW5naWZ5KHNhZmVyU3RhdHVzKX06ICR7ZXJyLm1lc3NhZ2V9YCkpLFxuICAgICAgICApLCBgVXBkYXRpbmcgZ2l0aHViIHN0YXR1czogJHt1cmx9IHRvICR7SlNPTi5zdHJpbmdpZnkoc2FmZXJTdGF0dXMpfWAsIHt9KTtcbn1cblxuLypcbiAqIElmIHlvdSBzZW5kIGEgdGFyZ2V0VXJsIHRoYXQgZG9lc24ndCB3b3JrLCBHaXRIdWIgd2lsbCBub3QgYWNjZXB0IHRoZSBzdGF0dXMuXG4gKiBDb21tb25seSBvbiBmaW5kQXJ0aWZhY3QsIHdlIGdldCBhIERvY2tlciBpbWFnZSBuYW1lIGluc3RlYWQsIGFuZCBwZW9wbGUgcmVhbGx5IHdhbnRcbiAqIHRvIHB1dCB0aGF0IGluIHRoZSBVUkwgYnV0IGl0IGRvZXNuJ3Qgd29yay5cbiAqXG4gKiBUaGlzIGxpbWl0YXRpb24gZXhpc3RzIG9ubHkgYmVjYXVzZSB3ZSBhcmUgdXNpbmcgR2l0SHViIFN0YXR1c2VzIGZvciBHb2FscyByaWdodCBub3csXG4gKiBhbmQgd2hlbiB3ZSBtb3ZlIHRvIGEgY3VzdG9tIGV2ZW50IGl0IHdvbid0IGJlIHRoZSBzYW1lIHByb2JsZW0uIFNvIGl0IG1ha2VzIHNlbnNlXG4gKiB0byBlbmNvZGUgdGhlIGxpbWl0YXRpb24gaGVyZS5cbiAqXG4gKiBZZXMgdGhlIGRlc2NyaXB0aW9uIGlzIGdvaW5nIHRvIGJlIHVnbHkuIERlYWwgd2l0aCBpdC5cbiAqL1xuZnVuY3Rpb24gZW5zdXJlVmFsaWRVcmwoaW5wdXRTdGF0dXM6IFN0YXR1cyk6IFN0YXR1cyB7XG5cbiAgICBpZiAoIWlucHV0U3RhdHVzLnRhcmdldF91cmwpIHtcbiAgICAgICAgcmV0dXJuIGlucHV0U3RhdHVzO1xuICAgIH1cbiAgICBpZiAoaW5wdXRTdGF0dXMudGFyZ2V0X3VybC5zdGFydHNXaXRoKFwiaHR0cFwiKSkge1xuICAgICAgICByZXR1cm4gaW5wdXRTdGF0dXM7XG4gICAgfVxuICAgIGxvZ2dlci53YXJuKFwiSWxsZWdhbCB0byBzZW5kIGEgbm9uLXVybCBpbiB0YXJnZXRfdXJsLCBzbyBJJ20gYXBwZW5kaW5nIGl0IHRvIHRoZSBkZXNjcmlwdGlvblwiKTtcbiAgICByZXR1cm4ge1xuICAgICAgICB0YXJnZXRfdXJsOiB1bmRlZmluZWQsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBpbnB1dFN0YXR1cy5kZXNjcmlwdGlvbiArIFwiIGF0IFwiICsgaW5wdXRTdGF0dXMudGFyZ2V0X3VybCxcbiAgICAgICAgc3RhdGU6IGlucHV0U3RhdHVzLnN0YXRlLFxuICAgICAgICBjb250ZXh0OiBpbnB1dFN0YXR1cy5jb250ZXh0LFxuICAgIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGFnIHtcbiAgICB0YWc6IHN0cmluZztcbiAgICBtZXNzYWdlOiBzdHJpbmc7XG5cbiAgICAvKiogQ29tbWl0IHNoYSAqL1xuICAgIG9iamVjdDogc3RyaW5nO1xuICAgIHR5cGU6IHN0cmluZztcbiAgICB0YWdnZXI6IHtcbiAgICAgICAgbmFtZTogc3RyaW5nO1xuICAgICAgICBlbWFpbDogc3RyaW5nO1xuICAgICAgICBkYXRlOiBzdHJpbmc7XG4gICAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVRhZyh0b2tlbjogc3RyaW5nLCBycjogR2l0SHViUmVwb1JlZiwgdGFnOiBUYWcpOiBBeGlvc1Byb21pc2Uge1xuICAgIGNvbnN0IGNvbmZpZyA9IGF1dGhIZWFkZXJzKHRva2VuKTtcbiAgICBjb25zdCB1cmwgPSBgJHtyci5hcGlCYXNlfS9yZXBvcy8ke3JyLm93bmVyfS8ke3JyLnJlcG99L2dpdC90YWdzYDtcbiAgICBsb2dnZXIuaW5mbyhcIlVwZGF0aW5nIGdpdGh1YiB0YWc6ICVzIHRvICVqXCIsIHVybCwgdGFnKTtcbiAgICByZXR1cm4gZG9XaXRoUmV0cnkoKCkgPT4gYXhpb3MucG9zdCh1cmwsIHRhZywgY29uZmlnKVxuICAgICAgICAuY2F0Y2goZXJyID0+XG4gICAgICAgICAgICBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoYEVycm9yIGhpdHRpbmcgJHt1cmx9IHRvIHNldCB0YWcgJHtKU09OLnN0cmluZ2lmeSh0YWcpfTogJHtlcnIubWVzc2FnZX1gKSksXG4gICAgICAgICksIGBVcGRhdGluZyBnaXRodWIgdGFnOiAke3VybH0gdG8gJHtKU09OLnN0cmluZ2lmeSh0YWcpfWAsIHt9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVRhZ1JlZmVyZW5jZSh0b2tlbjogc3RyaW5nLCBycjogR2l0SHViUmVwb1JlZiwgdGFnOiBUYWcpOiBBeGlvc1Byb21pc2Uge1xuICAgIGNvbnN0IGNvbmZpZyA9IGF1dGhIZWFkZXJzKHRva2VuKTtcbiAgICBjb25zdCB1cmwgPSBgJHtyci5hcGlCYXNlfS9yZXBvcy8ke3JyLm93bmVyfS8ke3JyLnJlcG99L2dpdC9yZWZzYDtcbiAgICBsb2dnZXIuaW5mbyhcIkNyZWF0aW5nIGdpdGh1YiByZWZlcmVuY2U6ICVzIHRvICVqXCIsIHVybCwgdGFnKTtcbiAgICByZXR1cm4gZG9XaXRoUmV0cnkoKCkgPT4gYXhpb3MucG9zdCh1cmwsIHtyZWY6IGByZWZzL3RhZ3MvJHt0YWcudGFnfWAsIHNoYTogdGFnLm9iamVjdH0sIGNvbmZpZylcbiAgICAgICAgLmNhdGNoKGVyciA9PlxuICAgICAgICAgICAgUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKGBFcnJvciBoaXR0aW5nICR7dXJsfSB0byBzZXQgdGFnICR7SlNPTi5zdHJpbmdpZnkodGFnKX06ICR7ZXJyLm1lc3NhZ2V9YCkpLFxuICAgICAgICApLCBgVXBkYXRpbmcgZ2l0aHViIHRhZzogJHt1cmx9IHRvICR7SlNPTi5zdHJpbmdpZnkodGFnKX1gLCB7fSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWxldGVSZXBvc2l0b3J5KHRva2VuOiBzdHJpbmcsIHJyOiBHaXRIdWJSZXBvUmVmKTogQXhpb3NQcm9taXNlIHtcbiAgICBjb25zdCBjb25maWcgPSBhdXRoSGVhZGVycyh0b2tlbik7XG4gICAgY29uc3QgdXJsID0gYCR7cnIuYXBpQmFzZX0vcmVwb3MvJHtyci5vd25lcn0vJHtyci5yZXBvfWA7XG4gICAgbG9nZ2VyLmluZm8oXCJEZWxldGluZyByZXBvc2l0b3J5OiAlc1wiLCB1cmwpO1xuICAgIHJldHVybiBheGlvcy5kZWxldGUodXJsLCBjb25maWcpXG4gICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnIubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVyci5yZXNwb25zZS5ib2R5KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKGBFcnJvciBoaXR0aW5nICR7dXJsfSB0byBkZWxldGUgcmVwb2ApKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVsZWFzZSB7XG4gICAgdGFnX25hbWU6IHN0cmluZztcbiAgICB0YXJnZXRfY29tbWl0aXNoPzogc3RyaW5nO1xuICAgIG5hbWU/OiBzdHJpbmc7XG4gICAgYm9keT86IHN0cmluZztcbiAgICBkcmFmdD86IGJvb2xlYW47XG4gICAgcHJlcmVsZWFzZT86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVSZWxlYXNlKHRva2VuOiBzdHJpbmcsIHJyOiBHaXRIdWJSZXBvUmVmLCByZWxlYXNlOiBSZWxlYXNlKTogQXhpb3NQcm9taXNlIHtcbiAgICBjb25zdCBjb25maWcgPSBhdXRoSGVhZGVycyh0b2tlbik7XG4gICAgY29uc3QgdXJsID0gYCR7cnIuYXBpQmFzZX0vcmVwb3MvJHtyci5vd25lcn0vJHtyci5yZXBvfS9yZWxlYXNlc2A7XG4gICAgbG9nZ2VyLmluZm8oXCJVcGRhdGluZyBnaXRodWIgcmVsZWFzZTogJXMgdG8gJWpcIiwgdXJsLCByZWxlYXNlKTtcbiAgICByZXR1cm4gZG9XaXRoUmV0cnkoKCkgPT4gYXhpb3MucG9zdCh1cmwsIHJlbGVhc2UsIGNvbmZpZylcbiAgICAgICAgLmNhdGNoKGVyciA9PlxuICAgICAgICAgICAgUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKGBFcnJvciBoaXR0aW5nICR7dXJsfSB0byBzZXQgcmVsZWFzZSAke0pTT04uc3RyaW5naWZ5KHJlbGVhc2UpfTogJHtlcnIubWVzc2FnZX1gKSksXG4gICAgICAgICksIGBVcGRhdGluZyBnaXRodWIgcmVsZWFzZTogJHt1cmx9IHRvICR7SlNPTi5zdHJpbmdpZnkocmVsZWFzZSl9YCwge30pO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEdpdEh1YkNvbW1pdHNCZXR3ZWVuIHtcbiAgICBjb21taXRzOiBBcnJheTx7XG4gICAgICAgIHNoYTogc3RyaW5nO1xuICAgICAgICBhdXRob3I6IHsgbG9naW46IHN0cmluZyB9O1xuICAgICAgICBjb21taXQ6IHsgbWVzc2FnZTogc3RyaW5nIH07XG4gICAgfT47XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsaXN0Q29tbWl0c0JldHdlZW4odG9rZW46IHN0cmluZywgcnI6IEdpdEh1YlJlcG9SZWYsIHN0YXJ0U2hhOiBzdHJpbmcsIGVuZDogc3RyaW5nKTogUHJvbWlzZTxHaXRIdWJDb21taXRzQmV0d2Vlbj4ge1xuICAgIGNvbnN0IGNvbmZpZyA9IGF1dGhIZWFkZXJzKHRva2VuKTtcbiAgICBjb25zdCB1cmwgPSBgJHtyci5hcGlCYXNlfS9yZXBvcy8ke3JyLm93bmVyfS8ke3JyLnJlcG99L2NvbXBhcmUvJHtzdGFydFNoYX0uLi4ke2VuZH1gO1xuICAgIHJldHVybiBheGlvcy5nZXQodXJsLCBjb25maWcpXG4gICAgICAgIC50aGVuKGFwID0+IGFwLmRhdGEpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXV0aEhlYWRlcnModG9rZW46IHN0cmluZyk6IEF4aW9zUmVxdWVzdENvbmZpZyB7XG4gICAgcmV0dXJuIHRva2VuID8ge1xuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGB0b2tlbiAke3Rva2VufWAsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgICAgIDoge307XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0aXBPZkRlZmF1bHRCcmFuY2godG9rZW46IHN0cmluZywgcnI6IEdpdEh1YlJlcG9SZWYpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIC8vIFRPRE86IHVzZSByZWFsIGRlZmF1bHQgYnJhbmNoXG4gICAgY29uc3QgY29uZmlnID0gYXV0aEhlYWRlcnModG9rZW4pO1xuICAgIGNvbnN0IHVybCA9IGAke3JyLmFwaUJhc2V9L3JlcG9zLyR7cnIub3duZXJ9LyR7cnIucmVwb30vYnJhbmNoZXMvbWFzdGVyYDtcbiAgICByZXR1cm4gYXhpb3MuZ2V0KHVybCwgY29uZmlnKVxuICAgICAgICAudGhlbihhcCA9PiBhcC5kYXRhLmNvbW1pdC5zaGEpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNQdWJsaWNSZXBvKHRva2VuOiBzdHJpbmcsIHJyOiBHaXRIdWJSZXBvUmVmKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgY29uZmlnID0gYXV0aEhlYWRlcnModG9rZW4pO1xuICAgIGNvbnN0IHVybCA9IGAke3JyLmFwaUJhc2V9L3JlcG9zLyR7cnIub3duZXJ9LyR7cnIucmVwb31gO1xuICAgIHJldHVybiBheGlvcy5nZXQodXJsLCBjb25maWcpXG4gICAgICAgIC50aGVuKGFwID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHByaXZhdGVuZXNzID0gYXAuZGF0YS5wcml2YXRlO1xuICAgICAgICAgICAgbG9nZ2VyLmluZm8oYFJldHJpZXZlZCAke3VybH0uIFByaXZhdGUgaXMgJyR7cHJpdmF0ZW5lc3N9J2ApO1xuICAgICAgICAgICAgcmV0dXJuICFwcml2YXRlbmVzcztcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGFwID0+IHtcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKGBDb3VsZCBub3QgYWNjZXNzICR7dXJsfSB0byBkZXRlcm1pbmUgcmVwbyB2aXNpYmlsaXR5OiAke2FwLnJlc3BvbnNlLnN0YXR1c31gKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSk7XG59XG5cbi8vIFRPRE8gbW92ZSB0byBjbGllbnRcbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVJc3N1ZShjcmVkczogc3RyaW5nIHwgUHJvamVjdE9wZXJhdGlvbkNyZWRlbnRpYWxzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJyOiBSZW1vdGVSZXBvUmVmLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzc3VlTnVtYmVyOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNzdWU6IElzc3VlKTogQXhpb3NQcm9taXNlIHtcbiAgICBjb25zdCBncnIgPSBpc0dpdEh1YlJlcG9SZWYocnIpID8gcnIgOiBuZXcgR2l0SHViUmVwb1JlZihyci5vd25lciwgcnIucmVwbywgcnIuc2hhKTtcbiAgICBjb25zdCB1cmwgPSBgJHtncnIuYXBpQmFzZX0vcmVwb3MvJHtncnIub3duZXJ9LyR7Z3JyLnJlcG99L2lzc3Vlcy8ke2lzc3VlTnVtYmVyfWA7XG4gICAgbG9nZ2VyLmRlYnVnKGBSZXF1ZXN0IHRvICcke3VybH0nIHRvIHVwZGF0ZSBpc3N1ZWApO1xuICAgIHJldHVybiBheGlvcy5wYXRjaCh1cmwsIGlzc3VlLCBhdXRoSGVhZGVycyh0b1Rva2VuKGNyZWRzKSkpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbGlzdFRvcGljcyh0b2tlbjogc3RyaW5nLCBycjogUmVtb3RlUmVwb1JlZik6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBjb25zdCBoZWFkZXJzID0ge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAuLi5hdXRoSGVhZGVycyh0b2tlbikuaGVhZGVycyxcbiAgICAgICAgICAgIEFjY2VwdDogXCJhcHBsaWNhdGlvbi92bmQuZ2l0aHViLm1lcmN5LXByZXZpZXcranNvblwiLFxuICAgICAgICB9LFxuICAgIH07XG4gICAgY29uc3QgZ3JyID0gaXNHaXRIdWJSZXBvUmVmKHJyKSA/IHJyIDogbmV3IEdpdEh1YlJlcG9SZWYocnIub3duZXIsIHJyLnJlcG8sIHJyLnNoYSk7XG4gICAgY29uc3QgdXJsID0gYCR7Z3JyLmFwaUJhc2V9L3JlcG9zLyR7Z3JyLm93bmVyfS8ke2dyci5yZXBvfS90b3BpY3NgO1xuICAgIGNvbnN0IHRvcGljcyA9IGF3YWl0IGF4aW9zLmdldCh1cmwsIGhlYWRlcnMpO1xuICAgIHJldHVybiB0b3BpY3MuZGF0YS5uYW1lcztcbn1cbiJdfQ==