"use strict";/*
 * Copyright Â© 2018 Atomist, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cov_6ja42kq8h=function(){var path="/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/util/webhook/ImageLink.ts",hash="24dce58a44293b2eed1f645336c3346c88d2c3d0",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/util/webhook/ImageLink.ts",statementMap:{"0":{start:{line:17,column:0},end:{line:17,column:62}},"1":{start:{line:18,column:28},end:{line:18,column:65}},"2":{start:{line:19,column:16},end:{line:19,column:32}},"3":{start:{line:20,column:21},end:{line:20,column:45}},"4":{start:{line:21,column:28},end:{line:27,column:1}},"5":{start:{line:42,column:20},end:{line:49,column:5}},"6":{start:{line:50,column:4},end:{line:50,column:63}},"7":{start:{line:52,column:0},end:{line:52,column:44}},"8":{start:{line:66,column:20},end:{line:76,column:5}},"9":{start:{line:77,column:4},end:{line:77,column:68}},"10":{start:{line:79,column:0},end:{line:79,column:52}},"11":{start:{line:91,column:4},end:{line:91,column:68}},"12":{start:{line:92,column:20},end:{line:92,column:88}},"13":{start:{line:93,column:16},end:{line:93,column:63}},"14":{start:{line:94,column:4},end:{line:106,column:7}},"15":{start:{line:95,column:8},end:{line:95,column:102}},"16":{start:{line:96,column:8},end:{line:101,column:11}},"17":{start:{line:97,column:24},end:{line:97,column:28}},"18":{start:{line:99,column:12},end:{line:99,column:98}},"19":{start:{line:100,column:12},end:{line:100,column:23}},"20":{start:{line:104,column:8},end:{line:104,column:95}},"21":{start:{line:105,column:8},end:{line:105,column:21}},"22":{start:{line:108,column:0},end:{line:108,column:34}}},fnMap:{"0":{name:"postBuildWebhook",decl:{start:{line:41,column:9},end:{line:41,column:25}},loc:{start:{line:41,column:107},end:{line:51,column:1}},line:41},"1":{name:"postLinkImageWebhook",decl:{start:{line:65,column:9},end:{line:65,column:29}},loc:{start:{line:65,column:102},end:{line:78,column:1}},line:65},"2":{name:"postWebhook",decl:{start:{line:90,column:9},end:{line:90,column:20}},loc:{start:{line:90,column:83},end:{line:107,column:1}},line:90},"3":{name:"(anonymous_3)",decl:{start:{line:94,column:38},end:{line:94,column:39}},loc:{start:{line:94,column:61},end:{line:102,column:5}},line:94},"4":{name:"(anonymous_4)",decl:{start:{line:97,column:18},end:{line:97,column:19}},loc:{start:{line:97,column:24},end:{line:97,column:28}},line:97},"5":{name:"(anonymous_5)",decl:{start:{line:98,column:19},end:{line:98,column:20}},loc:{start:{line:98,column:26},end:{line:101,column:9}},line:98},"6":{name:"(anonymous_6)",decl:{start:{line:103,column:15},end:{line:103,column:16}},loc:{start:{line:103,column:22},end:{line:106,column:5}},line:103}},branchMap:{"0":{loc:{start:{line:41,column:71},end:{line:41,column:105}},type:"default-arg",locations:[{start:{line:41,column:86},end:{line:41,column:105}}],line:41},"1":{loc:{start:{line:65,column:66},end:{line:65,column:100}},type:"default-arg",locations:[{start:{line:65,column:81},end:{line:65,column:100}}],line:65},"2":{loc:{start:{line:90,column:47},end:{line:90,column:81}},type:"default-arg",locations:[{start:{line:90,column:62},end:{line:90,column:81}}],line:90},"3":{loc:{start:{line:92,column:20},end:{line:92,column:88}},type:"binary-expr",locations:[{start:{line:92,column:20},end:{line:92,column:55}},{start:{line:92,column:59},end:{line:92,column:88}}],line:92}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0],"1":[0],"2":[0],"3":[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();cov_6ja42kq8h.s[0]++;Object.defineProperty(exports,"__esModule",{value:true});const automation_client_1=(cov_6ja42kq8h.s[1]++,require("@atomist/automation-client"));const axios_1=(cov_6ja42kq8h.s[2]++,require("axios"));const promiseRetry=(cov_6ja42kq8h.s[3]++,require("promise-retry"));const DefaultRetryOptions=(cov_6ja42kq8h.s[4]++,{retries:10,factor:2,minTimeout:1*500,maxTimeout:5*1000,randomize:true});/**
 * Post to the Atomist generic build webhook URL.  It creates the payload
 * then uses postWebhook.
 *
 * @param owner repository owner, i.e., user or organization
 * @param repo name of repository
 * @param branch commit branch
 * @param commit commit SHA
 * @param status "start", "success", or "fail"
 * @param teamId Atomist team ID
 * @param retryOptions change default retry options
 * @return true if successful, false on failure after retries
 */function postBuildWebhook(owner,repo,branch,commit,status,teamId,retryOptions=(cov_6ja42kq8h.b[0][0]++,DefaultRetryOptions)){cov_6ja42kq8h.f[0]++;const payload=(cov_6ja42kq8h.s[5]++,{repository:{owner_name:owner,name:repo},type:"push",status,commit,branch,provider:"GoogleContainerBuilder"});cov_6ja42kq8h.s[6]++;return postWebhook("build",payload,teamId,retryOptions);}cov_6ja42kq8h.s[7]++;exports.postBuildWebhook=postBuildWebhook;/**
 * Post to the Atomist link-image webhook URL.  It creates the payload
 * then uses postWebhook.
 *
 * @param owner repository owner, i.e., user or organization
 * @param repo name of repository
 * @param commit commit SHA
 * @param image Docker image tag, e.g., registry.com/owner/repo:version
 * @param teamId Atomist team ID
 * @param retryOptions change default retry options
 * @return true if successful, false on failure after retries
 */function postLinkImageWebhook(owner,repo,commit,image,teamId,retryOptions=(cov_6ja42kq8h.b[1][0]++,DefaultRetryOptions)){cov_6ja42kq8h.f[1]++;const payload=(cov_6ja42kq8h.s[8]++,{git:{owner,repo,sha:commit},docker:{image},type:"link-image"});cov_6ja42kq8h.s[9]++;return postWebhook("link-image",payload,teamId,retryOptions);}cov_6ja42kq8h.s[10]++;exports.postLinkImageWebhook=postLinkImageWebhook;/**
 * Post payload to the Atomist webhook URL.  It will retry
 * several times.
 *
 * @param webhook type of webhook
 * @param payload object to post
 * @param teamId Atomist team ID
 * @param retryOptions change default retry options
 * @return true if successful, false on failure after retries
 */function postWebhook(webhook,payload,teamId,retryOptions=(cov_6ja42kq8h.b[2][0]++,DefaultRetryOptions)){cov_6ja42kq8h.f[2]++;cov_6ja42kq8h.s[11]++;automation_client_1.logger.info("Posting webhook: %j",payload);const baseUrl=(cov_6ja42kq8h.s[12]++,(cov_6ja42kq8h.b[3][0]++,process.env.ATOMIST_WEBHOOK_BASEURL)||(cov_6ja42kq8h.b[3][1]++,"https://webhook.atomist.com"));const url=(cov_6ja42kq8h.s[13]++,`${baseUrl}/atomist/${webhook}/teams/${teamId}`);cov_6ja42kq8h.s[14]++;return promiseRetry(retryOptions,(retry,retryCount)=>{cov_6ja42kq8h.f[3]++;cov_6ja42kq8h.s[15]++;automation_client_1.logger.debug("posting '%j' to '%s' attempt %d",payload,url,retryCount);cov_6ja42kq8h.s[16]++;return axios_1.default.post(url,payload).then(()=>{cov_6ja42kq8h.f[4]++;cov_6ja42kq8h.s[17]++;return true;}).catch(err=>{cov_6ja42kq8h.f[5]++;cov_6ja42kq8h.s[18]++;automation_client_1.logger.debug("error posting '%j' to '%s': %j",payload,url,err);cov_6ja42kq8h.s[19]++;retry(err);});}).catch(err=>{cov_6ja42kq8h.f[6]++;cov_6ja42kq8h.s[20]++;automation_client_1.logger.error("failed to post '%j' to '%s': %j",payload,url,err);cov_6ja42kq8h.s[21]++;return false;});}cov_6ja42kq8h.s[22]++;exports.postWebhook=postWebhook;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL3JvZGpvaG5zb24vc2ZvcnphbmRvLWRldi9pZGVhLXByb2plY3RzL215LWZsb3cvc3JjL3V0aWwvd2ViaG9vay9JbWFnZUxpbmsudHMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2Rqb2huc29uL3Nmb3J6YW5kby1kZXYvaWRlYS1wcm9qZWN0cy9teS1mbG93L3NyYy91dGlsL3dlYmhvb2svSW1hZ2VMaW5rLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7Ozs7R0FjRzs7QUFFSCxrRUFBb0Q7QUFDcEQsaUNBQTBCO0FBQzFCLDhDQUErQztBQTZCL0MsTUFBTSxtQkFBbUIsR0FBRztJQUN4QixPQUFPLEVBQUUsRUFBRTtJQUNYLE1BQU0sRUFBRSxDQUFDO0lBQ1QsVUFBVSxFQUFFLENBQUMsR0FBRyxHQUFHO0lBQ25CLFVBQVUsRUFBRSxDQUFDLEdBQUcsSUFBSTtJQUNwQixTQUFTLEVBQUUsSUFBSTtDQUNsQixDQUFDO0FBRUY7Ozs7Ozs7Ozs7OztHQVlHO0FBQ0gsMEJBQ0ksS0FBYSxFQUNiLElBQVksRUFDWixNQUFjLEVBQ2QsTUFBYyxFQUNkLE1BQTBCLEVBQzFCLE1BQWMsRUFDZCxZQUFZLEdBQUcsbUJBQW1CO0lBR2xDLE1BQU0sT0FBTyxHQUFpQjtRQUMxQixVQUFVLEVBQUUsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUU7UUFDN0MsSUFBSSxFQUFFLE1BQU07UUFDWixNQUFNO1FBQ04sTUFBTTtRQUNOLE1BQU07UUFDTixRQUFRLEVBQUUsd0JBQXdCO0tBQ3JDLENBQUM7SUFDRixPQUFPLFdBQVcsQ0FBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxZQUFZLENBQUMsQ0FBQztBQUMvRCxDQUFDO0FBbkJELDRDQW1CQztBQWtCRDs7Ozs7Ozs7Ozs7R0FXRztBQUNILDhCQUNJLEtBQWEsRUFDYixJQUFZLEVBQ1osTUFBYyxFQUNkLEtBQWEsRUFDYixNQUFjLEVBQ2QsWUFBWSxHQUFHLG1CQUFtQjtJQUdsQyxNQUFNLE9BQU8sR0FBcUI7UUFDOUIsR0FBRyxFQUFFO1lBQ0QsS0FBSztZQUNMLElBQUk7WUFDSixHQUFHLEVBQUUsTUFBTTtTQUNkO1FBQ0QsTUFBTSxFQUFFO1lBQ0osS0FBSztTQUNSO1FBQ0QsSUFBSSxFQUFFLFlBQVk7S0FDckIsQ0FBQztJQUNGLE9BQU8sV0FBVyxDQUFDLFlBQVksRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLFlBQVksQ0FBQyxDQUFDO0FBQ3BFLENBQUM7QUFyQkQsb0RBcUJDO0FBRUQ7Ozs7Ozs7OztHQVNHO0FBQ0gscUJBQ0ksT0FBMkIsRUFDM0IsT0FBWSxFQUNaLE1BQWMsRUFDZCxZQUFZLEdBQUcsbUJBQW1CO0lBRWxDLDBCQUFNLENBQUMsSUFBSSxDQUFDLHFCQUFxQixFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBRTVDLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLElBQUksNkJBQTZCLENBQUM7SUFDckYsTUFBTSxHQUFHLEdBQUcsR0FBRyxPQUFPLFlBQVksT0FBTyxVQUFVLE1BQU0sRUFBRSxDQUFDO0lBQzVELE9BQU8sWUFBWSxDQUFDLFlBQVksRUFBRSxDQUFDLEtBQUssRUFBRSxVQUFVLEVBQUUsRUFBRTtRQUNwRCwwQkFBTSxDQUFDLEtBQUssQ0FBQyxpQ0FBaUMsRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQzFFLE9BQU8sZUFBSyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDO2FBQzFCLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUM7YUFDaEIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ1QsMEJBQU0sQ0FBQyxLQUFLLENBQUMsZ0NBQWdDLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNsRSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDZixDQUFDLENBQUMsQ0FBQztJQUNYLENBQUMsQ0FBQztTQUNHLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRTtRQUNULDBCQUFNLENBQUMsS0FBSyxDQUFDLGlDQUFpQyxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDbkUsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQyxDQUFDLENBQUM7QUFDWCxDQUFDO0FBdkJELGtDQXVCQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgwqkgMjAxOCBBdG9taXN0LCBJbmMuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gXCJAYXRvbWlzdC9hdXRvbWF0aW9uLWNsaWVudFwiO1xuaW1wb3J0IGF4aW9zIGZyb20gXCJheGlvc1wiO1xuaW1wb3J0IHByb21pc2VSZXRyeSA9IHJlcXVpcmUoXCJwcm9taXNlLXJldHJ5XCIpO1xuXG5leHBvcnQgaW50ZXJmYWNlIEF0b21pc3RCdWlsZFJlcG9zaXRvcnkge1xuICAgIG93bmVyX25hbWU6IHN0cmluZztcbiAgICBuYW1lOiBzdHJpbmc7XG59XG5cbmV4cG9ydCB0eXBlIEF0b21pc3RCdWlsZFR5cGUgPSBcImNyb25cIiB8IFwicHVsbF9yZXF1ZXN0XCIgfCBcInB1c2hcIiB8IFwidGFnXCIgfCBcIm1hbnVhbFwiO1xuXG5leHBvcnQgdHlwZSBBdG9taXN0QnVpbGRTdGF0dXMgPSBcInN0YXJ0ZWRcIiB8IFwiZmFpbGVkXCIgfCBcImVycm9yXCIgfCBcInBhc3NlZFwiIHwgXCJjYW5jZWxlZFwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIEF0b21pc3RCdWlsZCB7XG4gICAgcmVwb3NpdG9yeTogQXRvbWlzdEJ1aWxkUmVwb3NpdG9yeTtcbiAgICBudW1iZXI/OiBudW1iZXI7XG4gICAgbmFtZT86IHN0cmluZztcbiAgICBjb21wYXJlX3VybD86IHN0cmluZztcbiAgICB0eXBlOiBBdG9taXN0QnVpbGRUeXBlO1xuICAgIHB1bGxfcmVxdWVzdF9udW1iZXI/OiBudW1iZXI7XG4gICAgYnVpbGRfdXJsPzogc3RyaW5nO1xuICAgIHN0YXR1czogQXRvbWlzdEJ1aWxkU3RhdHVzO1xuICAgIGlkPzogc3RyaW5nO1xuICAgIGNvbW1pdDogc3RyaW5nO1xuICAgIHRhZz86IHN0cmluZztcbiAgICBicmFuY2g/OiBzdHJpbmc7XG4gICAgcHJvdmlkZXI/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCB0eXBlIEF0b21pc3RXZWJob29rVHlwZSA9IFwiYXBwbGljYXRpb25cIiB8IFwiYnVpbGRcIiB8IFwibGluay1pbWFnZVwiO1xuXG5jb25zdCBEZWZhdWx0UmV0cnlPcHRpb25zID0ge1xuICAgIHJldHJpZXM6IDEwLFxuICAgIGZhY3RvcjogMixcbiAgICBtaW5UaW1lb3V0OiAxICogNTAwLFxuICAgIG1heFRpbWVvdXQ6IDUgKiAxMDAwLFxuICAgIHJhbmRvbWl6ZTogdHJ1ZSxcbn07XG5cbi8qKlxuICogUG9zdCB0byB0aGUgQXRvbWlzdCBnZW5lcmljIGJ1aWxkIHdlYmhvb2sgVVJMLiAgSXQgY3JlYXRlcyB0aGUgcGF5bG9hZFxuICogdGhlbiB1c2VzIHBvc3RXZWJob29rLlxuICpcbiAqIEBwYXJhbSBvd25lciByZXBvc2l0b3J5IG93bmVyLCBpLmUuLCB1c2VyIG9yIG9yZ2FuaXphdGlvblxuICogQHBhcmFtIHJlcG8gbmFtZSBvZiByZXBvc2l0b3J5XG4gKiBAcGFyYW0gYnJhbmNoIGNvbW1pdCBicmFuY2hcbiAqIEBwYXJhbSBjb21taXQgY29tbWl0IFNIQVxuICogQHBhcmFtIHN0YXR1cyBcInN0YXJ0XCIsIFwic3VjY2Vzc1wiLCBvciBcImZhaWxcIlxuICogQHBhcmFtIHRlYW1JZCBBdG9taXN0IHRlYW0gSURcbiAqIEBwYXJhbSByZXRyeU9wdGlvbnMgY2hhbmdlIGRlZmF1bHQgcmV0cnkgb3B0aW9uc1xuICogQHJldHVybiB0cnVlIGlmIHN1Y2Nlc3NmdWwsIGZhbHNlIG9uIGZhaWx1cmUgYWZ0ZXIgcmV0cmllc1xuICovXG5leHBvcnQgZnVuY3Rpb24gcG9zdEJ1aWxkV2ViaG9vayhcbiAgICBvd25lcjogc3RyaW5nLFxuICAgIHJlcG86IHN0cmluZyxcbiAgICBicmFuY2g6IHN0cmluZyxcbiAgICBjb21taXQ6IHN0cmluZyxcbiAgICBzdGF0dXM6IEF0b21pc3RCdWlsZFN0YXR1cyxcbiAgICB0ZWFtSWQ6IHN0cmluZyxcbiAgICByZXRyeU9wdGlvbnMgPSBEZWZhdWx0UmV0cnlPcHRpb25zLFxuKTogUHJvbWlzZTxib29sZWFuPiB7XG5cbiAgICBjb25zdCBwYXlsb2FkOiBBdG9taXN0QnVpbGQgPSB7XG4gICAgICAgIHJlcG9zaXRvcnk6IHsgb3duZXJfbmFtZTogb3duZXIsIG5hbWU6IHJlcG8gfSxcbiAgICAgICAgdHlwZTogXCJwdXNoXCIsXG4gICAgICAgIHN0YXR1cyxcbiAgICAgICAgY29tbWl0LFxuICAgICAgICBicmFuY2gsXG4gICAgICAgIHByb3ZpZGVyOiBcIkdvb2dsZUNvbnRhaW5lckJ1aWxkZXJcIixcbiAgICB9O1xuICAgIHJldHVybiBwb3N0V2ViaG9vayhcImJ1aWxkXCIsIHBheWxvYWQsIHRlYW1JZCwgcmV0cnlPcHRpb25zKTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBdG9taXN0TGlua0ltYWdlR2l0IHtcbiAgICBvd25lcjogc3RyaW5nO1xuICAgIHJlcG86IHN0cmluZztcbiAgICBzaGE6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBdG9taXN0TGlua0ltYWdlRG9ja2VyIHtcbiAgICBpbWFnZTogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF0b21pc3RMaW5rSW1hZ2Uge1xuICAgIGdpdDogQXRvbWlzdExpbmtJbWFnZUdpdDtcbiAgICBkb2NrZXI6IEF0b21pc3RMaW5rSW1hZ2VEb2NrZXI7XG4gICAgdHlwZTogXCJsaW5rLWltYWdlXCI7XG59XG5cbi8qKlxuICogUG9zdCB0byB0aGUgQXRvbWlzdCBsaW5rLWltYWdlIHdlYmhvb2sgVVJMLiAgSXQgY3JlYXRlcyB0aGUgcGF5bG9hZFxuICogdGhlbiB1c2VzIHBvc3RXZWJob29rLlxuICpcbiAqIEBwYXJhbSBvd25lciByZXBvc2l0b3J5IG93bmVyLCBpLmUuLCB1c2VyIG9yIG9yZ2FuaXphdGlvblxuICogQHBhcmFtIHJlcG8gbmFtZSBvZiByZXBvc2l0b3J5XG4gKiBAcGFyYW0gY29tbWl0IGNvbW1pdCBTSEFcbiAqIEBwYXJhbSBpbWFnZSBEb2NrZXIgaW1hZ2UgdGFnLCBlLmcuLCByZWdpc3RyeS5jb20vb3duZXIvcmVwbzp2ZXJzaW9uXG4gKiBAcGFyYW0gdGVhbUlkIEF0b21pc3QgdGVhbSBJRFxuICogQHBhcmFtIHJldHJ5T3B0aW9ucyBjaGFuZ2UgZGVmYXVsdCByZXRyeSBvcHRpb25zXG4gKiBAcmV0dXJuIHRydWUgaWYgc3VjY2Vzc2Z1bCwgZmFsc2Ugb24gZmFpbHVyZSBhZnRlciByZXRyaWVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwb3N0TGlua0ltYWdlV2ViaG9vayhcbiAgICBvd25lcjogc3RyaW5nLFxuICAgIHJlcG86IHN0cmluZyxcbiAgICBjb21taXQ6IHN0cmluZyxcbiAgICBpbWFnZTogc3RyaW5nLFxuICAgIHRlYW1JZDogc3RyaW5nLFxuICAgIHJldHJ5T3B0aW9ucyA9IERlZmF1bHRSZXRyeU9wdGlvbnMsXG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcblxuICAgIGNvbnN0IHBheWxvYWQ6IEF0b21pc3RMaW5rSW1hZ2UgPSB7XG4gICAgICAgIGdpdDoge1xuICAgICAgICAgICAgb3duZXIsXG4gICAgICAgICAgICByZXBvLFxuICAgICAgICAgICAgc2hhOiBjb21taXQsXG4gICAgICAgIH0sXG4gICAgICAgIGRvY2tlcjoge1xuICAgICAgICAgICAgaW1hZ2UsXG4gICAgICAgIH0sXG4gICAgICAgIHR5cGU6IFwibGluay1pbWFnZVwiLFxuICAgIH07XG4gICAgcmV0dXJuIHBvc3RXZWJob29rKFwibGluay1pbWFnZVwiLCBwYXlsb2FkLCB0ZWFtSWQsIHJldHJ5T3B0aW9ucyk7XG59XG5cbi8qKlxuICogUG9zdCBwYXlsb2FkIHRvIHRoZSBBdG9taXN0IHdlYmhvb2sgVVJMLiAgSXQgd2lsbCByZXRyeVxuICogc2V2ZXJhbCB0aW1lcy5cbiAqXG4gKiBAcGFyYW0gd2ViaG9vayB0eXBlIG9mIHdlYmhvb2tcbiAqIEBwYXJhbSBwYXlsb2FkIG9iamVjdCB0byBwb3N0XG4gKiBAcGFyYW0gdGVhbUlkIEF0b21pc3QgdGVhbSBJRFxuICogQHBhcmFtIHJldHJ5T3B0aW9ucyBjaGFuZ2UgZGVmYXVsdCByZXRyeSBvcHRpb25zXG4gKiBAcmV0dXJuIHRydWUgaWYgc3VjY2Vzc2Z1bCwgZmFsc2Ugb24gZmFpbHVyZSBhZnRlciByZXRyaWVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwb3N0V2ViaG9vayhcbiAgICB3ZWJob29rOiBBdG9taXN0V2ViaG9va1R5cGUsXG4gICAgcGF5bG9hZDogYW55LFxuICAgIHRlYW1JZDogc3RyaW5nLFxuICAgIHJldHJ5T3B0aW9ucyA9IERlZmF1bHRSZXRyeU9wdGlvbnMsXG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBsb2dnZXIuaW5mbyhcIlBvc3Rpbmcgd2ViaG9vazogJWpcIiwgcGF5bG9hZCk7XG5cbiAgICBjb25zdCBiYXNlVXJsID0gcHJvY2Vzcy5lbnYuQVRPTUlTVF9XRUJIT09LX0JBU0VVUkwgfHwgXCJodHRwczovL3dlYmhvb2suYXRvbWlzdC5jb21cIjtcbiAgICBjb25zdCB1cmwgPSBgJHtiYXNlVXJsfS9hdG9taXN0LyR7d2ViaG9va30vdGVhbXMvJHt0ZWFtSWR9YDtcbiAgICByZXR1cm4gcHJvbWlzZVJldHJ5KHJldHJ5T3B0aW9ucywgKHJldHJ5LCByZXRyeUNvdW50KSA9PiB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhcInBvc3RpbmcgJyVqJyB0byAnJXMnIGF0dGVtcHQgJWRcIiwgcGF5bG9hZCwgdXJsLCByZXRyeUNvdW50KTtcbiAgICAgICAgcmV0dXJuIGF4aW9zLnBvc3QodXJsLCBwYXlsb2FkKVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4gdHJ1ZSlcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhcImVycm9yIHBvc3RpbmcgJyVqJyB0byAnJXMnOiAlalwiLCBwYXlsb2FkLCB1cmwsIGVycik7XG4gICAgICAgICAgICAgICAgcmV0cnkoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH0pXG4gICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKFwiZmFpbGVkIHRvIHBvc3QgJyVqJyB0byAnJXMnOiAlalwiLCBwYXlsb2FkLCB1cmwsIGVycik7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0pO1xufVxuIl19