"use strict";/*
 * Copyright Â© 2018 Atomist, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cov_1exvn7ietp=function(){var path="/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/common/delivery/goals/Goal.ts",hash="afb3861e66c1c933d07a7d642be9c2b4022fb4b6",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/common/delivery/goals/Goal.ts",statementMap:{"0":{start:{line:17,column:16},end:{line:24,column:1}},"1":{start:{line:18,column:4},end:{line:23,column:7}},"2":{start:{line:19,column:36},end:{line:19,column:97}},"3":{start:{line:19,column:42},end:{line:19,column:70}},"4":{start:{line:19,column:85},end:{line:19,column:95}},"5":{start:{line:20,column:35},end:{line:20,column:100}},"6":{start:{line:20,column:41},end:{line:20,column:73}},"7":{start:{line:20,column:88},end:{line:20,column:98}},"8":{start:{line:21,column:32},end:{line:21,column:149}},"9":{start:{line:21,column:97},end:{line:21,column:119}},"10":{start:{line:22,column:8},end:{line:22,column:78}},"11":{start:{line:25,column:0},end:{line:25,column:62}},"12":{start:{line:26,column:28},end:{line:26,column:65}},"13":{start:{line:27,column:23},end:{line:27,column:87}},"14":{start:{line:28,column:24},end:{line:28,column:50}},"15":{start:{line:29,column:22},end:{line:29,column:48}},"16":{start:{line:35,column:8},end:{line:35,column:43}},"17":{start:{line:38,column:8},end:{line:38,column:82}},"18":{start:{line:41,column:8},end:{line:41,column:79}},"19":{start:{line:44,column:8},end:{line:44,column:77}},"20":{start:{line:47,column:8},end:{line:47,column:39}},"21":{start:{line:50,column:8},end:{line:50,column:115}},"22":{start:{line:53,column:8},end:{line:53,column:38}},"23":{start:{line:56,column:8},end:{line:58,column:9}},"24":{start:{line:57,column:12},end:{line:57,column:101}},"25":{start:{line:59,column:8},end:{line:59,column:37}},"26":{start:{line:60,column:30},end:{line:60,column:47}},"27":{start:{line:61,column:26},end:{line:61,column:69}},"28":{start:{line:62,column:8},end:{line:65,column:9}},"29":{start:{line:63,column:12},end:{line:63,column:137}},"30":{start:{line:64,column:12},end:{line:64,column:19}},"31":{start:{line:66,column:8},end:{line:66,column:59}},"32":{start:{line:67,column:8},end:{line:67,column:101}},"33":{start:{line:68,column:8},end:{line:68,column:57}},"34":{start:{line:72,column:8},end:{line:74,column:11}},"35":{start:{line:73,column:12},end:{line:73,column:29}},"36":{start:{line:77,column:0},end:{line:77,column:20}},"37":{start:{line:80,column:8},end:{line:80,column:26}},"38":{start:{line:81,column:8},end:{line:81,column:35}},"39":{start:{line:84,column:8},end:{line:101,column:11}},"40":{start:{line:85,column:27},end:{line:85,column:85}},"41":{start:{line:85,column:52},end:{line:85,column:84}},"42":{start:{line:86,column:12},end:{line:86,column:74}},"43":{start:{line:87,column:27},end:{line:88,column:34}},"44":{start:{line:87,column:46},end:{line:87,column:67}},"45":{start:{line:88,column:26},end:{line:88,column:33}},"46":{start:{line:89,column:34},end:{line:89,column:91}},"47":{start:{line:89,column:53},end:{line:89,column:73}},"48":{start:{line:89,column:84},end:{line:89,column:90}},"49":{start:{line:90,column:12},end:{line:90,column:131}},"50":{start:{line:90,column:32},end:{line:90,column:129}},"51":{start:{line:91,column:12},end:{line:91,column:115}},"52":{start:{line:91,column:39},end:{line:91,column:113}},"53":{start:{line:92,column:12},end:{line:95,column:13}},"54":{start:{line:93,column:16},end:{line:93,column:248}},"55":{start:{line:93,column:182},end:{line:93,column:188}},"56":{start:{line:94,column:16},end:{line:94,column:33}},"57":{start:{line:96,column:12},end:{line:99,column:13}},"58":{start:{line:97,column:16},end:{line:97,column:254}},"59":{start:{line:97,column:188},end:{line:97,column:194}},"60":{start:{line:98,column:16},end:{line:98,column:33}},"61":{start:{line:100,column:12},end:{line:100,column:29}},"62":{start:{line:104,column:0},end:{line:104,column:52}},"63":{start:{line:106,column:4},end:{line:106,column:28}},"64":{start:{line:108,column:0},end:{line:108,column:44}},"65":{start:{line:110,column:27},end:{line:110,column:77}},"66":{start:{line:110,column:51},end:{line:110,column:76}},"67":{start:{line:111,column:4},end:{line:113,column:5}},"68":{start:{line:112,column:8},end:{line:112,column:67}},"69":{start:{line:114,column:4},end:{line:116,column:5}},"70":{start:{line:115,column:8},end:{line:115,column:77}},"71":{start:{line:117,column:4},end:{line:119,column:5}},"72":{start:{line:118,column:8},end:{line:118,column:94}},"73":{start:{line:120,column:4},end:{line:122,column:5}},"74":{start:{line:121,column:8},end:{line:121,column:76}},"75":{start:{line:123,column:4},end:{line:123,column:14}},"76":{start:{line:126,column:21},end:{line:126,column:73}},"77":{start:{line:126,column:47},end:{line:126,column:72}},"78":{start:{line:127,column:4},end:{line:130,column:5}},"79":{start:{line:128,column:8},end:{line:128,column:117}},"80":{start:{line:129,column:8},end:{line:129,column:21}},"81":{start:{line:131,column:4},end:{line:133,column:5}},"82":{start:{line:132,column:8},end:{line:132,column:20}},"83":{start:{line:134,column:4},end:{line:136,column:5}},"84":{start:{line:135,column:8},end:{line:135,column:20}},"85":{start:{line:137,column:4},end:{line:138,column:68}},"86":{start:{line:139,column:4},end:{line:139,column:17}},"87":{start:{line:141,column:0},end:{line:141,column:62}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:17,column:44},end:{line:17,column:45}},loc:{start:{line:17,column:89},end:{line:24,column:1}},line:17},"1":{name:"(anonymous_1)",decl:{start:{line:18,column:36},end:{line:18,column:37}},loc:{start:{line:18,column:63},end:{line:23,column:5}},line:18},"2":{name:"fulfilled",decl:{start:{line:19,column:17},end:{line:19,column:26}},loc:{start:{line:19,column:34},end:{line:19,column:99}},line:19},"3":{name:"rejected",decl:{start:{line:20,column:17},end:{line:20,column:25}},loc:{start:{line:20,column:33},end:{line:20,column:102}},line:20},"4":{name:"step",decl:{start:{line:21,column:17},end:{line:21,column:21}},loc:{start:{line:21,column:30},end:{line:21,column:151}},line:21},"5":{name:"(anonymous_5)",decl:{start:{line:21,column:76},end:{line:21,column:77}},loc:{start:{line:21,column:95},end:{line:21,column:121}},line:21},"6":{name:"(anonymous_6)",decl:{start:{line:34,column:4},end:{line:34,column:5}},loc:{start:{line:34,column:22},end:{line:36,column:5}},line:34},"7":{name:"(anonymous_7)",decl:{start:{line:37,column:4},end:{line:37,column:5}},loc:{start:{line:37,column:29},end:{line:39,column:5}},line:37},"8":{name:"(anonymous_8)",decl:{start:{line:40,column:4},end:{line:40,column:5}},loc:{start:{line:40,column:31},end:{line:42,column:5}},line:40},"9":{name:"(anonymous_9)",decl:{start:{line:43,column:4},end:{line:43,column:5}},loc:{start:{line:43,column:29},end:{line:45,column:5}},line:43},"10":{name:"(anonymous_10)",decl:{start:{line:46,column:4},end:{line:46,column:5}},loc:{start:{line:46,column:31},end:{line:48,column:5}},line:46},"11":{name:"(anonymous_11)",decl:{start:{line:49,column:4},end:{line:49,column:5}},loc:{start:{line:49,column:40},end:{line:51,column:5}},line:49},"12":{name:"(anonymous_12)",decl:{start:{line:52,column:4},end:{line:52,column:5}},loc:{start:{line:52,column:22},end:{line:54,column:5}},line:52},"13":{name:"(anonymous_13)",decl:{start:{line:55,column:4},end:{line:55,column:5}},loc:{start:{line:55,column:28},end:{line:69,column:5}},line:55},"14":{name:"(anonymous_14)",decl:{start:{line:71,column:4},end:{line:71,column:5}},loc:{start:{line:71,column:33},end:{line:75,column:5}},line:71},"15":{name:"(anonymous_15)",decl:{start:{line:72,column:47},end:{line:72,column:48}},loc:{start:{line:72,column:60},end:{line:74,column:9}},line:72},"16":{name:"(anonymous_16)",decl:{start:{line:79,column:4},end:{line:79,column:5}},loc:{start:{line:79,column:42},end:{line:82,column:5}},line:79},"17":{name:"(anonymous_17)",decl:{start:{line:83,column:4},end:{line:83,column:5}},loc:{start:{line:83,column:43},end:{line:102,column:5}},line:83},"18":{name:"(anonymous_18)",decl:{start:{line:84,column:47},end:{line:84,column:48}},loc:{start:{line:84,column:60},end:{line:101,column:9}},line:84},"19":{name:"(anonymous_19)",decl:{start:{line:85,column:46},end:{line:85,column:47}},loc:{start:{line:85,column:52},end:{line:85,column:84}},line:85},"20":{name:"(anonymous_20)",decl:{start:{line:87,column:41},end:{line:87,column:42}},loc:{start:{line:87,column:46},end:{line:87,column:67}},line:87},"21":{name:"(anonymous_21)",decl:{start:{line:88,column:21},end:{line:88,column:22}},loc:{start:{line:88,column:26},end:{line:88,column:33}},line:88},"22":{name:"(anonymous_22)",decl:{start:{line:89,column:48},end:{line:89,column:49}},loc:{start:{line:89,column:53},end:{line:89,column:73}},line:89},"23":{name:"(anonymous_23)",decl:{start:{line:89,column:79},end:{line:89,column:80}},loc:{start:{line:89,column:84},end:{line:89,column:90}},line:89},"24":{name:"(anonymous_24)",decl:{start:{line:90,column:27},end:{line:90,column:28}},loc:{start:{line:90,column:32},end:{line:90,column:129}},line:90},"25":{name:"(anonymous_25)",decl:{start:{line:91,column:34},end:{line:91,column:35}},loc:{start:{line:91,column:39},end:{line:91,column:113}},line:91},"26":{name:"(anonymous_26)",decl:{start:{line:93,column:177},end:{line:93,column:178}},loc:{start:{line:93,column:182},end:{line:93,column:188}},line:93},"27":{name:"(anonymous_27)",decl:{start:{line:97,column:183},end:{line:97,column:184}},loc:{start:{line:97,column:188},end:{line:97,column:194}},line:97},"28":{name:"hasPreconditions",decl:{start:{line:105,column:9},end:{line:105,column:25}},loc:{start:{line:105,column:32},end:{line:107,column:1}},line:105},"29":{name:"checkPreconditionStatus",decl:{start:{line:109,column:9},end:{line:109,column:32}},loc:{start:{line:109,column:42},end:{line:124,column:1}},line:109},"30":{name:"(anonymous_30)",decl:{start:{line:110,column:45},end:{line:110,column:46}},loc:{start:{line:110,column:51},end:{line:110,column:76}},line:110},"31":{name:"currentGoalIsStillPending",decl:{start:{line:125,column:9},end:{line:125,column:34}},loc:{start:{line:125,column:56},end:{line:140,column:1}},line:125},"32":{name:"(anonymous_32)",decl:{start:{line:126,column:42},end:{line:126,column:43}},loc:{start:{line:126,column:47},end:{line:126,column:72}},line:126}},branchMap:{"0":{loc:{start:{line:17,column:16},end:{line:24,column:1}},type:"binary-expr",locations:[{start:{line:17,column:17},end:{line:17,column:21}},{start:{line:17,column:25},end:{line:17,column:39}},{start:{line:17,column:44},end:{line:24,column:1}}],line:17},"1":{loc:{start:{line:18,column:16},end:{line:18,column:34}},type:"binary-expr",locations:[{start:{line:18,column:16},end:{line:18,column:17}},{start:{line:18,column:22},end:{line:18,column:33}}],line:18},"2":{loc:{start:{line:21,column:32},end:{line:21,column:148}},type:"cond-expr",locations:[{start:{line:21,column:46},end:{line:21,column:67}},{start:{line:21,column:70},end:{line:21,column:148}}],line:21},"3":{loc:{start:{line:22,column:51},end:{line:22,column:67}},type:"binary-expr",locations:[{start:{line:22,column:51},end:{line:22,column:61}},{start:{line:22,column:65},end:{line:22,column:67}}],line:22},"4":{loc:{start:{line:38,column:15},end:{line:38,column:81}},type:"binary-expr",locations:[{start:{line:38,column:15},end:{line:38,column:51}},{start:{line:38,column:56},end:{line:38,column:80}}],line:38},"5":{loc:{start:{line:41,column:15},end:{line:41,column:78}},type:"binary-expr",locations:[{start:{line:41,column:15},end:{line:41,column:49}},{start:{line:41,column:54},end:{line:41,column:77}}],line:41},"6":{loc:{start:{line:44,column:15},end:{line:44,column:76}},type:"binary-expr",locations:[{start:{line:44,column:15},end:{line:44,column:48}},{start:{line:44,column:53},end:{line:44,column:75}}],line:44},"7":{loc:{start:{line:50,column:15},end:{line:50,column:114}},type:"binary-expr",locations:[{start:{line:50,column:15},end:{line:50,column:60}},{start:{line:50,column:65},end:{line:50,column:113}}],line:50},"8":{loc:{start:{line:56,column:8},end:{line:58,column:9}},type:"if",locations:[{start:{line:56,column:8},end:{line:58,column:9}},{start:{line:56,column:8},end:{line:58,column:9}}],line:56},"9":{loc:{start:{line:62,column:8},end:{line:65,column:9}},type:"if",locations:[{start:{line:62,column:8},end:{line:65,column:9}},{start:{line:62,column:8},end:{line:65,column:9}}],line:62},"10":{loc:{start:{line:66,column:20},end:{line:66,column:58}},type:"binary-expr",locations:[{start:{line:66,column:20},end:{line:66,column:42}},{start:{line:66,column:46},end:{line:66,column:58}}],line:66},"11":{loc:{start:{line:92,column:12},end:{line:95,column:13}},type:"if",locations:[{start:{line:92,column:12},end:{line:95,column:13}},{start:{line:92,column:12},end:{line:95,column:13}}],line:92},"12":{loc:{start:{line:96,column:12},end:{line:99,column:13}},type:"if",locations:[{start:{line:96,column:12},end:{line:99,column:13}},{start:{line:96,column:12},end:{line:99,column:13}}],line:96},"13":{loc:{start:{line:111,column:4},end:{line:113,column:5}},type:"if",locations:[{start:{line:111,column:4},end:{line:113,column:5}},{start:{line:111,column:4},end:{line:113,column:5}}],line:111},"14":{loc:{start:{line:114,column:4},end:{line:116,column:5}},type:"if",locations:[{start:{line:114,column:4},end:{line:116,column:5}},{start:{line:114,column:4},end:{line:116,column:5}}],line:114},"15":{loc:{start:{line:117,column:4},end:{line:119,column:5}},type:"if",locations:[{start:{line:117,column:4},end:{line:119,column:5}},{start:{line:117,column:4},end:{line:119,column:5}}],line:117},"16":{loc:{start:{line:120,column:4},end:{line:122,column:5}},type:"if",locations:[{start:{line:120,column:4},end:{line:122,column:5}},{start:{line:120,column:4},end:{line:122,column:5}}],line:120},"17":{loc:{start:{line:127,column:4},end:{line:130,column:5}},type:"if",locations:[{start:{line:127,column:4},end:{line:130,column:5}},{start:{line:127,column:4},end:{line:130,column:5}}],line:127},"18":{loc:{start:{line:131,column:4},end:{line:133,column:5}},type:"if",locations:[{start:{line:131,column:4},end:{line:133,column:5}},{start:{line:131,column:4},end:{line:133,column:5}}],line:131},"19":{loc:{start:{line:131,column:8},end:{line:131,column:83}},type:"binary-expr",locations:[{start:{line:131,column:8},end:{line:131,column:36}},{start:{line:131,column:40},end:{line:131,column:83}}],line:131},"20":{loc:{start:{line:134,column:4},end:{line:136,column:5}},type:"if",locations:[{start:{line:134,column:4},end:{line:136,column:5}},{start:{line:134,column:4},end:{line:136,column:5}}],line:134},"21":{loc:{start:{line:134,column:8},end:{line:134,column:79}},type:"binary-expr",locations:[{start:{line:134,column:8},end:{line:134,column:36}},{start:{line:134,column:40},end:{line:134,column:79}}],line:134}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0},b:{"0":[0,0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var __awaiter=(cov_1exvn7ietp.s[0]++,(cov_1exvn7ietp.b[0][0]++,this)&&(cov_1exvn7ietp.b[0][1]++,this.__awaiter)||(cov_1exvn7ietp.b[0][2]++,function(thisArg,_arguments,P,generator){cov_1exvn7ietp.f[0]++;cov_1exvn7ietp.s[1]++;return new((cov_1exvn7ietp.b[1][0]++,P)||(cov_1exvn7ietp.b[1][1]++,P=Promise))(function(resolve,reject){cov_1exvn7ietp.f[1]++;function fulfilled(value){cov_1exvn7ietp.f[2]++;cov_1exvn7ietp.s[2]++;try{cov_1exvn7ietp.s[3]++;step(generator.next(value));}catch(e){cov_1exvn7ietp.s[4]++;reject(e);}}function rejected(value){cov_1exvn7ietp.f[3]++;cov_1exvn7ietp.s[5]++;try{cov_1exvn7ietp.s[6]++;step(generator["throw"](value));}catch(e){cov_1exvn7ietp.s[7]++;reject(e);}}function step(result){cov_1exvn7ietp.f[4]++;cov_1exvn7ietp.s[8]++;result.done?(cov_1exvn7ietp.b[2][0]++,resolve(result.value)):(cov_1exvn7ietp.b[2][1]++,new P(function(resolve){cov_1exvn7ietp.f[5]++;cov_1exvn7ietp.s[9]++;resolve(result.value);}).then(fulfilled,rejected));}cov_1exvn7ietp.s[10]++;step((generator=generator.apply(thisArg,(cov_1exvn7ietp.b[3][0]++,_arguments)||(cov_1exvn7ietp.b[3][1]++,[]))).next());});}));cov_1exvn7ietp.s[11]++;Object.defineProperty(exports,"__esModule",{value:true});const automation_client_1=(cov_1exvn7ietp.s[12]++,require("@atomist/automation-client"));const approvalGate_1=(cov_1exvn7ietp.s[13]++,require("../../../handlers/events/delivery/verify/approvalGate"));const gitHubContext_1=(cov_1exvn7ietp.s[14]++,require("./gitHubContext"));const ValidGoalName=(cov_1exvn7ietp.s[15]++,/^[a-zA-Z_][a-zA-Z0-9_]*$/);/**
 * Represents a delivery action, such as Build or Deploy.
 */class Goal{get environment(){cov_1exvn7ietp.f[6]++;cov_1exvn7ietp.s[16]++;return this.definition.environment;}get successDescription(){cov_1exvn7ietp.f[7]++;cov_1exvn7ietp.s[17]++;return(cov_1exvn7ietp.b[4][0]++,this.definition.completedDescription)||(cov_1exvn7ietp.b[4][1]++,"Complete: "+this.name);}get inProcessDescription(){cov_1exvn7ietp.f[8]++;cov_1exvn7ietp.s[18]++;return(cov_1exvn7ietp.b[5][0]++,this.definition.workingDescription)||(cov_1exvn7ietp.b[5][1]++,"Working: "+this.name);}get failureDescription(){cov_1exvn7ietp.f[9]++;cov_1exvn7ietp.s[19]++;return(cov_1exvn7ietp.b[6][0]++,this.definition.failedDescription)||(cov_1exvn7ietp.b[6][1]++,"Failed: "+this.name);}get requestedDescription(){cov_1exvn7ietp.f[10]++;cov_1exvn7ietp.s[20]++;return"Planned: "+this.name;}get waitingForApprovalDescription(){cov_1exvn7ietp.f[11]++;cov_1exvn7ietp.s[21]++;return(cov_1exvn7ietp.b[7][0]++,this.definition.waitingForApprovalDescription)||(cov_1exvn7ietp.b[7][1]++,this.successDescription+"(but needs approval)");}get retryIntent(){cov_1exvn7ietp.f[12]++;cov_1exvn7ietp.s[22]++;return"trigger "+this.name;}constructor(definition){cov_1exvn7ietp.f[13]++;cov_1exvn7ietp.s[23]++;if(!ValidGoalName.test(definition.uniqueName)){cov_1exvn7ietp.b[8][0]++;cov_1exvn7ietp.s[24]++;throw new Error(`${definition.uniqueName} is not a valid goal name: Must be camel case`);}else{cov_1exvn7ietp.b[8][1]++;}cov_1exvn7ietp.s[25]++;this.definition=definition;const numberAndName=(cov_1exvn7ietp.s[26]++,/([0-9\.]+)-(.*)/);const matchGoal=(cov_1exvn7ietp.s[27]++,definition.orderedName.match(numberAndName));cov_1exvn7ietp.s[28]++;if(!matchGoal){cov_1exvn7ietp.b[9][0]++;cov_1exvn7ietp.s[29]++;automation_client_1.logger.debug(`Ordered name must be '#-name'. Did not find number and name in ${definition.orderedName}`);cov_1exvn7ietp.s[30]++;return;}else{cov_1exvn7ietp.b[9][1]++;}cov_1exvn7ietp.s[31]++;this.name=(cov_1exvn7ietp.b[10][0]++,definition.displayName)||(cov_1exvn7ietp.b[10][1]++,matchGoal[2]);cov_1exvn7ietp.s[32]++;this.context=gitHubContext_1.BaseContext+definition.environment+definition.orderedName;cov_1exvn7ietp.s[33]++;this.uniqueCamelCaseName=definition.uniqueName;}// TODO decouple from github statuses
preconditionsStatus(id,sub){cov_1exvn7ietp.f[14]++;cov_1exvn7ietp.s[34]++;return __awaiter(this,void 0,void 0,function*(){cov_1exvn7ietp.f[15]++;cov_1exvn7ietp.s[35]++;return"success";});}}cov_1exvn7ietp.s[36]++;exports.Goal=Goal;class GoalWithPrecondition extends(Goal){constructor(definition,...dependsOn){cov_1exvn7ietp.f[16]++;cov_1exvn7ietp.s[37]++;super(definition);cov_1exvn7ietp.s[38]++;this.dependsOn=dependsOn;}preconditionsStatus(idForLogging,sub){cov_1exvn7ietp.f[17]++;cov_1exvn7ietp.s[39]++;return __awaiter(this,void 0,void 0,function*(){cov_1exvn7ietp.f[18]++;const checks=(cov_1exvn7ietp.s[40]++,this.dependsOn.map(pg=>{cov_1exvn7ietp.f[19]++;cov_1exvn7ietp.s[41]++;return checkPreconditionStatus(sub,pg);}));cov_1exvn7ietp.s[42]++;automation_client_1.logger.debug("Preconditions: %j",checks);const errors=(cov_1exvn7ietp.s[43]++,checks.filter(r=>{cov_1exvn7ietp.f[20]++;cov_1exvn7ietp.s[44]++;return r.error!==undefined;}).map(r=>{cov_1exvn7ietp.f[21]++;cov_1exvn7ietp.s[45]++;return r.error;}));const reasonsToWait=(cov_1exvn7ietp.s[46]++,checks.filter(r=>{cov_1exvn7ietp.f[22]++;cov_1exvn7ietp.s[47]++;return r.wait!==undefined;}).map(r=>{cov_1exvn7ietp.f[23]++;cov_1exvn7ietp.s[48]++;return r.wait;}));cov_1exvn7ietp.s[49]++;errors.forEach(e=>{cov_1exvn7ietp.f[24]++;cov_1exvn7ietp.s[50]++;return automation_client_1.logger.debug("Could not establish preconditions for "+this.name+": "+e);});cov_1exvn7ietp.s[51]++;reasonsToWait.forEach(e=>{cov_1exvn7ietp.f[25]++;cov_1exvn7ietp.s[52]++;return automation_client_1.logger.debug("Not triggering "+this.name+": "+e);});cov_1exvn7ietp.s[53]++;if(errors.length>0){cov_1exvn7ietp.b[11][0]++;cov_1exvn7ietp.s[54]++;automation_client_1.logger.info("Preconditions failed on goal %s with dependencies '%s' on %j: Errors=[%s]; reasons to wait=[%s]",this.name,this.dependsOn.map(g=>{cov_1exvn7ietp.f[26]++;cov_1exvn7ietp.s[55]++;return g.name;}),idForLogging,errors.join(","),reasonsToWait.join(","));cov_1exvn7ietp.s[56]++;return"failure";}else{cov_1exvn7ietp.b[11][1]++;}cov_1exvn7ietp.s[57]++;if(reasonsToWait.length>0){cov_1exvn7ietp.b[12][0]++;cov_1exvn7ietp.s[58]++;automation_client_1.logger.debug("Preconditions not yet met on goal %s with dependencies '%s' on %j: Errors=[%s]; reasons to wait=[%s]",this.name,this.dependsOn.map(g=>{cov_1exvn7ietp.f[27]++;cov_1exvn7ietp.s[59]++;return g.name;}),idForLogging,errors.join(","),reasonsToWait.join(","));cov_1exvn7ietp.s[60]++;return"waiting";}else{cov_1exvn7ietp.b[12][1]++;}cov_1exvn7ietp.s[61]++;return"success";});}}cov_1exvn7ietp.s[62]++;exports.GoalWithPrecondition=GoalWithPrecondition;function hasPreconditions(goal){cov_1exvn7ietp.f[28]++;cov_1exvn7ietp.s[63]++;return!!goal.dependsOn;}cov_1exvn7ietp.s[64]++;exports.hasPreconditions=hasPreconditions;function checkPreconditionStatus(sub,pg){cov_1exvn7ietp.f[29]++;const detectedStatus=(cov_1exvn7ietp.s[65]++,sub.siblings.find(gs=>{cov_1exvn7ietp.f[30]++;cov_1exvn7ietp.s[66]++;return gs.context===pg.context;}));cov_1exvn7ietp.s[67]++;if(!detectedStatus){cov_1exvn7ietp.b[13][0]++;cov_1exvn7ietp.s[68]++;return{wait:"Did not find a status for "+pg.context};}else{cov_1exvn7ietp.b[13][1]++;}cov_1exvn7ietp.s[69]++;if(detectedStatus.state==="pending"){cov_1exvn7ietp.b[14][0]++;cov_1exvn7ietp.s[70]++;return{wait:"Precondition '"+pg.name+"' not yet successful"};}else{cov_1exvn7ietp.b[14][1]++;}cov_1exvn7ietp.s[71]++;if(detectedStatus.state!=="success"){cov_1exvn7ietp.b[15][0]++;cov_1exvn7ietp.s[72]++;return{error:"Precondition '"+pg.name+`' in state [${detectedStatus.state}]`};}else{cov_1exvn7ietp.b[15][1]++;}cov_1exvn7ietp.s[73]++;if(approvalGate_1.requiresApproval(detectedStatus)){cov_1exvn7ietp.b[16][0]++;cov_1exvn7ietp.s[74]++;return{wait:"Precondition '"+pg.name+"' requires approval"};}else{cov_1exvn7ietp.b[16][1]++;}cov_1exvn7ietp.s[75]++;return{};}function currentGoalIsStillPending(currentGoal,status){cov_1exvn7ietp.f[31]++;const myStatus=(cov_1exvn7ietp.s[76]++,status.siblings.find(s=>{cov_1exvn7ietp.f[32]++;cov_1exvn7ietp.s[77]++;return s.context===currentGoal;}));cov_1exvn7ietp.s[78]++;if(!myStatus){cov_1exvn7ietp.b[17][0]++;cov_1exvn7ietp.s[79]++;automation_client_1.logger.debug("Status.context is %s but there is nothing with this context",currentGoal);cov_1exvn7ietp.s[80]++;return false;}else{cov_1exvn7ietp.b[17][1]++;}cov_1exvn7ietp.s[81]++;if((cov_1exvn7ietp.b[19][0]++,myStatus.state==="pending")&&(cov_1exvn7ietp.b[19][1]++,myStatus.description.startsWith("Planning"))){cov_1exvn7ietp.b[18][0]++;cov_1exvn7ietp.s[82]++;return true;}else{cov_1exvn7ietp.b[18][1]++;}cov_1exvn7ietp.s[83]++;if((cov_1exvn7ietp.b[21][0]++,myStatus.state==="failure")&&(cov_1exvn7ietp.b[21][1]++,myStatus.description.startsWith("Skip"))){cov_1exvn7ietp.b[20][0]++;cov_1exvn7ietp.s[84]++;return true;}else{cov_1exvn7ietp.b[20][1]++;}cov_1exvn7ietp.s[85]++;automation_client_1.logger.debug(`${currentGoal} is not still planned or skipped, so I'm not running it.
    State: ${myStatus.state} Description: ${myStatus.description}`);cov_1exvn7ietp.s[86]++;return false;}cov_1exvn7ietp.s[87]++;exports.currentGoalIsStillPending=currentGoalIsStillPending;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL3JvZGpvaG5zb24vc2ZvcnphbmRvLWRldi9pZGVhLXByb2plY3RzL215LWZsb3cvc3JjL2NvbW1vbi9kZWxpdmVyeS9nb2Fscy9Hb2FsLnRzIiwic291cmNlcyI6WyIvVXNlcnMvcm9kam9obnNvbi9zZm9yemFuZG8tZGV2L2lkZWEtcHJvamVjdHMvbXktZmxvdy9zcmMvY29tbW9uL2RlbGl2ZXJ5L2dvYWxzL0dvYWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7Ozs7OztHQWNHOzs7Ozs7Ozs7O0FBRUgsa0VBQW9EO0FBRXBELHdGQUF5RjtBQUN6RixtREFBNEc7QUEyQjVHLE1BQU0sYUFBYSxHQUFHLDBCQUEwQixDQUFDO0FBRWpEOztHQUVHO0FBQ0g7SUFPSSxJQUFJLFdBQVc7UUFDWCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxJQUFJLGtCQUFrQjtRQUNsQixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsb0JBQW9CLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzlFLENBQUM7SUFFRCxJQUFJLG9CQUFvQjtRQUNwQixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsa0JBQWtCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzNFLENBQUM7SUFFRCxJQUFJLGtCQUFrQjtRQUNsQixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsaUJBQWlCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3pFLENBQUM7SUFFRCxJQUFJLG9CQUFvQjtRQUNwQixPQUFPLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO0lBQ25DLENBQUM7SUFFRCxJQUFJLDZCQUE2QjtRQUM3QixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsNkJBQTZCLElBQUksQ0FBQyxJQUFJLENBQUMs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VyxFQUFFLENBQUMsQ0FBQztJQUNoRSxPQUFPLEtBQUssQ0FBQztBQUNqQixDQUFDO0FBZkQsOERBZUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IMKpIDIwMTggQXRvbWlzdCwgSW5jLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwiQGF0b21pc3QvYXV0b21hdGlvbi1jbGllbnRcIjtcbmltcG9ydCB7IFJlcG9SZWYgfSBmcm9tIFwiQGF0b21pc3QvYXV0b21hdGlvbi1jbGllbnQvb3BlcmF0aW9ucy9jb21tb24vUmVwb0lkXCI7XG5pbXBvcnQgeyByZXF1aXJlc0FwcHJvdmFsIH0gZnJvbSBcIi4uLy4uLy4uL2hhbmRsZXJzL2V2ZW50cy9kZWxpdmVyeS92ZXJpZnkvYXBwcm92YWxHYXRlXCI7XG5pbXBvcnQgeyBCYXNlQ29udGV4dCwgR2l0SHViU3RhdHVzQW5kRnJpZW5kcywgR2l0SHViU3RhdHVzQ29udGV4dCwgR29hbEVudmlyb25tZW50IH0gZnJvbSBcIi4vZ2l0SHViQ29udGV4dFwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIEdvYWxEZWZpbml0aW9uIHtcblxuICAgIC8qKlxuICAgICAqIE11c3QgYmUgdW5pcXVlIGFtb25nIGdvYWxzXG4gICAgICogU2hvdWxkIGJlIGNhbWVsIGNhc2VcbiAgICAgKi9cbiAgICB1bmlxdWVOYW1lOiBzdHJpbmc7XG5cbiAgICBlbnZpcm9ubWVudDogR29hbEVudmlyb25tZW50O1xuICAgIG9yZGVyZWROYW1lOiBzdHJpbmc7XG4gICAgZGlzcGxheU5hbWU/OiBzdHJpbmc7XG4gICAgY29tcGxldGVkRGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gICAgd29ya2luZ0Rlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgIGZhaWxlZERlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAgIHdhaXRpbmdGb3JBcHByb3ZhbERlc2NyaXB0aW9uPzogc3RyaW5nO1xuXG4gICAgLy8gd2hlbiBzZXQgdG8gdHJ1ZSwgdGhpcyBnb2FsIHdpbGwgZXhlY3V0ZSBpbiBpdHMgb3duIGNvbnRhaW5lci9jbGllbnRcbiAgICBpc29sYXRlZD86IGJvb2xlYW47XG5cbiAgICAvLyB3aGVuIHNldCB0byB0cnVlLCB0aGlzIGdvYWwgcmVxdWlyZXMgYXBwcm92YWwgYmVmb3JlIGl0IGlzIG1hcmtlZCBzdWNjZXNzXG4gICAgYXBwcm92YWxSZXF1aXJlZD86IGJvb2xlYW47XG59XG5cbmV4cG9ydCB0eXBlIFByZWNvbmRpdGlvbnNTdGF0dXMgPSBcIndhaXRpbmdcIiB8IFwic3VjY2Vzc1wiIHwgXCJmYWlsdXJlXCI7XG5cbmNvbnN0IFZhbGlkR29hbE5hbWUgPSAvXlthLXpBLVpfXVthLXpBLVowLTlfXSokLztcblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgZGVsaXZlcnkgYWN0aW9uLCBzdWNoIGFzIEJ1aWxkIG9yIERlcGxveS5cbiAqL1xuZXhwb3J0IGNsYXNzIEdvYWwge1xuXG4gICAgcHVibGljIHJlYWRvbmx5IGNvbnRleHQ6IEdpdEh1YlN0YXR1c0NvbnRleHQ7XG4gICAgcHVibGljIHJlYWRvbmx5IG5hbWU6IHN0cmluZztcbiAgICBwdWJsaWMgcmVhZG9ubHkgZGVmaW5pdGlvbjogR29hbERlZmluaXRpb247XG4gICAgcHVibGljIHJlYWRvbmx5IHVuaXF1ZUNhbWVsQ2FzZU5hbWU6IHN0cmluZztcblxuICAgIGdldCBlbnZpcm9ubWVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVmaW5pdGlvbi5lbnZpcm9ubWVudDtcbiAgICB9XG5cbiAgICBnZXQgc3VjY2Vzc0Rlc2NyaXB0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kZWZpbml0aW9uLmNvbXBsZXRlZERlc2NyaXB0aW9uIHx8IChcIkNvbXBsZXRlOiBcIiArIHRoaXMubmFtZSk7XG4gICAgfVxuXG4gICAgZ2V0IGluUHJvY2Vzc0Rlc2NyaXB0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kZWZpbml0aW9uLndvcmtpbmdEZXNjcmlwdGlvbiB8fCAoXCJXb3JraW5nOiBcIiArIHRoaXMubmFtZSk7XG4gICAgfVxuXG4gICAgZ2V0IGZhaWx1cmVEZXNjcmlwdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVmaW5pdGlvbi5mYWlsZWREZXNjcmlwdGlvbiB8fCAoXCJGYWlsZWQ6IFwiICsgdGhpcy5uYW1lKTtcbiAgICB9XG5cbiAgICBnZXQgcmVxdWVzdGVkRGVzY3JpcHRpb24oKSB7XG4gICAgICAgIHJldHVybiBcIlBsYW5uZWQ6IFwiICsgdGhpcy5uYW1lO1xuICAgIH1cblxuICAgIGdldCB3YWl0aW5nRm9yQXBwcm92YWxEZXNjcmlwdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVmaW5pdGlvbi53YWl0aW5nRm9yQXBwcm92YWxEZXNjcmlwdGlvbiB8fCAodGhpcy5zdWNjZXNzRGVzY3JpcHRpb24gKyBcIihidXQgbmVlZHMgYXBwcm92YWwpXCIpO1xuICAgIH1cblxuICAgIGdldCByZXRyeUludGVudCgpIHtcbiAgICAgICAgcmV0dXJuIFwidHJpZ2dlciBcIiArIHRoaXMubmFtZTtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uOiBHb2FsRGVmaW5pdGlvbikge1xuICAgICAgICBpZiAoIVZhbGlkR29hbE5hbWUudGVzdChkZWZpbml0aW9uLnVuaXF1ZU5hbWUpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7ZGVmaW5pdGlvbi51bmlxdWVOYW1lfSBpcyBub3QgYSB2YWxpZCBnb2FsIG5hbWU6IE11c3QgYmUgY2FtZWwgY2FzZWApO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZGVmaW5pdGlvbiA9IGRlZmluaXRpb247XG5cbiAgICAgICAgY29uc3QgbnVtYmVyQW5kTmFtZSA9IC8oWzAtOVxcLl0rKS0oLiopLztcbiAgICAgICAgY29uc3QgbWF0Y2hHb2FsID0gZGVmaW5pdGlvbi5vcmRlcmVkTmFtZS5tYXRjaChudW1iZXJBbmROYW1lKTtcbiAgICAgICAgaWYgKCFtYXRjaEdvYWwpIHtcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhgT3JkZXJlZCBuYW1lIG11c3QgYmUgJyMtbmFtZScuIERpZCBub3QgZmluZCBudW1iZXIgYW5kIG5hbWUgaW4gJHtkZWZpbml0aW9uLm9yZGVyZWROYW1lfWApO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5uYW1lID0gZGVmaW5pdGlvbi5kaXNwbGF5TmFtZSB8fCBtYXRjaEdvYWxbMl07XG4gICAgICAgIHRoaXMuY29udGV4dCA9IEJhc2VDb250ZXh0ICsgZGVmaW5pdGlvbi5lbnZpcm9ubWVudCArIGRlZmluaXRpb24ub3JkZXJlZE5hbWU7XG5cbiAgICAgICAgdGhpcy51bmlxdWVDYW1lbENhc2VOYW1lID0gZGVmaW5pdGlvbi51bmlxdWVOYW1lO1xuICAgIH1cblxuICAgIC8vIFRPRE8gZGVjb3VwbGUgZnJvbSBnaXRodWIgc3RhdHVzZXNcbiAgICBwdWJsaWMgYXN5bmMgcHJlY29uZGl0aW9uc1N0YXR1cyhpZDogUmVwb1JlZixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWI6IEdpdEh1YlN0YXR1c0FuZEZyaWVuZHMpOiBQcm9taXNlPFByZWNvbmRpdGlvbnNTdGF0dXM+IHtcbiAgICAgICAgcmV0dXJuIFwic3VjY2Vzc1wiO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIEdvYWxXaXRoUHJlY29uZGl0aW9uIGV4dGVuZHMgR29hbCB7XG5cbiAgICBwdWJsaWMgcmVhZG9ubHkgZGVwZW5kc09uOiBHb2FsW107XG5cbiAgICBjb25zdHJ1Y3RvcihkZWZpbml0aW9uOiBHb2FsRGVmaW5pdGlvbiwgLi4uZGVwZW5kc09uOiBHb2FsW10pIHtcbiAgICAgICAgc3VwZXIoZGVmaW5pdGlvbik7XG4gICAgICAgIHRoaXMuZGVwZW5kc09uID0gZGVwZW5kc09uO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBwcmVjb25kaXRpb25zU3RhdHVzKGlkRm9yTG9nZ2luZzogUmVwb1JlZixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWI6IEdpdEh1YlN0YXR1c0FuZEZyaWVuZHMpOiBQcm9taXNlPFByZWNvbmRpdGlvbnNTdGF0dXM+IHtcbiAgICAgICAgY29uc3QgY2hlY2tzID0gdGhpcy5kZXBlbmRzT24ubWFwKHBnID0+IGNoZWNrUHJlY29uZGl0aW9uU3RhdHVzKHN1YiwgcGcpKTtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKFwiUHJlY29uZGl0aW9uczogJWpcIiwgY2hlY2tzKTtcbiAgICAgICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IGNoZWNrcy5maWx0ZXIociA9PiByLmVycm9yICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAubWFwKHIgPT4gci5lcnJvcik7XG4gICAgICAgIGNvbnN0IHJlYXNvbnNUb1dhaXQ6IHN0cmluZ1tdID0gY2hlY2tzLmZpbHRlcihyID0+IHIud2FpdCAhPT0gdW5kZWZpbmVkKS5tYXAociA9PiByLndhaXQpO1xuXG4gICAgICAgIGVycm9ycy5mb3JFYWNoKGUgPT4gbG9nZ2VyLmRlYnVnKFwiQ291bGQgbm90IGVzdGFibGlzaCBwcmVjb25kaXRpb25zIGZvciBcIiArIHRoaXMubmFtZSArIFwiOiBcIiArIGUpKTtcbiAgICAgICAgcmVhc29uc1RvV2FpdC5mb3JFYWNoKGUgPT4gbG9nZ2VyLmRlYnVnKFwiTm90IHRyaWdnZXJpbmcgXCIgKyB0aGlzLm5hbWUgKyBcIjogXCIgKyBlKSk7XG4gICAgICAgIGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgbG9nZ2VyLmluZm8oXCJQcmVjb25kaXRpb25zIGZhaWxlZCBvbiBnb2FsICVzIHdpdGggZGVwZW5kZW5jaWVzICclcycgb24gJWo6IEVycm9ycz1bJXNdOyByZWFzb25zIHRvIHdhaXQ9WyVzXVwiLFxuICAgICAgICAgICAgICAgIHRoaXMubmFtZSwgdGhpcy5kZXBlbmRzT24ubWFwKGcgPT4gZy5uYW1lKSxcbiAgICAgICAgICAgICAgICBpZEZvckxvZ2dpbmcsIGVycm9ycy5qb2luKFwiLFwiKSwgcmVhc29uc1RvV2FpdC5qb2luKFwiLFwiKSk7XG4gICAgICAgICAgICByZXR1cm4gXCJmYWlsdXJlXCI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlYXNvbnNUb1dhaXQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKFwiUHJlY29uZGl0aW9ucyBub3QgeWV0IG1ldCBvbiBnb2FsICVzIHdpdGggZGVwZW5kZW5jaWVzICclcycgb24gJWo6IEVycm9ycz1bJXNdOyByZWFzb25zIHRvIHdhaXQ9WyVzXVwiLFxuICAgICAgICAgICAgICAgIHRoaXMubmFtZSwgdGhpcy5kZXBlbmRzT24ubWFwKGcgPT4gZy5uYW1lKSxcbiAgICAgICAgICAgICAgICBpZEZvckxvZ2dpbmcsIGVycm9ycy5qb2luKFwiLFwiKSwgcmVhc29uc1RvV2FpdC5qb2luKFwiLFwiKSk7XG4gICAgICAgICAgICByZXR1cm4gXCJ3YWl0aW5nXCI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFwic3VjY2Vzc1wiO1xuICAgIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhc1ByZWNvbmRpdGlvbnMoZ29hbDogR29hbCk6IGdvYWwgaXMgR29hbFdpdGhQcmVjb25kaXRpb24ge1xuICAgIHJldHVybiAhIShnb2FsIGFzIEdvYWxXaXRoUHJlY29uZGl0aW9uKS5kZXBlbmRzT247XG59XG5cbmZ1bmN0aW9uIGNoZWNrUHJlY29uZGl0aW9uU3RhdHVzKHN1YjogR2l0SHViU3RhdHVzQW5kRnJpZW5kcywgcGc6IEdvYWwpOiB7IHdhaXQ/OiBzdHJpbmcsIGVycm9yPzogc3RyaW5nIH0ge1xuICAgIGNvbnN0IGRldGVjdGVkU3RhdHVzID0gc3ViLnNpYmxpbmdzLmZpbmQoZ3MgPT4gZ3MuY29udGV4dCA9PT0gcGcuY29udGV4dCk7XG4gICAgaWYgKCFkZXRlY3RlZFN0YXR1cykge1xuICAgICAgICByZXR1cm4geyB3YWl0OiBcIkRpZCBub3QgZmluZCBhIHN0YXR1cyBmb3IgXCIgKyBwZy5jb250ZXh0IH07XG4gICAgfVxuICAgIGlmIChkZXRlY3RlZFN0YXR1cy5zdGF0ZSA9PT0gXCJwZW5kaW5nXCIpIHtcbiAgICAgICAgcmV0dXJuIHsgd2FpdDogXCJQcmVjb25kaXRpb24gJ1wiICsgcGcubmFtZSArIFwiJyBub3QgeWV0IHN1Y2Nlc3NmdWxcIiB9O1xuICAgIH1cbiAgICBpZiAoZGV0ZWN0ZWRTdGF0dXMuc3RhdGUgIT09IFwic3VjY2Vzc1wiKSB7XG4gICAgICAgIHJldHVybiB7IGVycm9yOiBcIlByZWNvbmRpdGlvbiAnXCIgKyBwZy5uYW1lICsgYCcgaW4gc3RhdGUgWyR7ZGV0ZWN0ZWRTdGF0dXMuc3RhdGV9XWAgfTtcbiAgICB9XG4gICAgaWYgKHJlcXVpcmVzQXBwcm92YWwoZGV0ZWN0ZWRTdGF0dXMpKSB7XG4gICAgICAgIHJldHVybiB7IHdhaXQ6IFwiUHJlY29uZGl0aW9uICdcIiArIHBnLm5hbWUgKyBcIicgcmVxdWlyZXMgYXBwcm92YWxcIiB9O1xuICAgIH1cbiAgICByZXR1cm4ge307XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjdXJyZW50R29hbElzU3RpbGxQZW5kaW5nKGN1cnJlbnRHb2FsOiBHaXRIdWJTdGF0dXNDb250ZXh0LCBzdGF0dXM6IEdpdEh1YlN0YXR1c0FuZEZyaWVuZHMpOiBib29sZWFuIHtcbiAgICBjb25zdCBteVN0YXR1cyA9IHN0YXR1cy5zaWJsaW5ncy5maW5kKHMgPT4gcy5jb250ZXh0ID09PSBjdXJyZW50R29hbCk7XG4gICAgaWYgKCFteVN0YXR1cykge1xuICAgICAgICBsb2dnZXIuZGVidWcoXCJTdGF0dXMuY29udGV4dCBpcyAlcyBidXQgdGhlcmUgaXMgbm90aGluZyB3aXRoIHRoaXMgY29udGV4dFwiLCBjdXJyZW50R29hbCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKG15U3RhdHVzLnN0YXRlID09PSBcInBlbmRpbmdcIiAmJiBteVN0YXR1cy5kZXNjcmlwdGlvbi5zdGFydHNXaXRoKFwiUGxhbm5pbmdcIikpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChteVN0YXR1cy5zdGF0ZSA9PT0gXCJmYWlsdXJlXCIgJiYgbXlTdGF0dXMuZGVzY3JpcHRpb24uc3RhcnRzV2l0aChcIlNraXBcIikpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGxvZ2dlci5kZWJ1ZyhgJHtjdXJyZW50R29hbH0gaXMgbm90IHN0aWxsIHBsYW5uZWQgb3Igc2tpcHBlZCwgc28gSSdtIG5vdCBydW5uaW5nIGl0LlxuICAgIFN0YXRlOiAke215U3RhdHVzLnN0YXRlfSBEZXNjcmlwdGlvbjogJHtteVN0YXR1cy5kZXNjcmlwdGlvbn1gKTtcbiAgICByZXR1cm4gZmFsc2U7XG59XG4iXX0=