"use strict";var cov_1dyfm9k9z6=function(){var path="/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/common/command/BitBucketServerRepoRef.ts",hash="2ca9060a685a83579f45771365b51539914db4ad",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/common/command/BitBucketServerRepoRef.ts",statementMap:{"0":{start:{line:2,column:0},end:{line:2,column:62}},"1":{start:{line:3,column:28},end:{line:3,column:65}},"2":{start:{line:4,column:23},end:{line:4,column:80}},"3":{start:{line:5,column:17},end:{line:5,column:79}},"4":{start:{line:6,column:31},end:{line:6,column:107}},"5":{start:{line:7,column:16},end:{line:7,column:32}},"6":{start:{line:8,column:17},end:{line:8,column:50}},"7":{start:{line:9,column:32},end:{line:9,column:66}},"8":{start:{line:26,column:8},end:{line:26,column:83}},"9":{start:{line:27,column:8},end:{line:27,column:35}},"10":{start:{line:28,column:8},end:{line:28,column:58}},"11":{start:{line:29,column:8},end:{line:29,column:88}},"12":{start:{line:32,column:20},end:{line:32,column:80}},"13":{start:{line:33,column:21},end:{line:37,column:9}},"14":{start:{line:38,column:21},end:{line:38,column:35}},"15":{start:{line:39,column:8},end:{line:39,column:129}},"16":{start:{line:40,column:8},end:{line:51,column:11}},"17":{start:{line:42,column:12},end:{line:46,column:14}},"18":{start:{line:49,column:12},end:{line:49,column:106}},"19":{start:{line:50,column:12},end:{line:50,column:41}},"20":{start:{line:54,column:20},end:{line:54,column:76}},"21":{start:{line:55,column:8},end:{line:55,column:86}},"22":{start:{line:56,column:8},end:{line:67,column:11}},"23":{start:{line:58,column:12},end:{line:62,column:14}},"24":{start:{line:65,column:12},end:{line:65,column:94}},"25":{start:{line:66,column:12},end:{line:66,column:39}},"26":{start:{line:70,column:8},end:{line:70,column:63}},"27":{start:{line:73,column:20},end:{line:73,column:75}},"28":{start:{line:74,column:8},end:{line:74,column:83}},"29":{start:{line:75,column:8},end:{line:95,column:11}},"30":{start:{line:86,column:12},end:{line:90,column:14}},"31":{start:{line:93,column:12},end:{line:93,column:85}},"32":{start:{line:94,column:12},end:{line:94,column:39}},"33":{start:{line:98,column:18},end:{line:98,column:48}},"34":{start:{line:99,column:8},end:{line:101,column:9}},"35":{start:{line:100,column:12},end:{line:100,column:46}},"36":{start:{line:102,column:8},end:{line:102,column:70}},"37":{start:{line:105,column:8},end:{line:105,column:66}},"38":{start:{line:108,column:8},end:{line:108,column:41}},"39":{start:{line:111,column:8},end:{line:111,column:78}},"40":{start:{line:114,column:8},end:{line:114,column:53}},"41":{start:{line:117,column:0},end:{line:117,column:56}},"42":{start:{line:119,column:4},end:{line:121,column:5}},"43":{start:{line:120,column:8},end:{line:120,column:83}},"44":{start:{line:122,column:17},end:{line:122,column:54}},"45":{start:{line:123,column:20},end:{line:123,column:41}},"46":{start:{line:124,column:4},end:{line:128,column:6}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:25,column:4},end:{line:25,column:5}},loc:{start:{line:25,column:81},end:{line:30,column:5}},line:25},"1":{name:"(anonymous_1)",decl:{start:{line:31,column:4},end:{line:31,column:5}},loc:{start:{line:31,column:49},end:{line:52,column:5}},line:31},"2":{name:"(anonymous_2)",decl:{start:{line:41,column:18},end:{line:41,column:19}},loc:{start:{line:41,column:35},end:{line:47,column:9}},line:41},"3":{name:"(anonymous_3)",decl:{start:{line:48,column:19},end:{line:48,column:20}},loc:{start:{line:48,column:28},end:{line:51,column:9}},line:48},"4":{name:"(anonymous_4)",decl:{start:{line:53,column:4},end:{line:53,column:5}},loc:{start:{line:53,column:24},end:{line:68,column:5}},line:53},"5":{name:"(anonymous_5)",decl:{start:{line:57,column:18},end:{line:57,column:19}},loc:{start:{line:57,column:35},end:{line:63,column:9}},line:57},"6":{name:"(anonymous_6)",decl:{start:{line:64,column:19},end:{line:64,column:20}},loc:{start:{line:64,column:26},end:{line:67,column:9}},line:64},"7":{name:"(anonymous_7)",decl:{start:{line:69,column:4},end:{line:69,column:5}},loc:{start:{line:69,column:40},end:{line:71,column:5}},line:69},"8":{name:"(anonymous_8)",decl:{start:{line:72,column:4},end:{line:72,column:5}},loc:{start:{line:72,column:59},end:{line:96,column:5}},line:72},"9":{name:"(anonymous_9)",decl:{start:{line:85,column:18},end:{line:85,column:19}},loc:{start:{line:85,column:35},end:{line:91,column:9}},line:85},"10":{name:"(anonymous_10)",decl:{start:{line:92,column:19},end:{line:92,column:20}},loc:{start:{line:92,column:26},end:{line:95,column:9}},line:92},"11":{name:"(anonymous_11)",decl:{start:{line:97,column:4},end:{line:97,column:5}},loc:{start:{line:97,column:14},end:{line:103,column:5}},line:97},"12":{name:"(anonymous_12)",decl:{start:{line:104,column:4},end:{line:104,column:5}},loc:{start:{line:104,column:24},end:{line:106,column:5}},line:104},"13":{name:"(anonymous_13)",decl:{start:{line:107,column:4},end:{line:107,column:5}},loc:{start:{line:107,column:21},end:{line:109,column:5}},line:107},"14":{name:"(anonymous_14)",decl:{start:{line:110,column:4},end:{line:110,column:5}},loc:{start:{line:110,column:31},end:{line:112,column:5}},line:110},"15":{name:"(anonymous_15)",decl:{start:{line:113,column:4},end:{line:113,column:5}},loc:{start:{line:113,column:27},end:{line:115,column:5}},line:113},"16":{name:"headers",decl:{start:{line:118,column:9},end:{line:118,column:16}},loc:{start:{line:118,column:24},end:{line:129,column:1}},line:118}},branchMap:{"0":{loc:{start:{line:25,column:41},end:{line:25,column:57}},type:"default-arg",locations:[{start:{line:25,column:53},end:{line:25,column:57}}],line:25},"1":{loc:{start:{line:25,column:59},end:{line:25,column:73}},type:"default-arg",locations:[{start:{line:25,column:65},end:{line:25,column:73}}],line:25},"2":{loc:{start:{line:28,column:25},end:{line:28,column:57}},type:"cond-expr",locations:[{start:{line:28,column:37},end:{line:28,column:47}},{start:{line:28,column:50},end:{line:28,column:57}}],line:28},"3":{loc:{start:{line:99,column:8},end:{line:101,column:9}},type:"if",locations:[{start:{line:99,column:8},end:{line:101,column:9}},{start:{line:99,column:8},end:{line:101,column:9}}],line:99},"4":{loc:{start:{line:108,column:15},end:{line:108,column:40}},type:"cond-expr",locations:[{start:{line:108,column:32},end:{line:108,column:34}},{start:{line:108,column:37},end:{line:108,column:40}}],line:108},"5":{loc:{start:{line:119,column:4},end:{line:121,column:5}},type:"if",locations:[{start:{line:119,column:4},end:{line:121,column:5}},{start:{line:119,column:4},end:{line:121,column:5}}],line:119}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},b:{"0":[0],"1":[0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();cov_1dyfm9k9z6.s[0]++;Object.defineProperty(exports,"__esModule",{value:true});const automation_client_1=(cov_1dyfm9k9z6.s[1]++,require("@atomist/automation-client"));const ActionResult_1=(cov_1dyfm9k9z6.s[2]++,require("@atomist/automation-client/action/ActionResult"));const RepoId_1=(cov_1dyfm9k9z6.s[3]++,require("@atomist/automation-client/operations/common/RepoId"));const BasicAuthCredentials_1=(cov_1dyfm9k9z6.s[4]++,require("@atomist/automation-client/operations/common/BasicAuthCredentials"));const axios_1=(cov_1dyfm9k9z6.s[5]++,require("axios"));const base64_1=(cov_1dyfm9k9z6.s[6]++,require("../../util/misc/base64"));const AbstractRemoteRepoRef_1=(cov_1dyfm9k9z6.s[7]++,require("./AbstractRemoteRepoRef"));/**
 * RemoteRepoRef implementation for BitBucket server (not BitBucket Cloud)
 *
 * This should ultimately move to automation-client-ts
 */class BitBucketServerRepoRef extends(AbstractRemoteRepoRef_1.AbstractRemoteRepoRef){/**
     * Construct a new BitBucketServerRepoRef
     * @param {string} remoteBase remote base, including scheme
     * @param {string} owner
     * @param {string} repo
     * @param {boolean} isProject
     * @param {string} sha
     * @param {string} path
     */constructor(remoteBase,owner,repo,isProject=(cov_1dyfm9k9z6.b[0][0]++,true),sha=(cov_1dyfm9k9z6.b[1][0]++,"master"),path){cov_1dyfm9k9z6.f[0]++;cov_1dyfm9k9z6.s[8]++;super(RepoId_1.ProviderType.bitbucket,remoteBase,owner,repo,sha,path);cov_1dyfm9k9z6.s[9]++;this.isProject=isProject;cov_1dyfm9k9z6.s[10]++;this.ownerType=isProject?(cov_1dyfm9k9z6.b[2][0]++,"projects"):(cov_1dyfm9k9z6.b[2][1]++,"users");cov_1dyfm9k9z6.s[11]++;automation_client_1.logger.info("Constructed BitBucketServerRepoRef: %j",this);}createRemote(creds,description,visibility){cov_1dyfm9k9z6.f[1]++;const url=(cov_1dyfm9k9z6.s[12]++,`${this.scheme}${this.apiBase}/${this.apiBasePathComponent}`);const data=(cov_1dyfm9k9z6.s[13]++,{name:this.repo,scmId:"git",forkable:"true"});const hdrs=(cov_1dyfm9k9z6.s[14]++,headers(creds));cov_1dyfm9k9z6.s[15]++;automation_client_1.logger.info("Making request to BitBucket '%s' to create repo, data=%j, headers=%j",url,data,hdrs);cov_1dyfm9k9z6.s[16]++;return axios_1.default.post(url,data,hdrs).then(axiosResponse=>{cov_1dyfm9k9z6.f[2]++;cov_1dyfm9k9z6.s[17]++;return{target:this,success:true,axiosResponse};}).catch(error=>{cov_1dyfm9k9z6.f[3]++;cov_1dyfm9k9z6.s[18]++;automation_client_1.logger.error("Error attempting to create repository %j: %s",this,error);cov_1dyfm9k9z6.s[19]++;return Promise.reject(error);});}deleteRemote(creds){cov_1dyfm9k9z6.f[4]++;const url=(cov_1dyfm9k9z6.s[20]++,`${this.scheme}${this.apiBase}/${this.apiPathComponent}`);cov_1dyfm9k9z6.s[21]++;automation_client_1.logger.debug(`Making request to '${url}' to delete repo`);cov_1dyfm9k9z6.s[22]++;return axios_1.default.delete(url,headers(creds)).then(axiosResponse=>{cov_1dyfm9k9z6.f[5]++;cov_1dyfm9k9z6.s[23]++;return{target:this,success:true,axiosResponse};}).catch(err=>{cov_1dyfm9k9z6.f[6]++;cov_1dyfm9k9z6.s[24]++;automation_client_1.logger.error(`Error attempting to delete repository: ${err}`);cov_1dyfm9k9z6.s[25]++;return Promise.reject(err);});}setUserConfig(credentials,project){cov_1dyfm9k9z6.f[7]++;cov_1dyfm9k9z6.s[26]++;return Promise.resolve(ActionResult_1.successOn(this));}raisePullRequest(credentials,title,body,head,base){cov_1dyfm9k9z6.f[8]++;const url=(cov_1dyfm9k9z6.s[27]++,`${this.apiBase}${this.apiPathComponent}/pull-requests`);cov_1dyfm9k9z6.s[28]++;automation_client_1.logger.debug(`Making request to '${url}' to raise PR`);cov_1dyfm9k9z6.s[29]++;return axios_1.default.post(url,{title,description:body,fromRef:{id:head},toRef:{id:base}},headers(credentials)).then(axiosResponse=>{cov_1dyfm9k9z6.f[9]++;cov_1dyfm9k9z6.s[30]++;return{target:this,success:true,axiosResponse};}).catch(err=>{cov_1dyfm9k9z6.f[10]++;cov_1dyfm9k9z6.s[31]++;automation_client_1.logger.error(`Error attempting to raise PR: ${err}`);cov_1dyfm9k9z6.s[32]++;return Promise.reject(err);});}get url(){cov_1dyfm9k9z6.f[11]++;let url=(cov_1dyfm9k9z6.s[33]++,`projects/${this.owner}/repos`);cov_1dyfm9k9z6.s[34]++;if(!this.isProject){cov_1dyfm9k9z6.b[3][0]++;cov_1dyfm9k9z6.s[35]++;url=`users/${this.owner}/repos`;}else{cov_1dyfm9k9z6.b[3][1]++;}cov_1dyfm9k9z6.s[36]++;return`${this.scheme}${this.remoteBase}/${url}/${this.repo}`;}get pathComponent(){cov_1dyfm9k9z6.f[12]++;cov_1dyfm9k9z6.s[37]++;return`scm/${this.maybeTilde}${this.owner}/${this.repo}`;}get maybeTilde(){cov_1dyfm9k9z6.f[13]++;cov_1dyfm9k9z6.s[38]++;return this.isProject?(cov_1dyfm9k9z6.b[4][0]++,""):(cov_1dyfm9k9z6.b[4][1]++,"~");}get apiBasePathComponent(){cov_1dyfm9k9z6.f[14]++;cov_1dyfm9k9z6.s[39]++;return`rest/api/1.0/projects/${this.maybeTilde}${this.owner}/repos/`;}get apiPathComponent(){cov_1dyfm9k9z6.f[15]++;cov_1dyfm9k9z6.s[40]++;return this.apiBasePathComponent+this.repo;}}cov_1dyfm9k9z6.s[41]++;exports.BitBucketServerRepoRef=BitBucketServerRepoRef;function headers(creds){cov_1dyfm9k9z6.f[16]++;cov_1dyfm9k9z6.s[42]++;if(!BasicAuthCredentials_1.isBasicAuthCredentials(creds)){cov_1dyfm9k9z6.b[5][0]++;cov_1dyfm9k9z6.s[43]++;throw new Error("Only Basic auth supported: Had "+JSON.stringify(creds));}else{cov_1dyfm9k9z6.b[5][1]++;}const upwd=(cov_1dyfm9k9z6.s[44]++,`${creds.username}:${creds.password}`);const encoded=(cov_1dyfm9k9z6.s[45]++,base64_1.encode(upwd));cov_1dyfm9k9z6.s[46]++;return{headers:{Authorization:`Basic ${encoded}`}};}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL3JvZGpvaG5zb24vc2ZvcnphbmRvLWRldi9pZGVhLXByb2plY3RzL215LWZsb3cvc3JjL2NvbW1vbi9jb21tYW5kL0JpdEJ1Y2tldFNlcnZlclJlcG9SZWYudHMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2Rqb2huc29uL3Nmb3J6YW5kby1kZXYvaWRlYS1wcm9qZWN0cy9teS1mbG93L3NyYy9jb21tb24vY29tbWFuZC9CaXRCdWNrZXRTZXJ2ZXJSZXBvUmVmLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsa0VBQW9EO0FBQ3BELGlGQUF5RjtBQUV6RixnRkFBbUY7QUFFbkYsNEdBQTJHO0FBRTNHLGlDQUEwQjtBQUMxQixtREFBZ0Q7QUFDaEQsbUVBQWdFO0FBRWhFOzs7O0dBSUc7QUFDSCw0QkFBb0MsU0FBUSw2Q0FBcUI7SUFJN0Q7Ozs7Ozs7O09BUUc7SUFDSCxZQUFZLFVBQWtCLEVBQ2xCLEtBQWEsRUFDYixJQUFZLEVBQ0ssWUFBcUIsSUFBSSxFQUMxQyxNQUFjLFFBQVEsRUFDdEIsSUFBYTtRQUNyQixLQUFLLENBQUMscUJBQVksQ0FBQyxTQUFTLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBSHpDLGNBQVMsR0FBVCxTQUFTLENBQWdCO1FBSWxELElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztRQUNsRCwwQkFBTSxDQUFDLElBQUksQ0FBQyx3Q0FBd0MsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUNoRSxDQUFDO0lBRU0sWUFBWSxDQUFDLEtBQWtDLEVBQUUsV0FBbUIsRUFBRSxVQUFVO1FBQ25GLE1BQU0sR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1FBQ3pFLE1BQU0sSUFBSSxHQUFH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O0lBQ25ELE1BQU0sT0FBTyxHQUFHLGVBQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM3QixPQUFPO1FBQ0gsT0FBTyxFQUFFO1lBQ0wsYUFBYSxFQUFFLFNBQVMsT0FBTyxFQUFFO1NBQ3BDO0tBQ0osQ0FBQztBQUNOLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwiQGF0b21pc3QvYXV0b21hdGlvbi1jbGllbnRcIjtcbmltcG9ydCB7IEFjdGlvblJlc3VsdCwgc3VjY2Vzc09uIH0gZnJvbSBcIkBhdG9taXN0L2F1dG9tYXRpb24tY2xpZW50L2FjdGlvbi9BY3Rpb25SZXN1bHRcIjtcbmltcG9ydCB7IFByb2plY3RPcGVyYXRpb25DcmVkZW50aWFscyB9IGZyb20gXCJAYXRvbWlzdC9hdXRvbWF0aW9uLWNsaWVudC9vcGVyYXRpb25zL2NvbW1vbi9Qcm9qZWN0T3BlcmF0aW9uQ3JlZGVudGlhbHNcIjtcbmltcG9ydCB7IFByb3ZpZGVyVHlwZSB9IGZyb20gXCJAYXRvbWlzdC9hdXRvbWF0aW9uLWNsaWVudC9vcGVyYXRpb25zL2NvbW1vbi9SZXBvSWRcIjtcblxuaW1wb3J0IHsgaXNCYXNpY0F1dGhDcmVkZW50aWFscyB9IGZyb20gXCJAYXRvbWlzdC9hdXRvbWF0aW9uLWNsaWVudC9vcGVyYXRpb25zL2NvbW1vbi9CYXNpY0F1dGhDcmVkZW50aWFsc1wiO1xuaW1wb3J0IHsgQ29uZmlndXJhYmxlIH0gZnJvbSBcIkBhdG9taXN0L2F1dG9tYXRpb24tY2xpZW50L3Byb2plY3QvZ2l0L0NvbmZpZ3VyYWJsZVwiO1xuaW1wb3J0IGF4aW9zIGZyb20gXCJheGlvc1wiO1xuaW1wb3J0IHsgZW5jb2RlIH0gZnJvbSBcIi4uLy4uL3V0aWwvbWlzYy9iYXNlNjRcIjtcbmltcG9ydCB7IEFic3RyYWN0UmVtb3RlUmVwb1JlZiB9IGZyb20gXCIuL0Fic3RyYWN0UmVtb3RlUmVwb1JlZlwiO1xuXG4vKipcbiAqIFJlbW90ZVJlcG9SZWYgaW1wbGVtZW50YXRpb24gZm9yIEJpdEJ1Y2tldCBzZXJ2ZXIgKG5vdCBCaXRCdWNrZXQgQ2xvdWQpXG4gKlxuICogVGhpcyBzaG91bGQgdWx0aW1hdGVseSBtb3ZlIHRvIGF1dG9tYXRpb24tY2xpZW50LXRzXG4gKi9cbmV4cG9ydCBjbGFzcyBCaXRCdWNrZXRTZXJ2ZXJSZXBvUmVmIGV4dGVuZHMgQWJzdHJhY3RSZW1vdGVSZXBvUmVmIHtcblxuICAgIHB1YmxpYyByZWFkb25seSBvd25lclR5cGU6IFwicHJvamVjdHNcIiB8IFwidXNlcnNcIjtcblxuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdCBhIG5ldyBCaXRCdWNrZXRTZXJ2ZXJSZXBvUmVmXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHJlbW90ZUJhc2UgcmVtb3RlIGJhc2UsIGluY2x1ZGluZyBzY2hlbWVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gb3duZXJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcmVwb1xuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNQcm9qZWN0XG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHNoYVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoXG4gICAgICovXG4gICAgY29uc3RydWN0b3IocmVtb3RlQmFzZTogc3RyaW5nLFxuICAgICAgICAgICAgICAgIG93bmVyOiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgcmVwbzogc3RyaW5nLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgcmVhZG9ubHkgaXNQcm9qZWN0OiBib29sZWFuID0gdHJ1ZSxcbiAgICAgICAgICAgICAgICBzaGE6IHN0cmluZyA9IFwibWFzdGVyXCIsXG4gICAgICAgICAgICAgICAgcGF0aD86IHN0cmluZykge1xuICAgICAgICBzdXBlcihQcm92aWRlclR5cGUuYml0YnVja2V0LCByZW1vdGVCYXNlLCBvd25lciwgcmVwbywgc2hhLCBwYXRoKTtcbiAgICAgICAgdGhpcy5vd25lclR5cGUgPSBpc1Byb2plY3QgPyBcInByb2plY3RzXCIgOiBcInVzZXJzXCI7XG4gICAgICAgIGxvZ2dlci5pbmZvKFwiQ29uc3RydWN0ZWQgQml0QnVja2V0U2VydmVyUmVwb1JlZjogJWpcIiwgdGhpcyk7XG4gICAgfVxuXG4gICAgcHVibGljIGNyZWF0ZVJlbW90ZShjcmVkczogUHJvamVjdE9wZXJhdGlvbkNyZWRlbnRpYWxzLCBkZXNjcmlwdGlvbjogc3RyaW5nLCB2aXNpYmlsaXR5KTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dGhpcz4+IHtcbiAgICAgICAgY29uc3QgdXJsID0gYCR7dGhpcy5zY2hlbWV9JHt0aGlzLmFwaUJhc2V9LyR7dGhpcy5hcGlCYXNlUGF0aENvbXBvbmVudH1gO1xuICAgICAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICAgICAgbmFtZTogdGhpcy5yZXBvLFxuICAgICAgICAgICAgc2NtSWQ6IFwiZ2l0XCIsXG4gICAgICAgICAgICBmb3JrYWJsZTogXCJ0cnVlXCIsXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGhkcnMgPSBoZWFkZXJzKGNyZWRzKTtcbiAgICAgICAgbG9nZ2VyLmluZm8oXCJNYWtpbmcgcmVxdWVzdCB0byBCaXRCdWNrZXQgJyVzJyB0byBjcmVhdGUgcmVwbywgZGF0YT0laiwgaGVhZGVycz0lalwiLCB1cmwsIGRhdGEsIGhkcnMpO1xuICAgICAgICByZXR1cm4gYXhpb3MucG9zdCh1cmwsIGRhdGEsIGhkcnMpXG4gICAgICAgICAgICAudGhlbihheGlvc1Jlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IHRoaXMsXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGF4aW9zUmVzcG9uc2UsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihcIkVycm9yIGF0dGVtcHRpbmcgdG8gY3JlYXRlIHJlcG9zaXRvcnkgJWo6ICVzXCIsIHRoaXMsIGVycm9yKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGRlbGV0ZVJlbW90ZShjcmVkczogUHJvamVjdE9wZXJhdGlvbkNyZWRlbnRpYWxzKTogUHJvbWlzZTxBY3Rpb25SZXN1bHQ8dGhpcz4+IHtcbiAgICAgICAgY29uc3QgdXJsID0gYCR7dGhpcy5zY2hlbWV9JHt0aGlzLmFwaUJhc2V9LyR7dGhpcy5hcGlQYXRoQ29tcG9uZW50fWA7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgTWFraW5nIHJlcXVlc3QgdG8gJyR7dXJsfScgdG8gZGVsZXRlIHJlcG9gKTtcbiAgICAgICAgcmV0dXJuIGF4aW9zLmRlbGV0ZSh1cmwsIGhlYWRlcnMoY3JlZHMpKVxuICAgICAgICAgICAgLnRoZW4oYXhpb3NSZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiB0aGlzLFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBheGlvc1Jlc3BvbnNlLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGBFcnJvciBhdHRlbXB0aW5nIHRvIGRlbGV0ZSByZXBvc2l0b3J5OiAke2Vycn1gKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRVc2VyQ29uZmlnKGNyZWRlbnRpYWxzOiBQcm9qZWN0T3BlcmF0aW9uQ3JlZGVudGlhbHMsIHByb2plY3Q6IENvbmZpZ3VyYWJsZSk6IFByb21pc2U8QWN0aW9uUmVzdWx0PGFueT4+IHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShzdWNjZXNzT24odGhpcykpO1xuICAgIH1cblxuICAgIHB1YmxpYyByYWlzZVB1bGxSZXF1ZXN0KGNyZWRlbnRpYWxzOiBQcm9qZWN0T3BlcmF0aW9uQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHN0cmluZywgYm9keTogc3RyaW5nLCBoZWFkOiBzdHJpbmcsIGJhc2U6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uUmVzdWx0PHRoaXM+PiB7XG4gICAgICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYXBpQmFzZX0ke3RoaXMuYXBpUGF0aENvbXBvbmVudH0vcHVsbC1yZXF1ZXN0c2A7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgTWFraW5nIHJlcXVlc3QgdG8gJyR7dXJsfScgdG8gcmFpc2UgUFJgKTtcbiAgICAgICAgcmV0dXJuIGF4aW9zLnBvc3QodXJsLCB7XG4gICAgICAgICAgICB0aXRsZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBib2R5LFxuICAgICAgICAgICAgZnJvbVJlZjoge1xuICAgICAgICAgICAgICAgIGlkOiBoZWFkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRvUmVmOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGJhc2UsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LCBoZWFkZXJzKGNyZWRlbnRpYWxzKSlcbiAgICAgICAgICAgIC50aGVuKGF4aW9zUmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldDogdGhpcyxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYXhpb3NSZXNwb25zZSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihgRXJyb3IgYXR0ZW1wdGluZyB0byByYWlzZSBQUjogJHtlcnJ9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycik7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXQgdXJsKCkge1xuICAgICAgICBsZXQgdXJsOiBzdHJpbmcgPSBgcHJvamVjdHMvJHt0aGlzLm93bmVyfS9yZXBvc2A7XG4gICAgICAgIGlmICghdGhpcy5pc1Byb2plY3QpIHtcbiAgICAgICAgICAgIHVybCA9IGB1c2Vycy8ke3RoaXMub3duZXJ9L3JlcG9zYDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYCR7dGhpcy5zY2hlbWV9JHt0aGlzLnJlbW90ZUJhc2V9LyR7dXJsfS8ke3RoaXMucmVwb31gO1xuICAgIH1cblxuICAgIGdldCBwYXRoQ29tcG9uZW50KCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBgc2NtLyR7dGhpcy5tYXliZVRpbGRlfSR7dGhpcy5vd25lcn0vJHt0aGlzLnJlcG99YDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldCBtYXliZVRpbGRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pc1Byb2plY3QgPyBcIlwiIDogXCJ+XCI7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXQgYXBpQmFzZVBhdGhDb21wb25lbnQoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGByZXN0L2FwaS8xLjAvcHJvamVjdHMvJHt0aGlzLm1heWJlVGlsZGV9JHt0aGlzLm93bmVyfS9yZXBvcy9gO1xuICAgIH1cblxuICAgIGdldCBhcGlQYXRoQ29tcG9uZW50KCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmFwaUJhc2VQYXRoQ29tcG9uZW50ICsgdGhpcy5yZXBvO1xuICAgIH1cblxufVxuXG5mdW5jdGlvbiBoZWFkZXJzKGNyZWRzOiBQcm9qZWN0T3BlcmF0aW9uQ3JlZGVudGlhbHMpIHtcbiAgICBpZiAoIWlzQmFzaWNBdXRoQ3JlZGVudGlhbHMoY3JlZHMpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk9ubHkgQmFzaWMgYXV0aCBzdXBwb3J0ZWQ6IEhhZCBcIiArIEpTT04uc3RyaW5naWZ5KGNyZWRzKSk7XG4gICAgfVxuICAgIGNvbnN0IHVwd2QgPSBgJHtjcmVkcy51c2VybmFtZX06JHtjcmVkcy5wYXNzd29yZH1gO1xuICAgIGNvbnN0IGVuY29kZWQgPSBlbmNvZGUodXB3ZCk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJhc2ljICR7ZW5jb2RlZH1gLFxuICAgICAgICB9LFxuICAgIH07XG59XG4iXX0=