"use strict";/*
 * Copyright Â© 2018 Atomist, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cov_1xkjzeo0zi=function(){var path="/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/common/delivery/deploy/pcf/CloudFoundryBlueGreener.ts",hash="37eaff6902dd9d5056a565098b716470f69639f3",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/common/delivery/deploy/pcf/CloudFoundryBlueGreener.ts",statementMap:{"0":{start:{line:17,column:16},end:{line:24,column:1}},"1":{start:{line:18,column:4},end:{line:23,column:7}},"2":{start:{line:19,column:36},end:{line:19,column:97}},"3":{start:{line:19,column:42},end:{line:19,column:70}},"4":{start:{line:19,column:85},end:{line:19,column:95}},"5":{start:{line:20,column:35},end:{line:20,column:100}},"6":{start:{line:20,column:41},end:{line:20,column:73}},"7":{start:{line:20,column:88},end:{line:20,column:98}},"8":{start:{line:21,column:32},end:{line:21,column:149}},"9":{start:{line:21,column:97},end:{line:21,column:119}},"10":{start:{line:22,column:8},end:{line:22,column:78}},"11":{start:{line:25,column:0},end:{line:25,column:62}},"12":{start:{line:26,column:10},end:{line:26,column:27}},"13":{start:{line:29,column:8},end:{line:29,column:45}},"14":{start:{line:32,column:8},end:{line:32,column:40}},"15":{start:{line:35,column:8},end:{line:35,column:44}},"16":{start:{line:38,column:8},end:{line:38,column:44}},"17":{start:{line:41,column:0},end:{line:41,column:40}},"18":{start:{line:44,column:8},end:{line:44,column:27}},"19":{start:{line:45,column:8},end:{line:45,column:29}},"20":{start:{line:46,column:8},end:{line:46,column:27}},"21":{start:{line:47,column:8},end:{line:47,column:23}},"22":{start:{line:50,column:8},end:{line:62,column:11}},"23":{start:{line:51,column:30},end:{line:51,column:62}},"24":{start:{line:52,column:32},end:{line:52,column:99}},"25":{start:{line:53,column:12},end:{line:56,column:13}},"26":{start:{line:54,column:16},end:{line:54,column:108}},"27":{start:{line:55,column:16},end:{line:55,column:70}},"28":{start:{line:57,column:28},end:{line:57,column:91}},"29":{start:{line:58,column:12},end:{line:61,column:13}},"30":{start:{line:59,column:16},end:{line:59,column:66}},"31":{start:{line:60,column:16},end:{line:60,column:104}},"32":{start:{line:65,column:8},end:{line:91,column:11}},"33":{start:{line:66,column:30},end:{line:66,column:62}},"34":{start:{line:67,column:34},end:{line:67,column:59}},"35":{start:{line:68,column:31},end:{line:68,column:97}},"36":{start:{line:69,column:32},end:{line:69,column:34}},"37":{start:{line:70,column:12},end:{line:73,column:13}},"38":{start:{line:71,column:16},end:{line:71,column:65}},"39":{start:{line:72,column:16},end:{line:72,column:88}},"40":{start:{line:74,column:12},end:{line:76,column:13}},"41":{start:{line:75,column:16},end:{line:75,column:53}},"42":{start:{line:77,column:12},end:{line:77,column:91}},"43":{start:{line:78,column:31},end:{line:78,column:91}},"44":{start:{line:79,column:12},end:{line:89,column:13}},"45":{start:{line:80,column:16},end:{line:80,column:103}},"46":{start:{line:81,column:32},end:{line:81,column:86}},"47":{start:{line:82,column:16},end:{line:84,column:20}},"48":{start:{line:82,column:49},end:{line:84,column:18}},"49":{start:{line:83,column:20},end:{line:83,column:130}},"50":{start:{line:85,column:33},end:{line:85,column:49}},"51":{start:{line:86,column:31},end:{line:86,column:92}},"52":{start:{line:87,column:33},end:{line:87,column:88}},"53":{start:{line:88,column:16},end:{line:88,column:62}},"54":{start:{line:90,column:12},end:{line:90,column:30}},"55":{start:{line:94,column:8},end:{line:121,column:11}},"56":{start:{line:95,column:30},end:{line:95,column:62}},"57":{start:{line:96,column:28},end:{line:96,column:91}},"58":{start:{line:97,column:12},end:{line:99,column:13}},"59":{start:{line:98,column:16},end:{line:98,column:23}},"60":{start:{line:100,column:31},end:{line:100,column:97}},"61":{start:{line:101,column:12},end:{line:103,column:13}},"62":{start:{line:102,column:16},end:{line:102,column:23}},"63":{start:{line:104,column:34},end:{line:104,column:89}},"64":{start:{line:105,column:12},end:{line:111,column:13}},"65":{start:{line:106,column:16},end:{line:106,column:116}},"66":{start:{line:107,column:31},end:{line:107,column:56}},"67":{start:{line:108,column:16},end:{line:110,column:20}},"68":{start:{line:108,column:49},end:{line:110,column:18}},"69":{start:{line:109,column:20},end:{line:109,column:120}},"70":{start:{line:112,column:12},end:{line:113,column:60}},"71":{start:{line:114,column:12},end:{line:114,column:98}},"72":{start:{line:115,column:12},end:{line:115,column:104}},"73":{start:{line:116,column:12},end:{line:116,column:63}},"74":{start:{line:117,column:12},end:{line:118,column:59}},"75":{start:{line:119,column:12},end:{line:119,column:94}},"76":{start:{line:120,column:12},end:{line:120,column:27}},"77":{start:{line:124,column:0},end:{line:124,column:58}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:17,column:44},end:{line:17,column:45}},loc:{start:{line:17,column:89},end:{line:24,column:1}},line:17},"1":{name:"(anonymous_1)",decl:{start:{line:18,column:36},end:{line:18,column:37}},loc:{start:{line:18,column:63},end:{line:23,column:5}},line:18},"2":{name:"fulfilled",decl:{start:{line:19,column:17},end:{line:19,column:26}},loc:{start:{line:19,column:34},end:{line:19,column:99}},line:19},"3":{name:"rejected",decl:{start:{line:20,column:17},end:{line:20,column:25}},loc:{start:{line:20,column:33},end:{line:20,column:102}},line:20},"4":{name:"step",decl:{start:{line:21,column:17},end:{line:21,column:21}},loc:{start:{line:21,column:30},end:{line:21,column:151}},line:21},"5":{name:"(anonymous_5)",decl:{start:{line:21,column:76},end:{line:21,column:77}},loc:{start:{line:21,column:95},end:{line:21,column:121}},line:21},"6":{name:"(anonymous_6)",decl:{start:{line:28,column:4},end:{line:28,column:5}},loc:{start:{line:28,column:32},end:{line:30,column:5}},line:28},"7":{name:"(anonymous_7)",decl:{start:{line:31,column:4},end:{line:31,column:5}},loc:{start:{line:31,column:24},end:{line:33,column:5}},line:31},"8":{name:"(anonymous_8)",decl:{start:{line:34,column:4},end:{line:34,column:5}},loc:{start:{line:34,column:25},end:{line:36,column:5}},line:34},"9":{name:"(anonymous_9)",decl:{start:{line:37,column:4},end:{line:37,column:5}},loc:{start:{line:37,column:21},end:{line:39,column:5}},line:37},"10":{name:"(anonymous_10)",decl:{start:{line:43,column:4},end:{line:43,column:5}},loc:{start:{line:43,column:43},end:{line:48,column:5}},line:43},"11":{name:"(anonymous_11)",decl:{start:{line:49,column:4},end:{line:49,column:5}},loc:{start:{line:49,column:35},end:{line:63,column:5}},line:49},"12":{name:"(anonymous_12)",decl:{start:{line:50,column:47},end:{line:50,column:48}},loc:{start:{line:50,column:60},end:{line:62,column:9}},line:50},"13":{name:"(anonymous_13)",decl:{start:{line:64,column:4},end:{line:64,column:5}},loc:{start:{line:64,column:54},end:{line:92,column:5}},line:64},"14":{name:"(anonymous_14)",decl:{start:{line:65,column:47},end:{line:65,column:48}},loc:{start:{line:65,column:60},end:{line:91,column:9}},line:65},"15":{name:"(anonymous_15)",decl:{start:{line:82,column:38},end:{line:82,column:39}},loc:{start:{line:82,column:49},end:{line:84,column:18}},line:82},"16":{name:"(anonymous_16)",decl:{start:{line:82,column:81},end:{line:82,column:82}},loc:{start:{line:82,column:94},end:{line:84,column:17}},line:82},"17":{name:"(anonymous_17)",decl:{start:{line:93,column:4},end:{line:93,column:5}},loc:{start:{line:93,column:23},end:{line:122,column:5}},line:93},"18":{name:"(anonymous_18)",decl:{start:{line:94,column:47},end:{line:94,column:48}},loc:{start:{line:94,column:60},end:{line:121,column:9}},line:94},"19":{name:"(anonymous_19)",decl:{start:{line:108,column:38},end:{line:108,column:39}},loc:{start:{line:108,column:49},end:{line:110,column:18}},line:108},"20":{name:"(anonymous_20)",decl:{start:{line:108,column:81},end:{line:108,column:82}},loc:{start:{line:108,column:94},end:{line:110,column:17}},line:108}},branchMap:{"0":{loc:{start:{line:17,column:16},end:{line:24,column:1}},type:"binary-expr",locations:[{start:{line:17,column:17},end:{line:17,column:21}},{start:{line:17,column:25},end:{line:17,column:39}},{start:{line:17,column:44},end:{line:24,column:1}}],line:17},"1":{loc:{start:{line:18,column:16},end:{line:18,column:34}},type:"binary-expr",locations:[{start:{line:18,column:16},end:{line:18,column:17}},{start:{line:18,column:22},end:{line:18,column:33}}],line:18},"2":{loc:{start:{line:21,column:32},end:{line:21,column:148}},type:"cond-expr",locations:[{start:{line:21,column:46},end:{line:21,column:67}},{start:{line:21,column:70},end:{line:21,column:148}}],line:21},"3":{loc:{start:{line:22,column:51},end:{line:22,column:67}},type:"binary-expr",locations:[{start:{line:22,column:51},end:{line:22,column:61}},{start:{line:22,column:65},end:{line:22,column:67}}],line:22},"4":{loc:{start:{line:53,column:12},end:{line:56,column:13}},type:"if",locations:[{start:{line:53,column:12},end:{line:56,column:13}},{start:{line:53,column:12},end:{line:56,column:13}}],line:53},"5":{loc:{start:{line:58,column:12},end:{line:61,column:13}},type:"if",locations:[{start:{line:58,column:12},end:{line:61,column:13}},{start:{line:58,column:12},end:{line:61,column:13}}],line:58},"6":{loc:{start:{line:70,column:12},end:{line:73,column:13}},type:"if",locations:[{start:{line:70,column:12},end:{line:73,column:13}},{start:{line:70,column:12},end:{line:73,column:13}}],line:70},"7":{loc:{start:{line:74,column:12},end:{line:76,column:13}},type:"if",locations:[{start:{line:74,column:12},end:{line:76,column:13}},{start:{line:74,column:12},end:{line:76,column:13}}],line:74},"8":{loc:{start:{line:79,column:12},end:{line:89,column:13}},type:"if",locations:[{start:{line:79,column:12},end:{line:89,column:13}},{start:{line:79,column:12},end:{line:89,column:13}}],line:79},"9":{loc:{start:{line:97,column:12},end:{line:99,column:13}},type:"if",locations:[{start:{line:97,column:12},end:{line:99,column:13}},{start:{line:97,column:12},end:{line:99,column:13}}],line:97},"10":{loc:{start:{line:101,column:12},end:{line:103,column:13}},type:"if",locations:[{start:{line:101,column:12},end:{line:103,column:13}},{start:{line:101,column:12},end:{line:103,column:13}}],line:101},"11":{loc:{start:{line:105,column:12},end:{line:111,column:13}},type:"if",locations:[{start:{line:105,column:12},end:{line:111,column:13}},{start:{line:105,column:12},end:{line:111,column:13}}],line:105}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},b:{"0":[0,0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var __awaiter=(cov_1xkjzeo0zi.s[0]++,(cov_1xkjzeo0zi.b[0][0]++,this)&&(cov_1xkjzeo0zi.b[0][1]++,this.__awaiter)||(cov_1xkjzeo0zi.b[0][2]++,function(thisArg,_arguments,P,generator){cov_1xkjzeo0zi.f[0]++;cov_1xkjzeo0zi.s[1]++;return new((cov_1xkjzeo0zi.b[1][0]++,P)||(cov_1xkjzeo0zi.b[1][1]++,P=Promise))(function(resolve,reject){cov_1xkjzeo0zi.f[1]++;function fulfilled(value){cov_1xkjzeo0zi.f[2]++;cov_1xkjzeo0zi.s[2]++;try{cov_1xkjzeo0zi.s[3]++;step(generator.next(value));}catch(e){cov_1xkjzeo0zi.s[4]++;reject(e);}}function rejected(value){cov_1xkjzeo0zi.f[3]++;cov_1xkjzeo0zi.s[5]++;try{cov_1xkjzeo0zi.s[6]++;step(generator["throw"](value));}catch(e){cov_1xkjzeo0zi.s[7]++;reject(e);}}function step(result){cov_1xkjzeo0zi.f[4]++;cov_1xkjzeo0zi.s[8]++;result.done?(cov_1xkjzeo0zi.b[2][0]++,resolve(result.value)):(cov_1xkjzeo0zi.b[2][1]++,new P(function(resolve){cov_1xkjzeo0zi.f[5]++;cov_1xkjzeo0zi.s[9]++;resolve(result.value);}).then(fulfilled,rejected));}cov_1xkjzeo0zi.s[10]++;step((generator=generator.apply(thisArg,(cov_1xkjzeo0zi.b[3][0]++,_arguments)||(cov_1xkjzeo0zi.b[3][1]++,[]))).next());});}));cov_1xkjzeo0zi.s[11]++;Object.defineProperty(exports,"__esModule",{value:true});const _=(cov_1xkjzeo0zi.s[12]++,require("lodash"));class BlueGreenNamer{constructor(currentAppName){cov_1xkjzeo0zi.f[6]++;cov_1xkjzeo0zi.s[13]++;this.currentAppName=currentAppName;}getCurrentAppName(){cov_1xkjzeo0zi.f[7]++;cov_1xkjzeo0zi.s[14]++;return`${this.currentAppName}`;}getPreviousAppName(){cov_1xkjzeo0zi.f[8]++;cov_1xkjzeo0zi.s[15]++;return`${this.currentAppName}-old`;}getNextAppName(){cov_1xkjzeo0zi.f[9]++;cov_1xkjzeo0zi.s[16]++;return`${this.currentAppName}-new`;}}cov_1xkjzeo0zi.s[17]++;exports.BlueGreenNamer=BlueGreenNamer;class CloudFoundryBlueGreener{constructor(cfApi,pusher,namer,log){cov_1xkjzeo0zi.f[10]++;cov_1xkjzeo0zi.s[18]++;this.cfApi=cfApi;cov_1xkjzeo0zi.s[19]++;this.pusher=pusher;cov_1xkjzeo0zi.s[20]++;this.namer=namer;cov_1xkjzeo0zi.s[21]++;this.log=log;}cleanUpExistingBlueGreenApps(){cov_1xkjzeo0zi.f[11]++;cov_1xkjzeo0zi.s[22]++;return __awaiter(this,void 0,void 0,function*(){cov_1xkjzeo0zi.f[12]++;const spaceGuid=(cov_1xkjzeo0zi.s[23]++,yield this.pusher.getSpaceGuid());const previousApp=(cov_1xkjzeo0zi.s[24]++,yield this.cfApi.getApp(spaceGuid,this.namer.getPreviousAppName()));cov_1xkjzeo0zi.s[25]++;if(previousApp){cov_1xkjzeo0zi.b[4][0]++;cov_1xkjzeo0zi.s[26]++;this.log.write(`Removing app ${this.pusher.spaceName}:${this.namer.getPreviousAppName()}.`);cov_1xkjzeo0zi.s[27]++;yield this.cfApi.deleteApp(previousApp.metadata.guid);}else{cov_1xkjzeo0zi.b[4][1]++;}const nextApp=(cov_1xkjzeo0zi.s[28]++,yield this.cfApi.getApp(spaceGuid,this.namer.getNextAppName()));cov_1xkjzeo0zi.s[29]++;if(nextApp){cov_1xkjzeo0zi.b[5][0]++;cov_1xkjzeo0zi.s[30]++;yield this.cfApi.deleteApp(nextApp.metadata.guid);cov_1xkjzeo0zi.s[31]++;this.log.write(`Removing app ${this.pusher.spaceName}:${this.namer.getNextAppName()}.`);}else{cov_1xkjzeo0zi.b[5][1]++;}});}createNextAppWithRoutes(manifestApp,packageFile){cov_1xkjzeo0zi.f[13]++;cov_1xkjzeo0zi.s[32]++;return __awaiter(this,void 0,void 0,function*(){cov_1xkjzeo0zi.f[14]++;const spaceGuid=(cov_1xkjzeo0zi.s[33]++,yield this.pusher.getSpaceGuid());const appProperties=(cov_1xkjzeo0zi.s[34]++,_.assign({},manifestApp));const currentApp=(cov_1xkjzeo0zi.s[35]++,yield this.cfApi.getApp(spaceGuid,this.namer.getCurrentAppName()));let currentRoutes=(cov_1xkjzeo0zi.s[36]++,[]);cov_1xkjzeo0zi.s[37]++;if(currentApp){cov_1xkjzeo0zi.b[6][0]++;cov_1xkjzeo0zi.s[38]++;appProperties.name=this.namer.getNextAppName();cov_1xkjzeo0zi.s[39]++;currentRoutes=yield this.cfApi.getAppRoutes(currentApp.metadata.guid);}else{cov_1xkjzeo0zi.b[6][1]++;}cov_1xkjzeo0zi.s[40]++;if(currentRoutes.length===0){cov_1xkjzeo0zi.b[7][0]++;cov_1xkjzeo0zi.s[41]++;appProperties["random-route"]=true;}else{cov_1xkjzeo0zi.b[7][1]++;}cov_1xkjzeo0zi.s[42]++;this.log.write(`Creating app ${this.pusher.spaceName}:${appProperties.name}.`);const deployment=(cov_1xkjzeo0zi.s[43]++,yield this.pusher.push(appProperties,packageFile,this.log));cov_1xkjzeo0zi.s[44]++;if(currentRoutes.length>0){cov_1xkjzeo0zi.b[8][0]++;cov_1xkjzeo0zi.s[45]++;this.log.write(`Adding routes to app ${this.pusher.spaceName}:${appProperties.name}.`);const nextApp=(cov_1xkjzeo0zi.s[46]++,yield this.cfApi.getApp(spaceGuid,appProperties.name));cov_1xkjzeo0zi.s[47]++;currentRoutes.forEach(route=>{cov_1xkjzeo0zi.f[15]++;cov_1xkjzeo0zi.s[48]++;return __awaiter(this,void 0,void 0,function*(){cov_1xkjzeo0zi.f[16]++;cov_1xkjzeo0zi.s[49]++;yield this.cfApi.addRouteToApp(spaceGuid,nextApp.metadata.guid,route.entity.host,route.entity.domain_guid);});});const anyRoute=(cov_1xkjzeo0zi.s[50]++,currentRoutes[0]);const domain=(cov_1xkjzeo0zi.s[51]++,yield this.cfApi.getDomainByGuid(anyRoute.entity.domain_guid));const endpoint=(cov_1xkjzeo0zi.s[52]++,`https://${anyRoute.entity.host}.${domain.entity.name}`);cov_1xkjzeo0zi.s[53]++;return _.assign({},deployment,{endpoint});}else{cov_1xkjzeo0zi.b[8][1]++;}cov_1xkjzeo0zi.s[54]++;return deployment;});}retireCurrentApp(){cov_1xkjzeo0zi.f[17]++;cov_1xkjzeo0zi.s[55]++;return __awaiter(this,void 0,void 0,function*(){cov_1xkjzeo0zi.f[18]++;const spaceGuid=(cov_1xkjzeo0zi.s[56]++,yield this.pusher.getSpaceGuid());const nextApp=(cov_1xkjzeo0zi.s[57]++,yield this.cfApi.getApp(spaceGuid,this.namer.getNextAppName()));cov_1xkjzeo0zi.s[58]++;if(!nextApp){cov_1xkjzeo0zi.b[9][0]++;cov_1xkjzeo0zi.s[59]++;return;}else{cov_1xkjzeo0zi.b[9][1]++;}const currentApp=(cov_1xkjzeo0zi.s[60]++,yield this.cfApi.getApp(spaceGuid,this.namer.getCurrentAppName()));cov_1xkjzeo0zi.s[61]++;if(!currentApp){cov_1xkjzeo0zi.b[10][0]++;cov_1xkjzeo0zi.s[62]++;return;}else{cov_1xkjzeo0zi.b[10][1]++;}const currentRoutes=(cov_1xkjzeo0zi.s[63]++,yield this.cfApi.getAppRoutes(currentApp.metadata.guid));cov_1xkjzeo0zi.s[64]++;if(currentRoutes.length>0){cov_1xkjzeo0zi.b[11][0]++;cov_1xkjzeo0zi.s[65]++;this.log.write(`Removing routes from app ${this.pusher.spaceName}:${this.namer.getNextAppName()}.`);const domain=(cov_1xkjzeo0zi.s[66]++,this.pusher.defaultDomain);cov_1xkjzeo0zi.s[67]++;currentRoutes.forEach(route=>{cov_1xkjzeo0zi.f[19]++;cov_1xkjzeo0zi.s[68]++;return __awaiter(this,void 0,void 0,function*(){cov_1xkjzeo0zi.f[20]++;cov_1xkjzeo0zi.s[69]++;yield this.cfApi.removeRouteFromApp(spaceGuid,currentApp.metadata.guid,route.entity.host,domain);});});}else{cov_1xkjzeo0zi.b[11][1]++;}cov_1xkjzeo0zi.s[70]++;this.log.write(`Renaming app ${this.pusher.spaceName}:${this.namer.getCurrentAppName()} `+`to ${this.namer.getPreviousAppName()}.`);cov_1xkjzeo0zi.s[71]++;yield this.cfApi.renameApp(currentApp.metadata.guid,this.namer.getPreviousAppName());cov_1xkjzeo0zi.s[72]++;this.log.write(`Stopping app ${this.pusher.spaceName}:${this.namer.getPreviousAppName()}.`);cov_1xkjzeo0zi.s[73]++;yield this.cfApi.stopApp(currentApp.metadata.guid);cov_1xkjzeo0zi.s[74]++;this.log.write(`Renaming app ${this.pusher.spaceName}:${this.namer.getNextAppName()} `+`to ${this.namer.getCurrentAppName()}.`);cov_1xkjzeo0zi.s[75]++;yield this.cfApi.renameApp(nextApp.metadata.guid,this.namer.getCurrentAppName());cov_1xkjzeo0zi.s[76]++;return nextApp;});}}cov_1xkjzeo0zi.s[77]++;exports.CloudFoundryBlueGreener=CloudFoundryBlueGreener;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL3JvZGpvaG5zb24vc2ZvcnphbmRvLWRldi9pZGVhLXByb2plY3RzL215LWZsb3cvc3JjL2NvbW1vbi9kZWxpdmVyeS9kZXBsb3kvcGNmL0Nsb3VkRm91bmRyeUJsdWVHcmVlbmVyLnRzIiwic291cmNlcyI6WyIvVXNlcnMvcm9kam9obnNvbi9zZm9yemFuZG8tZGV2L2lkZWEtcHJvamVjdHMvbXktZmxvdy9zcmMvY29tbW9uL2RlbGl2ZXJ5L2RlcGxveS9wY2YvQ2xvdWRGb3VuZHJ5Qmx1ZUdyZWVuZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7Ozs7OztHQWNHOzs7Ozs7Ozs7O0FBRUgsNEJBQTRCO0FBUzVCO0lBQ0ksWUFBNkIsY0FBc0I7UUFBdEIsbUJBQWMsR0FBZCxjQUFjLENBQVE7SUFDbkQsQ0FBQztJQUVNLGlCQUFpQjtRQUNwQixPQUFPLEdBQUcsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3BDLENBQUM7SUFFTSxrQkFBa0I7UUFDckIsT0FBTyxHQUFHLElBQUksQ0FBQyxjQUFjLE1BQU0sQ0FBQztJQUN4QyxDQUFDO0lBRU0sY0FBYztRQUNqQixPQUFPLEdBQUcsSUFBSSxDQUFDLGNBQWMsTUFBTSxDQUFDO0lBQ3hDLENBQUM7Q0FDSjtBQWZELHdDQWVDO0FBRUQ7SUFFSSxZQUE2QixLQUFzQixFQUN0QixNQUEwQixFQUMxQixLQUFxQixFQUNyQixHQUFnQjtRQUhoQixVQUFLLEdBQUwsS0FBSyxDQUFpQjtRQUN0QixXQUFNLEdBQU4sTUFBTSxDQUFvQjtRQUMxQixVQUFLLEdBQUwsS0FBSyxDQUFnQjtRQUNyQixRQUFHLEdBQUgsR0FBRyxDQUFhO0lBQzdDLENBQUM7SUFFWSw0QkFBNEI7O1lBQ3JDLE1BQU0sU0FBUyxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUNuRCxNQUFNLFdBQVcsR0FBRyxNQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFD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LENBQUMsTUFBTSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxHQUFHO2tCQUNoRixNQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDL0MsTUFBTSxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLENBQUMsQ0FBQztZQUNsRixPQUFPLE9BQU8sQ0FBQztRQUNuQixDQUFDO0tBQUE7Q0FFSjtBQWpGRCwwREFpRkMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IMKpIDIwMTggQXRvbWlzdCwgSW5jLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgKiBhcyBfIGZyb20gXCJsb2Rhc2hcIjtcblxuaW1wb3J0IHtSZWFkU3RyZWFtfSBmcm9tIFwiZnNcIjtcbmltcG9ydCB7UHJvZ3Jlc3NMb2d9IGZyb20gXCIuLi8uLi8uLi8uLi9zcGkvbG9nL1Byb2dyZXNzTG9nXCI7XG5pbXBvcnQge0Nsb3VkRm91bmRyeUFwaX0gZnJvbSBcIi4vQ2xvdWRGb3VuZHJ5QXBpXCI7XG5pbXBvcnQge01hbmlmZXN0QXBwbGljYXRpb259IGZyb20gXCIuL0Nsb3VkRm91bmRyeU1hbmlmZXN0XCI7XG5pbXBvcnQge0Nsb3VkRm91bmRyeVB1c2hlcn0gZnJvbSBcIi4vQ2xvdWRGb3VuZHJ5UHVzaGVyXCI7XG5pbXBvcnQge0Nsb3VkRm91bmRyeURlcGxveW1lbnR9IGZyb20gXCIuL0Nsb3VkRm91bmRyeVRhcmdldFwiO1xuXG5leHBvcnQgY2xhc3MgQmx1ZUdyZWVuTmFtZXIge1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgY3VycmVudEFwcE5hbWU6IHN0cmluZykge1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRDdXJyZW50QXBwTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIGAke3RoaXMuY3VycmVudEFwcE5hbWV9YDtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0UHJldmlvdXNBcHBOYW1lKCkge1xuICAgICAgICByZXR1cm4gYCR7dGhpcy5jdXJyZW50QXBwTmFtZX0tb2xkYDtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0TmV4dEFwcE5hbWUoKSB7XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmN1cnJlbnRBcHBOYW1lfS1uZXdgO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIENsb3VkRm91bmRyeUJsdWVHcmVlbmVyIHtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgY2ZBcGk6IENsb3VkRm91bmRyeUFwaSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIHJlYWRvbmx5IHB1c2hlcjogQ2xvdWRGb3VuZHJ5UHVzaGVyLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgcmVhZG9ubHkgbmFtZXI6IEJsdWVHcmVlbk5hbWVyLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgcmVhZG9ubHkgbG9nOiBQcm9ncmVzc0xvZykge1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBjbGVhblVwRXhpc3RpbmdCbHVlR3JlZW5BcHBzKCkge1xuICAgICAgICBjb25zdCBzcGFjZUd1aWQgPSBhd2FpdCB0aGlzLnB1c2hlci5nZXRTcGFjZUd1aWQoKTtcbiAgICAgICAgY29uc3QgcHJldmlvdXNBcHAgPSBhd2FpdCB0aGlzLmNmQXBpLmdldEFwcChzcGFjZUd1aWQsIHRoaXMubmFtZXIuZ2V0UHJldmlvdXNBcHBOYW1lKCkpO1xuICAgICAgICBpZiAocHJldmlvdXNBcHApIHtcbiAgICAgICAgICAgIHRoaXMubG9nLndyaXRlKGBSZW1vdmluZyBhcHAgJHt0aGlzLnB1c2hlci5zcGFjZU5hbWV9OiR7dGhpcy5uYW1lci5nZXRQcmV2aW91c0FwcE5hbWUoKX0uYCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmNmQXBpLmRlbGV0ZUFwcChwcmV2aW91c0FwcC5tZXRhZGF0YS5ndWlkKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuZXh0QXBwID0gYXdhaXQgdGhpcy5jZkFwaS5nZXRBcHAoc3BhY2VHdWlkLCB0aGlzLm5hbWVyLmdldE5leHRBcHBOYW1lKCkpO1xuICAgICAgICBpZiAobmV4dEFwcCkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5jZkFwaS5kZWxldGVBcHAobmV4dEFwcC5tZXRhZGF0YS5ndWlkKTtcbiAgICAgICAgICAgIHRoaXMubG9nLndyaXRlKGBSZW1vdmluZyBhcHAgJHt0aGlzLnB1c2hlci5zcGFjZU5hbWV9OiR7dGhpcy5uYW1lci5nZXROZXh0QXBwTmFtZSgpfS5gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBjcmVhdGVOZXh0QXBwV2l0aFJvdXRlcyhtYW5pZmVzdEFwcDogTWFuaWZlc3RBcHBsaWNhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFja2FnZUZpbGU6IFJlYWRTdHJlYW0pOiBQcm9taXNlPENsb3VkRm91bmRyeURlcGxveW1lbnQ+IHtcbiAgICAgICAgY29uc3Qgc3BhY2VHdWlkID0gYXdhaXQgdGhpcy5wdXNoZXIuZ2V0U3BhY2VHdWlkKCk7XG4gICAgICAgIGNvbnN0IGFwcFByb3BlcnRpZXMgPSBfLmFzc2lnbih7fSwgbWFuaWZlc3RBcHApO1xuICAgICAgICBjb25zdCBjdXJyZW50QXBwID0gYXdhaXQgdGhpcy5jZkFwaS5nZXRBcHAoc3BhY2VHdWlkLCB0aGlzLm5hbWVyLmdldEN1cnJlbnRBcHBOYW1lKCkpO1xuICAgICAgICBsZXQgY3VycmVudFJvdXRlcyA9IFtdO1xuICAgICAgICBpZiAoY3VycmVudEFwcCkge1xuICAgICAgICAgICAgYXBwUHJvcGVydGllcy5uYW1lID0gdGhpcy5uYW1lci5nZXROZXh0QXBwTmFtZSgpO1xuICAgICAgICAgICAgY3VycmVudFJvdXRlcyA9IGF3YWl0IHRoaXMuY2ZBcGkuZ2V0QXBwUm91dGVzKGN1cnJlbnRBcHAubWV0YWRhdGEuZ3VpZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGN1cnJlbnRSb3V0ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBhcHBQcm9wZXJ0aWVzW1wicmFuZG9tLXJvdXRlXCJdID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvZy53cml0ZShgQ3JlYXRpbmcgYXBwICR7dGhpcy5wdXNoZXIuc3BhY2VOYW1lfToke2FwcFByb3BlcnRpZXMubmFtZX0uYCk7XG4gICAgICAgIGNvbnN0IGRlcGxveW1lbnQgPSBhd2FpdCB0aGlzLnB1c2hlci5wdXNoKGFwcFByb3BlcnRpZXMsIHBhY2thZ2VGaWxlLCB0aGlzLmxvZyk7XG4gICAgICAgIGlmIChjdXJyZW50Um91dGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMubG9nLndyaXRlKGBBZGRpbmcgcm91dGVzIHRvIGFwcCAke3RoaXMucHVzaGVyLnNwYWNlTmFtZX06JHthcHBQcm9wZXJ0aWVzLm5hbWV9LmApO1xuICAgICAgICAgICAgY29uc3QgbmV4dEFwcCA9IGF3YWl0IHRoaXMuY2ZBcGkuZ2V0QXBwKHNwYWNlR3VpZCwgYXBwUHJvcGVydGllcy5uYW1lKTtcbiAgICAgICAgICAgIGN1cnJlbnRSb3V0ZXMuZm9yRWFjaChhc3luYyByb3V0ZSA9PiB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jZkFwaS5hZGRSb3V0ZVRvQXBwKHNwYWNlR3VpZCwgbmV4dEFwcC5tZXRhZGF0YS5ndWlkLCByb3V0ZS5lbnRpdHkuaG9zdCxcbiAgICAgICAgICAgICAgICAgICAgcm91dGUuZW50aXR5LmRvbWFpbl9ndWlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgYW55Um91dGUgPSBjdXJyZW50Um91dGVzWzBdO1xuICAgICAgICAgICAgY29uc3QgZG9tYWluID0gYXdhaXQgdGhpcy5jZkFwaS5nZXREb21haW5CeUd1aWQoYW55Um91dGUuZW50aXR5LmRvbWFpbl9ndWlkKTtcbiAgICAgICAgICAgIGNvbnN0IGVuZHBvaW50ID0gYGh0dHBzOi8vJHthbnlSb3V0ZS5lbnRpdHkuaG9zdH0uJHtkb21haW4uZW50aXR5Lm5hbWV9YDtcbiAgICAgICAgICAgIHJldHVybiBfLmFzc2lnbih7fSwgZGVwbG95bWVudCwge2VuZHBvaW50fSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlcGxveW1lbnQ7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIHJldGlyZUN1cnJlbnRBcHAoKSB7XG4gICAgICAgIGNvbnN0IHNwYWNlR3VpZCA9IGF3YWl0IHRoaXMucHVzaGVyLmdldFNwYWNlR3VpZCgpO1xuICAgICAgICBjb25zdCBuZXh0QXBwID0gYXdhaXQgdGhpcy5jZkFwaS5nZXRBcHAoc3BhY2VHdWlkLCB0aGlzLm5hbWVyLmdldE5leHRBcHBOYW1lKCkpO1xuICAgICAgICBpZiAoIW5leHRBcHApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjdXJyZW50QXBwID0gYXdhaXQgdGhpcy5jZkFwaS5nZXRBcHAoc3BhY2VHdWlkLCB0aGlzLm5hbWVyLmdldEN1cnJlbnRBcHBOYW1lKCkpO1xuICAgICAgICBpZiAoIWN1cnJlbnRBcHApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjdXJyZW50Um91dGVzID0gYXdhaXQgdGhpcy5jZkFwaS5nZXRBcHBSb3V0ZXMoY3VycmVudEFwcC5tZXRhZGF0YS5ndWlkKTtcbiAgICAgICAgaWYgKGN1cnJlbnRSb3V0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGhpcy5sb2cud3JpdGUoYFJlbW92aW5nIHJvdXRlcyBmcm9tIGFwcCAke3RoaXMucHVzaGVyLnNwYWNlTmFtZX06JHt0aGlzLm5hbWVyLmdldE5leHRBcHBOYW1lKCl9LmApO1xuICAgICAgICAgICAgY29uc3QgZG9tYWluID0gdGhpcy5wdXNoZXIuZGVmYXVsdERvbWFpbjtcbiAgICAgICAgICAgIGN1cnJlbnRSb3V0ZXMuZm9yRWFjaChhc3luYyByb3V0ZSA9PiB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jZkFwaS5yZW1vdmVSb3V0ZUZyb21BcHAoc3BhY2VHdWlkLCBjdXJyZW50QXBwLm1ldGFkYXRhLmd1aWQsIHJvdXRlLmVudGl0eS5ob3N0LCBkb21haW4pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sb2cud3JpdGUoYFJlbmFtaW5nIGFwcCAke3RoaXMucHVzaGVyLnNwYWNlTmFtZX06JHt0aGlzLm5hbWVyLmdldEN1cnJlbnRBcHBOYW1lKCl9IGBcbiAgICAgICAgICAgICsgYHRvICR7dGhpcy5uYW1lci5nZXRQcmV2aW91c0FwcE5hbWUoKX0uYCk7XG4gICAgICAgIGF3YWl0IHRoaXMuY2ZBcGkucmVuYW1lQXBwKGN1cnJlbnRBcHAubWV0YWRhdGEuZ3VpZCwgdGhpcy5uYW1lci5nZXRQcmV2aW91c0FwcE5hbWUoKSk7XG4gICAgICAgIHRoaXMubG9nLndyaXRlKGBTdG9wcGluZyBhcHAgJHt0aGlzLnB1c2hlci5zcGFjZU5hbWV9OiR7dGhpcy5uYW1lci5nZXRQcmV2aW91c0FwcE5hbWUoKX0uYCk7XG4gICAgICAgIGF3YWl0IHRoaXMuY2ZBcGkuc3RvcEFwcChjdXJyZW50QXBwLm1ldGFkYXRhLmd1aWQpO1xuICAgICAgICB0aGlzLmxvZy53cml0ZShgUmVuYW1pbmcgYXBwICR7dGhpcy5wdXNoZXIuc3BhY2VOYW1lfToke3RoaXMubmFtZXIuZ2V0TmV4dEFwcE5hbWUoKX0gYFxuICAgICAgICAgICAgKyBgdG8gJHt0aGlzLm5hbWVyLmdldEN1cnJlbnRBcHBOYW1lKCl9LmApO1xuICAgICAgICBhd2FpdCB0aGlzLmNmQXBpLnJlbmFtZUFwcChuZXh0QXBwLm1ldGFkYXRhLmd1aWQsIHRoaXMubmFtZXIuZ2V0Q3VycmVudEFwcE5hbWUoKSk7XG4gICAgICAgIHJldHVybiBuZXh0QXBwO1xuICAgIH1cblxufVxuIl19