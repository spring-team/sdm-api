"use strict";/*
 * Copyright Â© 2018 Atomist, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cov_u7hw7su0e=function(){var path="/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/common/delivery/build/local/LocalBuilder.ts",hash="adb009473cde5acb9542b5036a3bbcbd7eeaa982",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/common/delivery/build/local/LocalBuilder.ts",statementMap:{"0":{start:{line:17,column:16},end:{line:24,column:1}},"1":{start:{line:18,column:4},end:{line:23,column:7}},"2":{start:{line:19,column:36},end:{line:19,column:97}},"3":{start:{line:19,column:42},end:{line:19,column:70}},"4":{start:{line:19,column:85},end:{line:19,column:95}},"5":{start:{line:20,column:35},end:{line:20,column:100}},"6":{start:{line:20,column:41},end:{line:20,column:73}},"7":{start:{line:20,column:88},end:{line:20,column:98}},"8":{start:{line:21,column:32},end:{line:21,column:149}},"9":{start:{line:21,column:97},end:{line:21,column:119}},"10":{start:{line:22,column:8},end:{line:22,column:78}},"11":{start:{line:25,column:0},end:{line:25,column:62}},"12":{start:{line:26,column:28},end:{line:26,column:65}},"13":{start:{line:27,column:22},end:{line:27,column:81}},"14":{start:{line:28,column:24},end:{line:28,column:87}},"15":{start:{line:29,column:16},end:{line:29,column:64}},"16":{start:{line:30,column:16},end:{line:30,column:32}},"17":{start:{line:31,column:21},end:{line:31,column:42}},"18":{start:{line:32,column:20},end:{line:32,column:65}},"19":{start:{line:33,column:21},end:{line:33,column:45}},"20":{start:{line:34,column:27},end:{line:34,column:56}},"21":{start:{line:41,column:8},end:{line:41,column:25}},"22":{start:{line:42,column:8},end:{line:42,column:43}},"23":{start:{line:43,column:8},end:{line:43,column:43}},"24":{start:{line:46,column:8},end:{line:70,column:11}},"25":{start:{line:47,column:23},end:{line:47,column:41}},"26":{start:{line:48,column:32},end:{line:48,column:46}},"27":{start:{line:49,column:32},end:{line:49,column:79}},"28":{start:{line:50,column:12},end:{line:69,column:13}},"29":{start:{line:51,column:27},end:{line:51,column:100}},"30":{start:{line:52,column:16},end:{line:52,column:86}},"31":{start:{line:53,column:16},end:{line:61,column:17}},"32":{start:{line:54,column:31},end:{line:54,column:51}},"33":{start:{line:55,column:20},end:{line:55,column:102}},"34":{start:{line:56,column:20},end:{line:56,column:101}},"35":{start:{line:59,column:20},end:{line:59,column:98}},"36":{start:{line:60,column:20},end:{line:60,column:55}},"37":{start:{line:65,column:16},end:{line:65,column:125}},"38":{start:{line:66,column:16},end:{line:66,column:125}},"39":{start:{line:67,column:16},end:{line:67,column:133}},"40":{start:{line:68,column:16},end:{line:68,column:51}},"41":{start:{line:73,column:8},end:{line:73,column:85}},"42":{start:{line:76,column:8},end:{line:95,column:11}},"43":{start:{line:77,column:12},end:{line:94,column:13}},"44":{start:{line:78,column:16},end:{line:90,column:17}},"45":{start:{line:79,column:20},end:{line:79,column:95}},"46":{start:{line:80,column:20},end:{line:80,column:87}},"47":{start:{line:81,column:20},end:{line:86,column:21}},"48":{start:{line:82,column:24},end:{line:82,column:101}},"49":{start:{line:85,column:24},end:{line:85,column:118}},"50":{start:{line:89,column:20},end:{line:89,column:95}},"51":{start:{line:93,column:16},end:{line:93,column:88}},"52":{start:{line:98,column:8},end:{line:98,column:158}},"53":{start:{line:99,column:20},end:{line:99,column:90}},"54":{start:{line:100,column:21},end:{line:113,column:9}},"55":{start:{line:114,column:8},end:{line:115,column:38}},"56":{start:{line:114,column:41},end:{line:114,column:72}},"57":{start:{line:115,column:24},end:{line:115,column:36}},"58":{start:{line:118,column:8},end:{line:145,column:11}},"59":{start:{line:119,column:27},end:{line:127,column:14}},"60":{start:{line:129,column:12},end:{line:141,column:13}},"61":{start:{line:130,column:16},end:{line:130,column:63}},"62":{start:{line:133,column:16},end:{line:140,column:18}},"63":{start:{line:142,column:42},end:{line:142,column:138}},"64":{start:{line:143,column:12},end:{line:143,column:116}},"65":{start:{line:144,column:12},end:{line:144,column:52}},"66":{start:{line:148,column:8},end:{line:153,column:11}},"67":{start:{line:149,column:28},end:{line:149,column:137}},"68":{start:{line:150,column:12},end:{line:152,column:13}},"69":{start:{line:151,column:16},end:{line:151,column:132}},"70":{start:{line:156,column:0},end:{line:156,column:36}},"71":{start:{line:158,column:4},end:{line:159,column:127}},"72":{start:{line:159,column:26},end:{line:159,column:125}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:17,column:44},end:{line:17,column:45}},loc:{start:{line:17,column:89},end:{line:24,column:1}},line:17},"1":{name:"(anonymous_1)",decl:{start:{line:18,column:36},end:{line:18,column:37}},loc:{start:{line:18,column:63},end:{line:23,column:5}},line:18},"2":{name:"fulfilled",decl:{start:{line:19,column:17},end:{line:19,column:26}},loc:{start:{line:19,column:34},end:{line:19,column:99}},line:19},"3":{name:"rejected",decl:{start:{line:20,column:17},end:{line:20,column:25}},loc:{start:{line:20,column:33},end:{line:20,column:102}},line:20},"4":{name:"step",decl:{start:{line:21,column:17},end:{line:21,column:21}},loc:{start:{line:21,column:30},end:{line:21,column:151}},line:21},"5":{name:"(anonymous_5)",decl:{start:{line:21,column:76},end:{line:21,column:77}},loc:{start:{line:21,column:95},end:{line:21,column:121}},line:21},"6":{name:"(anonymous_6)",decl:{start:{line:40,column:4},end:{line:40,column:5}},loc:{start:{line:40,column:52},end:{line:44,column:5}},line:40},"7":{name:"(anonymous_7)",decl:{start:{line:45,column:4},end:{line:45,column:5}},loc:{start:{line:45,column:72},end:{line:71,column:5}},line:45},"8":{name:"(anonymous_8)",decl:{start:{line:46,column:47},end:{line:46,column:48}},loc:{start:{line:46,column:60},end:{line:70,column:9}},line:46},"9":{name:"(anonymous_9)",decl:{start:{line:72,column:4},end:{line:72,column:5}},loc:{start:{line:72,column:69},end:{line:74,column:5}},line:72},"10":{name:"(anonymous_10)",decl:{start:{line:75,column:4},end:{line:75,column:5}},loc:{start:{line:75,column:90},end:{line:96,column:5}},line:75},"11":{name:"(anonymous_11)",decl:{start:{line:76,column:47},end:{line:76,column:48}},loc:{start:{line:76,column:60},end:{line:95,column:9}},line:76},"12":{name:"(anonymous_12)",decl:{start:{line:97,column:4},end:{line:97,column:5}},loc:{start:{line:97,column:61},end:{line:116,column:5}},line:97},"13":{name:"(anonymous_13)",decl:{start:{line:114,column:35},end:{line:114,column:36}},loc:{start:{line:114,column:41},end:{line:114,column:72}},line:114},"14":{name:"(anonymous_14)",decl:{start:{line:115,column:18},end:{line:115,column:19}},loc:{start:{line:115,column:24},end:{line:115,column:36}},line:115},"15":{name:"(anonymous_15)",decl:{start:{line:117,column:4},end:{line:117,column:5}},loc:{start:{line:117,column:37},end:{line:146,column:5}},line:117},"16":{name:"(anonymous_16)",decl:{start:{line:118,column:47},end:{line:118,column:48}},loc:{start:{line:118,column:60},end:{line:145,column:9}},line:118},"17":{name:"(anonymous_17)",decl:{start:{line:147,column:4},end:{line:147,column:5}},loc:{start:{line:147,column:60},end:{line:154,column:5}},line:147},"18":{name:"(anonymous_18)",decl:{start:{line:148,column:47},end:{line:148,column:48}},loc:{start:{line:148,column:60},end:{line:153,column:9}},line:148},"19":{name:"linkArtifact",decl:{start:{line:157,column:9},end:{line:157,column:21}},loc:{start:{line:157,column:54},end:{line:160,column:1}},line:157},"20":{name:"(anonymous_20)",decl:{start:{line:159,column:14},end:{line:159,column:15}},loc:{start:{line:159,column:26},end:{line:159,column:125}},line:159}},branchMap:{"0":{loc:{start:{line:17,column:16},end:{line:24,column:1}},type:"binary-expr",locations:[{start:{line:17,column:17},end:{line:17,column:21}},{start:{line:17,column:25},end:{line:17,column:39}},{start:{line:17,column:44},end:{line:24,column:1}}],line:17},"1":{loc:{start:{line:18,column:16},end:{line:18,column:34}},type:"binary-expr",locations:[{start:{line:18,column:16},end:{line:18,column:17}},{start:{line:18,column:22},end:{line:18,column:33}}],line:18},"2":{loc:{start:{line:21,column:32},end:{line:21,column:148}},type:"cond-expr",locations:[{start:{line:21,column:46},end:{line:21,column:67}},{start:{line:21,column:70},end:{line:21,column:148}}],line:21},"3":{loc:{start:{line:22,column:51},end:{line:22,column:67}},type:"binary-expr",locations:[{start:{line:22,column:51},end:{line:22,column:61}},{start:{line:22,column:65},end:{line:22,column:67}}],line:22},"4":{loc:{start:{line:56,column:27},end:{line:56,column:100}},type:"cond-expr",locations:[{start:{line:56,column:38},end:{line:56,column:70}},{start:{line:56,column:73},end:{line:56,column:100}}],line:56},"5":{loc:{start:{line:78,column:16},end:{line:90,column:17}},type:"if",locations:[{start:{line:78,column:16},end:{line:90,column:17}},{start:{line:78,column:16},end:{line:90,column:17}}],line:78},"6":{loc:{start:{line:81,column:20},end:{line:86,column:21}},type:"if",locations:[{start:{line:81,column:20},end:{line:86,column:21}},{start:{line:81,column:20},end:{line:86,column:21}}],line:81},"7":{loc:{start:{line:129,column:12},end:{line:141,column:13}},type:"if",locations:[{start:{line:129,column:12},end:{line:141,column:13}},{start:{line:129,column:12},end:{line:141,column:13}}],line:129},"8":{loc:{start:{line:129,column:16},end:{line:129,column:83}},type:"binary-expr",locations:[{start:{line:129,column:16},end:{line:129,column:41}},{start:{line:129,column:45},end:{line:129,column:83}}],line:129},"9":{loc:{start:{line:150,column:12},end:{line:152,column:13}},type:"if",locations:[{start:{line:150,column:12},end:{line:152,column:13}},{start:{line:150,column:12},end:{line:152,column:13}}],line:150}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},b:{"0":[0,0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var __awaiter=(cov_u7hw7su0e.s[0]++,(cov_u7hw7su0e.b[0][0]++,this)&&(cov_u7hw7su0e.b[0][1]++,this.__awaiter)||(cov_u7hw7su0e.b[0][2]++,function(thisArg,_arguments,P,generator){cov_u7hw7su0e.f[0]++;cov_u7hw7su0e.s[1]++;return new((cov_u7hw7su0e.b[1][0]++,P)||(cov_u7hw7su0e.b[1][1]++,P=Promise))(function(resolve,reject){cov_u7hw7su0e.f[1]++;function fulfilled(value){cov_u7hw7su0e.f[2]++;cov_u7hw7su0e.s[2]++;try{cov_u7hw7su0e.s[3]++;step(generator.next(value));}catch(e){cov_u7hw7su0e.s[4]++;reject(e);}}function rejected(value){cov_u7hw7su0e.f[3]++;cov_u7hw7su0e.s[5]++;try{cov_u7hw7su0e.s[6]++;step(generator["throw"](value));}catch(e){cov_u7hw7su0e.s[7]++;reject(e);}}function step(result){cov_u7hw7su0e.f[4]++;cov_u7hw7su0e.s[8]++;result.done?(cov_u7hw7su0e.b[2][0]++,resolve(result.value)):(cov_u7hw7su0e.b[2][1]++,new P(function(resolve){cov_u7hw7su0e.f[5]++;cov_u7hw7su0e.s[9]++;resolve(result.value);}).then(fulfilled,rejected));}cov_u7hw7su0e.s[10]++;step((generator=generator.apply(thisArg,(cov_u7hw7su0e.b[3][0]++,_arguments)||(cov_u7hw7su0e.b[3][1]++,[]))).next());});}));cov_u7hw7su0e.s[11]++;Object.defineProperty(exports,"__esModule",{value:true});const automation_client_1=(cov_u7hw7su0e.s[12]++,require("@atomist/automation-client"));const GraphClient_1=(cov_u7hw7su0e.s[13]++,require("@atomist/automation-client/spi/graph/GraphClient"));const MessageClient_1=(cov_u7hw7su0e.s[14]++,require("@atomist/automation-client/spi/message/MessageClient"));const retry_1=(cov_u7hw7su0e.s[15]++,require("@atomist/automation-client/util/retry"));const axios_1=(cov_u7hw7su0e.s[16]++,require("axios"));const sprintf_js_1=(cov_u7hw7su0e.s[17]++,require("sprintf-js"));const ImageLink_1=(cov_u7hw7su0e.s[18]++,require("../../../../util/webhook/ImageLink"));const executeTag_1=(cov_u7hw7su0e.s[19]++,require("../executeTag"));const projectVersioner_1=(cov_u7hw7su0e.s[20]++,require("./projectVersioner"));/**
 * Superclass for build implemented on the automation client itself, emitting appropriate events to Atomist.
 * Allows listening to a Running build
 */class LocalBuilder{constructor(name,artifactStore,projectLoader){cov_u7hw7su0e.f[6]++;cov_u7hw7su0e.s[21]++;this.name=name;cov_u7hw7su0e.s[22]++;this.artifactStore=artifactStore;cov_u7hw7su0e.s[23]++;this.projectLoader=projectLoader;}initiateBuild(credentials,id,addressChannels,push,log,context){cov_u7hw7su0e.f[7]++;cov_u7hw7su0e.s[24]++;return __awaiter(this,void 0,void 0,function*(){cov_u7hw7su0e.f[8]++;const as=(cov_u7hw7su0e.s[25]++,this.artifactStore);const atomistTeam=(cov_u7hw7su0e.s[26]++,context.teamId);const buildNumber=(cov_u7hw7su0e.s[27]++,yield this.obtainBuildIdentifier(push,context));cov_u7hw7su0e.s[28]++;try{const rb=(cov_u7hw7su0e.s[29]++,yield this.startBuild(credentials,id,atomistTeam,log,addressChannels));cov_u7hw7su0e.s[30]++;yield this.onStarted(credentials,id,push,rb,buildNumber,context);cov_u7hw7su0e.s[31]++;try{const br=(cov_u7hw7su0e.s[32]++,yield rb.buildResult);cov_u7hw7su0e.s[33]++;yield this.onExit(credentials,id,!br.error,push,rb,buildNumber,as,context);cov_u7hw7su0e.s[34]++;return br.error?(cov_u7hw7su0e.b[4][0]++,{code:1,message:br.message}):(cov_u7hw7su0e.b[4][1]++,automation_client_1.Success);}catch(err){cov_u7hw7su0e.s[35]++;yield this.onExit(credentials,id,false,push,rb,buildNumber,as,context);cov_u7hw7su0e.s[36]++;return automation_client_1.Failure;}}catch(err){cov_u7hw7su0e.s[37]++;// If we get here, the build failed before even starting
automation_client_1.logger.warn("Build on branch %s failed on start: %j - %s",push.branch,id,err.message);cov_u7hw7su0e.s[38]++;log.write(sprintf_js_1.sprintf("Build on branch %s failed on start: %j - %s",push.branch,id,err.message));cov_u7hw7su0e.s[39]++;yield this.updateBuildStatus({repoRef:id,team:atomistTeam,url:undefined},"failed",push.branch,buildNumber);cov_u7hw7su0e.s[40]++;return automation_client_1.Failure;}});}onStarted(credentials,id,push,runningBuild,buildNo,context){cov_u7hw7su0e.f[9]++;cov_u7hw7su0e.s[41]++;return this.updateBuildStatus(runningBuild,"started",push.branch,buildNo);}onExit(credentials,id,success,push,runningBuild,buildNo,artifactStore,context){cov_u7hw7su0e.f[10]++;cov_u7hw7su0e.s[42]++;return __awaiter(this,void 0,void 0,function*(){cov_u7hw7su0e.f[11]++;cov_u7hw7su0e.s[43]++;try{cov_u7hw7su0e.s[44]++;if(success){cov_u7hw7su0e.b[5][0]++;cov_u7hw7su0e.s[45]++;yield this.updateBuildStatus(runningBuild,"passed",push.branch,buildNo);cov_u7hw7su0e.s[46]++;yield this.createBuildTag(id,push,buildNo,context,credentials);cov_u7hw7su0e.s[47]++;if(!!runningBuild.deploymentUnitFile){cov_u7hw7su0e.b[6][0]++;cov_u7hw7su0e.s[48]++;yield linkArtifact(credentials,runningBuild,context.teamId,artifactStore);}else{cov_u7hw7su0e.b[6][1]++;cov_u7hw7su0e.s[49]++;automation_client_1.logger.warn("No artifact generated by build of %j",runningBuild.appInfo);}}else{cov_u7hw7su0e.b[5][1]++;cov_u7hw7su0e.s[50]++;yield this.updateBuildStatus(runningBuild,"failed",push.branch,buildNo);}}catch(err){cov_u7hw7su0e.s[51]++;automation_client_1.logger.warn("Unexpected build exit error: %s",err);}});}updateBuildStatus(runningBuild,status,branch,buildNo){cov_u7hw7su0e.f[12]++;cov_u7hw7su0e.s[52]++;automation_client_1.logger.info("Telling Atomist about a %s build on %s, sha %s, url %s",status,branch,runningBuild.repoRef.sha,runningBuild.url);const url=(cov_u7hw7su0e.s[53]++,`https://webhook.atomist.com/atomist/build/teams/${runningBuild.team}`);const data=(cov_u7hw7su0e.s[54]++,{repository:{owner_name:runningBuild.repoRef.owner,name:runningBuild.repoRef.repo},name:`Build #${buildNo}`,number:+buildNo,type:"push",build_url:runningBuild.url,status,commit:runningBuild.repoRef.sha,branch,provider:"sdm"});cov_u7hw7su0e.s[55]++;return retry_1.doWithRetry(()=>{cov_u7hw7su0e.f[13]++;cov_u7hw7su0e.s[56]++;return axios_1.default.post(url,data);},`Update build to ${JSON.stringify(status)}`).then(()=>{cov_u7hw7su0e.f[14]++;cov_u7hw7su0e.s[57]++;return runningBuild;});}obtainBuildIdentifier(push,ctx){cov_u7hw7su0e.f[15]++;cov_u7hw7su0e.s[58]++;return __awaiter(this,void 0,void 0,function*(){cov_u7hw7su0e.f[16]++;const result=(cov_u7hw7su0e.s[59]++,yield ctx.graphClient.query({name:"SdmBuildIdentifierForRepo",variables:{owner:[push.owner],name:[push.name],providerId:[push.providerId]},options:GraphClient_1.QueryNoCacheOptions}));let buildIdentifier;cov_u7hw7su0e.s[60]++;if((cov_u7hw7su0e.b[8][0]++,result.SdmBuildIdentifier)&&(cov_u7hw7su0e.b[8][1]++,result.SdmBuildIdentifier.length===1)){cov_u7hw7su0e.b[7][0]++;cov_u7hw7su0e.s[61]++;buildIdentifier=result.SdmBuildIdentifier[0];}else{cov_u7hw7su0e.b[7][1]++;cov_u7hw7su0e.s[62]++;buildIdentifier={identifier:"0",repo:{owner:push.owner,name:push.name,providerId:push.providerId}};}const bumpedBuildIdentifier=(cov_u7hw7su0e.s[63]++,Object.assign({},buildIdentifier,{identifier:(+buildIdentifier.identifier+1).toString()}));cov_u7hw7su0e.s[64]++;yield ctx.messageClient.send(bumpedBuildIdentifier,MessageClient_1.addressEvent("SdmBuildIdentifier"));cov_u7hw7su0e.s[65]++;return bumpedBuildIdentifier.identifier;});}createBuildTag(id,push,buildNo,context,credentials){cov_u7hw7su0e.f[17]++;cov_u7hw7su0e.s[66]++;return __awaiter(this,void 0,void 0,function*(){cov_u7hw7su0e.f[18]++;const version=(cov_u7hw7su0e.s[67]++,yield projectVersioner_1.readSdmVersion(push.owner,push.name,push.providerId,push.sha,id.branch,context));cov_u7hw7su0e.s[68]++;if(version){cov_u7hw7su0e.b[9][0]++;cov_u7hw7su0e.s[69]++;yield executeTag_1.createTagForStatus(id,push.sha,"Tag created by SDM",`${version}+sdm.${buildNo}`,credentials);}else{cov_u7hw7su0e.b[9][1]++;}});}}cov_u7hw7su0e.s[70]++;exports.LocalBuilder=LocalBuilder;function linkArtifact(creds,rb,team,artifactStore){cov_u7hw7su0e.f[19]++;cov_u7hw7su0e.s[71]++;return artifactStore.storeFile(rb.appInfo,rb.deploymentUnitFile,creds).then(imageUrl=>{cov_u7hw7su0e.f[20]++;cov_u7hw7su0e.s[72]++;return ImageLink_1.postLinkImageWebhook(rb.repoRef.owner,rb.repoRef.repo,rb.repoRef.sha,imageUrl,team);});}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL3JvZGpvaG5zb24vc2ZvcnphbmRvLWRldi9pZGVhLXByb2plY3RzL215LWZsb3cvc3JjL2NvbW1vbi9kZWxpdmVyeS9idWlsZC9sb2NhbC9Mb2NhbEJ1aWxkZXIudHMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2Rqb2huc29uL3Nmb3J6YW5kby1kZXYvaWRlYS1wcm9qZWN0cy9teS1mbG93L3NyYy9jb21tb24vZGVsaXZlcnkvYnVpbGQvbG9jYWwvTG9jYWxCdWlsZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7Ozs7R0FjRzs7Ozs7Ozs7OztBQUVILGtFQUFxRztBQUdyRyxrRkFBdUY7QUFDdkYsd0ZBQW9GO0FBQ3BGLGlFQUFvRTtBQUNwRSxpQ0FBMEI7QUFDMUIsMkNBQXFDO0FBUXJDLGtFQUEwRTtBQUcxRSw4Q0FBbUQ7QUFDbkQseURBQW9EO0FBbUJwRDs7O0dBR0c7QUFDSDtJQUVJLFlBQTZCLElBQVksRUFDRixhQUE0QixFQUNuQyxhQUE0QjtRQUYvQixTQUFJLEdBQUosSUFBSSxDQUFRO1FBQ0Ysa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDbkMsa0JBQWEsR0FBYixhQUFhLENBQWU7SUFDNUQsQ0FBQztJQUVZLGFBQWEsQ0FBQyxXQUF3QyxFQUN4QyxFQUFpQixFQUNqQixlQUFnQyxFQUNoQyxJQUEyQixFQUMzQixHQUFnQixFQUNoQixPQUF1Qjs7WUFDOUMsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQztZQUM5QixNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDO1lBQ25DLE1BQU0sV0FBVyxHQUFHLE1BQU0sSUFBSSxDQUFDLHFCQUFxQixDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztZQUVwRSxJQUFJO2dCQUNBLE1BQU0sRUFBRSxHQUFHLE1BQU0sSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLEVBQUUsRUFBRSxFQUFFLFdBQVcsRUFBRSxHQUFHLEVBQUUsZUFBZSxD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LEVBQ3ZCLFdBQXdDOztZQUNuRSxNQUFNLE9BQU8sR0FBRyxNQUFNLGlDQUFjLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQzNHLElBQUksT0FBTyxFQUFFO2dCQUNULE1BQU0sK0JBQWtCLENBQ3BCLEVBQUUsRUFDRixJQUFJLENBQUMsR0FBRyxFQUNSLG9CQUFvQixFQUNwQixHQUFHLE9BQU8sUUFBUSxPQUFPLEVBQUUsRUFDM0IsV0FBVyxDQUFDLENBQUM7YUFDcEI7UUFDTCxDQUFDO0tBQUE7Q0FFSjtBQXBMRCxvQ0FvTEM7QUFFRCxzQkFBc0IsS0FBa0MsRUFBRSxFQUF3QixFQUFFLElBQVksRUFBRSxhQUE0QjtJQUMxSCxPQUFPLGFBQWEsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsa0JBQWtCLEVBQUUsS0FBSyxDQUFDO1NBQ25FLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLGdDQUFvQixDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO0FBQ25ILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IMKpIDIwMTggQXRvbWlzdCwgSW5jLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBGYWlsdXJlLCBIYW5kbGVyQ29udGV4dCwgSGFuZGxlclJlc3VsdCwgbG9nZ2VyLCBTdWNjZXNzIH0gZnJvbSBcIkBhdG9taXN0L2F1dG9tYXRpb24tY2xpZW50XCI7XG5pbXBvcnQgeyBQcm9qZWN0T3BlcmF0aW9uQ3JlZGVudGlhbHMgfSBmcm9tIFwiQGF0b21pc3QvYXV0b21hdGlvbi1jbGllbnQvb3BlcmF0aW9ucy9jb21tb24vUHJvamVjdE9wZXJhdGlvbkNyZWRlbnRpYWxzXCI7XG5pbXBvcnQgeyBSZW1vdGVSZXBvUmVmIH0gZnJvbSBcIkBhdG9taXN0L2F1dG9tYXRpb24tY2xpZW50L29wZXJhdGlvbnMvY29tbW9uL1JlcG9JZFwiO1xuaW1wb3J0IHsgUXVlcnlOb0NhY2hlT3B0aW9ucyB9IGZyb20gXCJAYXRvbWlzdC9hdXRvbWF0aW9uLWNsaWVudC9zcGkvZ3JhcGgvR3JhcGhDbGllbnRcIjtcbmltcG9ydCB7IGFkZHJlc3NFdmVudCB9IGZyb20gXCJAYXRvbWlzdC9hdXRvbWF0aW9uLWNsaWVudC9zcGkvbWVzc2FnZS9NZXNzYWdlQ2xpZW50XCI7XG5pbXBvcnQgeyBkb1dpdGhSZXRyeSB9IGZyb20gXCJAYXRvbWlzdC9hdXRvbWF0aW9uLWNsaWVudC91dGlsL3JldHJ5XCI7XG5pbXBvcnQgYXhpb3MgZnJvbSBcImF4aW9zXCI7XG5pbXBvcnQgeyBzcHJpbnRmIH0gZnJvbSBcInNwcmludGYtanNcIjtcbmltcG9ydCB7IEFydGlmYWN0U3RvcmUgfSBmcm9tIFwiLi4vLi4vLi4vLi4vc3BpL2FydGlmYWN0L0FydGlmYWN0U3RvcmVcIjtcbmltcG9ydCB7IEJ1aWxkZXIsIFB1c2hUaGF0VHJpZ2dlcnNCdWlsZCB9IGZyb20gXCIuLi8uLi8uLi8uLi9zcGkvYnVpbGQvQnVpbGRlclwiO1xuaW1wb3J0IHsgQXBwSW5mbyB9IGZyb20gXCIuLi8uLi8uLi8uLi9zcGkvZGVwbG95L0RlcGxveW1lbnRcIjtcbmltcG9ydCB7IEludGVycHJldExvZyB9IGZyb20gXCIuLi8uLi8uLi8uLi9zcGkvbG9nL0ludGVycHJldGVkTG9nXCI7XG5pbXBvcnQgeyBQcm9ncmVzc0xvZyB9IGZyb20gXCIuLi8uLi8uLi8uLi9zcGkvbG9nL1Byb2dyZXNzTG9nXCI7XG5pbXBvcnQgeyBTZG1CdWlsZElkZW50aWZpZXJGb3JSZXBvIH0gZnJvbSBcIi4uLy4uLy4uLy4uL3R5cGluZ3MvdHlwZXNcIjtcbmltcG9ydCB7IENoaWxkUHJvY2Vzc1Jlc3VsdCB9IGZyb20gXCIuLi8uLi8uLi8uLi91dGlsL21pc2Mvc3Bhd25lZFwiO1xuaW1wb3J0IHsgcG9zdExpbmtJbWFnZVdlYmhvb2sgfSBmcm9tIFwiLi4vLi4vLi4vLi4vdXRpbC93ZWJob29rL0ltYWdlTGlua1wiO1xuaW1wb3J0IHsgUHJvamVjdExvYWRlciB9IGZyb20gXCIuLi8uLi8uLi9yZXBvL1Byb2plY3RMb2FkZXJcIjtcbmltcG9ydCB7IEFkZHJlc3NDaGFubmVscyB9IGZyb20gXCIuLi8uLi8uLi9zbGFjay9hZGRyZXNzQ2hhbm5lbHNcIjtcbmltcG9ydCB7IGNyZWF0ZVRhZ0ZvclN0YXR1cyB9IGZyb20gXCIuLi9leGVjdXRlVGFnXCI7XG5pbXBvcnQgeyByZWFkU2RtVmVyc2lvbiB9IGZyb20gXCIuL3Byb2plY3RWZXJzaW9uZXJcIjtcbmltcG9ydCBTZG1CdWlsZElkZW50aWZpZXIgPSBTZG1CdWlsZElkZW50aWZpZXJGb3JSZXBvLlNkbUJ1aWxkSWRlbnRpZmllcjtcblxuZXhwb3J0IGludGVyZmFjZSBMb2NhbEJ1aWxkSW5Qcm9ncmVzcyB7XG5cbiAgICByZWFkb25seSBidWlsZFJlc3VsdDogUHJvbWlzZTxDaGlsZFByb2Nlc3NSZXN1bHQ+O1xuXG4gICAgcmVhZG9ubHkgcmVwb1JlZjogUmVtb3RlUmVwb1JlZjtcblxuICAgIHJlYWRvbmx5IHRlYW06IHN0cmluZztcblxuICAgIC8qKiBBdmFpbGFibGUgb25jZSBidWlsZCBpcyBjb21wbGV0ZSAqL1xuICAgIHJlYWRvbmx5IGFwcEluZm86IEFwcEluZm87XG5cbiAgICByZWFkb25seSBkZXBsb3ltZW50VW5pdEZpbGU6IHN0cmluZztcblxuICAgIHJlYWRvbmx5IHVybDogc3RyaW5nO1xufVxuXG4vKipcbiAqIFN1cGVyY2xhc3MgZm9yIGJ1aWxkIGltcGxlbWVudGVkIG9uIHRoZSBhdXRvbWF0aW9uIGNsaWVudCBpdHNlbGYsIGVtaXR0aW5nIGFwcHJvcHJpYXRlIGV2ZW50cyB0byBBdG9taXN0LlxuICogQWxsb3dzIGxpc3RlbmluZyB0byBhIFJ1bm5pbmcgYnVpbGRcbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIExvY2FsQnVpbGRlciBpbXBsZW1lbnRzIEJ1aWxkZXIge1xuXG4gICAgcHJvdGVjdGVkIGNvbnN0cnVjdG9yKHB1YmxpYyBuYW1lOiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHByaXZhdGUgcmVhZG9ubHkgYXJ0aWZhY3RTdG9yZTogQXJ0aWZhY3RTdG9yZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvdGVjdGVkIHByb2plY3RMb2FkZXI6IFByb2plY3RMb2FkZXIpIHtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgaW5pdGlhdGVCdWlsZChjcmVkZW50aWFsczogUHJvamVjdE9wZXJhdGlvbkNyZWRlbnRpYWxzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBSZW1vdGVSZXBvUmVmLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3NDaGFubmVsczogQWRkcmVzc0NoYW5uZWxzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2g6IFB1c2hUaGF0VHJpZ2dlcnNCdWlsZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2c6IFByb2dyZXNzTG9nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6IEhhbmRsZXJDb250ZXh0KTogUHJvbWlzZTxIYW5kbGVyUmVzdWx0PiB7XG4gICAgICAgIGNvbnN0IGFzID0gdGhpcy5hcnRpZmFjdFN0b3JlO1xuICAgICAgICBjb25zdCBhdG9taXN0VGVhbSA9IGNvbnRleHQudGVhbUlkO1xuICAgICAgICBjb25zdCBidWlsZE51bWJlciA9IGF3YWl0IHRoaXMub2J0YWluQnVpbGRJZGVudGlmaWVyKHB1c2gsIGNvbnRleHQpO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByYiA9IGF3YWl0IHRoaXMuc3RhcnRCdWlsZChjcmVkZW50aWFscywgaWQsIGF0b21pc3RUZWFtLCBsb2csIGFkZHJlc3NDaGFubmVscyk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLm9uU3RhcnRlZChjcmVkZW50aWFscywgaWQsIHB1c2gsIHJiLCBidWlsZE51bWJlciwgY29udGV4dCk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGJyID0gYXdhaXQgcmIuYnVpbGRSZXN1bHQ7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5vbkV4aXQoXG4gICAgICAgICAgICAgICAgICAgIGNyZWRlbnRpYWxzLFxuICAgICAgICAgICAgICAgICAgICBpZCxcbiAgICAgICAgICAgICAgICAgICAgIWJyLmVycm9yLFxuICAgICAgICAgICAgICAgICAgICBwdXNoLFxuICAgICAgICAgICAgICAgICAgICByYixcbiAgICAgICAgICAgICAgICAgICAgYnVpbGROdW1iZXIsXG4gICAgICAgICAgICAgICAgICAgIGFzLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXh0KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYnIuZXJyb3IgPyB7Y29kZTogMSwgbWVzc2FnZTogYnIubWVzc2FnZX0gOiBTdWNjZXNzO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5vbkV4aXQoXG4gICAgICAgICAgICAgICAgICAgIGNyZWRlbnRpYWxzLFxuICAgICAgICAgICAgICAgICAgICBpZCxcbiAgICAgICAgICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHB1c2gsXG4gICAgICAgICAgICAgICAgICAgIHJiLFxuICAgICAgICAgICAgICAgICAgICBidWlsZE51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgYXMsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRleHQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBGYWlsdXJlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIC8vIElmIHdlIGdldCBoZXJlLCB0aGUgYnVpbGQgZmFpbGVkIGJlZm9yZSBldmVuIHN0YXJ0aW5nXG4gICAgICAgICAgICBsb2dnZXIud2FybihcIkJ1aWxkIG9uIGJyYW5jaCAlcyBmYWlsZWQgb24gc3RhcnQ6ICVqIC0gJXNcIiwgcHVzaC5icmFuY2gsIGlkLCBlcnIubWVzc2FnZSk7XG4gICAgICAgICAgICBsb2cud3JpdGUoc3ByaW50ZihcIkJ1aWxkIG9uIGJyYW5jaCAlcyBmYWlsZWQgb24gc3RhcnQ6ICVqIC0gJXNcIiwgcHVzaC5icmFuY2gsIGlkLCBlcnIubWVzc2FnZSkpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVCdWlsZFN0YXR1cyh7cmVwb1JlZjogaWQsIHRlYW06IGF0b21pc3RUZWFtLCB1cmw6IHVuZGVmaW5lZH0sXG4gICAgICAgICAgICAgICAgXCJmYWlsZWRcIixcbiAgICAgICAgICAgICAgICBwdXNoLmJyYW5jaCxcbiAgICAgICAgICAgICAgICBidWlsZE51bWJlcik7XG4gICAgICAgICAgICByZXR1cm4gRmFpbHVyZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEltcGxlbWVudGVkIHRvIGludGVycHJldCBidWlsZCBsb2dzXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGxvZ1xuICAgICAqIEByZXR1cm4ge0ludGVycHJldGVkTG9nfVxuICAgICAqL1xuICAgIHB1YmxpYyBhYnN0cmFjdCBsb2dJbnRlcnByZXRlcjogSW50ZXJwcmV0TG9nO1xuXG4gICAgcHJvdGVjdGVkIGFic3RyYWN0IHN0YXJ0QnVpbGQoY3JlZGVudGlhbHM6IFByb2plY3RPcGVyYXRpb25DcmVkZW50aWFscyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogUmVtb3RlUmVwb1JlZixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdG9taXN0VGVhbTogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZzogUHJvZ3Jlc3NMb2csXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkcmVzc0NoYW5uZWxzOiBBZGRyZXNzQ2hhbm5lbHMpOiBQcm9taXNlPExvY2FsQnVpbGRJblByb2dyZXNzPjtcblxuICAgIHByb3RlY3RlZCBvblN0YXJ0ZWQoY3JlZGVudGlhbHM6IFByb2plY3RPcGVyYXRpb25DcmVkZW50aWFscyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBSZW1vdGVSZXBvUmVmLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHVzaDogUHVzaFRoYXRUcmlnZ2Vyc0J1aWxkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcnVubmluZ0J1aWxkOiBMb2NhbEJ1aWxkSW5Qcm9ncmVzcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1aWxkTm86IHN0cmluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6IEhhbmRsZXJDb250ZXh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnVwZGF0ZUJ1aWxkU3RhdHVzKHJ1bm5pbmdCdWlsZCwgXCJzdGFydGVkXCIsIHB1c2guYnJhbmNoLCBidWlsZE5vKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgYXN5bmMgb25FeGl0KGNyZWRlbnRpYWxzOiBQcm9qZWN0T3BlcmF0aW9uQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogUmVtb3RlUmVwb1JlZixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGJvb2xlYW4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoOiBQdXNoVGhhdFRyaWdnZXJzQnVpbGQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBydW5uaW5nQnVpbGQ6IExvY2FsQnVpbGRJblByb2dyZXNzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVpbGRObzogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJ0aWZhY3RTdG9yZTogQXJ0aWZhY3RTdG9yZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6IEhhbmRsZXJDb250ZXh0KTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVCdWlsZFN0YXR1cyhydW5uaW5nQnVpbGQsIFwicGFzc2VkXCIsIHB1c2guYnJhbmNoLCBidWlsZE5vKTtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNyZWF0ZUJ1aWxkVGFnKGlkLCBwdXNoLCBidWlsZE5vLCBjb250ZXh0LCBjcmVkZW50aWFscyk7XG4gICAgICAgICAgICAgICAgaWYgKCEhcnVubmluZ0J1aWxkLmRlcGxveW1lbnRVbml0RmlsZSkge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBsaW5rQXJ0aWZhY3QoY3JlZGVudGlhbHMsIHJ1bm5pbmdCdWlsZCwgY29udGV4dC50ZWFtSWQsIGFydGlmYWN0U3RvcmUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuKFwiTm8gYXJ0aWZhY3QgZ2VuZXJhdGVkIGJ5IGJ1aWxkIG9mICVqXCIsIHJ1bm5pbmdCdWlsZC5hcHBJbmZvKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlQnVpbGRTdGF0dXMocnVubmluZ0J1aWxkLCBcImZhaWxlZFwiLCBwdXNoLmJyYW5jaCwgYnVpbGRObyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgbG9nZ2VyLndhcm4oXCJVbmV4cGVjdGVkIGJ1aWxkIGV4aXQgZXJyb3I6ICVzXCIsIGVycik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgdXBkYXRlQnVpbGRTdGF0dXMocnVubmluZ0J1aWxkOiB7IHJlcG9SZWY6IFJlbW90ZVJlcG9SZWYsIHVybDogc3RyaW5nLCB0ZWFtOiBzdHJpbmcgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBcInN0YXJ0ZWRcIiB8IFwiZmFpbGVkXCIgfCBcImVycm9yXCIgfCBcInBhc3NlZFwiIHwgXCJjYW5jZWxlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmFuY2g6IHN0cmluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVpbGRObzogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgbG9nZ2VyLmluZm8oXCJUZWxsaW5nIEF0b21pc3QgYWJvdXQgYSAlcyBidWlsZCBvbiAlcywgc2hhICVzLCB1cmwgJXNcIixcbiAgICAgICAgICAgIHN0YXR1cywgYnJhbmNoLCBydW5uaW5nQnVpbGQucmVwb1JlZi5zaGEsIHJ1bm5pbmdCdWlsZC51cmwpO1xuICAgICAgICBjb25zdCB1cmwgPSBgaHR0cHM6Ly93ZWJob29rLmF0b21pc3QuY29tL2F0b21pc3QvYnVpbGQvdGVhbXMvJHtydW5uaW5nQnVpbGQudGVhbX1gO1xuICAgICAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICAgICAgcmVwb3NpdG9yeToge1xuICAgICAgICAgICAgICAgIG93bmVyX25hbWU6IHJ1bm5pbmdCdWlsZC5yZXBvUmVmLm93bmVyLFxuICAgICAgICAgICAgICAgIG5hbWU6IHJ1bm5pbmdCdWlsZC5yZXBvUmVmLnJlcG8sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbmFtZTogYEJ1aWxkICMke2J1aWxkTm99YCxcbiAgICAgICAgICAgIG51bWJlcjogK2J1aWxkTm8sXG4gICAgICAgICAgICB0eXBlOiBcInB1c2hcIixcbiAgICAgICAgICAgIGJ1aWxkX3VybDogcnVubmluZ0J1aWxkLnVybCxcbiAgICAgICAgICAgIHN0YXR1cyxcbiAgICAgICAgICAgIGNvbW1pdDogcnVubmluZ0J1aWxkLnJlcG9SZWYuc2hhLFxuICAgICAgICAgICAgYnJhbmNoLFxuICAgICAgICAgICAgcHJvdmlkZXI6IFwic2RtXCIsXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBkb1dpdGhSZXRyeShcbiAgICAgICAgICAgICgpID0+IGF4aW9zLnBvc3QodXJsLCBkYXRhKSxcbiAgICAgICAgICAgIGBVcGRhdGUgYnVpbGQgdG8gJHtKU09OLnN0cmluZ2lmeShzdGF0dXMpfWApXG4gICAgICAgICAgICAudGhlbigoKSA9PiBydW5uaW5nQnVpbGQpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBhc3luYyBvYnRhaW5CdWlsZElkZW50aWZpZXIocHVzaDogUHVzaFRoYXRUcmlnZ2Vyc0J1aWxkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4OiBIYW5kbGVyQ29udGV4dCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGN0eC5ncmFwaENsaWVudC5xdWVyeTxTZG1CdWlsZElkZW50aWZpZXJGb3JSZXBvLlF1ZXJ5LCBTZG1CdWlsZElkZW50aWZpZXJGb3JSZXBvLlZhcmlhYmxlcz4oe1xuICAgICAgICAgICAgbmFtZTogXCJTZG1CdWlsZElkZW50aWZpZXJGb3JSZXBvXCIsXG4gICAgICAgICAgICB2YXJpYWJsZXM6IHtcbiAgICAgICAgICAgICAgICBvd25lcjogW3B1c2gub3duZXJdLFxuICAgICAgICAgICAgICAgIG5hbWU6IFtwdXNoLm5hbWVdLFxuICAgICAgICAgICAgICAgIHByb3ZpZGVySWQ6IFtwdXNoLnByb3ZpZGVySWRdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9wdGlvbnM6IFF1ZXJ5Tm9DYWNoZU9wdGlvbnMsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCBidWlsZElkZW50aWZpZXI6IFNkbUJ1aWxkSWRlbnRpZmllcjtcbiAgICAgICAgaWYgKHJlc3VsdC5TZG1CdWlsZElkZW50aWZpZXIgJiYgcmVzdWx0LlNkbUJ1aWxkSWRlbnRpZmllci5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIGJ1aWxkSWRlbnRpZmllciA9IHJlc3VsdC5TZG1CdWlsZElkZW50aWZpZXJbMF07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBidWlsZElkZW50aWZpZXIgPSB7XG4gICAgICAgICAgICAgICAgaWRlbnRpZmllcjogXCIwXCIsXG4gICAgICAgICAgICAgICAgcmVwbzoge1xuICAgICAgICAgICAgICAgICAgICBvd25lcjogcHVzaC5vd25lcixcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogcHVzaC5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBwcm92aWRlcklkOiBwdXNoLnByb3ZpZGVySWQsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBidW1wZWRCdWlsZElkZW50aWZpZXIgPSB7XG4gICAgICAgICAgICAuLi5idWlsZElkZW50aWZpZXIsXG4gICAgICAgICAgICBpZGVudGlmaWVyOiAoK2J1aWxkSWRlbnRpZmllci5pZGVudGlmaWVyICsgMSkudG9TdHJpbmcoKSxcbiAgICAgICAgfTtcbiAgICAgICAgYXdhaXQgY3R4Lm1lc3NhZ2VDbGllbnQuc2VuZChidW1wZWRCdWlsZElkZW50aWZpZXIsIGFkZHJlc3NFdmVudChcIlNkbUJ1aWxkSWRlbnRpZmllclwiKSk7XG4gICAgICAgIHJldHVybiBidW1wZWRCdWlsZElkZW50aWZpZXIuaWRlbnRpZmllcjtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgYXN5bmMgY3JlYXRlQnVpbGRUYWcoaWQ6IFJlbW90ZVJlcG9SZWYsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2g6IFB1c2hUaGF0VHJpZ2dlcnNCdWlsZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVpbGRObzogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0OiBIYW5kbGVyQ29udGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGVudGlhbHM6IFByb2plY3RPcGVyYXRpb25DcmVkZW50aWFscykge1xuICAgICAgICBjb25zdCB2ZXJzaW9uID0gYXdhaXQgcmVhZFNkbVZlcnNpb24ocHVzaC5vd25lciwgcHVzaC5uYW1lLCBwdXNoLnByb3ZpZGVySWQsIHB1c2guc2hhLCBpZC5icmFuY2gsIGNvbnRleHQpO1xuICAgICAgICBpZiAodmVyc2lvbikge1xuICAgICAgICAgICAgYXdhaXQgY3JlYXRlVGFnRm9yU3RhdHVzKFxuICAgICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgICAgIHB1c2guc2hhLFxuICAgICAgICAgICAgICAgIFwiVGFnIGNyZWF0ZWQgYnkgU0RNXCIsXG4gICAgICAgICAgICAgICAgYCR7dmVyc2lvbn0rc2RtLiR7YnVpbGROb31gLFxuICAgICAgICAgICAgICAgIGNyZWRlbnRpYWxzKTtcbiAgICAgICAgfVxuICAgIH1cblxufVxuXG5mdW5jdGlvbiBsaW5rQXJ0aWZhY3QoY3JlZHM6IFByb2plY3RPcGVyYXRpb25DcmVkZW50aWFscywgcmI6IExvY2FsQnVpbGRJblByb2dyZXNzLCB0ZWFtOiBzdHJpbmcsIGFydGlmYWN0U3RvcmU6IEFydGlmYWN0U3RvcmUpOiBQcm9taXNlPGFueT4ge1xuICAgIHJldHVybiBhcnRpZmFjdFN0b3JlLnN0b3JlRmlsZShyYi5hcHBJbmZvLCByYi5kZXBsb3ltZW50VW5pdEZpbGUsIGNyZWRzKVxuICAgICAgICAudGhlbihpbWFnZVVybCA9PiBwb3N0TGlua0ltYWdlV2ViaG9vayhyYi5yZXBvUmVmLm93bmVyLCByYi5yZXBvUmVmLnJlcG8sIHJiLnJlcG9SZWYuc2hhLCBpbWFnZVVybCwgdGVhbSkpO1xufVxuIl19