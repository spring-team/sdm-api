"use strict";/*
 * Copyright Â© 2018 Atomist, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cov_svrcx913f=function(){var path="/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/handlers/events/delivery/goals/RequestDownstreamGoalsOnGoalSuccess.ts",hash="b33a1ddc259979a478c665f9d8a65178293770e5",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/handlers/events/delivery/goals/RequestDownstreamGoalsOnGoalSuccess.ts",statementMap:{"0":{start:{line:17,column:17},end:{line:22,column:1}},"1":{start:{line:18,column:12},end:{line:18,column:28}},"2":{start:{line:18,column:34},end:{line:18,column:125}},"3":{start:{line:19,column:4},end:{line:20,column:150}},"4":{start:{line:19,column:79},end:{line:19,column:131}},"5":{start:{line:20,column:9},end:{line:20,column:150}},"6":{start:{line:20,column:58},end:{line:20,column:150}},"7":{start:{line:20,column:81},end:{line:20,column:150}},"8":{start:{line:21,column:4},end:{line:21,column:66}},"9":{start:{line:23,column:17},end:{line:25,column:1}},"10":{start:{line:24,column:4},end:{line:24,column:109}},"11":{start:{line:24,column:79},end:{line:24,column:109}},"12":{start:{line:26,column:16},end:{line:33,column:1}},"13":{start:{line:27,column:4},end:{line:32,column:7}},"14":{start:{line:28,column:36},end:{line:28,column:97}},"15":{start:{line:28,column:42},end:{line:28,column:70}},"16":{start:{line:28,column:85},end:{line:28,column:95}},"17":{start:{line:29,column:35},end:{line:29,column:100}},"18":{start:{line:29,column:41},end:{line:29,column:73}},"19":{start:{line:29,column:88},end:{line:29,column:98}},"20":{start:{line:30,column:32},end:{line:30,column:149}},"21":{start:{line:30,column:97},end:{line:30,column:119}},"22":{start:{line:31,column:8},end:{line:31,column:78}},"23":{start:{line:34,column:0},end:{line:34,column:62}},"24":{start:{line:35,column:28},end:{line:35,column:65}},"25":{start:{line:36,column:18},end:{line:36,column:69}},"26":{start:{line:37,column:10},end:{line:37,column:27}},"27":{start:{line:38,column:29},end:{line:38,column:100}},"28":{start:{line:39,column:28},end:{line:39,column:98}},"29":{start:{line:40,column:38},end:{line:40,column:118}},"30":{start:{line:41,column:21},end:{line:41,column:84}},"31":{start:{line:42,column:26},end:{line:42,column:74}},"32":{start:{line:43,column:18},end:{line:43,column:57}},"33":{start:{line:47,column:42},end:{line:92,column:1}},"34":{start:{line:49,column:8},end:{line:49,column:57}},"35":{start:{line:54,column:8},end:{line:90,column:11}},"36":{start:{line:55,column:28},end:{line:55,column:49}},"37":{start:{line:56,column:12},end:{line:59,column:13}},"38":{start:{line:57,column:16},end:{line:57,column:118}},"39":{start:{line:58,column:16},end:{line:58,column:68}},"40":{start:{line:60,column:23},end:{line:60,column:118}},"41":{start:{line:61,column:26},end:{line:61,column:149}},"42":{start:{line:62,column:35},end:{line:65,column:99}},"43":{start:{line:62,column:53},end:{line:62,column:86}},"44":{start:{line:65,column:29},end:{line:65,column:98}},"45":{start:{line:66,column:12},end:{line:68,column:13}},"46":{start:{line:67,column:16},end:{line:67,column:213}},"47":{start:{line:69,column:32},end:{line:69,column:59}},"48":{start:{line:77,column:12},end:{line:88,column:17}},"49":{start:{line:77,column:59},end:{line:88,column:14}},"50":{start:{line:78,column:28},end:{line:78,column:91}},"51":{start:{line:79,column:24},end:{line:79,column:28}},"52":{start:{line:80,column:16},end:{line:82,column:17}},"53":{start:{line:81,column:20},end:{line:81,column:103}},"54":{start:{line:83,column:16},end:{line:87,column:19}},"55":{start:{line:89,column:12},end:{line:89,column:47}},"56":{start:{line:93,column:0},end:{line:96,column:73}},"57":{start:{line:97,column:0},end:{line:100,column:40}},"58":{start:{line:101,column:0},end:{line:101,column:82}},"59":{start:{line:105,column:18},end:{line:105,column:89}},"60":{start:{line:105,column:53},end:{line:105,column:88}},"61":{start:{line:106,column:24},end:{line:106,column:85}},"62":{start:{line:106,column:52},end:{line:106,column:84}},"63":{start:{line:107,column:4},end:{line:107,column:23}},"64":{start:{line:109,column:0},end:{line:109,column:64}},"65":{start:{line:111,column:4},end:{line:113,column:5}},"66":{start:{line:112,column:8},end:{line:112,column:25}},"67":{start:{line:116,column:4},end:{line:116,column:196}},"68":{start:{line:117,column:4},end:{line:117,column:37}},"69":{start:{line:120,column:4},end:{line:126,column:7}},"70":{start:{line:121,column:23},end:{line:121,column:106}},"71":{start:{line:122,column:8},end:{line:124,column:9}},"72":{start:{line:123,column:12},end:{line:123,column:65}},"73":{start:{line:125,column:8},end:{line:125,column:37}},"74":{start:{line:128,column:0},end:{line:128,column:44}},"75":{start:{line:130,column:4},end:{line:132,column:5}},"76":{start:{line:131,column:8},end:{line:131,column:20}},"77":{start:{line:133,column:4},end:{line:136,column:5}},"78":{start:{line:134,column:8},end:{line:134,column:108}},"79":{start:{line:135,column:8},end:{line:135,column:20}},"80":{start:{line:137,column:4},end:{line:140,column:5}},"81":{start:{line:138,column:8},end:{line:138,column:106}},"82":{start:{line:139,column:8},end:{line:139,column:20}},"83":{start:{line:141,column:4},end:{line:141,column:122}},"84":{start:{line:142,column:4},end:{line:142,column:17}},"85":{start:{line:146,column:4},end:{line:154,column:5}},"86":{start:{line:148,column:12},end:{line:148,column:24}},"87":{start:{line:150,column:12},end:{line:150,column:25}},"88":{start:{line:153,column:12},end:{line:153,column:24}},"89":{start:{line:157,column:4},end:{line:161,column:6}},"90":{start:{line:158,column:22},end:{line:159,column:38}},"91":{start:{line:158,column:38},end:{line:159,column:37}},"92":{start:{line:160,column:8},end:{line:160,column:21}},"93":{start:{line:164,column:4},end:{line:167,column:5}},"94":{start:{line:165,column:8},end:{line:165,column:139}},"95":{start:{line:166,column:8},end:{line:166,column:21}},"96":{start:{line:168,column:4},end:{line:170,column:5}},"97":{start:{line:169,column:8},end:{line:169,column:21}},"98":{start:{line:171,column:4},end:{line:174,column:5}},"99":{start:{line:172,column:8},end:{line:172,column:93}},"100":{start:{line:173,column:8},end:{line:173,column:20}},"101":{start:{line:175,column:4},end:{line:175,column:17}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:17,column:46},end:{line:17,column:47}},loc:{start:{line:17,column:87},end:{line:22,column:1}},line:17},"1":{name:"(anonymous_1)",decl:{start:{line:23,column:46},end:{line:23,column:47}},loc:{start:{line:23,column:62},end:{line:25,column:1}},line:23},"2":{name:"(anonymous_2)",decl:{start:{line:26,column:44},end:{line:26,column:45}},loc:{start:{line:26,column:89},end:{line:33,column:1}},line:26},"3":{name:"(anonymous_3)",decl:{start:{line:27,column:36},end:{line:27,column:37}},loc:{start:{line:27,column:63},end:{line:32,column:5}},line:27},"4":{name:"fulfilled",decl:{start:{line:28,column:17},end:{line:28,column:26}},loc:{start:{line:28,column:34},end:{line:28,column:99}},line:28},"5":{name:"rejected",decl:{start:{line:29,column:17},end:{line:29,column:25}},loc:{start:{line:29,column:33},end:{line:29,column:102}},line:29},"6":{name:"step",decl:{start:{line:30,column:17},end:{line:30,column:21}},loc:{start:{line:30,column:30},end:{line:30,column:151}},line:30},"7":{name:"(anonymous_7)",decl:{start:{line:30,column:76},end:{line:30,column:77}},loc:{start:{line:30,column:95},end:{line:30,column:121}},line:30},"8":{name:"(anonymous_8)",decl:{start:{line:48,column:4},end:{line:48,column:5}},loc:{start:{line:48,column:38},end:{line:50,column:5}},line:48},"9":{name:"(anonymous_9)",decl:{start:{line:53,column:4},end:{line:53,column:5}},loc:{start:{line:53,column:27},end:{line:91,column:5}},line:53},"10":{name:"(anonymous_10)",decl:{start:{line:54,column:47},end:{line:54,column:48}},loc:{start:{line:54,column:60},end:{line:90,column:9}},line:54},"11":{name:"(anonymous_11)",decl:{start:{line:62,column:48},end:{line:62,column:49}},loc:{start:{line:62,column:53},end:{line:62,column:86}},line:62},"12":{name:"(anonymous_12)",decl:{start:{line:65,column:24},end:{line:65,column:25}},loc:{start:{line:65,column:29},end:{line:65,column:98}},line:65},"13":{name:"(anonymous_13)",decl:{start:{line:77,column:49},end:{line:77,column:50}},loc:{start:{line:77,column:59},end:{line:88,column:14}},line:77},"14":{name:"(anonymous_14)",decl:{start:{line:77,column:91},end:{line:77,column:92}},loc:{start:{line:77,column:104},end:{line:88,column:13}},line:77},"15":{name:"sumSdmGoalEventsByOverride",decl:{start:{line:102,column:9},end:{line:102,column:35}},loc:{start:{line:102,column:48},end:{line:108,column:1}},line:102},"16":{name:"(anonymous_16)",decl:{start:{line:105,column:47},end:{line:105,column:48}},loc:{start:{line:105,column:53},end:{line:105,column:88}},line:105},"17":{name:"(anonymous_17)",decl:{start:{line:106,column:47},end:{line:106,column:48}},loc:{start:{line:106,column:52},end:{line:106,column:84}},line:106},"18":{name:"sumEventsForOneSdmGoal",decl:{start:{line:110,column:9},end:{line:110,column:31}},loc:{start:{line:110,column:40},end:{line:118,column:1}},line:110},"19":{name:"fetchScmProvider",decl:{start:{line:119,column:9},end:{line:119,column:25}},loc:{start:{line:119,column:47},end:{line:127,column:1}},line:119},"20":{name:"(anonymous_20)",decl:{start:{line:120,column:43},end:{line:120,column:44}},loc:{start:{line:120,column:56},end:{line:126,column:5}},line:120},"21":{name:"shouldBePlannedOrSkipped",decl:{start:{line:129,column:9},end:{line:129,column:33}},loc:{start:{line:129,column:49},end:{line:143,column:1}},line:129},"22":{name:"expectToBeFulfilledAfterRequest",decl:{start:{line:145,column:9},end:{line:145,column:40}},loc:{start:{line:145,column:56},end:{line:155,column:1}},line:145},"23":{name:"mapKeyToGoal",decl:{start:{line:156,column:9},end:{line:156,column:21}},loc:{start:{line:156,column:29},end:{line:162,column:1}},line:156},"24":{name:"(anonymous_24)",decl:{start:{line:157,column:11},end:{line:157,column:12}},loc:{start:{line:157,column:26},end:{line:161,column:5}},line:157},"25":{name:"(anonymous_25)",decl:{start:{line:158,column:33},end:{line:158,column:34}},loc:{start:{line:158,column:38},end:{line:159,column:37}},line:158},"26":{name:"isDirectlyDependentOn",decl:{start:{line:163,column:9},end:{line:163,column:30}},loc:{start:{line:163,column:53},end:{line:176,column:1}},line:163}},branchMap:{"0":{loc:{start:{line:17,column:17},end:{line:22,column:1}},type:"binary-expr",locations:[{start:{line:17,column:18},end:{line:17,column:22}},{start:{line:17,column:26},end:{line:17,column:41}},{start:{line:17,column:46},end:{line:22,column:1}}],line:17},"1":{loc:{start:{line:18,column:34},end:{line:18,column:125}},type:"cond-expr",locations:[{start:{line:18,column:42},end:{line:18,column:48}},{start:{line:18,column:51},end:{line:18,column:125}}],line:18},"2":{loc:{start:{line:18,column:51},end:{line:18,column:125}},type:"cond-expr",locations:[{start:{line:18,column:67},end:{line:18,column:118}},{start:{line:18,column:121},end:{line:18,column:125}}],line:18},"3":{loc:{start:{line:19,column:4},end:{line:20,column:150}},type:"if",locations:[{start:{line:19,column:4},end:{line:20,column:150}},{start:{line:19,column:4},end:{line:20,column:150}}],line:19},"4":{loc:{start:{line:19,column:8},end:{line:19,column:77}},type:"binary-expr",locations:[{start:{line:19,column:8},end:{line:19,column:35}},{start:{line:19,column:39},end:{line:19,column:77}}],line:19},"5":{loc:{start:{line:20,column:58},end:{line:20,column:150}},type:"if",locations:[{start:{line:20,column:58},end:{line:20,column:150}},{start:{line:20,column:58},end:{line:20,column:150}}],line:20},"6":{loc:{start:{line:20,column:85},end:{line:20,column:149}},type:"binary-expr",locations:[{start:{line:20,column:86},end:{line:20,column:143}},{start:{line:20,column:148},end:{line:20,column:149}}],line:20},"7":{loc:{start:{line:20,column:86},end:{line:20,column:143}},type:"cond-expr",locations:[{start:{line:20,column:94},end:{line:20,column:98}},{start:{line:20,column:101},end:{line:20,column:143}}],line:20},"8":{loc:{start:{line:20,column:101},end:{line:20,column:143}},type:"cond-expr",locations:[{start:{line:20,column:109},end:{line:20,column:126}},{start:{line:20,column:129},end:{line:20,column:143}}],line:20},"9":{loc:{start:{line:21,column:11},end:{line:21,column:62}},type:"binary-expr",locations:[{start:{line:21,column:11},end:{line:21,column:16}},{start:{line:21,column:20},end:{line:21,column:21}},{start:{line:21,column:25},end:{line:21,column:62}}],line:21},"10":{loc:{start:{line:23,column:17},end:{line:25,column:1}},type:"binary-expr",locations:[{start:{line:23,column:18},end:{line:23,column:22}},{start:{line:23,column:26},end:{line:23,column:41}},{start:{line:23,column:46},end:{line:25,column:1}}],line:23},"11":{loc:{start:{line:24,column:4},end:{line:24,column:109}},type:"if",locations:[{start:{line:24,column:4},end:{line:24,column:109}},{start:{line:24,column:4},end:{line:24,column:109}}],line:24},"12":{loc:{start:{line:24,column:8},end:{line:24,column:77}},type:"binary-expr",locations:[{start:{line:24,column:8},end:{line:24,column:35}},{start:{line:24,column:39},end:{line:24,column:77}}],line:24},"13":{loc:{start:{line:26,column:16},end:{line:33,column:1}},type:"binary-expr",locations:[{start:{line:26,column:17},end:{line:26,column:21}},{start:{line:26,column:25},end:{line:26,column:39}},{start:{line:26,column:44},end:{line:33,column:1}}],line:26},"14":{loc:{start:{line:27,column:16},end:{line:27,column:34}},type:"binary-expr",locations:[{start:{line:27,column:16},end:{line:27,column:17}},{start:{line:27,column:22},end:{line:27,column:33}}],line:27},"15":{loc:{start:{line:30,column:32},end:{line:30,column:148}},type:"cond-expr",locations:[{start:{line:30,column:46},end:{line:30,column:67}},{start:{line:30,column:70},end:{line:30,column:148}}],line:30},"16":{loc:{start:{line:31,column:51},end:{line:31,column:67}},type:"binary-expr",locations:[{start:{line:31,column:51},end:{line:31,column:61}},{start:{line:31,column:65},end:{line:31,column:67}}],line:31},"17":{loc:{start:{line:56,column:12},end:{line:59,column:13}},type:"if",locations:[{start:{line:56,column:12},end:{line:59,column:13}},{start:{line:56,column:12},end:{line:59,column:13}}],line:56},"18":{loc:{start:{line:66,column:12},end:{line:68,column:13}},type:"if",locations:[{start:{line:66,column:12},end:{line:68,column:13}},{start:{line:66,column:12},end:{line:68,column:13}}],line:66},"19":{loc:{start:{line:111,column:4},end:{line:113,column:5}},type:"if",locations:[{start:{line:111,column:4},end:{line:113,column:5}},{start:{line:111,column:4},end:{line:113,column:5}}],line:111},"20":{loc:{start:{line:122,column:8},end:{line:124,column:9}},type:"if",locations:[{start:{line:122,column:8},end:{line:124,column:9}},{start:{line:122,column:8},end:{line:124,column:9}}],line:122},"21":{loc:{start:{line:122,column:12},end:{line:122,column:77}},type:"binary-expr",locations:[{start:{line:122,column:12},end:{line:122,column:19}},{start:{line:122,column:23},end:{line:122,column:42}},{start:{line:122,column:46},end:{line:122,column:77}}],line:122},"22":{loc:{start:{line:130,column:4},end:{line:132,column:5}},type:"if",locations:[{start:{line:130,column:4},end:{line:132,column:5}},{start:{line:130,column:4},end:{line:132,column:5}}],line:130},"23":{loc:{start:{line:133,column:4},end:{line:136,column:5}},type:"if",locations:[{start:{line:133,column:4},end:{line:136,column:5}},{start:{line:133,column:4},end:{line:136,column:5}}],line:133},"24":{loc:{start:{line:137,column:4},end:{line:140,column:5}},type:"if",locations:[{start:{line:137,column:4},end:{line:140,column:5}},{start:{line:137,column:4},end:{line:140,column:5}}],line:137},"25":{loc:{start:{line:137,column:8},end:{line:137,column:72}},type:"binary-expr",locations:[{start:{line:137,column:8},end:{line:137,column:41}},{start:{line:137,column:45},end:{line:137,column:72}}],line:137},"26":{loc:{start:{line:146,column:4},end:{line:154,column:5}},type:"switch",locations:[{start:{line:147,column:8},end:{line:148,column:24}},{start:{line:149,column:8},end:{line:150,column:25}},{start:{line:151,column:8},end:{line:153,column:24}}],line:146},"27":{loc:{start:{line:158,column:38},end:{line:159,column:37}},type:"binary-expr",locations:[{start:{line:158,column:38},end:{line:158,column:77}},{start:{line:159,column:12},end:{line:159,column:37}}],line:158},"28":{loc:{start:{line:164,column:4},end:{line:167,column:5}},type:"if",locations:[{start:{line:164,column:4},end:{line:167,column:5}},{start:{line:164,column:4},end:{line:167,column:5}}],line:164},"29":{loc:{start:{line:168,column:4},end:{line:170,column:5}},type:"if",locations:[{start:{line:168,column:4},end:{line:170,column:5}},{start:{line:168,column:4},end:{line:170,column:5}}],line:168},"30":{loc:{start:{line:168,column:8},end:{line:168,column:62}},type:"binary-expr",locations:[{start:{line:168,column:8},end:{line:168,column:27}},{start:{line:168,column:31},end:{line:168,column:62}}],line:168},"31":{loc:{start:{line:171,column:4},end:{line:174,column:5}},type:"if",locations:[{start:{line:171,column:4},end:{line:174,column:5}},{start:{line:171,column:4},end:{line:174,column:5}}],line:171}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0},b:{"0":[0,0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0,0],"10":[0,0,0],"11":[0,0],"12":[0,0],"13":[0,0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var __decorate=(cov_svrcx913f.s[0]++,(cov_svrcx913f.b[0][0]++,this)&&(cov_svrcx913f.b[0][1]++,this.__decorate)||(cov_svrcx913f.b[0][2]++,function(decorators,target,key,desc){cov_svrcx913f.f[0]++;var c=(cov_svrcx913f.s[1]++,arguments.length),r=(cov_svrcx913f.s[2]++,c<3?(cov_svrcx913f.b[1][0]++,target):(cov_svrcx913f.b[1][1]++,desc===null?(cov_svrcx913f.b[2][0]++,desc=Object.getOwnPropertyDescriptor(target,key)):(cov_svrcx913f.b[2][1]++,desc))),d;cov_svrcx913f.s[3]++;if((cov_svrcx913f.b[4][0]++,typeof Reflect==="object")&&(cov_svrcx913f.b[4][1]++,typeof Reflect.decorate==="function")){cov_svrcx913f.b[3][0]++;cov_svrcx913f.s[4]++;r=Reflect.decorate(decorators,target,key,desc);}else{cov_svrcx913f.b[3][1]++;cov_svrcx913f.s[5]++;for(var i=decorators.length-1;i>=0;i--){cov_svrcx913f.s[6]++;if(d=decorators[i]){cov_svrcx913f.b[5][0]++;cov_svrcx913f.s[7]++;r=(cov_svrcx913f.b[6][0]++,c<3?(cov_svrcx913f.b[7][0]++,d(r)):(cov_svrcx913f.b[7][1]++,c>3?(cov_svrcx913f.b[8][0]++,d(target,key,r)):(cov_svrcx913f.b[8][1]++,d(target,key))))||(cov_svrcx913f.b[6][1]++,r);}else{cov_svrcx913f.b[5][1]++;}}}cov_svrcx913f.s[8]++;return(cov_svrcx913f.b[9][0]++,c>3)&&(cov_svrcx913f.b[9][1]++,r)&&(cov_svrcx913f.b[9][2]++,Object.defineProperty(target,key,r)),r;}));var __metadata=(cov_svrcx913f.s[9]++,(cov_svrcx913f.b[10][0]++,this)&&(cov_svrcx913f.b[10][1]++,this.__metadata)||(cov_svrcx913f.b[10][2]++,function(k,v){cov_svrcx913f.f[1]++;cov_svrcx913f.s[10]++;if((cov_svrcx913f.b[12][0]++,typeof Reflect==="object")&&(cov_svrcx913f.b[12][1]++,typeof Reflect.metadata==="function")){cov_svrcx913f.b[11][0]++;cov_svrcx913f.s[11]++;return Reflect.metadata(k,v);}else{cov_svrcx913f.b[11][1]++;}}));var __awaiter=(cov_svrcx913f.s[12]++,(cov_svrcx913f.b[13][0]++,this)&&(cov_svrcx913f.b[13][1]++,this.__awaiter)||(cov_svrcx913f.b[13][2]++,function(thisArg,_arguments,P,generator){cov_svrcx913f.f[2]++;cov_svrcx913f.s[13]++;return new((cov_svrcx913f.b[14][0]++,P)||(cov_svrcx913f.b[14][1]++,P=Promise))(function(resolve,reject){cov_svrcx913f.f[3]++;function fulfilled(value){cov_svrcx913f.f[4]++;cov_svrcx913f.s[14]++;try{cov_svrcx913f.s[15]++;step(generator.next(value));}catch(e){cov_svrcx913f.s[16]++;reject(e);}}function rejected(value){cov_svrcx913f.f[5]++;cov_svrcx913f.s[17]++;try{cov_svrcx913f.s[18]++;step(generator["throw"](value));}catch(e){cov_svrcx913f.s[19]++;reject(e);}}function step(result){cov_svrcx913f.f[6]++;cov_svrcx913f.s[20]++;result.done?(cov_svrcx913f.b[15][0]++,resolve(result.value)):(cov_svrcx913f.b[15][1]++,new P(function(resolve){cov_svrcx913f.f[7]++;cov_svrcx913f.s[21]++;resolve(result.value);}).then(fulfilled,rejected));}cov_svrcx913f.s[22]++;step((generator=generator.apply(thisArg,(cov_svrcx913f.b[16][0]++,_arguments)||(cov_svrcx913f.b[16][1]++,[]))).next());});}));cov_svrcx913f.s[23]++;Object.defineProperty(exports,"__esModule",{value:true});const automation_client_1=(cov_svrcx913f.s[24]++,require("@atomist/automation-client"));const graphQL_1=(cov_svrcx913f.s[25]++,require("@atomist/automation-client/graph/graphQL"));const _=(cov_svrcx913f.s[26]++,require("lodash"));const fetchGoalsOnCommit_1=(cov_svrcx913f.s[27]++,require("../../../../common/delivery/goals/support/fetchGoalsOnCommit"));const goalPreconditions_1=(cov_svrcx913f.s[28]++,require("../../../../common/delivery/goals/support/goalPreconditions"));const SdmGoalImplementationMapper_1=(cov_svrcx913f.s[29]++,require("../../../../common/delivery/goals/support/SdmGoalImplementationMapper"));const storeGoals_1=(cov_svrcx913f.s[30]++,require("../../../../common/delivery/goals/support/storeGoals"));const sdmGoalIngester_1=(cov_svrcx913f.s[31]++,require("../../../../ingesters/sdmGoalIngester"));const repoRef_1=(cov_svrcx913f.s[32]++,require("../../../../util/git/repoRef"));/**
 * Respond to a failure status by failing downstream goals
 */cov_svrcx913f.s[33]++;let RequestDownstreamGoalsOnGoalSuccess=class RequestDownstreamGoalsOnGoalSuccess{constructor(implementationMapper){cov_svrcx913f.f[8]++;cov_svrcx913f.s[34]++;this.implementationMapper=implementationMapper;}// #98: GitHub Status->SdmGoal: I believe all the goal state updates in this SDM
// are now happening on the SdmGoal. This subscription can change to be on SdmGoal state.
handle(event,context){cov_svrcx913f.f[9]++;cov_svrcx913f.s[35]++;return __awaiter(this,void 0,void 0,function*(){cov_svrcx913f.f[10]++;const sdmGoal=(cov_svrcx913f.s[36]++,event.data.SdmGoal[0]);cov_svrcx913f.s[37]++;if(sdmGoal.state!=="success"){cov_svrcx913f.b[17][0]++;cov_svrcx913f.s[38]++;// atomisthq/automation-api#395
automation_client_1.logger.debug(`Nevermind: success reported when the state was=[${sdmGoal.state}]`);cov_svrcx913f.s[39]++;return Promise.resolve(automation_client_1.Success);}else{cov_svrcx913f.b[17][1]++;}const id=(cov_svrcx913f.s[40]++,repoRef_1.repoRefFromSdmGoal(sdmGoal,(yield fetchScmProvider(context,sdmGoal.repo.providerId))));const goals=(cov_svrcx913f.s[41]++,sumSdmGoalEventsByOverride((yield fetchGoalsOnCommit_1.fetchGoalsForCommit(context,id,sdmGoal.repo.providerId)),[sdmGoal]));const goalsToRequest=(cov_svrcx913f.s[42]++,goals.filter(g=>{cov_svrcx913f.f[11]++;cov_svrcx913f.s[43]++;return isDirectlyDependentOn(sdmGoal,g);})// .filter(expectToBeFulfilledAfterRequest)
.filter(shouldBePlannedOrSkipped).filter(g=>{cov_svrcx913f.f[12]++;cov_svrcx913f.s[44]++;return goalPreconditions_1.preconditionsAreMet(g,{goalsForCommit:goals});}));cov_svrcx913f.s[45]++;if(goalsToRequest.length>0){cov_svrcx913f.b[18][0]++;cov_svrcx913f.s[46]++;automation_client_1.logger.info("because %s is successful, these goals are now ready: %s",sdmGoalIngester_1.goalKeyString(sdmGoal),goalsToRequest.map(sdmGoalIngester_1.goalKeyString).join(", "));}else{cov_svrcx913f.b[18][1]++;}const credentials=(cov_svrcx913f.s[47]++,{token:this.githubToken});/*
             * #294 Intention: for custom descriptions per goal, we need to look up the Goal.
             * This is the only reason to do that here.
             * I want to maintain a list in the SDM of all goals that can be assigned by rules,
             * and pass them here for mapping from SdmGoalKey -> Goal. Then, we can use
             * the requestDescription defined on that Goal.
             */cov_svrcx913f.s[48]++;yield Promise.all(goalsToRequest.map(goal=>{cov_svrcx913f.f[13]++;cov_svrcx913f.s[49]++;return __awaiter(this,void 0,void 0,function*(){cov_svrcx913f.f[14]++;const cbs=(cov_svrcx913f.s[50]++,this.implementationMapper.findFullfillmentCallbackForGoal(goal));let g=(cov_svrcx913f.s[51]++,goal);cov_svrcx913f.s[52]++;for(const cb of cbs){cov_svrcx913f.s[53]++;g=yield cb.callback(g,{id,addressChannels:undefined,credentials,context});}cov_svrcx913f.s[54]++;return storeGoals_1.updateGoal(context,g,{state:"requested",description:`Ready to `+g.name,data:g.data});});}));cov_svrcx913f.s[55]++;return automation_client_1.Success;});}};cov_svrcx913f.s[56]++;__decorate([automation_client_1.Value("token"),__metadata("design:type",String)],RequestDownstreamGoalsOnGoalSuccess.prototype,"githubToken",void 0);cov_svrcx913f.s[57]++;RequestDownstreamGoalsOnGoalSuccess=__decorate([automation_client_1.EventHandler("Move downstream goals from 'planned' to 'success' when preconditions are met",graphQL_1.subscription("OnAnySuccessfulSdmGoal")),__metadata("design:paramtypes",[SdmGoalImplementationMapper_1.SdmGoalImplementationMapper])],RequestDownstreamGoalsOnGoalSuccess);cov_svrcx913f.s[58]++;exports.RequestDownstreamGoalsOnGoalSuccess=RequestDownstreamGoalsOnGoalSuccess;function sumSdmGoalEventsByOverride(some,more){cov_svrcx913f.f[15]++;// For some reason this won't compile with the obvious fix
// tslint:disable-next-line:no-unnecessary-callback-wrapper
const byKey=(cov_svrcx913f.s[59]++,_.groupBy(some.concat(more),sg=>{cov_svrcx913f.f[16]++;cov_svrcx913f.s[60]++;return sdmGoalIngester_1.goalKeyString(sg);}));const summedGoals=(cov_svrcx913f.s[61]++,Object.keys(byKey).map(k=>{cov_svrcx913f.f[17]++;cov_svrcx913f.s[62]++;return sumEventsForOneSdmGoal(byKey[k]);}));cov_svrcx913f.s[63]++;return summedGoals;}cov_svrcx913f.s[64]++;exports.sumSdmGoalEventsByOverride=sumSdmGoalEventsByOverride;function sumEventsForOneSdmGoal(events){cov_svrcx913f.f[18]++;cov_svrcx913f.s[65]++;if(events.length===1){cov_svrcx913f.b[19][0]++;cov_svrcx913f.s[66]++;return events[0];}else{cov_svrcx913f.b[19][1]++;}// here, I could get clever and sort by timestamp, or someday build a graph if they link to prior versions,
// or get smart about statuses. Let me be lazy.
cov_svrcx913f.s[67]++;automation_client_1.logger.debug("Found %d events for %s. Taking the last one, which has state %s",events.length,sdmGoalIngester_1.goalKeyString(events[0]),events[events.length-1].state);cov_svrcx913f.s[68]++;return events[events.length-1];}function fetchScmProvider(context,providerId){cov_svrcx913f.f[19]++;cov_svrcx913f.s[69]++;return __awaiter(this,void 0,void 0,function*(){cov_svrcx913f.f[20]++;const result=(cov_svrcx913f.s[70]++,yield context.graphClient.query({name:"SCMProvider",variables:{providerId}}));cov_svrcx913f.s[71]++;if((cov_svrcx913f.b[21][0]++,!result)||(cov_svrcx913f.b[21][1]++,!result.SCMProvider)||(cov_svrcx913f.b[21][2]++,result.SCMProvider.length===0)){cov_svrcx913f.b[20][0]++;cov_svrcx913f.s[72]++;throw new Error(`Provider not found: ${providerId}`);}else{cov_svrcx913f.b[20][1]++;}cov_svrcx913f.s[73]++;return result.SCMProvider[0];});}cov_svrcx913f.s[74]++;exports.fetchScmProvider=fetchScmProvider;function shouldBePlannedOrSkipped(dependentGoal){cov_svrcx913f.f[21]++;cov_svrcx913f.s[75]++;if(dependentGoal.state==="planned"){cov_svrcx913f.b[22][0]++;cov_svrcx913f.s[76]++;return true;}else{cov_svrcx913f.b[22][1]++;}cov_svrcx913f.s[77]++;if(dependentGoal.state==="skipped"){cov_svrcx913f.b[23][0]++;cov_svrcx913f.s[78]++;automation_client_1.logger.info("Goal %s was skipped, but now maybe it can go",dependentGoal.name);cov_svrcx913f.s[79]++;return true;}else{cov_svrcx913f.b[23][1]++;}cov_svrcx913f.s[80]++;if((cov_svrcx913f.b[25][0]++,dependentGoal.state==="failure")&&(cov_svrcx913f.b[25][1]++,dependentGoal.retryFeasible)){cov_svrcx913f.b[24][0]++;cov_svrcx913f.s[81]++;automation_client_1.logger.info("Goal %s failed, but maybe we will retry it",dependentGoal.name);cov_svrcx913f.s[82]++;return true;}else{cov_svrcx913f.b[24][1]++;}cov_svrcx913f.s[83]++;automation_client_1.logger.warn("Goal %s in state %s will not be requested",dependentGoal.name,dependentGoal.state);cov_svrcx913f.s[84]++;return false;}// tslint:disable-next-line:no-unused-variable
function expectToBeFulfilledAfterRequest(dependentGoal){cov_svrcx913f.f[22]++;cov_svrcx913f.s[85]++;switch(dependentGoal.fulfillment.method){case"SDM fulfill on requested":cov_svrcx913f.b[26][0]++;cov_svrcx913f.s[86]++;return true;case"side-effect":cov_svrcx913f.b[26][1]++;cov_svrcx913f.s[87]++;return false;case"other":cov_svrcx913f.b[26][2]++;cov_svrcx913f.s[88]++;// legacy behavior
return true;}}function mapKeyToGoal(goals){cov_svrcx913f.f[23]++;cov_svrcx913f.s[89]++;return keyToFind=>{cov_svrcx913f.f[24]++;const found=(cov_svrcx913f.s[90]++,goals.find(g=>{cov_svrcx913f.f[25]++;cov_svrcx913f.s[91]++;return(cov_svrcx913f.b[27][0]++,g.environment===keyToFind.environment)&&(cov_svrcx913f.b[27][1]++,g.name===keyToFind.name);}));cov_svrcx913f.s[92]++;return found;};}function isDirectlyDependentOn(successfulGoal,goal){cov_svrcx913f.f[26]++;cov_svrcx913f.s[93]++;if(!goal){cov_svrcx913f.b[28][0]++;cov_svrcx913f.s[94]++;automation_client_1.logger.warn("Internal error: Trying to work out if %j is dependent on null or undefined goal",successfulGoal);cov_svrcx913f.s[95]++;return false;}else{cov_svrcx913f.b[28][1]++;}cov_svrcx913f.s[96]++;if((cov_svrcx913f.b[30][0]++,!goal.preConditions)||(cov_svrcx913f.b[30][1]++,goal.preConditions.length===0)){cov_svrcx913f.b[29][0]++;cov_svrcx913f.s[97]++;return false;// no preconditions? not dependent
}else{cov_svrcx913f.b[29][1]++;}cov_svrcx913f.s[98]++;if(mapKeyToGoal(goal.preConditions)(successfulGoal)){cov_svrcx913f.b[31][0]++;cov_svrcx913f.s[99]++;automation_client_1.logger.debug("%s depends on %s",goal.name,successfulGoal.name);cov_svrcx913f.s[100]++;return true;// the failed goal is one of my preconditions? dependent
}else{cov_svrcx913f.b[31][1]++;}cov_svrcx913f.s[101]++;return false;}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL3JvZGpvaG5zb24vc2ZvcnphbmRvLWRldi9pZGVhLXByb2plY3RzL215LWZsb3cvc3JjL2hhbmRsZXJzL2V2ZW50cy9kZWxpdmVyeS9nb2Fscy9SZXF1ZXN0RG93bnN0cmVhbUdvYWxzT25Hb2FsU3VjY2Vzcy50cyIsInNvdXJjZXMiOlsiL1VzZXJzL3JvZGpvaG5zb24vc2ZvcnphbmRvLWRldi9pZGVhLXByb2plY3RzL215LWZsb3cvc3JjL2hhbmRsZXJzL2V2ZW50cy9kZWxpdmVyeS9nb2Fscy9SZXF1ZXN0RG93bnN0cmVhbUdvYWxzT25Hb2FsU3VjY2Vzcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7Ozs7O0dBY0c7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFSCxrRUFTb0M7QUFDcEMsc0VBQXdFO0FBQ3hFLDRCQUE0QjtBQUM1QixxR0FBbUc7QUFDbkcsbUdBQWtHO0FBQ2xHLHVIQUFvSDtBQUNwSCxxRkFBa0Y7QUFDbEYsMkVBSStDO0FBSy9DLDBEQUFrRTtBQUVsRTs7R0FFRztBQUdILElBQWEsbUNBQW1DLEdBQWhEO0lBS0ksWUFBNkIsb0JBQWlEO1FBQWpELHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBNkI7SUFBSSxDQUFDO0lBRW5GLGdGQUFnRjtJQUNoRix5RkFBeUY7SUFDNUUsTUFBTSxDQUFDLEtBQXNELEVBQ3RELE9BQXVCOztZQUN2QyxNQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQVksQ0FBQztZQUVqRCxJQUFJLE9BQU8sQ0FBQyxLQUFLLEtBQUssU0FBUyxFQUFFLEVBQUUsK0JBQStCO2dCQUM5RCwwQkFBTSxDQUFDLEtBQUssQ0FBQyxtREFBbUQsT0FBTyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7Z0JBQ2xGLE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQywyQkFBTyxDQUFDLENBQUM7YUFDbkM7WUFFRCxNQUFNLEVBQUUsR0FBRyw0QkFBa0IsQ0FBQyxPQUFPLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ2pHLE1BQU0sS0FBSyxHQUFjLDBCQUEwQixDQUFDLE1BQU0sd0NBQW1CLENBQUMsT0FBTyxFQUFFLEVBQUUsRUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBYyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUU3SSxNQUFNLGNBQWMsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMscUJBQXFCLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUN2RSwyQ0FBMkM7aUJBQzFDLE1BQU0sQ0FBQyx3QkFBd0IsQ0FBQztpQkFDaEMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsdUNBQW1CLENBQUMsQ0FBQyxFQUFFLEVBQUUsY0FBYyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztZQUVwRSxJQUFJLGNBQWMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUMzQiwwQkFBTSxDQUFDLElBQUksQ0FBQyx5REFBeUQsRUFBRSwrQkFBYSxDQUFDLE9BQU8sQ0FBQyxFQUN6RixjQUFjLENBQUMsR0FBRyxDQUFDLCtCQUFhLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQzthQUNyRDtZQUVELE1BQU0sV0FBVyxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUVoRDs7Ozs7O2VBTUc7WUFDSCxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxDQUFNLElBQUksRUFBQyxFQUFFO2dCQUM5QyxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsK0JBQStCLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzVFLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQztnQkFDYixLQUFLLE1BQU0sRUFBRSxJQUFJLEdBQUcsRUFBRTtvQkFDbEIsQ0FBQyxHQUFHLE1BQU0sRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztpQkFDdEY7Z0JBRUQsT0FBTyx1QkFBVSxDQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUU7b0JBQzFCLEtBQUssRUFBRSxXQUFXO29CQUNsQixXQUFXLEVBQUUsV0FBVyxHQUFHLENBQUMsQ0FBQyxJQUFJO29CQUNqQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUk7aUJBQ2YsQ0FBQyxDQUFDO1lBQ1AsQ0FBQyxDQUFBLENBQUMsQ0FBQyxDQUFDO1lBQ0osT0FBTywyQkFBTyxDQUFDO1FBQ25CLENBQUM7S0FBQTtDQUNKLENBQUE7QUFwREc7SUFEQyx5QkFBSyxDQUFDLE9BQU8sQ0FBQzs7d0VBQ1k7QUFIbEIsbUNBQW1DO0lBRi9DLGdDQUFZLENBQUMsOEVBQThFLEVBQ3hGLHNCQUFZLENBQUMsd0JBQXdCLENBQUMsQ0FBQztxQ0FNWSx5REFBMkI7R0FMckUsbUNBQW1DLENBdUQvQztBQXZEWSxrRkFBbUM7QUF5RGhELG9DQUEyQyxJQUFlLEVBQUUsSUFBZTtJQUN2RSwwREFBMEQ7SUFDMUQsMkRBQTJEO0lBQzNELE1BQU0sS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLCtCQUFhLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNwRSxNQUFNLFdBQVcsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLHNCQUFzQixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbEYsT0FBTyxXQUFXLENBQUM7QUFDdkIsQ0FBQztBQU5ELGdFQU1DO0FBRUQsZ0NBQWdDLE1BQWlCO0lBQzdDLElBQUksTUFBTSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7UUFDckIsT0FBTyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDcEI7SUFDRCwyR0FBMkc7SUFDM0csK0NBQStDO0lBQy9DLDBCQUFNLENBQUMsS0FBSyxDQUFDLGlFQUFpRSxFQUFFLE1BQU0sQ0FBQyxNQUFNLEVBQUUsK0JBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFDbkgsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDckMsT0FBTyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztBQUNyQyxDQUFDO0FBRUQsMEJBQXVDLE9BQXVCLEVBQUUsVUFBa0I7O1FBQzlFLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQzFDLEVBQUUsSUFBSSxFQUFFLGFBQWEsRUFBRSxTQUFTLEVBQUUsRUFBRSxVQUFVLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDeEQsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLElBQUksTUFBTSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ25FLE1BQU0sSUFBSSxLQUFLLENBQUMsdUJBQXVCLFVBQVUsRUFBRSxDQUFDLENBQUM7U0FDeEQ7UUFDRCxPQUFPLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDakMsQ0FBQztDQUFBO0FBUEQsNENBT0M7QUFFRCxrQ0FBa0MsYUFBc0I7SUFDcEQsSUFBSSxhQUFhLENBQUMsS0FBSyxLQUFLLFNBQVMsRUFBRTtRQUNuQyxPQUFPLElBQUksQ0FBQztLQUNmO0lBQ0QsSUFBSSxhQUFhLENBQUMsS0FBSyxLQUFLLFNBQVMsRUFBRTtRQUNuQywwQkFBTSxDQUFDLElBQUksQ0FBQyw4Q0FBOEMsRUFBRSxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEYsT0FBTyxJQUFJLENBQUM7S0FDZjtJQUNELElBQUksYUFBYSxDQUFDLEtBQUssS0FBSyxTQUFTLElBQUksYUFBYSxDQUFDLGFBQWEsRUFBRTtRQUNsRSwwQkFBTSxDQUFDLElBQUksQ0FBQyw0Q0FBNEMsRUFBRSxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDOUUsT0FBTyxJQUFJLENBQUM7S0FDZjtJQUNELDBCQUFNLENBQUMsSUFBSSxDQUFDLDJDQUEyQyxFQUFFLGFBQWEsQ0FBQyxJQUFJLEVBQUUsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2xHLE9BQU8sS0FBSyxDQUFDO0FBQ2pCLENBQUM7QUFFRCw4Q0FBOEM7QUFDOUMseUNBQXlDLGFBQXNCO0lBQzNELFFBQVEsYUFBYSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUU7UUFDdEMsS0FBSywwQkFBMEI7WUFDM0IsT0FBTyxJQUFJLENBQUM7UUFDaEIsS0FBSyxhQUFhO1lBQ2QsT0FBTyxLQUFLLENBQUM7UUFDakIsS0FBSyxPQUFPO1lBQ1Isa0JBQWtCO1lBQ2xCLE9BQU8sSUFBSSxDQUFDO0tBQ25CO0FBQ0wsQ0FBQztBQUVELHNCQUE0QyxLQUFVO0lBQ2xELE9BQU8sQ0FBQyxTQUFxQixFQUFFLEVBQUU7UUFDN0IsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUN6QixDQUFDLENBQUMsV0FBVyxLQUFLLFNBQVMsQ0FBQyxXQUFXO1lBQ3ZDLENBQUMsQ0FBQyxJQUFJLEtBQUssU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9CLE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUMsQ0FBQztBQUNOLENBQUM7QUFFRCwrQkFBK0IsY0FBMEIsRUFBRSxJQUFhO0lBQ3BFLElBQUksQ0FBQyxJQUFJLEVBQUU7UUFDUCwwQkFBTSxDQUFDLElBQUksQ0FBQyxpRkFBaUYsRUFBRSxjQUFjLENBQUMsQ0FBQztRQUMvRyxPQUFPLEtBQUssQ0FBQztLQUNoQjtJQUNELElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtRQUN4RCxPQUFPLEtBQUssQ0FBQyxDQUFDLGtDQUFrQztLQUNuRDtJQUNELElBQUksWUFBWSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxjQUFjLENBQUMsRUFBRTtRQUNsRCwwQkFBTSxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNqRSxPQUFPLElBQUksQ0FBQyxDQUFDLHdEQUF3RDtLQUN4RTtJQUNELE9BQU8sS0FBSyxDQUFDO0FBQ2pCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IMKpIDIwMTggQXRvbWlzdCwgSW5jLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQge1xuICAgIEV2ZW50RmlyZWQsXG4gICAgRXZlbnRIYW5kbGVyLFxuICAgIEhhbmRsZUV2ZW50LFxuICAgIEhhbmRsZXJDb250ZXh0LFxuICAgIEhhbmRsZXJSZXN1bHQsXG4gICAgbG9nZ2VyLFxuICAgIFN1Y2Nlc3MsXG4gICAgVmFsdWUsXG59IGZyb20gXCJAYXRvbWlzdC9hdXRvbWF0aW9uLWNsaWVudFwiO1xuaW1wb3J0IHsgc3Vic2NyaXB0aW9uIH0gZnJvbSBcIkBhdG9taXN0L2F1dG9tYXRpb24tY2xpZW50L2dyYXBoL2dyYXBoUUxcIjtcbmltcG9ydCAqIGFzIF8gZnJvbSBcImxvZGFzaFwiO1xuaW1wb3J0IHsgZmV0Y2hHb2Fsc0ZvckNvbW1pdCB9IGZyb20gXCIuLi8uLi8uLi8uLi9jb21tb24vZGVsaXZlcnkvZ29hbHMvc3VwcG9ydC9mZXRjaEdvYWxzT25Db21taXRcIjtcbmltcG9ydCB7IHByZWNvbmRpdGlvbnNBcmVNZXQgfSBmcm9tIFwiLi4vLi4vLi4vLi4vY29tbW9uL2RlbGl2ZXJ5L2dvYWxzL3N1cHBvcnQvZ29hbFByZWNvbmRpdGlvbnNcIjtcbmltcG9ydCB7IFNkbUdvYWxJbXBsZW1lbnRhdGlvbk1hcHBlciB9IGZyb20gXCIuLi8uLi8uLi8uLi9jb21tb24vZGVsaXZlcnkvZ29hbHMvc3VwcG9ydC9TZG1Hb2FsSW1wbGVtZW50YXRpb25NYXBwZXJcIjtcbmltcG9ydCB7IHVwZGF0ZUdvYWwgfSBmcm9tIFwiLi4vLi4vLi4vLi4vY29tbW9uL2RlbGl2ZXJ5L2dvYWxzL3N1cHBvcnQvc3RvcmVHb2Fsc1wiO1xuaW1wb3J0IHtcbiAgICBnb2FsS2V5U3RyaW5nLFxuICAgIFNkbUdvYWwsXG4gICAgU2RtR29hbEtleSxcbn0gZnJvbSBcIi4uLy4uLy4uLy4uL2luZ2VzdGVycy9zZG1Hb2FsSW5nZXN0ZXJcIjtcbmltcG9ydCB7XG4gICAgT25BbnlTdWNjZXNzZnVsU2RtR29hbCxcbiAgICBTY21Qcm92aWRlcixcbn0gZnJvbSBcIi4uLy4uLy4uLy4uL3R5cGluZ3MvdHlwZXNcIjtcbmltcG9ydCB7IHJlcG9SZWZGcm9tU2RtR29hbCB9IGZyb20gXCIuLi8uLi8uLi8uLi91dGlsL2dpdC9yZXBvUmVmXCI7XG5cbi8qKlxuICogUmVzcG9uZCB0byBhIGZhaWx1cmUgc3RhdHVzIGJ5IGZhaWxpbmcgZG93bnN0cmVhbSBnb2Fsc1xuICovXG5ARXZlbnRIYW5kbGVyKFwiTW92ZSBkb3duc3RyZWFtIGdvYWxzIGZyb20gJ3BsYW5uZWQnIHRvICdzdWNjZXNzJyB3aGVuIHByZWNvbmRpdGlvbnMgYXJlIG1ldFwiLFxuICAgIHN1YnNjcmlwdGlvbihcIk9uQW55U3VjY2Vzc2Z1bFNkbUdvYWxcIikpXG5leHBvcnQgY2xhc3MgUmVxdWVzdERvd25zdHJlYW1Hb2Fsc09uR29hbFN1Y2Nlc3MgaW1wbGVtZW50cyBIYW5kbGVFdmVudDxPbkFueVN1Y2Nlc3NmdWxTZG1Hb2FsLlN1YnNjcmlwdGlvbj4ge1xuXG4gICAgQFZhbHVlKFwidG9rZW5cIilcbiAgICBwdWJsaWMgZ2l0aHViVG9rZW46IHN0cmluZztcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgaW1wbGVtZW50YXRpb25NYXBwZXI6IFNkbUdvYWxJbXBsZW1lbnRhdGlvbk1hcHBlcikgeyB9XG5cbiAgICAvLyAjOTg6IEdpdEh1YiBTdGF0dXMtPlNkbUdvYWw6IEkgYmVsaWV2ZSBhbGwgdGhlIGdvYWwgc3RhdGUgdXBkYXRlcyBpbiB0aGlzIFNETVxuICAgIC8vIGFyZSBub3cgaGFwcGVuaW5nIG9uIHRoZSBTZG1Hb2FsLiBUaGlzIHN1YnNjcmlwdGlvbiBjYW4gY2hhbmdlIHRvIGJlIG9uIFNkbUdvYWwgc3RhdGUuXG4gICAgcHVibGljIGFzeW5jIGhhbmRsZShldmVudDogRXZlbnRGaXJlZDxPbkFueVN1Y2Nlc3NmdWxTZG1Hb2FsLlN1YnNjcmlwdGlvbj4sXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0OiBIYW5kbGVyQ29udGV4dCk6IFByb21pc2U8SGFuZGxlclJlc3VsdD4ge1xuICAgICAgICBjb25zdCBzZG1Hb2FsID0gZXZlbnQuZGF0YS5TZG1Hb2FsWzBdIGFzIFNkbUdvYWw7XG5cbiAgICAgICAgaWYgKHNkbUdvYWwuc3RhdGUgIT09IFwic3VjY2Vzc1wiKSB7IC8vIGF0b21pc3RocS9hdXRvbWF0aW9uLWFwaSMzOTVcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhgTmV2ZXJtaW5kOiBzdWNjZXNzIHJlcG9ydGVkIHdoZW4gdGhlIHN0YXRlIHdhcz1bJHtzZG1Hb2FsLnN0YXRlfV1gKTtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoU3VjY2Vzcyk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBpZCA9IHJlcG9SZWZGcm9tU2RtR29hbChzZG1Hb2FsLCBhd2FpdCBmZXRjaFNjbVByb3ZpZGVyKGNvbnRleHQsIHNkbUdvYWwucmVwby5wcm92aWRlcklkKSk7XG4gICAgICAgIGNvbnN0IGdvYWxzOiBTZG1Hb2FsW10gPSBzdW1TZG1Hb2FsRXZlbnRzQnlPdmVycmlkZShhd2FpdCBmZXRjaEdvYWxzRm9yQ29tbWl0KGNvbnRleHQsIGlkLCBzZG1Hb2FsLnJlcG8ucHJvdmlkZXJJZCkgYXMgU2RtR29hbFtdLCBbc2RtR29hbF0pO1xuXG4gICAgICAgIGNvbnN0IGdvYWxzVG9SZXF1ZXN0ID0gZ29hbHMuZmlsdGVyKGcgPT4gaXNEaXJlY3RseURlcGVuZGVudE9uKHNkbUdvYWwsIGcpKVxuICAgICAgICAgICAgLy8gLmZpbHRlcihleHBlY3RUb0JlRnVsZmlsbGVkQWZ0ZXJSZXF1ZXN0KVxuICAgICAgICAgICAgLmZpbHRlcihzaG91bGRCZVBsYW5uZWRPclNraXBwZWQpXG4gICAgICAgICAgICAuZmlsdGVyKGcgPT4gcHJlY29uZGl0aW9uc0FyZU1ldChnLCB7IGdvYWxzRm9yQ29tbWl0OiBnb2FscyB9KSk7XG5cbiAgICAgICAgaWYgKGdvYWxzVG9SZXF1ZXN0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGxvZ2dlci5pbmZvKFwiYmVjYXVzZSAlcyBpcyBzdWNjZXNzZnVsLCB0aGVzZSBnb2FscyBhcmUgbm93IHJlYWR5OiAlc1wiLCBnb2FsS2V5U3RyaW5nKHNkbUdvYWwpLFxuICAgICAgICAgICAgICAgIGdvYWxzVG9SZXF1ZXN0Lm1hcChnb2FsS2V5U3RyaW5nKS5qb2luKFwiLCBcIikpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY3JlZGVudGlhbHMgPSB7IHRva2VuOiB0aGlzLmdpdGh1YlRva2VuIH07XG5cbiAgICAgICAgLypcbiAgICAgICAgICogIzI5NCBJbnRlbnRpb246IGZvciBjdXN0b20gZGVzY3JpcHRpb25zIHBlciBnb2FsLCB3ZSBuZWVkIHRvIGxvb2sgdXAgdGhlIEdvYWwuXG4gICAgICAgICAqIFRoaXMgaXMgdGhlIG9ubHkgcmVhc29uIHRvIGRvIHRoYXQgaGVyZS5cbiAgICAgICAgICogSSB3YW50IHRvIG1haW50YWluIGEgbGlzdCBpbiB0aGUgU0RNIG9mIGFsbCBnb2FscyB0aGF0IGNhbiBiZSBhc3NpZ25lZCBieSBydWxlcyxcbiAgICAgICAgICogYW5kIHBhc3MgdGhlbSBoZXJlIGZvciBtYXBwaW5nIGZyb20gU2RtR29hbEtleSAtPiBHb2FsLiBUaGVuLCB3ZSBjYW4gdXNlXG4gICAgICAgICAqIHRoZSByZXF1ZXN0RGVzY3JpcHRpb24gZGVmaW5lZCBvbiB0aGF0IEdvYWwuXG4gICAgICAgICAqL1xuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChnb2Fsc1RvUmVxdWVzdC5tYXAoYXN5bmMgZ29hbCA9PiB7XG4gICAgICAgICAgICBjb25zdCBjYnMgPSB0aGlzLmltcGxlbWVudGF0aW9uTWFwcGVyLmZpbmRGdWxsZmlsbG1lbnRDYWxsYmFja0ZvckdvYWwoZ29hbCk7XG4gICAgICAgICAgICBsZXQgZyA9IGdvYWw7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGNiIG9mIGNicykge1xuICAgICAgICAgICAgICAgIGcgPSBhd2FpdCBjYi5jYWxsYmFjayhnLCB7IGlkLCBhZGRyZXNzQ2hhbm5lbHM6IHVuZGVmaW5lZCwgY3JlZGVudGlhbHMsIGNvbnRleHQgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB1cGRhdGVHb2FsKGNvbnRleHQsIGcsIHtcbiAgICAgICAgICAgICAgICBzdGF0ZTogXCJyZXF1ZXN0ZWRcIixcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogYFJlYWR5IHRvIGAgKyBnLm5hbWUsXG4gICAgICAgICAgICAgICAgZGF0YTogZy5kYXRhLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgcmV0dXJuIFN1Y2Nlc3M7XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gc3VtU2RtR29hbEV2ZW50c0J5T3ZlcnJpZGUoc29tZTogU2RtR29hbFtdLCBtb3JlOiBTZG1Hb2FsW10pOiBTZG1Hb2FsW10ge1xuICAgIC8vIEZvciBzb21lIHJlYXNvbiB0aGlzIHdvbid0IGNvbXBpbGUgd2l0aCB0aGUgb2J2aW91cyBmaXhcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tdW5uZWNlc3NhcnktY2FsbGJhY2std3JhcHBlclxuICAgIGNvbnN0IGJ5S2V5ID0gXy5ncm91cEJ5KHNvbWUuY29uY2F0KG1vcmUpLCBzZyA9PiBnb2FsS2V5U3RyaW5nKHNnKSk7XG4gICAgY29uc3Qgc3VtbWVkR29hbHMgPSBPYmplY3Qua2V5cyhieUtleSkubWFwKGsgPT4gc3VtRXZlbnRzRm9yT25lU2RtR29hbChieUtleVtrXSkpO1xuICAgIHJldHVybiBzdW1tZWRHb2Fscztcbn1cblxuZnVuY3Rpb24gc3VtRXZlbnRzRm9yT25lU2RtR29hbChldmVudHM6IFNkbUdvYWxbXSk6IFNkbUdvYWwge1xuICAgIGlmIChldmVudHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIHJldHVybiBldmVudHNbMF07XG4gICAgfVxuICAgIC8vIGhlcmUsIEkgY291bGQgZ2V0IGNsZXZlciBhbmQgc29ydCBieSB0aW1lc3RhbXAsIG9yIHNvbWVkYXkgYnVpbGQgYSBncmFwaCBpZiB0aGV5IGxpbmsgdG8gcHJpb3IgdmVyc2lvbnMsXG4gICAgLy8gb3IgZ2V0IHNtYXJ0IGFib3V0IHN0YXR1c2VzLiBMZXQgbWUgYmUgbGF6eS5cbiAgICBsb2dnZXIuZGVidWcoXCJGb3VuZCAlZCBldmVudHMgZm9yICVzLiBUYWtpbmcgdGhlIGxhc3Qgb25lLCB3aGljaCBoYXMgc3RhdGUgJXNcIiwgZXZlbnRzLmxlbmd0aCwgZ29hbEtleVN0cmluZyhldmVudHNbMF0pLFxuICAgICAgICBldmVudHNbZXZlbnRzLmxlbmd0aCAtIDFdLnN0YXRlKTtcbiAgICByZXR1cm4gZXZlbnRzW2V2ZW50cy5sZW5ndGggLSAxXTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZldGNoU2NtUHJvdmlkZXIoY29udGV4dDogSGFuZGxlckNvbnRleHQsIHByb3ZpZGVySWQ6IHN0cmluZyk6IFByb21pc2U8U2NtUHJvdmlkZXIuU2NtUHJvdmlkZXI+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250ZXh0LmdyYXBoQ2xpZW50LnF1ZXJ5PFNjbVByb3ZpZGVyLlF1ZXJ5LCBTY21Qcm92aWRlci5WYXJpYWJsZXM+KFxuICAgICAgICB7IG5hbWU6IFwiU0NNUHJvdmlkZXJcIiwgdmFyaWFibGVzOiB7IHByb3ZpZGVySWQgfSB9KTtcbiAgICBpZiAoIXJlc3VsdCB8fCAhcmVzdWx0LlNDTVByb3ZpZGVyIHx8IHJlc3VsdC5TQ01Qcm92aWRlci5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBQcm92aWRlciBub3QgZm91bmQ6ICR7cHJvdmlkZXJJZH1gKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdC5TQ01Qcm92aWRlclswXTtcbn1cblxuZnVuY3Rpb24gc2hvdWxkQmVQbGFubmVkT3JTa2lwcGVkKGRlcGVuZGVudEdvYWw6IFNkbUdvYWwpIHtcbiAgICBpZiAoZGVwZW5kZW50R29hbC5zdGF0ZSA9PT0gXCJwbGFubmVkXCIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChkZXBlbmRlbnRHb2FsLnN0YXRlID09PSBcInNraXBwZWRcIikge1xuICAgICAgICBsb2dnZXIuaW5mbyhcIkdvYWwgJXMgd2FzIHNraXBwZWQsIGJ1dCBub3cgbWF5YmUgaXQgY2FuIGdvXCIsIGRlcGVuZGVudEdvYWwubmFtZSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoZGVwZW5kZW50R29hbC5zdGF0ZSA9PT0gXCJmYWlsdXJlXCIgJiYgZGVwZW5kZW50R29hbC5yZXRyeUZlYXNpYmxlKSB7XG4gICAgICAgIGxvZ2dlci5pbmZvKFwiR29hbCAlcyBmYWlsZWQsIGJ1dCBtYXliZSB3ZSB3aWxsIHJldHJ5IGl0XCIsIGRlcGVuZGVudEdvYWwubmFtZSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBsb2dnZXIud2FybihcIkdvYWwgJXMgaW4gc3RhdGUgJXMgd2lsbCBub3QgYmUgcmVxdWVzdGVkXCIsIGRlcGVuZGVudEdvYWwubmFtZSwgZGVwZW5kZW50R29hbC5zdGF0ZSk7XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tdW51c2VkLXZhcmlhYmxlXG5mdW5jdGlvbiBleHBlY3RUb0JlRnVsZmlsbGVkQWZ0ZXJSZXF1ZXN0KGRlcGVuZGVudEdvYWw6IFNkbUdvYWwpIHtcbiAgICBzd2l0Y2ggKGRlcGVuZGVudEdvYWwuZnVsZmlsbG1lbnQubWV0aG9kKSB7XG4gICAgICAgIGNhc2UgXCJTRE0gZnVsZmlsbCBvbiByZXF1ZXN0ZWRcIjpcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICBjYXNlIFwic2lkZS1lZmZlY3RcIjpcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgY2FzZSBcIm90aGVyXCI6XG4gICAgICAgICAgICAvLyBsZWdhY3kgYmVoYXZpb3JcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gbWFwS2V5VG9Hb2FsPFQgZXh0ZW5kcyBTZG1Hb2FsS2V5Pihnb2FsczogVFtdKTogKFNkbUdvYWxLZXkpID0+IFQge1xuICAgIHJldHVybiAoa2V5VG9GaW5kOiBTZG1Hb2FsS2V5KSA9PiB7XG4gICAgICAgIGNvbnN0IGZvdW5kID0gZ29hbHMuZmluZChnID0+XG4gICAgICAgICAgICBnLmVudmlyb25tZW50ID09PSBrZXlUb0ZpbmQuZW52aXJvbm1lbnQgJiZcbiAgICAgICAgICAgIGcubmFtZSA9PT0ga2V5VG9GaW5kLm5hbWUpO1xuICAgICAgICByZXR1cm4gZm91bmQ7XG4gICAgfTtcbn1cblxuZnVuY3Rpb24gaXNEaXJlY3RseURlcGVuZGVudE9uKHN1Y2Nlc3NmdWxHb2FsOiBTZG1Hb2FsS2V5LCBnb2FsOiBTZG1Hb2FsKTogYm9vbGVhbiB7XG4gICAgaWYgKCFnb2FsKSB7XG4gICAgICAgIGxvZ2dlci53YXJuKFwiSW50ZXJuYWwgZXJyb3I6IFRyeWluZyB0byB3b3JrIG91dCBpZiAlaiBpcyBkZXBlbmRlbnQgb24gbnVsbCBvciB1bmRlZmluZWQgZ29hbFwiLCBzdWNjZXNzZnVsR29hbCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKCFnb2FsLnByZUNvbmRpdGlvbnMgfHwgZ29hbC5wcmVDb25kaXRpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7IC8vIG5vIHByZWNvbmRpdGlvbnM/IG5vdCBkZXBlbmRlbnRcbiAgICB9XG4gICAgaWYgKG1hcEtleVRvR29hbChnb2FsLnByZUNvbmRpdGlvbnMpKHN1Y2Nlc3NmdWxHb2FsKSkge1xuICAgICAgICBsb2dnZXIuZGVidWcoXCIlcyBkZXBlbmRzIG9uICVzXCIsIGdvYWwubmFtZSwgc3VjY2Vzc2Z1bEdvYWwubmFtZSk7XG4gICAgICAgIHJldHVybiB0cnVlOyAvLyB0aGUgZmFpbGVkIGdvYWwgaXMgb25lIG9mIG15IHByZWNvbmRpdGlvbnM/IGRlcGVuZGVudFxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG4iXX0=