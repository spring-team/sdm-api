"use strict";/*
 * Copyright Â© 2018 Atomist, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cov_15f9fwhjp5=function(){var path="/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/common/delivery/goals/summarizeGoalsInGitHubStatus.ts",hash="340b54b4b91ad94c0df2e9de61ef9bc253c9c0e4",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/rodjohnson/sforzando-dev/idea-projects/my-flow/src/common/delivery/goals/summarizeGoalsInGitHubStatus.ts",statementMap:{"0":{start:{line:17,column:16},end:{line:24,column:1}},"1":{start:{line:18,column:4},end:{line:23,column:7}},"2":{start:{line:19,column:36},end:{line:19,column:97}},"3":{start:{line:19,column:42},end:{line:19,column:70}},"4":{start:{line:19,column:85},end:{line:19,column:95}},"5":{start:{line:20,column:35},end:{line:20,column:100}},"6":{start:{line:20,column:41},end:{line:20,column:73}},"7":{start:{line:20,column:88},end:{line:20,column:98}},"8":{start:{line:21,column:32},end:{line:21,column:149}},"9":{start:{line:21,column:97},end:{line:21,column:119}},"10":{start:{line:22,column:8},end:{line:22,column:78}},"11":{start:{line:25,column:0},end:{line:25,column:62}},"12":{start:{line:26,column:28},end:{line:26,column:65}},"13":{start:{line:27,column:26},end:{line:27,column:71}},"14":{start:{line:28,column:15},end:{line:28,column:51}},"15":{start:{line:30,column:4},end:{line:38,column:7}},"16":{start:{line:30,column:20},end:{line:38,column:6}},"17":{start:{line:31,column:36},end:{line:31,column:39}},"18":{start:{line:32,column:8},end:{line:37,column:11}},"19":{start:{line:40,column:0},end:{line:40,column:80}},"20":{start:{line:42,column:4},end:{line:64,column:7}},"21":{start:{line:42,column:20},end:{line:64,column:6}},"22":{start:{line:43,column:61},end:{line:43,column:64}},"23":{start:{line:44,column:8},end:{line:44,column:174}},"24":{start:{line:45,column:8},end:{line:45,column:126}},"25":{start:{line:45,column:30},end:{line:45,column:124}},"26":{start:{line:46,column:8},end:{line:54,column:9}},"27":{start:{line:47,column:12},end:{line:47,column:94}},"28":{start:{line:48,column:12},end:{line:53,column:15}},"29":{start:{line:55,column:8},end:{line:63,column:9}},"30":{start:{line:56,column:12},end:{line:56,column:94}},"31":{start:{line:57,column:12},end:{line:62,column:15}},"32":{start:{line:66,column:0},end:{line:66,column:74}},"33":{start:{line:68,column:4},end:{line:68,column:91}},"34":{start:{line:68,column:23},end:{line:68,column:89}},"35":{start:{line:69,column:4},end:{line:69,column:51}},"36":{start:{line:69,column:28},end:{line:69,column:49}},"37":{start:{line:72,column:4},end:{line:85,column:5}},"38":{start:{line:76,column:12},end:{line:76,column:29}},"39":{start:{line:79,column:12},end:{line:79,column:29}},"40":{start:{line:82,column:12},end:{line:82,column:29}},"41":{start:{line:84,column:12},end:{line:84,column:63}},"42":{start:{line:87,column:0},end:{line:87,column:74}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:17,column:44},end:{line:17,column:45}},loc:{start:{line:17,column:89},end:{line:24,column:1}},line:17},"1":{name:"(anonymous_1)",decl:{start:{line:18,column:36},end:{line:18,column:37}},loc:{start:{line:18,column:63},end:{line:23,column:5}},line:18},"2":{name:"fulfilled",decl:{start:{line:19,column:17},end:{line:19,column:26}},loc:{start:{line:19,column:34},end:{line:19,column:99}},line:19},"3":{name:"rejected",decl:{start:{line:20,column:17},end:{line:20,column:25}},loc:{start:{line:20,column:33},end:{line:20,column:102}},line:20},"4":{name:"step",decl:{start:{line:21,column:17},end:{line:21,column:21}},loc:{start:{line:21,column:30},end:{line:21,column:151}},line:21},"5":{name:"(anonymous_5)",decl:{start:{line:21,column:76},end:{line:21,column:77}},loc:{start:{line:21,column:95},end:{line:21,column:121}},line:21},"6":{name:"CreatePendingGitHubStatusOnGoalSet",decl:{start:{line:29,column:9},end:{line:29,column:43}},loc:{start:{line:29,column:64},end:{line:39,column:1}},line:29},"7":{name:"(anonymous_7)",decl:{start:{line:30,column:11},end:{line:30,column:12}},loc:{start:{line:30,column:20},end:{line:38,column:6}},line:30},"8":{name:"(anonymous_8)",decl:{start:{line:30,column:52},end:{line:30,column:53}},loc:{start:{line:30,column:65},end:{line:38,column:5}},line:30},"9":{name:"SetGitHubStatusOnGoalCompletion",decl:{start:{line:41,column:9},end:{line:41,column:40}},loc:{start:{line:41,column:43},end:{line:65,column:1}},line:41},"10":{name:"(anonymous_10)",decl:{start:{line:42,column:11},end:{line:42,column:12}},loc:{start:{line:42,column:20},end:{line:64,column:6}},line:42},"11":{name:"(anonymous_11)",decl:{start:{line:42,column:52},end:{line:42,column:53}},loc:{start:{line:42,column:65},end:{line:64,column:5}},line:42},"12":{name:"(anonymous_12)",decl:{start:{line:45,column:25},end:{line:45,column:26}},loc:{start:{line:45,column:30},end:{line:45,column:124}},line:45},"13":{name:"allSuccessful",decl:{start:{line:67,column:9},end:{line:67,column:22}},loc:{start:{line:67,column:30},end:{line:70,column:1}},line:67},"14":{name:"(anonymous_14)",decl:{start:{line:68,column:18},end:{line:68,column:19}},loc:{start:{line:68,column:23},end:{line:68,column:89}},line:68},"15":{name:"(anonymous_15)",decl:{start:{line:69,column:23},end:{line:69,column:24}},loc:{start:{line:69,column:28},end:{line:69,column:49}},line:69},"16":{name:"sdmGoalStateToGitHubStatusState",decl:{start:{line:71,column:9},end:{line:71,column:40}},loc:{start:{line:71,column:52},end:{line:86,column:1}},line:71}},branchMap:{"0":{loc:{start:{line:17,column:16},end:{line:24,column:1}},type:"binary-expr",locations:[{start:{line:17,column:17},end:{line:17,column:21}},{start:{line:17,column:25},end:{line:17,column:39}},{start:{line:17,column:44},end:{line:24,column:1}}],line:17},"1":{loc:{start:{line:18,column:16},end:{line:18,column:34}},type:"binary-expr",locations:[{start:{line:18,column:16},end:{line:18,column:17}},{start:{line:18,column:22},end:{line:18,column:33}}],line:18},"2":{loc:{start:{line:21,column:32},end:{line:21,column:148}},type:"cond-expr",locations:[{start:{line:21,column:46},end:{line:21,column:67}},{start:{line:21,column:70},end:{line:21,column:148}}],line:21},"3":{loc:{start:{line:22,column:51},end:{line:22,column:67}},type:"binary-expr",locations:[{start:{line:22,column:51},end:{line:22,column:61}},{start:{line:22,column:65},end:{line:22,column:67}}],line:22},"4":{loc:{start:{line:46,column:8},end:{line:54,column:9}},type:"if",locations:[{start:{line:46,column:8},end:{line:54,column:9}},{start:{line:46,column:8},end:{line:54,column:9}}],line:46},"5":{loc:{start:{line:55,column:8},end:{line:63,column:9}},type:"if",locations:[{start:{line:55,column:8},end:{line:63,column:9}},{start:{line:55,column:8},end:{line:63,column:9}}],line:55},"6":{loc:{start:{line:72,column:4},end:{line:85,column:5}},type:"switch",locations:[{start:{line:73,column:8},end:{line:73,column:23}},{start:{line:74,column:8},end:{line:74,column:25}},{start:{line:75,column:8},end:{line:76,column:29}},{start:{line:77,column:8},end:{line:77,column:36}},{start:{line:78,column:8},end:{line:79,column:29}},{start:{line:80,column:8},end:{line:80,column:23}},{start:{line:81,column:8},end:{line:82,column:29}},{start:{line:83,column:8},end:{line:84,column:63}}],line:72}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},b:{"0":[0,0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0,0,0,0,0,0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var __awaiter=(cov_15f9fwhjp5.s[0]++,(cov_15f9fwhjp5.b[0][0]++,this)&&(cov_15f9fwhjp5.b[0][1]++,this.__awaiter)||(cov_15f9fwhjp5.b[0][2]++,function(thisArg,_arguments,P,generator){cov_15f9fwhjp5.f[0]++;cov_15f9fwhjp5.s[1]++;return new((cov_15f9fwhjp5.b[1][0]++,P)||(cov_15f9fwhjp5.b[1][1]++,P=Promise))(function(resolve,reject){cov_15f9fwhjp5.f[1]++;function fulfilled(value){cov_15f9fwhjp5.f[2]++;cov_15f9fwhjp5.s[2]++;try{cov_15f9fwhjp5.s[3]++;step(generator.next(value));}catch(e){cov_15f9fwhjp5.s[4]++;reject(e);}}function rejected(value){cov_15f9fwhjp5.f[3]++;cov_15f9fwhjp5.s[5]++;try{cov_15f9fwhjp5.s[6]++;step(generator["throw"](value));}catch(e){cov_15f9fwhjp5.s[7]++;reject(e);}}function step(result){cov_15f9fwhjp5.f[4]++;cov_15f9fwhjp5.s[8]++;result.done?(cov_15f9fwhjp5.b[2][0]++,resolve(result.value)):(cov_15f9fwhjp5.b[2][1]++,new P(function(resolve){cov_15f9fwhjp5.f[5]++;cov_15f9fwhjp5.s[9]++;resolve(result.value);}).then(fulfilled,rejected));}cov_15f9fwhjp5.s[10]++;step((generator=generator.apply(thisArg,(cov_15f9fwhjp5.b[3][0]++,_arguments)||(cov_15f9fwhjp5.b[3][1]++,[]))).next());});}));cov_15f9fwhjp5.s[11]++;Object.defineProperty(exports,"__esModule",{value:true});const automation_client_1=(cov_15f9fwhjp5.s[12]++,require("@atomist/automation-client"));const sdmGoalIngester_1=(cov_15f9fwhjp5.s[13]++,require("../../../ingesters/sdmGoalIngester"));const ghub_1=(cov_15f9fwhjp5.s[14]++,require("../../../util/github/ghub"));function CreatePendingGitHubStatusOnGoalSet(credentialsFactory){cov_15f9fwhjp5.f[6]++;cov_15f9fwhjp5.s[15]++;return inv=>{cov_15f9fwhjp5.f[7]++;cov_15f9fwhjp5.s[16]++;return __awaiter(this,void 0,void 0,function*(){cov_15f9fwhjp5.f[8]++;const{id,credentials}=(cov_15f9fwhjp5.s[17]++,inv);cov_15f9fwhjp5.s[18]++;return ghub_1.createStatus(credentials,id,{context:"sdm/atomist",description:"Atomist SDM Goals in progress",target_url:"https://app.atomist.com",state:"pending"});});};}cov_15f9fwhjp5.s[19]++;exports.CreatePendingGitHubStatusOnGoalSet=CreatePendingGitHubStatusOnGoalSet;function SetGitHubStatusOnGoalCompletion(){cov_15f9fwhjp5.f[9]++;cov_15f9fwhjp5.s[20]++;return inv=>{cov_15f9fwhjp5.f[10]++;cov_15f9fwhjp5.s[21]++;return __awaiter(this,void 0,void 0,function*(){cov_15f9fwhjp5.f[11]++;const{id,completedGoal,allGoals,credentials}=(cov_15f9fwhjp5.s[22]++,inv);cov_15f9fwhjp5.s[23]++;automation_client_1.logger.info("Completed goal: %s with %s in set %s",sdmGoalIngester_1.goalKeyString(completedGoal),completedGoal.state,completedGoal.goalSetId);cov_15f9fwhjp5.s[24]++;allGoals.forEach(g=>{cov_15f9fwhjp5.f[12]++;cov_15f9fwhjp5.s[25]++;return automation_client_1.logger.info(" goal %s is %s",sdmGoalIngester_1.goalKeyString(g),g.state);});cov_15f9fwhjp5.s[26]++;if(completedGoal.state==="failure"){cov_15f9fwhjp5.b[4][0]++;cov_15f9fwhjp5.s[27]++;automation_client_1.logger.info("Setting GitHub status to failed on %s"+id.sha);cov_15f9fwhjp5.s[28]++;return ghub_1.createStatus(credentials,id,{context:"sdm/atomist",description:`Atomist SDM Goals: ${completedGoal.description}`,target_url:"https://app.atomist.com",state:"failure"});}else{cov_15f9fwhjp5.b[4][1]++;}cov_15f9fwhjp5.s[29]++;if(allSuccessful(allGoals)){cov_15f9fwhjp5.b[5][0]++;cov_15f9fwhjp5.s[30]++;automation_client_1.logger.info("Setting GitHub status to success on %s",id.sha);cov_15f9fwhjp5.s[31]++;return ghub_1.createStatus(credentials,id,{context:"sdm/atomist",description:`Atomist SDM Goals: all succeeded`,target_url:"https://app.atomist.com",state:"success"});}else{cov_15f9fwhjp5.b[5][1]++;}});};}cov_15f9fwhjp5.s[32]++;exports.SetGitHubStatusOnGoalCompletion=SetGitHubStatusOnGoalCompletion;function allSuccessful(goals){cov_15f9fwhjp5.f[13]++;cov_15f9fwhjp5.s[33]++;goals.forEach(g=>{cov_15f9fwhjp5.f[14]++;cov_15f9fwhjp5.s[34]++;return automation_client_1.logger.debug("goal %s is %s",g.name,g.state);});cov_15f9fwhjp5.s[35]++;return!goals.some(g=>{cov_15f9fwhjp5.f[15]++;cov_15f9fwhjp5.s[36]++;return g.state!=="success";});}function sdmGoalStateToGitHubStatusState(goalState){cov_15f9fwhjp5.f[16]++;cov_15f9fwhjp5.s[37]++;switch(goalState){case"planned":cov_15f9fwhjp5.b[6][0]++;case"requested":cov_15f9fwhjp5.b[6][1]++;case"in_process":cov_15f9fwhjp5.b[6][2]++;cov_15f9fwhjp5.s[38]++;return"pending";case"waiting_for_approval":cov_15f9fwhjp5.b[6][3]++;case"success":cov_15f9fwhjp5.b[6][4]++;cov_15f9fwhjp5.s[39]++;return"success";case"failure":cov_15f9fwhjp5.b[6][5]++;case"skipped":cov_15f9fwhjp5.b[6][6]++;cov_15f9fwhjp5.s[40]++;return"failure";default:cov_15f9fwhjp5.b[6][7]++;cov_15f9fwhjp5.s[41]++;throw new Error("Unknown goal state "+goalState);}}cov_15f9fwhjp5.s[42]++;exports.sdmGoalStateToGitHubStatusState=sdmGoalStateToGitHubStatusState;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL3JvZGpvaG5zb24vc2ZvcnphbmRvLWRldi9pZGVhLXByb2plY3RzL215LWZsb3cvc3JjL2NvbW1vbi9kZWxpdmVyeS9nb2Fscy9zdW1tYXJpemVHb2Fsc0luR2l0SHViU3RhdHVzLnRzIiwic291cmNlcyI6WyIvVXNlcnMvcm9kam9obnNvbi9zZm9yemFuZG8tZGV2L2lkZWEtcHJvamVjdHMvbXktZmxvdy9zcmMvY29tbW9uL2RlbGl2ZXJ5L2dvYWxzL3N1bW1hcml6ZUdvYWxzSW5HaXRIdWJTdGF0dXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7Ozs7OztHQWNHOzs7Ozs7Ozs7O0FBRUgsa0VBQW9EO0FBSXBELHdFQUEwRjtBQUMxRixvREFBeUQ7QUFFekQsNENBQW1ELGtCQUF1QztJQUN0RixPQUFPLENBQU8sR0FBK0IsRUFBRSxFQUFFO1FBQzdDLE1BQU0sRUFBQyxFQUFFLEVBQUUsV0FBVyxFQUFDLEdBQUcsR0FBRyxDQUFDO1FBQzlCLE9BQU8sbUJBQVksQ0FBQyxXQUFXLEVBQUUsRUFBbUIsRUFBRTtZQUNsRCxPQUFPLEVBQUUsYUFBYTtZQUN0QixXQUFXLEVBQUUsK0JBQStCO1lBQzVDLFVBQVUsRUFBRSx5QkFBeUI7WUFDckMsS0FBSyxFQUFFLFNBQVM7U0FDbkIsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFBLENBQUM7QUFDTixDQUFDO0FBVkQsZ0ZBVUM7QUFFRDtJQUNJLE9BQU8sQ0FBTyxHQUFxQyxFQUFFLEVBQUU7UUFDbkQsTUFBTSxFQUFDLEVBQUUsRUFBRSxhQUFhLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBQyxHQUFHLEdBQUcsQ0FBQztRQUN2RCwwQkFBTSxDQUFDLElBQUksQ0FBQyxzQ0FBc0MsRUFBRSwrQkFBYSxDQUFDLGFBQWEsQ0FBQyxFQUFFLGFBQWEsQ0FBQyxLQUFLLEVBQUUsYUFBYSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ2hJLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQywwQkFBTSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSwrQkFBYSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBRWhGLElBQUksYUFBYSxDQUFDLEtBQUssS0FBSyxTQUFTLEVBQUU7WUFDbkMsMEJBQU0sQ0FBQyxJQUFJLENBQUMsdUNBQXVDLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzlELE9BQU8sbUJBQVksQ0FBQyxXQUFXLEVBQUUsRUFBbUIsRUFBRTtnQkFDbEQsT0FBTyxFQUFFLGFBQWE7Z0JBQ3RCLFdBQVcsRUFBRSxzQkFBc0IsYUFBYSxDQUFDLFdBQVcsRUFBRTtnQkFDOUQsVUFBVSxFQUFFLHlCQUF5QjtnQkFDckMsS0FBSyxFQUFFLFNBQVM7YUFDbkIsQ0FBQyxDQUFDO1NBQ047UUFDRCxJQUFJLGFBQWEsQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUN6QiwwQkFBTSxDQUFDLElBQUksQ0FBQyx3Q0FBd0MsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDOUQsT0FBTyxtQkFBWSxDQUFDLFdBQVcsRUFBRSxFQUFtQixFQUFFO2dCQUNsRCxPQUFPLEVBQUUsYUFBYTtnQkFDdEIsV0FBVyxFQUFFLGtDQUFrQztnQkFDL0MsVUFBVSxFQUFFLHlCQUF5QjtnQkFDckMsS0FBSyxFQUFFLFNBQVM7YUFDbkIsQ0FBQyxDQUFDO1NBQ047SUFDTCxDQUFDLENBQUEsQ0FBQztBQUNOLENBQUM7QUF6QkQsMEVBeUJDO0FBRUQsdUJBQXVCLEtBQWdCO0lBQ25DLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQywwQkFBTSxDQUFDLEtBQUssQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUNuRSxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLEtBQUssU0FBUyxDQUFDLENBQUM7QUFDbkQsQ0FBQztBQUVELHlDQUFnRCxTQUF1QjtJQUNuRSxRQUFRLFNBQVMsRUFBRTtRQUNmLEtBQUssU0FBUyxDQUFDO1FBQ2YsS0FBSyxXQUFXLENBQUM7UUFDakIsS0FBSyxZQUFZO1lBQ2IsT0FBTyxTQUF3QixDQUFDO1FBQ3BDLEtBQUssc0JBQXNCLENBQUM7UUFDNUIsS0FBSyxTQUFTO1lBQ1YsT0FBTyxTQUF3QixDQUFDO1FBQ3BDLEtBQUssU0FBUyxDQUFDO1FBQ2YsS0FBSyxTQUFTO1lBQ1YsT0FBTyxTQUF3QixDQUFDO1FBQ3BDO1lBQ0ksTUFBTSxJQUFJLEtBQUssQ0FBQyxxQkFBcUIsR0FBRyxTQUFTLENBQUMsQ0FBQztLQUMxRDtBQUNMLENBQUM7QUFmRCwwRUFlQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgwqkgMjAxOCBBdG9taXN0LCBJbmMuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gXCJAYXRvbWlzdC9hdXRvbWF0aW9uLWNsaWVudFwiO1xuaW1wb3J0IHsgR2l0SHViUmVwb1JlZiB9IGZyb20gXCJAYXRvbWlzdC9hdXRvbWF0aW9uLWNsaWVudC9vcGVyYXRpb25zL2NvbW1vbi9HaXRIdWJSZXBvUmVmXCI7XG5pbXBvcnQgeyBHb2FsQ29tcGxldGlvbkxpc3RlbmVyLCBHb2FsQ29tcGxldGlvbkxpc3RlbmVySW52b2NhdGlvbiwgR29hbHNTZXRMaXN0ZW5lciwgR29hbHNTZXRMaXN0ZW5lckludm9jYXRpb24sIFN0YXR1c1N0YXRlIH0gZnJvbSBcIi4uLy4uLy4uXCI7XG5pbXBvcnQgeyBDcmVkZW50aWFsc1Jlc29sdmVyIH0gZnJvbSBcIi4uLy4uLy4uL2hhbmRsZXJzL2NvbW1vbi9DcmVkZW50aWFsc1Jlc29sdmVyXCI7XG5pbXBvcnQgeyBnb2FsS2V5U3RyaW5nLCBTZG1Hb2FsLCBTZG1Hb2FsU3RhdGUgfSBmcm9tIFwiLi4vLi4vLi4vaW5nZXN0ZXJzL3NkbUdvYWxJbmdlc3RlclwiO1xuaW1wb3J0IHsgY3JlYXRlU3RhdHVzIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWwvZ2l0aHViL2dodWJcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIENyZWF0ZVBlbmRpbmdHaXRIdWJTdGF0dXNPbkdvYWxTZXQoY3JlZGVudGlhbHNGYWN0b3J5OiBDcmVkZW50aWFsc1Jlc29sdmVyKTogR29hbHNTZXRMaXN0ZW5lciB7XG4gICAgcmV0dXJuIGFzeW5jIChpbnY6IEdvYWxzU2V0TGlzdGVuZXJJbnZvY2F0aW9uKSA9PiB7XG4gICAgICAgIGNvbnN0IHtpZCwgY3JlZGVudGlhbHN9ID0gaW52O1xuICAgICAgICByZXR1cm4gY3JlYXRlU3RhdHVzKGNyZWRlbnRpYWxzLCBpZCBhcyBHaXRIdWJSZXBvUmVmLCB7XG4gICAgICAgICAgICBjb250ZXh0OiBcInNkbS9hdG9taXN0XCIsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJBdG9taXN0IFNETSBHb2FscyBpbiBwcm9ncmVzc1wiLFxuICAgICAgICAgICAgdGFyZ2V0X3VybDogXCJodHRwczovL2FwcC5hdG9taXN0LmNvbVwiLCAvLyBUT0RPOiBkZWVwIGxpbmshXG4gICAgICAgICAgICBzdGF0ZTogXCJwZW5kaW5nXCIsXG4gICAgICAgIH0pO1xuICAgIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBTZXRHaXRIdWJTdGF0dXNPbkdvYWxDb21wbGV0aW9uKCk6IEdvYWxDb21wbGV0aW9uTGlzdGVuZXIge1xuICAgIHJldHVybiBhc3luYyAoaW52OiBHb2FsQ29tcGxldGlvbkxpc3RlbmVySW52b2NhdGlvbikgPT4ge1xuICAgICAgICBjb25zdCB7aWQsIGNvbXBsZXRlZEdvYWwsIGFsbEdvYWxzLCBjcmVkZW50aWFsc30gPSBpbnY7XG4gICAgICAgIGxvZ2dlci5pbmZvKFwiQ29tcGxldGVkIGdvYWw6ICVzIHdpdGggJXMgaW4gc2V0ICVzXCIsIGdvYWxLZXlTdHJpbmcoY29tcGxldGVkR29hbCksIGNvbXBsZXRlZEdvYWwuc3RhdGUsIGNvbXBsZXRlZEdvYWwuZ29hbFNldElkKTtcbiAgICAgICAgYWxsR29hbHMuZm9yRWFjaChnID0+IGxvZ2dlci5pbmZvKFwiIGdvYWwgJXMgaXMgJXNcIiwgZ29hbEtleVN0cmluZyhnKSwgZy5zdGF0ZSkpO1xuXG4gICAgICAgIGlmIChjb21wbGV0ZWRHb2FsLnN0YXRlID09PSBcImZhaWx1cmVcIikge1xuICAgICAgICAgICAgbG9nZ2VyLmluZm8oXCJTZXR0aW5nIEdpdEh1YiBzdGF0dXMgdG8gZmFpbGVkIG9uICVzXCIgKyBpZC5zaGEpO1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVN0YXR1cyhjcmVkZW50aWFscywgaWQgYXMgR2l0SHViUmVwb1JlZiwge1xuICAgICAgICAgICAgICAgIGNvbnRleHQ6IFwic2RtL2F0b21pc3RcIixcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogYEF0b21pc3QgU0RNIEdvYWxzOiAke2NvbXBsZXRlZEdvYWwuZGVzY3JpcHRpb259YCxcbiAgICAgICAgICAgICAgICB0YXJnZXRfdXJsOiBcImh0dHBzOi8vYXBwLmF0b21pc3QuY29tXCIsIC8vIFRPRE86IGRlZXAgbGluayFcbiAgICAgICAgICAgICAgICBzdGF0ZTogXCJmYWlsdXJlXCIsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWxsU3VjY2Vzc2Z1bChhbGxHb2FscykpIHtcbiAgICAgICAgICAgIGxvZ2dlci5pbmZvKFwiU2V0dGluZyBHaXRIdWIgc3RhdHVzIHRvIHN1Y2Nlc3Mgb24gJXNcIiwgaWQuc2hhKTtcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVTdGF0dXMoY3JlZGVudGlhbHMsIGlkIGFzIEdpdEh1YlJlcG9SZWYsIHtcbiAgICAgICAgICAgICAgICBjb250ZXh0OiBcInNkbS9hdG9taXN0XCIsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGBBdG9taXN0IFNETSBHb2FsczogYWxsIHN1Y2NlZWRlZGAsXG4gICAgICAgICAgICAgICAgdGFyZ2V0X3VybDogXCJodHRwczovL2FwcC5hdG9taXN0LmNvbVwiLCAvLyBUT0RPOiBkZWVwIGxpbmshXG4gICAgICAgICAgICAgICAgc3RhdGU6IFwic3VjY2Vzc1wiLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xufVxuXG5mdW5jdGlvbiBhbGxTdWNjZXNzZnVsKGdvYWxzOiBTZG1Hb2FsW10pOiBib29sZWFuIHtcbiAgICBnb2Fscy5mb3JFYWNoKGcgPT4gbG9nZ2VyLmRlYnVnKFwiZ29hbCAlcyBpcyAlc1wiLCBnLm5hbWUsIGcuc3RhdGUpKTtcbiAgICByZXR1cm4gIWdvYWxzLnNvbWUoZyA9PiBnLnN0YXRlICE9PSBcInN1Y2Nlc3NcIik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZG1Hb2FsU3RhdGVUb0dpdEh1YlN0YXR1c1N0YXRlKGdvYWxTdGF0ZTogU2RtR29hbFN0YXRlKTogU3RhdHVzU3RhdGUge1xuICAgIHN3aXRjaCAoZ29hbFN0YXRlKSB7XG4gICAgICAgIGNhc2UgXCJwbGFubmVkXCI6XG4gICAgICAgIGNhc2UgXCJyZXF1ZXN0ZWRcIjpcbiAgICAgICAgY2FzZSBcImluX3Byb2Nlc3NcIjpcbiAgICAgICAgICAgIHJldHVybiBcInBlbmRpbmdcIiBhcyBTdGF0dXNTdGF0ZTtcbiAgICAgICAgY2FzZSBcIndhaXRpbmdfZm9yX2FwcHJvdmFsXCI6XG4gICAgICAgIGNhc2UgXCJzdWNjZXNzXCI6XG4gICAgICAgICAgICByZXR1cm4gXCJzdWNjZXNzXCIgYXMgU3RhdHVzU3RhdGU7XG4gICAgICAgIGNhc2UgXCJmYWlsdXJlXCI6XG4gICAgICAgIGNhc2UgXCJza2lwcGVkXCI6XG4gICAgICAgICAgICByZXR1cm4gXCJmYWlsdXJlXCIgYXMgU3RhdHVzU3RhdGU7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmtub3duIGdvYWwgc3RhdGUgXCIgKyBnb2FsU3RhdGUpO1xuICAgIH1cbn1cbiJdfQ==